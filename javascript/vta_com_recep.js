var bolSoyMainOdc=false;var strNomMainOdc=false;var strNomFormViewOdc="";var strKeyViewOdc="";var strTipoVtaViewOdc="";var strNomOrderViewOdc="";var bolCompRecepdeMas=false;var bolCambioFechaInvRecep=false;var bolCambioCantidad=false;var bolVerCostosRecep=false;var bolSurteMasivo=false;var bolModificaCantidad=false;var bolConfirmaCajas=false;var lastselRecep=0;function vta_com_recep(){}function InitRecepODC(){document.getElementById("btn1").parentNode.setAttribute("class","Oculto");strNomMainOdc=objMap.getNomMain();if(strNomMainOdc=="COMP_RECEP"){bolSoyMainOdc=true;}if(bolSoyMainOdc){myLayout.close("west");myLayout.close("east");myLayout.close("south");myLayout.close("north");}document.getElementById("VIEW_SURTIDA2").checked=true;ActivaButtonsRecepOdc(false,false);$("#tabsCOMP_RECEP").tabs("disable",1);$("#dialogWait").dialog("open");$.ajax({type:"POST",data:"keys=168,69,171,275,440,439",scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"xml",url:"Acceso.do",success:function(datos){var objsc=datos.getElementsByTagName("Access")[0];var lstKeys=objsc.getElementsByTagName("key");for(i=0;i<lstKeys.length;i++){var obj=lstKeys[i];if(obj.getAttribute("id")==168&&obj.getAttribute("enabled")=="true"){bolCompRecepdeMas=true;}if(obj.getAttribute("id")==69&&obj.getAttribute("enabled")=="true"){bolCambioFechaInvRecep=true;}if(obj.getAttribute("id")==171&&obj.getAttribute("enabled")=="true"){bolCambioCantidad=true;}if(obj.getAttribute("id")==275&&obj.getAttribute("enabled")=="true"){bolVerCostosRecep=true;}if(obj.getAttribute("id")==439&&obj.getAttribute("enabled")=="true"){bolSurteMasivo=true;}if(obj.getAttribute("id")==440&&obj.getAttribute("enabled")=="true"){bolModificaCantidad=true;}}if(bolCambioFechaInvRecep){if($("#COM_FECHA").datepicker("isDisabled")){$("#COM_FECHA").datepicker("enable");}var objFecha=document.getElementById("COM_FECHA");objFecha.setAttribute("class","outEdit");objFecha.setAttribute("className","outEdit");objFecha.readOnly=false;}else{$("#COM_FECHA").datepicker("disable");}if(!bolCambioCantidad){document.getElementById("COM_CANT").readOnly=true;document.getElementById("COM_CANT").readonly=true;document.getElementById("COM_CANT").setAttribute("class","READONLY");document.getElementById("COM_CANT").setAttribute("className","READONLY");}if(!bolSurteMasivo){document.getElementById("btn_RecAll1").style.display="none";}var strHtml="<ul>"+getMenuItem("CallbtnCompRecep1();","Guardar Recepcion","images/ptovta/CircleSave.png");if(bolModificaCantidad){strHtml+=getMenuItem("CallbtnCompRecep3();","Editar cantidad","images/ptovta/VisQty.png");}strHtml+=getMenuItem("CallbtnCompRecep2();","Salir","images/ptovta/exitBig.png")+"</ul>";document.getElementById("TOOLBARCOM").innerHTML=strHtml;$("#dialogWait").dialog("close");setTimeout("ViewDoOdcRecep();",3000);},error:function(objeto,quepaso,otroobj){alert(":Compras recepcion:"+objeto+" "+quepaso+" "+otroobj);}});document.getElementById("btnSI").onclick=function(){ConfirmaSISurteMercaODC1();};document.getElementById("btnNO").onclick=function(){ConfirmaSISurteMercaODC2();};}function ConfirmaSISurteMercaODC1(){if(d.getElementById("Operac").value=="CHANGE_QTY"){CambioQtySurteMercaODC();}$("#SioNO").dialog("close");}function ConfirmaSISurteMercaODC2(){$("#SioNO").dialog("close");}function CambioQtySurteMercaODC(){var grid=jQuery("#COM_GRID");var id=grid.getGridParam("selrow");if(id!=null){var dblNvoQty=document.getElementById("_NvoQty").value;var lstRow=grid.getRowData(id);lstRow.COMD_RECIBIDO=dblNvoQty;grid.setRowData(id,lstRow);SetSumODCRecep();}}function OpnDiagProvCompReg(){OpnOpt("PROVEEDOR","grid","dialogProv",false,false);}function ViewDoOdcRecep(){bolSoyMainOdc=false;strNomMainOdc=objMap.getNomMain();if(strNomMainOdc=="COMP_RECEP"){bolSoyMainOdc=true;}var bolPasa=true;if(bolPasa){ActivaButtonsRecepOdc(true,true);var strPrefijoMasterOdc="COM";strNomOrderViewOdc="COM_ID";strNomFormViewOdc="COMRECEPDO";strKeyViewOdc="COM_ID";var strParams="&"+strPrefijoMasterOdc+"_ANULADO=999";strParams+="&"+strPrefijoMasterOdc+"_ESRECU=999";var strFecha1=document.getElementById("VIEWC_FECHA1").value;var strFecha2=document.getElementById("VIEWC_FECHA2").value;var strId=document.getElementById("VIEWC_ID").value;if(strId!="0"&&strId!=""){strParams+="&"+strKeyViewOdc+"="+strId+"";}else{if(strFecha1!=""&&strFecha2!=""){strParams+="&"+strPrefijoMasterOdc+"_FECHA1="+strFecha1+"&"+strPrefijoMasterOdc+"_FECHA2="+strFecha2+"";}if(document.getElementById("VIEWC_SUCURSAL").value!="0"){strParams+="&SC_ID="+document.getElementById("VIEWC_SUCURSAL").value+"";}if(document.getElementById("VIEWC_PV_ID").value!="0"){strParams+="&PV_ID="+document.getElementById("VIEWC_PV_ID").value+"";}if(document.getElementById("VIEWC_FOLIO").value!=""){strParams+="&"+strPrefijoMasterOdc+"_FOLIO="+document.getElementById("VIEWC_FOLIO").value+"";}if(document.getElementById("VIEWC_EMP").value!="0"){strParams+="&EMP_ID="+document.getElementById("VIEWC_EMP").value+"";}if(document.getElementById("VIEW_SURTIDA1").checked){strParams+="&COM_SURTIDA=1";}else{strParams+="&COM_SURTIDA=0";}}var grid=jQuery("#VIEWC_GRID1");grid.setGridParam({url:"CIP_TablaOp.jsp?ID=5&opnOpt="+strNomFormViewOdc+"&_search=true"+strParams});grid.setGridParam({sortname:strNomOrderViewOdc}).trigger("reloadGrid");}}function resetGridViewRecepOdc(){var grid=jQuery("#VIEW_GRID1");grid.clearGridData();}function ActivaButtonsRecepOdc(bolRecep,bolPrint){if(bolRecep){document.getElementById("bt_RepODCV1").style.display="none";}else{document.getElementById("bt_RepODCV1").style.display="none";}if(bolPrint){document.getElementById("bt_RepODCV2").style.display="block";}else{document.getElementById("bt_RepODCV2").style.display="none";}}function RecepOdcPrint(){var grid=jQuery("#VIEWC_GRID1");if(grid.getGridParam("selrow")!=null){var lstRow=grid.getRowData(grid.getGridParam("selrow"));var strHtml=CreaHidden("COM_ID",lstRow.COM_ID);openFormat("COMRECEPDO","PDF",strHtml);}}function RecepOdc(){$("#dialogWait").dialog("open");var grid=jQuery("#VIEWC_GRID1");if(grid.getGridParam("selrow")!=null){var grid2=jQuery("#COM_GRID");grid2.clearGridData();$.ajax({type:"POST",data:"COM_ID="+grid.getGridParam("selrow"),scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"xml",url:"ODCMov.do?id=8",success:function(datos){var objCompra=datos.getElementsByTagName("vta_compra")[0];var lstdeta=objCompra.getElementsByTagName("deta");$("#dialogWait").dialog("close");if(objCompra.getAttribute("COM_ANULADA")==0){if(objCompra.getAttribute("COM_AUTORIZA")==1){$("#tabsCOMP_RECEP").tabs("enable",1);$("#tabsCOMP_RECEP").tabs("option","active",1);DrawODCRecep(objCompra,lstdeta);$("#dialogView").dialog("close");}else{alert(lstMsg[69]);}}else{alert(lstMsg[70]);}},error:function(objeto,quepaso,otroobj){alert(":com recep1:"+objeto+" "+quepaso+" "+otroobj);$("#dialogWait").dialog("close");}});}}function DrawODCRecep(objCompra,lstdeta){$("#dialogWait").dialog("open");document.getElementById("COM_ID").value=objCompra.getAttribute("COM_ID");document.getElementById("COM_FOLIO").value=objCompra.getAttribute("TOD_ID");document.getElementById("SC_ID").value=objCompra.getAttribute("SC_ID");document.getElementById("COM_FOLIO").value=objCompra.getAttribute("COM_FOLIO");document.getElementById("COM_OPER").value=strUserName;document.getElementById("COM_CANT").value="1";document.getElementById("COM_PROD").value="";ObtenNomProvODCRecep(objCompra,lstdeta,true);}function ObtenNomProvODCRecep(objODC,lstdeta,bolPasaODC){var intPv=objODC.getAttribute("PV_ID");if(bolPasaODC==undefined){bolPasaODC=false;}ValidaClean("COM_PROV");$.ajax({type:"POST",data:"PV_ID="+intPv,scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"xml",url:"CXPMov.do?id=9",success:function(datoVal){var objPov=datoVal.getElementsByTagName("vta_proveedores")[0];if(objPov.getAttribute("PV_ID")==0){document.getElementById("COM_PROV").value="***************";
alert("EL proveedor no existe");}else{document.getElementById("COM_PROV").value=objPov.getAttribute("PV_RAZONSOCIAL");}if(bolPasaODC){DrawODCDetaRecep(objODC,lstdeta);}},error:function(objeto,quepaso,otroobj){document.getElementById("PV_NOM").value="***************";alert("ODC prov1:"+objeto+" "+quepaso+" "+otroobj);}});}function DrawODCDetaRecep(objPedido,lstdeta){for(i=0;i<lstdeta.length;i++){var obj=lstdeta[i];var dblCantidadXSurtir=obj.getAttribute("COMD_CANTIDAD")-obj.getAttribute("COMD_CANTIDADSURTIDA");if(dblCantidadXSurtir<0){dblCantidadXSurtir=0;}if(dblCantidadXSurtir>0){var datarow={COMD_ID:obj.getAttribute("COMD_ID"),COMD_CVE:obj.getAttribute("COMD_CVE"),COMD_DESCRIPCION:obj.getAttribute("COMD_DESCRIPCION"),COMD_CANTIDAD:dblCantidadXSurtir,COMD_RECIBIDO:0,COMD_COSTO:obj.getAttribute("COMD_COSTO"),COMD_NOTAS:obj.getAttribute("COMD_NOTAS"),COMD_PR_ID:obj.getAttribute("PR_ID"),COMD_FACTOR:0,COMD_USA_SERIE:0,COMD_SERIES:""};jQuery("#COM_GRID").addRowData(obj.getAttribute("COMD_ID"),datarow,"last");}}LoadConversionUnit();}function LoadConversionUnit(){var grid=jQuery("#COM_GRID");var arr=grid.getDataIDs();var strLstIds="";for(var i=0;i<arr.length;i++){var id=arr[i];var lstRow=grid.getRowData(id);strLstIds+=lstRow.COMD_PR_ID+",";}$.ajax({type:"POST",data:"lstIds="+strLstIds,scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"xml",url:"ODCMov.do?id=13",success:function(datos){var objCompra=datos.getElementsByTagName("conv_unidad")[0];var lstdeta=objCompra.getElementsByTagName("unidad");for(y=0;y<lstdeta.length;y++){var obj=lstdeta[y];for(var i=0;i<arr.length;i++){var id=arr[i];var lstRow=grid.getRowData(id);if(parseInt(lstRow.COMD_PR_ID)==parseInt(obj.getAttribute("PR_ID"))){lstRow.COMD_FACTOR=parseFloat(obj.getAttribute("FACTOR"));grid.setRowData(id,lstRow);}}}RecepExisteNumSerie();},error:function(objeto,quepaso,otroobj){alert(":com recep4:"+objeto+" "+quepaso+" "+otroobj);$("#dialogWait").dialog("close");}});}function CallbtnCompRecep1(){SaveODCRecep();}function CallbtnCompRecep2(){var dblTot=parseFloat(d.getElementById("COM_TOT").value);var bolSalir=true;if(dblTot>0){bolSalir=confirm(lstMsg[119]);}if(bolSalir){$("#tabsCOMP_RECEP").tabs("option","active",0);$("#tabsCOMP_RECEP").tabs("disable",1);}}function CallbtnCompRecep3(){var grid=jQuery("#COM_GRID");if(grid.getGridParam("selrow")!=null){var lstRow=grid.getRowData(grid.getGridParam("selrow"));document.getElementById("Operac").value="CHANGE_QTY";$("#SioNO").dialog("option","title",lstMsg[79]);var div=document.getElementById("SioNO_inside");var strHtml=CreaTexto(lstMsg[8],"_NvoQty",lstRow.COMD_RECIBIDO,10,10,true,false,"","left",0,"","","",false,1);div.innerHTML=strHtml;$("#SioNO").dialog("open");}}function AddItemEvtODCRecep(event,obj){if(event.keyCode==13){AddItemODCRecep();}}function AddItemODCRecep(){var strCod=UCase(d.getElementById("COM_PROD").value);var strCant=UCase(d.getElementById("COM_CANT").value);var strFechCad=UCase(d.getElementById("COM_FECHACAD").value);var intCant=0;var grid=jQuery("#COM_GRID");try{intCant=parseFloat(strCant);}catch(err){}if(trim(strCod)!=""){if(strPrefCodBar!=""){strCod=strCod.replace(strPrefCodBar,"");}$("#dialogWait").dialog("open");var bolEncontro=false;var idProd=0;var idProdLast=0;var arr=grid.getDataIDs();for(var i=0;i<arr.length;i++){var id=arr[i];var lstRowAct=grid.getRowData(id);if(lstRowAct.COMD_CVE==strCod){var dblDiff=parseFloat(lstRowAct.COMD_CANTIDAD)-(parseFloat(lstRowAct.COMD_RECIBIDO)+parseFloat(intCant));bolEncontro=true;idProdLast=id;if(dblDiff>=0){idProd=id;break;}}}if(bolEncontro){var idUpdate=0;if(idProd==0){alert(lstMsg[83]);if(bolCompRecepdeMas){var boolResp=confirm(lstMsg[84]);if(boolResp){idUpdate=idProdLast;}}}else{idUpdate=idProd;}if(idUpdate!=0){var lstRowUpdate=grid.getRowData(idUpdate);if(lstRowUpdate.COMD_USA_SERIE==1){DrawCapturaSerie(lstRowUpdate.COMD_CVE,lstRowUpdate.COMD_DESCRIPCION,intCant,idUpdate);}else{lstRowUpdate.COMD_RECIBIDO=parseFloat(lstRowUpdate.COMD_RECIBIDO)+intCant;lstRowUpdate.COMD_CADFECHA=strFechCad;grid.setRowData(idUpdate,lstRowUpdate);d.getElementById("COM_PROD").value="";d.getElementById("COM_CANT").value="1";SetSumODCRecep();d.getElementById("COM_PROD").focus();}}}else{alert(lstMsg[81]);d.getElementById("COM_PROD").focus();}$("#dialogWait").dialog("close");}else{alert(lstMsg[82]);d.getElementById("COM_PROD").focus();}}function SetSumODCRecep(){var grid=jQuery("#COM_GRID");var arr=grid.getDataIDs();var dblSuma=0;var dblSumaEsperado=0;for(var i=0;i<arr.length;i++){var id=arr[i];var lstRow=grid.getRowData(id);dblSuma+=parseFloat(lstRow.COMD_RECIBIDO);dblSumaEsperado+=parseFloat(lstRow.COMD_CANTIDAD);}d.getElementById("COM_TOT").value=dblSuma;if(dblSuma>=dblSumaEsperado){alert(lstMsg[118]);}}function dblClickODCRecep(id){RecepOdc();}function SaveODCRecep(){var dblTot=parseFloat(d.getElementById("COM_TOT").value);if(dblTot>0){var bolGuardar_=false;bolGuardar_=confirm(lstMsg[120]);if(bolGuardar_){SaveODCRecepDo();}}else{alert(lstMsg[85]);}}function SaveODCRecepDo(){$("#dialogWait").dialog("open");var strPOST="";strPOST+="COM_ID="+d.getElementById("COM_ID").value;strPOST+="&COM_FECHA="+d.getElementById("COM_FECHA").value;var grid=jQuery("#COM_GRID");var arr=grid.getDataIDs();var intC=0;for(var i=0;i<arr.length;i++){var id=arr[i];var lstRow=grid.getRowData(id);intC++;strPOST+="&COMD_ID"+intC+"="+lstRow.COMD_ID;strPOST+="&PR_ID"+intC+"="+lstRow.COMD_PR_ID;strPOST+="&COMD_CVE"+intC+"="+lstRow.COMD_CVE;strPOST+="&COMD_COSTO"+intC+"="+lstRow.COMD_COSTO;strPOST+="&COMD_CANTIDADSURTIDA"+intC+"="+lstRow.COMD_RECIBIDO;strPOST+="&COMD_FACTOR"+intC+"="+lstRow.COMD_FACTOR;strPOST+="&COMD_SERIES"+intC+"="+lstRow.COMD_SERIES;strPOST+="&COMD_USASERIE"+intC+"="+lstRow.COMD_USA_SERIE;strPOST+="&COMD_FECHACAD"+intC+"="+lstRow.COMD_CADFECHA;}strPOST+="&COUNT_ITEM="+intC;$.ajax({type:"POST",data:encodeURI(strPOST),scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"html",url:"ODCMov.do?id=10",success:function(dato){dato=trim(dato);if(Left(dato,3)=="OK."){d.getElementById("COM_TOT").value="0";CallbtnCompRecep2();jQuery("#VIEWC_GRID1").trigger("reloadGrid");var strHtml2=CreaHidden("MP_ID",dato.replace("OK.",""));$("#SioNO").dialog("open");$("#SioNO").dialog("option","title","¿Desea Imprimir Etiqueta?");document.getElementById("btnSI").onclick=function(){openFormat("COMRECEPDO","PDF",strHtml2,document.getElementById("COM_FOLIO").value);DoEtiqueta(dato.replace("OK.",""));$("#SioNO").dialog("close");};document.getElementById("btnNO").onclick=function(){openFormat("COMRECEPDO","PDF",strHtml2,document.getElementById("COM_FOLIO").value);$("#SioNO").dialog("close");};}else{alert(dato);}$("#dialogWait").dialog("close");},error:function(objeto,quepaso,otroobj){alert(":ODC Recep Save:"+objeto+" "+quepaso+" "+otroobj);$("#dialogWait").dialog("close");}});}function DoEtiqueta(intMP_ID){var strPost="";strPost+="&intEMP_ID="+document.getElementById("VIEWC_EMP").value;strPost+="&intSC_ID="+document.getElementById("SC_ID").value;strPost+="&intMP_ID="+intMP_ID;$.ajax({type:"POST",data:strPost,scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"xml",url:"ERP_com_recep.jsp?id=8",success:function(datos){$("#SioNO").dialog("open");$("#SioNO").dialog("option","title","¿Desea Imprimir PDF?");document.getElementById("btnSI").onclick=function(){var objsc=datos.getElementsByTagName("etiquetas")[0];if(objsc!=null){var lstProds=objsc.getElementsByTagName("etiquetas_deta");for(var i=0;i<lstProds.length;i++){var obj=lstProds[i];var IntIdRepo=obj.getAttribute("ET_REP_ODC");Abrir_Link("JasperReport?REP_ID="+IntIdRepo+"&boton_1=PDF&EMP_ID="+document.getElementById("VIEWC_EMP").value+"&SC_ID="+document.getElementById("VIEWC_SUCURSAL").value+"&MP_ID="+intMP_ID,"_reporte"+IntIdRepo,500,600,0,0);}}else{alert("El no existe");$("#dialogWait").dialog("close");}$("#SioNO").dialog("close");};document.getElementById("btnNO").onclick=function(){var objsc=datos.getElementsByTagName("etiquetas")[0];
if(objsc!=null){var lstProds=objsc.getElementsByTagName("etiquetas_deta");for(var i=0;i<lstProds.length;i++){var obj=lstProds[i];var strPost="";strPost+="&EMP_ID="+document.getElementById("VIEWC_EMP").value;strPost+="&SC_ID="+document.getElementById("VIEWC_SUCURSAL").value;strPost+="&MP_ID="+intMP_ID;strPost+="&ET_ID="+obj.getAttribute("ET_ID");Abrir_Link("ERP_com_recep.jsp?id=6"+strPost,"_new"+i,200,200,0,0);$("#dialogProv").dialog("close");}}else{alert("El no existe");$("#dialogWait").dialog("close");}$("#SioNO").dialog("close");};},error:function(){}});}function RecepOdcExit(){myLayout.open("west");myLayout.open("east");myLayout.open("south");myLayout.open("north");document.getElementById("MainPanel").innerHTML="";var objMainFacPedi=objMap.getScreen("COMP_RECEP");objMainFacPedi.bolActivo=false;objMainFacPedi.bolMain=false;objMainFacPedi.bolInit=false;objMainFacPedi.idOperAct=0;}function EvalItemEvtODCRecep(event,obj){if(event.keyCode==13){EvalitemODCRecep();}}function EvalitemODCRecep(){$("#dialogWait").dialog("open");var strCod=UCase(d.getElementById("COM_PROD").value);if(strPrefCodBar!=""){strCod=strCod.replace(strPrefCodBar,"");}$.ajax({type:"POST",data:"PR_CODIGO="+strCod+"&SC_ID="+d.getElementById("SC_ID").value,scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"xml",url:"VtasMov.do?id=5",success:function(datoVal){var objProd=datoVal.getElementsByTagName("vta_productos")[0];var Pr_Id=0;if(objProd!=undefined){Pr_Id=objProd.getAttribute("PR_ID");d.getElementById("COM_DESC").value=objProd.getAttribute("PR_DESCRIPCIONCOMPRA");d.getElementById("COM_PROD").value=objProd.getAttribute("PR_CODIGO");}if(Pr_Id==0){alert(lstMsg[0]);document.getElementById("COM_PROD").focus();}else{AddItemODCRecep();}$("#dialogWait").dialog("close");},error:function(objeto,quepaso,otroobj){alert(":Recepcion Compras{Eval Prod}:"+objeto+" "+quepaso+" "+otroobj);$("#dialogWait").dialog("close");}});}function DrawCapturaSerie(strCodigo,strDescripcion,intCantidad,idUpdate){$("#dialogInv").dialog("open");$("#dialogInv").dialog("option","title",lstMsg[107]+" - "+strCodigo+" "+strDescripcion);document.getElementById("dialogInv_inside").innerHTML="";var strHTML="<table border=0 cellpadding=0>";strHTML+="<tr>";strHTML+="<td colspan=2>"+lstMsg[110]+"</td>";strHTML+="</tr>";strHTML+="<tr>";var intContaF=0;for(var i=1;i<=intCantidad;i++){if(i==intCantidad){strHTML+="<td>"+CreaTexto("","_Serie"+i,"",25,25,false,false,"ConfirmNoSerie","left",0,"",""," onkeydown='EvalSerieNext(event,this,"+idUpdate+","+intCantidad+")'",false,3,"")+"</td>";}else{strHTML+="<td>"+CreaTexto("","_Serie"+i,"",25,25,false,false,"_Serie"+(i+1),"left",0,"",""," onblur='EvalSerieScNext(event,this,"+idUpdate+","+intCantidad+")'",false,3,"")+"</td>";}intContaF++;if(intContaF==10){strHTML+="</tr>";strHTML+="<tr>";intContaF=0;}}strHTML+="</tr>";strHTML+="<tr>";strHTML+="<td>"+CreaBoton("","ConfirmNoSerie",lstMsg[111],"RecepConfirmNumSerie("+idUpdate+","+intCantidad+");","left",false,false)+"</td>";strHTML+="<td>"+CreaBoton("","CancelNoSerie",lstMsg[112],"RecepCancelNumSerie("+idUpdate+","+intCantidad+");","left",false,false)+"</td>";strHTML+="</tr>";strHTML+="</table>";document.getElementById("dialogInv_inside").innerHTML=strHTML;setTimeout("document.getElementById('_Serie1').focus();",1000);}function EvalSerieNext(event,obj,idUpdate,intCantidad){if(event.keyCode==13){RecepConfirmNumSerie(idUpdate,intCantidad);}}function EvalSerieScNext(event,obj,idUpdate,intCantidad){if(event.keyCode==13){RecepEvalNumSerie(idUpdate,intCantidad);}}function RecepExisteNumSerie(){$("#dialogWait").dialog("open");var bolExiste=false;var lstIds="";var grid=jQuery("#COM_GRID");var arr=grid.getDataIDs();for(var i=0;i<arr.length;i++){var id=arr[i];var lstRow=grid.getRowData(id);lstIds+=lstRow.COMD_PR_ID+",";}$.ajax({type:"POST",data:"lstIds="+lstIds,scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"xml",url:"InvMov.do?id=18",success:function(datos){var grid=jQuery("#COM_GRID");var arr=grid.getDataIDs();var objCodBar=datos.getElementsByTagName("codigo_barras")[0];var lstProd=objCodBar.getElementsByTagName("cb");for(i=0;i<lstProd.length;i++){var obj=lstProd[i];if(parseInt(obj.getAttribute("USO"))==1){for(var j=0;j<arr.length;j++){var id=arr[j];var lstRow=grid.getRowData(id);if(parseInt(lstRow.COMD_PR_ID)==parseInt(obj.getAttribute("PR_ID"))){lstRow.COMD_USA_SERIE=1;grid.setRowData(id,lstRow);}}}}$("#dialogWait").dialog("close");document.getElementById("COM_PROD").focus();$("#dialogWait").dialog("close");},error:function(objeto,quepaso,otroobj){alert(":Recepcion Compras{Recep Prod}:"+objeto+" "+quepaso+" "+otroobj);$("#dialogWait").dialog("close");}});}function RecepConfirmNumSerie(idUpdate,intCantidad){var grid=jQuery("#COM_GRID");var lstRow=grid.getRowData(idUpdate);var strlstSeries="";for(var i=1;i<=intCantidad;i++){strlstSeries+=$.trim(document.getElementById("_Serie"+i).value)+",";if(document.getElementById("_Serie"+i).value==""||document.getElementById("_Serie"+i).value.length==0){alert(lstMsg[113]+" "+lstRow.COMD_CVE);document.getElementById("_Serie"+i).focus();return false;}if(document.getElementById("_Serie"+i).value!=""){for(var j=1;j<=intCantidad;j++){if(i!=j){if(document.getElementById("_Serie"+i).value==document.getElementById("_Serie"+j).value){alert(lstMsg[116]+":"+document.getElementById("_Serie"+j).value);return false;}}}}}$("#dialogWait").dialog("open");$.ajax({type:"POST",data:"PR_ID="+lstRow.COMD_PR_ID+"&SERIE="+strlstSeries,scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"html",url:"InvMov.do?id=19",success:function(datos){if(trim(datos)=="OK"){lstRow.COMD_RECIBIDO=parseFloat(lstRow.COMD_RECIBIDO)+intCantidad;lstRow.COMD_SERIES=lstRow.COMD_SERIES+strlstSeries;grid.setRowData(idUpdate,lstRow);d.getElementById("COM_PROD").value="";d.getElementById("COM_CANT").value="1";SetSumODCRecep();d.getElementById("COM_PROD").focus();$("#dialogWait").dialog("close");$("#dialogInv").dialog("close");return true;}else{alert(datos);$("#dialogWait").dialog("close");return false;}$("#dialogWait").dialog("close");},error:function(objeto,quepaso,otroobj){alert(":Recepcion Compras{Recep Prod}:"+objeto+" "+quepaso+" "+otroobj);$("#dialogWait").dialog("close");}});return true;}function RecepEvalNumSerie(idUpdate,intCantidad){var grid=jQuery("#COM_GRID");var lstRow=grid.getRowData(idUpdate);var strlstSeries="";for(var i=1;i<=intCantidad;i++){strlstSeries+=document.getElementById("_Serie"+i).value+",";if(document.getElementById("_Serie"+i).value!=""){for(var j=1;j<=intCantidad;j++){if(i!=j){if(document.getElementById("_Serie"+i).value==document.getElementById("_Serie"+j).value){alert(lstMsg[116]+":"+document.getElementById("_Serie"+j).value);return false;}}}}}$("#dialogWait").dialog("open");$.ajax({type:"POST",data:"PR_ID="+lstRow.COMD_PR_ID+"&SERIE="+strlstSeries,scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"html",url:"InvMov.do?id=19",success:function(datos){if(trim(datos)!="OK"){alert(datos);$("#dialogWait").dialog("close");return false;}$("#dialogWait").dialog("close");},error:function(objeto,quepaso,otroobj){alert(":Recepcion Compras{Recep Prod3}:"+objeto+" "+quepaso+" "+otroobj);$("#dialogWait").dialog("close");}});}function RecepCancelNumSerie(){$("#dialogInv").dialog("close");}function PrintCheckRecep(){var grid=jQuery("#VIEWC_GRID1");if(grid.getGridParam("selrow")!=null){var lstRow=grid.getRowData(grid.getGridParam("selrow"));var strHtml2=CreaHidden("COM_ID",lstRow.COM_ID);if(bolVerCostosRecep){openFormat("CHECK_1","PDF",strHtml2,lstRow.COM_FOLIO);}else{openFormat("CHECK_2","PDF",strHtml2,lstRow.COM_FOLIO);}}}function RecibirAllRecep(){var grid=jQuery("#COM_GRID");$("#dialogWait").dialog("open");var arr=grid.getDataIDs();for(var i=0;i<arr.length;i++){var id=arr[i];var lstRowUpdate=grid.getRowData(id);var intCant=parseFloat(lstRowUpdate.COMD_CANTIDAD)+(parseFloat(lstRowUpdate.COMD_RECIBIDO));
if(lstRowUpdate.COMD_USA_SERIE==1){DrawCapturaSerie(lstRowUpdate.COMD_CVE,lstRowUpdate.COMD_DESCRIPCION,intCant,id);return false;}else{lstRowUpdate.COMD_RECIBIDO=parseFloat(lstRowUpdate.COMD_RECIBIDO)+intCant;grid.setRowData(id,lstRowUpdate);}}d.getElementById("COM_PROD").value="";d.getElementById("COM_CANT").value="1";SetSumODCRecep();d.getElementById("COM_PROD").focus();$("#dialogWait").dialog("close");}function editGridRecep(e){if(e.originalEvent.keyCode==13){var grid=jQuery("#COM_GRID");if(verCantidadRecibida()==0){alert("La cantidad recibida es mayor a la solicitada favor de verificar.");}else{grid.saveRow(lastselRecep);lastselRecep=0;setTimeout("setSumaRecibidos();",1000);}}}function editGridRecepBlur(){var grid=jQuery("#COM_GRID");if(verCantidadRecibida()==0){alert("La cantidad recibida es mayor a la solicitada favor de verificar.");}else{grid.saveRow(lastselRecep);lastselRecep=0;setTimeout("setSumaRecibidos();",1000);}}function editFilaRecep(id){var grid=jQuery("#COM_GRID");if(id!=lastselRecep){grid.saveRow(lastselRecep);grid.editRow(id,false);lastselRecep=id;}}function verCantidadRecibida(){var grid=jQuery("#COM_GRID");if(grid.getGridParam("selrow")!=null){var id=grid.getGridParam("selrow");var lstRow=grid.getRowData(id);var intCantidad=parseFloat(lstRow.COMD_CANTIDAD);var intRecibido=parseFloat(document.getElementById(id+"_COMD_RECIBIDO").value);if(intCantidad<intRecibido){return 0;}}return 1;}function setSumaRecibidos(){var intTotal=0;var grid=jQuery("#COM_GRID");var arr=grid.getDataIDs();for(var i=0;i<arr.length;i++){var idRow=arr[i];var lstRow=grid.getRowData(idRow);intTotal=parseFloat(intTotal)+parseFloat(lstRow.COMD_RECIBIDO);}document.getElementById("COM_TOT").value=intTotal;}function ImprimeEtiquetasRecep(){var grid=jQuery("#VIEWC_GRID1");if(grid.getGridParam("selrow")!=null){$("#dialogWait").dialog("open");var lstRow=grid.getRowData(grid.getGridParam("selrow"));var strPOST="COM_ID="+lstRow.COM_ID;$.ajax({type:"POST",data:strPOST,scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"html",url:"ERP_com_recep.jsp?id=1",success:function(dato){if(dato=="OK"){$("#dialogWait").dialog("close");OpnOpt("SEL_ETQ",null,"dialogProv",false,false,true);}else{alert("NO Se puede Imprimir Etiqeutas");$("#dialogWait").dialog("close");}},error:function(objeto,quepaso,otroobj){alert(":pto9:"+objeto+" "+quepaso+" "+otroobj);$("#dialogWait").dialog("close");}});}}function CancelaVentanaEtiqRecep(){$("#dialogProv").dialog("close");}function AcpetarVentanaEtiqRecep(){var grid=jQuery("#VIEWC_GRID1");var lstRow=grid.getRowData(grid.getGridParam("selrow"));var intEtiqueta=document.getElementById("ET_ID").value;var strPOST="&COM_ID="+lstRow.COM_ID;strPOST+="&ET_ID="+intEtiqueta;Abrir_Link("ERP_com_recep.jsp?id=2"+strPOST,"_new",200,200,0,0);$("#dialogProv").dialog("close");}function RecepOdcPrintEtiquetas(){var grid=jQuery("#VIEWC_GRID1");var id=grid.getGridParam("selrow");var lstRow=grid.getRowData(id);if(grid.getGridParam("selrow")!=null){jQuery("#GRID_IMETRODC").clearGridData();OpnOpt("IMP_ETRODC",null,"dialog2",false,false,true);RecepOdcLlenaGrid();}else{alert("Selecciona un registro de la tabla");}}function RecepOdcLlenaGrid(){$("#dialogWait").dialog("open");var grid=jQuery("#VIEWC_GRID1");var id=grid.getGridParam("selrow");var lstRow=grid.getRowData(id);var intIdOC=lstRow.COM_ID;itemIdCob=0;var strPost="";strPost+="&intIdOC="+intIdOC;$.ajax({type:"POST",data:strPost,scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"xml",url:"ERP_com_recep.jsp?id=5",success:function(datos){var objsc=datos.getElementsByTagName("recep1")[0];var lstProds=objsc.getElementsByTagName("recep");for(var i=0;i<lstProds.length;i++){var obj=lstProds[i];var datarow={MP_ID:obj.getAttribute("MP_ID"),MP_FECHA:obj.getAttribute("MP_FECHA"),PROV_ID:obj.getAttribute("PROV_ID"),MP_FOLIO:obj.getAttribute("MP_FOLIO"),OC_ID:obj.getAttribute("OC_ID")};itemIdCob++;jQuery("#GRID_IMETRODC").addRowData(itemIdCob,datarow,"last");}$("#dialogWait").dialog("close");},error:function(){jQuery("#GRID_IMETRODC").clearGridData();alert("No hay con esas caracteristicas");$("#dialogWait").dialog("close");}});}function RecepOdcPrintRecep(){var grid=jQuery("#GRID_IMETRODC");var id=grid.getGridParam("selrow");var lstRow=grid.getRowData(id);if(grid.getGridParam("selrow")!=null){var strPost="";strPost+="&intEMP_ID="+document.getElementById("VIEWC_EMP").value;strPost+="&intSC_ID="+document.getElementById("SC_ID").value;strPost+="&intMP_ID="+lstRow.MP_ID;$.ajax({type:"POST",data:strPost,scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"xml",url:"ERP_com_recep.jsp?id=8",success:function(datos){$("#SioNO").dialog("open");$("#SioNO").dialog("option","title","¿Desea Imprimir PDF?");document.getElementById("btnSI").onclick=function(){var objsc=datos.getElementsByTagName("etiquetas")[0];if(objsc!=null){var lstProds=objsc.getElementsByTagName("etiquetas_deta");for(var i=0;i<lstProds.length;i++){var obj=lstProds[i];var IntIdRepo=obj.getAttribute("ET_REP_ODC");Abrir_Link("JasperReport?REP_ID="+IntIdRepo+"&boton_1=PDF&EMP_ID="+document.getElementById("VIEWC_EMP").value+"&SC_ID="+document.getElementById("VIEWC_SUCURSAL").value+"&MP_ID="+lstRow.MP_ID,"_reporte"+IntIdRepo,500,600,0,0);}}else{alert("El no existe");$("#dialogWait").dialog("close");}$("#SioNO").dialog("close");};document.getElementById("btnNO").onclick=function(){var objsc=datos.getElementsByTagName("etiquetas")[0];if(objsc!=null){var lstProds=objsc.getElementsByTagName("etiquetas_deta");for(var i=0;i<lstProds.length;i++){var obj=lstProds[i];var strPost="";strPost+="&EMP_ID="+document.getElementById("VIEWC_EMP").value;strPost+="&SC_ID="+document.getElementById("VIEWC_SUCURSAL").value;strPost+="&MP_ID="+lstRow.MP_ID;strPost+="&ET_ID="+obj.getAttribute("ET_ID");Abrir_Link("ERP_com_recep.jsp?id=6"+strPost,"_new"+i,200,200,0,0);$("#dialogProv").dialog("close");}}else{alert("El no existe");$("#dialogWait").dialog("close");}$("#SioNO").dialog("close");};},error:function(){}});}else{alert("Selecciona un registro de la tabla");}}