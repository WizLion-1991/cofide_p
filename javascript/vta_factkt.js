function vta_factkt(){}function InitFactTick(){$("#dialogWait").dialog("open");myLayout.close("west");myLayout.close("east");myLayout.close("south");myLayout.close("north");document.getElementById("FACT_TKTADD").focus();document.getElementById("FACT_TKTADD").select();var strHtml="<ul>"+getMenuItem("CallbtnFTKT0();","Guardar Factura","images/ptovta/CircleSave.png")+getMenuItem("CallbtnFTKT1();","Salir","images/ptovta/exitBig.png")+"</ul>";document.getElementById("TOOLBAR").innerHTML=strHtml;$("#dialogWait").dialog("close");d.getElementById("btn1").setAttribute("class","Oculto");d.getElementById("btn1").setAttribute("className","Oculto");}function OpnDiagCteFac(){OpnOpt("CLIENTES","grid","dialogCte",false,false);}function AddFilterFT(){var strSuc=d.getElementById("FACT_SUC").value;var strFecha1=d.getElementById("FACT_PERIOD1").value;var strFecha2=d.getElementById("FACT_PERIOD2").value;var strCT_ID=d.getElementById("FACT_CTE1").value;$("#dialogWait").dialog("open");resetTFMas();$.ajax({type:"POST",data:"SC_ID="+strSuc+"&TKT_FECHA1="+strFecha1+"&TKT_FECHA2="+strFecha2+"&TKT_ANULADA=0&FAC_ID=0&CT_ID="+strCT_ID,scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"xml",url:"VtasMov.do?id=22",success:function(datos){var objsc=datos.getElementsByTagName("vta_tickets")[0];var lstTiks=objsc.getElementsByTagName("vta_ticketss");for(i=0;i<lstTiks.length;i++){var obj=lstTiks[i];var dblPagos=obj.getAttribute("TKT_TOTAL")-obj.getAttribute("TKT_SALDO");var strFecha=obj.getAttribute("TKT_FECHA");strFecha=strFecha.substr(strFecha.length-2,strFecha.length)+"/"+strFecha.substr(4,2)+"/"+strFecha.substr(0,4);var datarow={FACTK_ID:obj.getAttribute("TKT_ID"),FACTK_FOLIO:obj.getAttribute("TKT_FOLIO"),FACTK_FECHA:strFecha,FACTK_RAZONSOCIAL:obj.getAttribute("TKT_RAZONSOCIAL"),FACTK_TOTAL:obj.getAttribute("TKT_TOTAL"),FACTK_PAGOS:dblPagos,FACTK_SALDO:obj.getAttribute("TKT_SALDO")};jQuery("#FACT_GRID1").addRowData(obj.getAttribute("TKT_ID"),datarow,"last");SumaTicketFT(obj.getAttribute("TKT_TOTAL"));}$("#dialogWait").dialog("close");},error:function(objeto,quepaso,otroobj){alert(":ptotFact:"+objeto+" "+quepaso+" "+otroobj);$("#dialogWait").dialog("close");}});}function AddTkFT(){var strValor=document.getElementById("FACT_TKTADD").value;$.ajax({type:"POST",data:"TKT_ID="+strValor+"&TKT_ANULADA=999",scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"xml",url:"CIP_TablaOp.jsp?ID=2&opnOpt=TICKETVIEW",success:function(datos){var objsc=datos.getElementsByTagName("vta_tickets")[0];var lstTiks=objsc.getElementsByTagName("vta_ticketss");for(i=0;i<lstTiks.length;i++){var obj=lstTiks[i];if(obj.getAttribute("TKT_ANULADA")==0){if(obj.getAttribute("FAC_ID")==0){var dblPagos=obj.getAttribute("TKT_TOTAL")-obj.getAttribute("TKT_SALDO");var strFecha=obj.getAttribute("TKT_FECHA");strFecha=strFecha.substr(strFecha.length-2,strFecha.length)+"/"+strFecha.substr(4,2)+"/"+strFecha.substr(0,4);var datarow={FACTK_ID:obj.getAttribute("TKT_ID"),FACTK_FOLIO:obj.getAttribute("TKT_FOLIO"),FACTK_FECHA:strFecha,FACTK_RAZONSOCIAL:obj.getAttribute("TKT_RAZONSOCIAL"),FACTK_TOTAL:obj.getAttribute("TKT_TOTAL"),FACTK_PAGOS:dblPagos,FACTK_SALDO:obj.getAttribute("TKT_SALDO")};jQuery("#FACT_GRID1").addRowData(obj.getAttribute("TKT_ID"),datarow,"last");SumaTicketFT(obj.getAttribute("TKT_TOTAL"));}else{alert(lstMsg[19]);}}else{alert(lstMsg[18]);}}$("#dialogWait").dialog("close");document.getElementById("FACT_TKTADD").focus();document.getElementById("FACT_TKTADD").select();},error:function(objeto,quepaso,otroobj){alert(":ptoExist:"+objeto+" "+quepaso+" "+otroobj);$("#dialogWait").dialog("close");}});}function SumaTicketFT(dblTotAdd){var dblTotAct=document.getElementById("FACT_TOTAL").value.replace(",","");dblTotAct=dblTotAct.replace(",","");dblTotAct=dblTotAct.replace(",","");var dblNuevoMonto=parseFloat(dblTotAct)+parseFloat(dblTotAdd);document.getElementById("FACT_TOTAL").value=FormatNumber(dblNuevoMonto,intNumdecimal,true);}function SaveFact(){var strCte=d.getElementById("FACT_CTE").value;var strFecha=d.getElementById("FACT_FECHA").value;var strSuc=d.getElementById("FACT_SUCFACT").value;var strFolio=d.getElementById("FACT_FOLIO").value;var dblTotal=d.getElementById("FACT_TOTAL").value;ValidaClean("FACT_CTE");ValidaClean("FACT_FECHA");ValidaClean("FACT_SUCFACT");if(strCte==0){ValidaShow("FACT_CTE","NECESITA SELECCIONAR UN CLIENTE");return;}if(strFecha==0){ValidaShow("FACT_FECHA","NECESITA CAPTURAR UNA FECHA");return;}if(strSuc==0){ValidaShow("FACT_SUCFACT","NECESITA SELECCIONAR UNA SUCURSAL");return;}$("#dialogWait").dialog("open");var strPost="SC_ID="+strSuc+"&CT_ID="+strCte+"&FAC_FECHA="+strFecha+"&FAC_FOLIO="+strFolio+"&FAC_TOTAL="+dblTotal+"&FAC_NOTAS=";var grid=jQuery("#FACT_GRID1");var arr=grid.getDataIDs();for(var i=0;i<arr.length;i++){var id=arr[i];var lstRow=grid.getRowData(id);strPost+="&TKT_ID="+lstRow.FACTK_ID;}strPost+="&FAC_METODOPAGO="+document.getElementById("FAC_METODOPAGO").value;strPost+="&FAC_NUMCUENTA="+document.getElementById("FAC_NUMCUENTA").value;strPost+="&FAC_FORMADEPAGO="+document.getElementById("FAC_FORMADEPAGO").value;$.ajax({type:"POST",data:strPost,scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"html",url:"VtasMov.do?id=3",success:function(dato){dato=trim(dato);if(Left(dato,3)=="OK."){var strHtml=CreaHidden("FAC_ID",dato.replace("OK.",""));openWhereverFormat("ERP_SendInvoice?id="+dato.replace("OK.",""),"FACTURA","PDF",strHtml);resetTFMas();}else{alert(dato);}$("#dialogWait").dialog("close");},error:function(objeto,quepaso,otroobj){alert(":ptotFact:"+objeto+" "+quepaso+" "+otroobj);$("#dialogWait").dialog("close");}});}function resetTFMas(){jQuery("#FACT_GRID1").clearGridData();document.getElementById("FACT_TOTAL").value="0.0";}function AddTktEvt(event,obj){if(event.keyCode==13){AddTkFT();}}var opcPopupProvfac;function OpnDiagCteFact(){OpnOpt("CLIENTES","grid","dialogCte",false,false);opcPopupProvfac=1;}function OpnDiagCteFact1(){OpnOpt("CLIENTES","grid","dialogCte",false,false);opcPopupProvfac=2;}function CallbtnFTKT0(){SaveFact();}function CallbtnFTKT1(){myLayout.open("west");myLayout.open("east");myLayout.open("south");myLayout.open("north");document.getElementById("MainPanel").innerHTML="";var objMainFacPedi=objMap.getScreen("FAC_TKT");objMainFacPedi.bolActivo=false;objMainFacPedi.bolMain=false;objMainFacPedi.bolInit=false;objMainFacPedi.idOperAct=0;}function LimpiaGridFTKT1(){jQuery("#FACT_GRID1").clearGridData();}