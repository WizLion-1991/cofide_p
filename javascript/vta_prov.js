var strExpRegRFCProv="";function vta_prov(){}function InitProv(){var objProvData=objMap.getScreen("PROVEEDOR");if(objProvData.objDataEdit!=null){var objDataItem=objProvData.objDataEdit.getElementsByTagName("vta_proveedores");refreshEstado(objDataItem[0].getAttribute("PV_ESTADO"));}else{refreshEstado();}UpdateObligatorios();}function InitProvSinO(){var objProvData=objMap.getScreen("PROVEEDOR");if(objProvData.objDataEdit!=null){var objDataItem=objProvData.objDataEdit.getElementsByTagName("vta_proveedores");refreshEstado(objDataItem[0].getAttribute("PV_ESTADO"));}else{refreshEstado();}}function dblClickProv(id){var strNomMain=objMap.getNomMain();var grid=jQuery("#PROVEEDOR");var lstVal=grid.getRowData(id);if(strNomMain=="PROVEEDOR"){OpnEdit(document.getElementById("Ed"+strNomMain));}else{if(strNomMain=="CXPAGAR"){var boolUsaEnMain=true;if(bolUsaOpnProv!=null){if(!bolUsaOpnProv){boolUsaEnMain=false;}}if(boolUsaEnMain){document.getElementById("FPV_ID").value=lstVal.PV_ID;document.getElementById("PV_NOM").value=lstVal.PV_RAZONSOCIAL;ObtenNomProv();}else{document.getElementById("CPX_CLIENTE").value=lstVal.PV_ID;}}else{if(strNomMain=="NC_VIEW2"){document.getElementById("VIEW_CLIENTE").value=lstVal.PV_ID;}else{if(strNomMain=="COBROSCTAS"){document.getElementById("COB_CTAS_PV").value=lstVal.PV_ID;PeticionMonedaProvCXP();}else{if(strNomMain=="COMPRAS"){document.getElementById("FPV_ID").value=lstVal.PV_ID;document.getElementById("PV_NOM").value=lstVal.PV_RAZONSOCIAL;ObtenNomProvODC();}else{if(strNomMain=="COM_VIEW"){document.getElementById("VIEWC_PV_ID").value=lstVal.PV_ID;}else{if(strNomMain=="COMP_RECEP"){document.getElementById("VIEWC_PV_ID").value=lstVal.PV_ID;}else{if(strNomMain=="AJS_PAGOSC"){document.getElementById("COB_CTAS_PV").value=lstVal.PV_ID;}else{if(strNomMain=="ANTI"){document.getElementById("PV_ID").value=lstVal.PV_ID;ObtenNomProvAnt();}else{if(strNomMain=="USE_ANTI"){document.getElementById("MC_PROVEEDOR").value=lstVal.PV_ID;ObtenNomProvAnt();}else{if(strNomMain=="CXP_VIEW"){document.getElementById("CPX_CLIENTE").value=lstVal.PV_ID;}else{if(strNomMain=="EDO_CTA_PR"){document.getElementById("ED_PROVEEDOR").value=lstVal.PV_ID;document.getElementById("ED_NOMBRE").value=lstVal.PV_RAZONSOCIAL;RefreshCteEdoCtaProv();}else{if(strNomMain=="NOTA_SRV2"){document.getElementById("FCT_ID").value=lstVal.PV_ID;ObtenNomPvServNC();}else{if(strNomMain=="CONA_PROV"){document.getElementById("PROV_ID").value=lstVal.PV_ID;document.getElementById("PROV_NOMBRE").value=lstVal.PV_RAZONSOCIAL;RefreshDatosProvConsAnt();}else{if(strNomMain=="CAP_NCARGOPROV"){document.getElementById("FCT_ID").value=lstVal.PV_ID;document.getElementById("CT_NOM").value=lstVal.PV_RAZONSOCIAL;$("#dialogCte").dialog("close");ObtenNomCteNCargoProv();}else{if(strNomMain=="CON_NCARGOPROV"){document.getElementById("VIEW_CLIENTE").value=lstVal.PV_ID;$("#dialogCte").dialog("close");}else{if(strNomMain=="REEMBOLSO"){if(opcPopupProv==1){document.getElementById("RMB_PROVEEDOR_ID_ANT").value=lstVal.PV_ID;document.getElementById("RMB_PROVEEDOR_NOM_ANT").value=lstVal.PV_RAZONSOCIAL;Reemb_PeticionMonedaProv();}else{document.getElementById("RMB_PROVEEDOR_ID").value=lstVal.PV_ID;document.getElementById("RMB_PROVEEDOR_NOM").value=lstVal.PV_RAZONSOCIAL;}}}}}}}}}}}}}}}}}}$("#dialogProv").dialog("close");}function refreshEstado(strIdDefa){if(document.getElementById("PA_ID").value!="0"){$("#dialogWait").dialog("open");var strPOST="idPais="+document.getElementById("PA_ID").value;$.ajax({type:"POST",data:strPOST,scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"xml",url:"ERP_Varios.jsp?id=1",success:function(datos){var lstXml=datos.getElementsByTagName("estados")[0];var lstCat=lstXml.getElementsByTagName("estado");var sel=document.getElementById("PV_ESTADO");select_clear(sel);select_add(sel,"SELECCIONE",0);for(var i=0;i<lstCat.length;i++){var objCat=lstCat[i];var idCat=objCat.getAttribute("id");var descCat=objCat.getAttribute("desc");select_add(sel,descCat,idCat);}if(strIdDefa!=null&&strIdDefa!=undefined){document.getElementById("PV_ESTADO").value=strIdDefa;}$("#dialogWait").dialog("close");},error:function(objeto,quepaso,otroobj){alert("obtener Edo prov: "+objeto+" "+quepaso+" "+otroobj);}});}else{select_clear(document.getElementById("PV_ESTADO"));}}function UpdateObligatorios(){var objTipoProv=document.getElementById("PV_TIPOPERS2");var objXML=objMap.getXml("PROVEEDOR");var _objscCM=objXML.getElementsByTagName("Screen")[0];var _ctrlCM=_objscCM.getElementsByTagName("ctrl");for(var i=0;i<_ctrlCM.length;i++){var obj=_ctrlCM[i];if(objTipoProv.checked){if(obj.getAttribute("frmd_nombre")=="PV_RFC"||obj.getAttribute("frmd_nombre")=="PV_MUNICIPIO"||obj.getAttribute("frmd_nombre")=="PV_CALLE"||obj.getAttribute("frmd_nombre")=="PV_NUMERO"||obj.getAttribute("frmd_nombre")=="PV_COLONIA"){obj.setAttribute("frmd_obligatorio",0);if(obj.getAttribute("frmd_nombre")=="PV_RFC"){if(strExpRegRFCProv==""){strExpRegRFCProv=obj.getAttribute("frmd_expreg");}obj.setAttribute("frmd_expreg","");}var objInput=document.getElementById(obj.getAttribute("frmd_nombre"));var objDiv=objInput.parentNode.parentNode;objDiv.firstChild.innerHTML=objDiv.firstChild.innerHTML.replace('class="oblig">*<','class="oblig2"><');}}else{if(obj.getAttribute("frmd_nombre")=="PV_RFC"||obj.getAttribute("frmd_nombre")=="PV_MUNICIPIO"||obj.getAttribute("frmd_nombre")=="PV_CALLE"||obj.getAttribute("frmd_nombre")=="PV_NUMERO"||obj.getAttribute("frmd_nombre")=="PV_COLONIA"){obj.setAttribute("frmd_obligatorio",1);var objInput=document.getElementById(obj.getAttribute("frmd_nombre"));var objDiv=objInput.parentNode.parentNode;objDiv.firstChild.innerHTML=objDiv.firstChild.innerHTML.replace('class="oblig2"><','class="oblig">*<');if(obj.getAttribute("frmd_nombre")=="PV_RFC"){if(strExpRegRFCProv!=""){obj.setAttribute("frmd_expreg",strExpRegRFCProv);}}}}}}function ProvEdo(){var grid=jQuery("#PROVEEDOR");if(grid.getGridParam("selrow")!=null){var lstVal=grid.getRowData(grid.getGridParam("selrow"));MakeReportInside(14,"Proveedor",lstVal.PV_ID,"1");}}function ProvEdoDo(){var a=confirm(lstMsg[102]);var strTipo="PDF";if(a){strTipo="XLS";}var strHtml=CreaHidden("PV_ID_REPO",document.getElementById("PV_ID_EDO").value);strHtml+=CreaHidden("FEC_INI",document.getElementById("FEC_INI").value);strHtml+=CreaHidden("FEC_FIN",document.getElementById("FEC_FIN").value);openReport("EDO_CTA_PROV",strTipo,strHtml);}function UpFileProv(strNomFile){ValidaClean(strNomFile);if(document.getElementById(strNomFile).value==""){ValidaShow(strNomFile,lstMsg[13]);return false;}var strExtencion=Right(document.getElementById(strNomFile).value.toUpperCase(),3);if(strExtencion=="PNG"||strExtencion=="JPG"){ajaxImageUploadProv(strNomFile,document.getElementById("PV_ID").value);return true;}else{ValidaShow(strNomFile,"Formato no valido solo: .png o .jpg");return false;}return true;}function ajaxImageUploadProv(strNomFile,intPV_ID){$("#dialogWait").dialog("open");$.ajaxFileUpload({url:"ERP_UpImageProveedor.jsp?PV_ID="+intPV_ID,secureuri:false,fileElementId:strNomFile,dataType:"json",success:function(data,status){if(typeof(data.error)!="undefined"){if(data.error!=""){alert(data.error);}}$("#dialogWait").dialog("close");alert("Imagen guardada Correctamente!");var strNomFileX="/iCommerce/images/ecomm/"+GetNomFile(document.getElementById(strNomFile).value);if(strNomFile=="PV_NOMIMG1"){document.getElementById("PV_NOMIMG1").value=strNomFileX;}else{document.getElementById("PV_NOMIMG1").value=strNomFileX;}InitProdImg();},error:function(data,status,e){alert(e);$("#dialogWait").dialog("close");}});return false;}function GetNomFile(strNom){var pathArray=strNom.split("/");var newPathname=pathArray[pathArray.length-1];return newPathname;}function InitProdImg(){if(document.getElementById("PV_IMG1").value==""){document.getElementById("PV_NOMIMG1").src="images/image_PNG.png";}else{ImgLoadProd(document.getElementById("PV_IMG1").value,"PV_IMG1");}}function ImgLoadProd(sSrc,strNomImg){var pathArray=document.URL.split("/");
var newPathname="";for(i=0;i<pathArray.length-1;i++){newPathname+=pathArray[i]+"/";}newPathname+=sSrc;var oImg=new Image();oImg.onload=function(){document.getElementById(strNomImg).src=oImg.src;};oImg.onerror=function(){document.getElementById(strNomImg).src="images/image_PNG.png";};oImg.src=newPathname+"?time="+new Date();}