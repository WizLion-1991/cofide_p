var itemIdODC=0;var lstPorcDescODC=null;var bolPriceODC=false;var bolQtyODC=false;var bolPorcODC=false;var bolCambioFechaODC=false;var bolAutorizarODC=false;var dblTasaODC1=dblTasa1;var dblTasaODC2=dblTasa2;var dblTasaODC3=dblTasa3;var intIdTasaODC1=intIdTasa1;var intIdTasaODC2=intIdTasa2;var intIdTasaODC3=intIdTasa3;var intSImpODC1_2=intSImp1_2;var intSImpODC1_3=intSImp1_3;var intSImpODC2_3=intSImp2_3;var intPV_TIPOPERS=0;var intPV_TIPOFAC=0;var strPV_USOIMBUEBLE="";var intRET_ISRODC=0;var intRET_IVAODC=0;var intRET_FLETEODC=1;var objTabla=null;var numFilas=0;var idT=0;var intContaIdGrid=0;var intSucOfertas=intSucDefOfertas;var bolCargaPromociones=false;var intEsEditable=1;function vta_compras(){}function InitCompras(){document.getElementById("btn1").setAttribute("class","Oculto");document.getElementById("COM_OPER").value=strUserName;myLayout.close("west");myLayout.close("east");myLayout.close("south");myLayout.close("north");OcultarAvisosODC();d.getElementById("SC_ID").value=intSucDefa;d.getElementById("COM_TASASEL1").value=intIdTasaODC1;d.getElementById("COM_PROD").focus();FormStyleODC();var strHtml="<ul>"+getMenuItem("CallbtnCOMP0();","Guardar Compra","images/ptovta/CircleSave.png")+getMenuItem("CallbtnCOMP1();","Nueva Compra","images/ptovta/VisPlus.png")+getMenuItem("CallbtnCOMP2();","Consultar Compra","images/ptovta/VisMagnifier.png")+getMenuItem("CallbtnCOMP6();","Cambio Costo","images/ptovta/VisModi.png")+getMenuItem("CallbtnCOMP7();","Cambio Cantidad","images/ptovta/VisQty.png")+getMenuItem("CallbtnCOMP3();","Notas","images/ptovta/VisNote.png")+getMenuItem("CallbtnCOMP4();","Borrar Producto","images/ptovta/VisClose.png")+getMenuItem("CallbtnCOMP5();","Salir","images/ptovta/exitBig.png")+"</ul>";document.getElementById("TOOLBARCOM").innerHTML=strHtml;bolCambioFechaODC=false;$.ajax({type:"POST",data:"keys=85,164,166,150",scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"xml",url:"Acceso.do",success:function(datos){var objsc=datos.getElementsByTagName("Access")[0];var lstKeys=objsc.getElementsByTagName("key");for(i=0;i<lstKeys.length;i++){var obj=lstKeys[i];if(obj.getAttribute("id")==85&&obj.getAttribute("enabled")=="true"){bolCambioFechaODC=true;}if(obj.getAttribute("id")==164&&obj.getAttribute("enabled")=="true"){bolPriceODC=true;}if(obj.getAttribute("id")==166&&obj.getAttribute("enabled")=="true"){bolQtyODC=true;}if(obj.getAttribute("id")==150&&obj.getAttribute("enabled")=="true"){bolAutorizarODC=true;}}if(bolCambioFechaODC){if($("#COM_FECHA").datepicker("isDisabled")){$("#COM_FECHA").datepicker("enable");}var objFecha=document.getElementById("COM_FECHA");objFecha.setAttribute("class","outEdit");objFecha.setAttribute("className","outEdit");objFecha.readOnly=false;}else{$("#COM_FECHA").datepicker("disable");}$("#dialogWait").dialog("close");setTimeout("GetFolioAuto();",1000);},error:function(objeto,quepaso,otroobj){alert(":pto:"+objeto+" "+quepaso+" "+otroobj);}});document.getElementById("btnSI").onclick=function(){ConfirmaSIODC();};document.getElementById("btnNO").onclick=function(){ConfirmaNOODC();};}function OpnDiagProvComp(){OpnOpt("PROVEEDOR","grid","dialogProv",false,false);}function OpnDiagProdComp(){OpnOpt("PROD","grid","dialogProd",false,false);}function AgregarProd(){var strCod=UCase(d.getElementById("COM_PROD").value);if(trim(strCod)!=""){var bolAgrupa=d.getElementById("COM_AGRUPA1").checked;$("#dialogWait").dialog("open");var bolNvo=true;var idProd=0;if(bolAgrupa){var grid=jQuery("#COM_GRID");var arr=grid.getDataIDs();for(var i=0;i<arr.length;i++){var id=arr[i];var lstRowAct=grid.getRowData(id);if(lstRowAct.COMD_CVE==strCod||lstRowAct.COMD_CODBARRAS==strCod){idProd=id;bolNvo=false;break;}}}if(bolNvo){$.ajax({type:"POST",data:"PR_CODIGO="+strCod+"&SC_ID="+d.getElementById("SC_ID").value,scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"xml",url:"VtasMov.do?id=5",success:function(datoVal){var objProd=datoVal.getElementsByTagName("vta_productos")[0];var Pr_Id=0;if(objProd!=undefined){Pr_Id=objProd.getAttribute("PR_ID");d.getElementById("COM_DESC").value=objProd.getAttribute("PR_DESCRIPCIONCOMPRA");if(Pr_Id!=0){strCod=objProd.getAttribute("PR_CODIGO");}}var Pv_Id=d.getElementById("FPV_ID").value;var dblCantidad=d.getElementById("COM_CANT").value;if(Pr_Id!=0){var dblCostoCompra=parseFloat(document.getElementById("COM_PRECIO").value);if(dblCostoCompra==0){dblCostoCompra=parseFloat(objProd.getAttribute("PR_COSTOCOMPRA"));}if(dblCostoCompra==0){alert(lstMsg[97]);$("#dialogWait").dialog("close");}else{AddItemPrecODC(objProd,Pr_Id,Pv_Id,dblCantidad,strCod,0,dblCostoCompra);}}else{alert(lstMsg[0]);document.getElementById("COM_PROD").focus();$("#dialogWait").dialog("close");}},error:function(objeto,quepaso,otroobj){alert(":Compra{partidas 1}:"+objeto+" "+quepaso+" "+otroobj);$("#dialogWait").dialog("close");}});}else{var Cantidad=d.getElementById("COM_CANT").value;var gridD=jQuery("#COM_GRID");var lstRow=gridD.getRowData(idProd);lstRow.COMD_CANTIDAD=parseFloat(lstRow.COMD_CANTIDAD)+parseFloat(Cantidad);lstRowChangePrecioODC(lstRow,idProd,gridD);document.getElementById("COM_PROD").value="";document.getElementById("COM_PROD").focus();d.getElementById("COM_CANT").value=1;d.getElementById("COM_PRECIO").value="0.0";d.getElementById("COM_DESC").value="";setSumODC();$("#dialogWait").dialog("close");}}}function MostrarAvisosODC(strMsg){var label=document.getElementById("LABELAVISOS");label.innerHTML=strMsg;label.setAttribute("class","Mostrar");label.setAttribute("className","Mostrar");label.setAttribute("class","ui-Total");label.setAttribute("className","ui-Total");}function OcultarAvisosODC(){var label=document.getElementById("LABELAVISOS");label.innerHTML="";label.setAttribute("class","Oculto");label.setAttribute("className","Oculto");}function FormStyleODC(){d.getElementById("COM_IMPORTE").setAttribute("class","ui-Total");d.getElementById("COM_IMPORTE").setAttribute("className","ui-Total");d.getElementById("COM_IMPUESTO1").setAttribute("class","ui-Total");d.getElementById("COM_IMPUESTO1").setAttribute("className","ui-Total");d.getElementById("COM_IMPORTE_IEPS").setAttribute("class","ui-Total");d.getElementById("COM_IMPORTE_IEPS").setAttribute("className","ui-Total");d.getElementById("COM_TOT").setAttribute("class","ui-Total");d.getElementById("COM_TOT").setAttribute("className","ui-Total");d.getElementById("btn1").setAttribute("class","Oculto");d.getElementById("btn1").setAttribute("className","Oculto");}function ConfirmaSIODC(){if(d.getElementById("Operac").value=="Nva"){ResetOperaActualODC(false,true,true);}if(d.getElementById("Operac").value=="CHANGE_COST"){CambioCostSendODC();}if(d.getElementById("Operac").value=="CHANGE_QTY"){CambioQtySendODC();}$("#SioNO").dialog("close");}function ConfirmaNOODC(){$("#SioNO").dialog("close");}function AddItemEvtODC(event,obj){if(event.keyCode==13){var strCodigo=d.getElementById("COM_PROD").value;setTimeout("AgregarProd()",1000);}}function AddItemPrecODC(objProd,Pr_Id,Pv_Id,Cantidad,strCod,dblExist,dblCostoCompra){var intMoneda=document.getElementById("COM_MONEDA").value;var dblParidad=1;if(objProd.getAttribute("MON_ID")!=0){if(parseInt(objProd.getAttribute("MON_ID"))!=parseInt(document.getElementById("COM_MONEDA").value)){intMoneda=objProd.getAttribute("MON_ID");}}if(parseInt(document.getElementById("FPV_ID").value)==0){alert(lstMsg[74]);$("#dialogWait").dialog("close");return false;}var objImportes=new _ImporteCompra();objImportes.dblCantidad=Cantidad;objImportes.dblPrecio=parseFloat(dblCostoCompra);objImportes.dblPrecioReal=parseFloat(dblCostoCompra);objImportes.dblPorcDescGlobal=document.getElementById("FPV_DESCUENTO").value;objImportes.dblExento1=objProd.getAttribute("PR_EXENTO1");objImportes.dblExento2=objProd.getAttribute("PR_EXENTO2");objImportes.dblExento3=objProd.getAttribute("PR_EXENTO3");objImportes.intDevo=0;objImportes.CalculaImporte();var dblImporte=objImportes.dblImporte;var datarow={COMD_ID:0,COMD_CANTIDAD:Cantidad,COMD_DESCRIPCION:objProd.getAttribute("PR_DESCRIPCIONCOMPRA"),COMD_IMPORTE:dblImporte,COMD_CVE:strCod,COMD_COSTO:dblCostoCompra,COMD_TASAIVA1:dblTasaODC1,COMD_TASAIVA2:dblTasaODC2,COMD_TASAIVA3:dblTasaODC3,COMD_DESGLOSA1:1,COMD_IMPUESTO1:objImportes.dblImpuesto1,COMD_IMPUESTO2:objImportes.dblImpuesto2,COMD_IMPUESTO3:objImportes.dblImpuesto3,COMD_PR_ID:Pr_Id,COMD_EXENTO1:objProd.getAttribute("PR_EXENTO1"),COMD_EXENTO2:objProd.getAttribute("PR_EXENTO2"),COMD_EXENTO3:objProd.getAttribute("PR_EXENTO3"),COMD_NOSERIE:"",COMD_IMPORTEREAL:dblImporte,COMD_COSTOREAL:dblCostoCompra,COMD_DESCUENTO:0,COMD_PORDESC:objImportes.dblPorcAplica,COMD_PRECFIJO:0,COMD_CODBARRAS:objProd.getAttribute("PR_CODBARRAS"),COMD_NOTAS:"",COMD_RET_ISR:intRET_ISRODC,COMD_RET_IVA:intRET_IVAODC,COMD_RET_FLETE:intRET_FLETEODC,COMD_UNIDAD_MEDIDA:objProd.getAttribute("PR_UNIDADMEDIDA"),COMD_MONEDA:intMoneda,COMD_PARIDAD:dblParidad};
itemIdODC++;jQuery("#COM_GRID").addRowData(itemIdODC,datarow,"last");d.getElementById("COM_PRECIO").value=dblCostoCompra;d.getElementById("COM_PROD").value="";d.getElementById("COM_PROD").focus();d.getElementById("COM_CANT").value=1;d.getElementById("COM_PRECIO").value="0.0";d.getElementById("COM_DESC").value="";setSumODC();EvalSucursalODC();$("#dialogWait").dialog("close");return true;}function lstRowChangePrecioODC(lstRow,idUpdate,grid){var objImportes=new _ImporteCompra();objImportes.dblCantidad=parseFloat(lstRow.COMD_CANTIDAD);objImportes.dblPrecio=parseFloat(lstRow.COMD_COSTO);objImportes.dblPrecioReal=lstRow.COMD_COSTOREAL;objImportes.dblPorcDescGlobal=document.getElementById("FPV_DESCUENTO").value;objImportes.dblPorcDesc=lstRow.COMD_PORDESC;objImportes.dblPrecFijo=lstRow.COMD_PRECFIJO;objImportes.dblExento1=lstRow.COMD_EXENTO1;objImportes.dblExento2=lstRow.COMD_EXENTO2;objImportes.dblExento3=lstRow.COMD_EXENTO3;objImportes.intDevo=0;objImportes.intPrecioZeros=0;objImportes.CalculaImporte();lstRow.COMD_IMPORTE=objImportes.dblImporte;lstRow.COMD_IMPUESTO1=objImportes.dblImpuesto1;lstRow.COMD_PORDESC=objImportes.dblPorcAplica;if(parseFloat(objImportes.dblPorcAplica)>0){if(intPreciosconImp==1){lstRow.COMD_DESCUENTO=parseFloat(objImportes.dblImporteReal)-(parseFloat(objImportes.dblImporte));}else{lstRow.COMD_DESCUENTO=parseFloat(objImportes.dblImporteReal)-(parseFloat(objImportes.dblImporte)-parseFloat(objImportes.dblImpuesto1));}}else{lstRow.COMD_DESCUENTO=0;}lstRow.COMD_IMPORTEREAL=objImportes.dblImporteReal;lstRow.COMD_TASAIVA1=dblTasaODC1;grid.setRowData(idUpdate,lstRow);setSumODC();}function ODCDrop(){var grid=jQuery("#COM_GRID");if(grid.getGridParam("selrow")!=null){grid.delRowData(grid.getGridParam("selrow"));document.getElementById("COM_PROD").focus();setSumODC();EvalSucursalODC();}}function setSumODC(){var grid=jQuery("#COM_GRID");var arr=grid.getDataIDs();var dblSuma=0;var dblImpuesto1=0;var dblImporte=0;for(var i=0;i<arr.length;i++){var id=arr[i];var lstRow=grid.getRowData(id);dblSuma+=parseFloat(lstRow.COMD_IMPORTE);dblImpuesto1+=parseFloat(lstRow.COMD_IMPUESTO1);dblImporte+=(parseFloat(lstRow.COMD_IMPORTE)-parseFloat(lstRow.COMD_IMPUESTO1));}var dblIEPS=0;if(document.getElementById("COM_USO_IEPS1").checked){if(parseFloat(document.getElementById("COM_TASA_IEPS").value)!=0){try{dblIEPS=dblImporte*(parseFloat(document.getElementById("COM_TASA_IEPS").value)/100);}catch(err){}}else{alert(lstMsg[62]);document.getElementById("COM_TASA_IEPS").focus();}var tax=new Impuestos(dblTasaODC1,dblTasaODC2,dblTasaODC3,intSImpODC1_2,intSImpODC1_3,intSImpODC2_3);tax.CalculaImpuestoMas(dblIEPS,0,0);dblImpuesto1+=tax.dblImpuesto1;dblSuma+=dblIEPS+tax.dblImpuesto1;}d.getElementById("COM_IMPORTE_IEPS").value=FormatNumber(dblIEPS,intNumdecimal,true,false,true,false);d.getElementById("COM_TOT").value=FormatNumber(dblSuma,intNumdecimal,true,false,true,false);d.getElementById("COM_IMPUESTO1").value=FormatNumber(dblImpuesto1,intNumdecimal,true,false,true,false);d.getElementById("COM_IMPORTE").value=FormatNumber(dblImporte,intNumdecimal,true,false,true,false);if(dblSuma>0){intEsEditable=0;RevisaEdicionCompras();}else{intEsEditable=1;RevisaEdicionCompras();}}function CallbtnCOMP0(){var op=confirm(lstMsg[198]);if(op==true){SaveODC();}}function CallbtnCOMP1(){$("#SioNO").dialog("option","title","Â¿Confirma que desea borrar la operacion actual e iniciar una nueva?");d.getElementById("Operac").value="Nva";document.getElementById("SioNO_inside").innerHTML="";$("#SioNO").dialog("open");}function CallbtnCOMP2(){OpnOpt("COM_VIEW","_ed","dialogView",false,false,true);}function CallbtnCOMP3(){var grid=jQuery("#COM_GRID");var id=grid.getGridParam("selrow");if(id!=null){var lstRowAct=grid.getRowData(id);var strHTML=CreaTextArea(lstMsg[30],"NOTASMOD",lstRowAct.COMD_NOTAS,5,80,"",0,0,3,0);strHTML+=CreaBoton("","NOTASBTN",lstMsg[31],"ChangeNotesODC()","center",false,true,0);$("#dialog2").dialog("option","title",lstMsg[29]);document.getElementById("dialog2").innerHTML=strHTML;$("#dialog2").dialog("option","width",500);$("#dialog2").dialog("open");document.getElementById("NOTASMOD").focus();}}function CallbtnCOMP4(){ODCDrop();}function CallbtnCOMP5(){myLayout.open("west");myLayout.open("east");myLayout.open("south");myLayout.open("north");document.getElementById("MainPanel").innerHTML="";}function CallbtnCOMP6(){var grid=jQuery("#COM_GRID");var ids=grid.getGridParam("selrow");if(ids!=null&&bolPriceODC){var lstRow=grid.getRowData(ids);document.getElementById("Operac").value="CHANGE_COST";$("#SioNO").dialog("option","title",lstMsg[78]);var div=document.getElementById("SioNO_inside");var strHtml=CreaTexto(lstMsg[8],"_NvoCost",lstRow.COMD_COSTO,10,10,true,false,"","left",0,"","","",false,1);strHtml+=CreaRadio(lstMsg[9],"_NvoClean",0,false," ");div.innerHTML=strHtml;$("#SioNO").dialog("open");}}function CallbtnCOMP7(){var grid=jQuery("#COM_GRID");var ids=grid.getGridParam("selrow");if(ids!=null&&bolQtyODC){var lstRow=grid.getRowData(ids);document.getElementById("Operac").value="CHANGE_QTY";$("#SioNO").dialog("option","title",lstMsg[79]);var div=document.getElementById("SioNO_inside");var strHtml=CreaTexto(lstMsg[8],"_NvoQty",lstRow.COMD_CANTIDAD,10,10,true,false,"","left",0,"","","",false,1);strHtml+=CreaRadio(lstMsg[9],"_NvoClean",0,false," ");div.innerHTML=strHtml;$("#SioNO").dialog("open");}}function ObtenNomProvODC(objODC,lstdeta,bolPasaODC){var intPv=document.getElementById("FPV_ID").value;var intSuc=document.getElementById("SC_ID").value;if(bolPasaODC==undefined){bolPasaODC=false;}ValidaClean("PV_NOM");$.ajax({type:"POST",data:"PV_ID="+intPv+"&SC_ID="+intSuc,scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"xml",url:"CXPMov.do?id=9",success:function(datoVal){var objPov=datoVal.getElementsByTagName("vta_proveedores")[0];if(objPov.getAttribute("PV_ID")==0){document.getElementById("PV_NOM").value="***************";alert("EL proveedor no existe");document.getElementById("FPV_ID").value=0;}else{document.getElementById("PV_NOM").value=objPov.getAttribute("PV_RAZONSOCIAL");document.getElementById("FPV_LPRECIOS").value=objPov.getAttribute("PV_LPRECIOS");document.getElementById("FPV_DESCUENTO").value=objPov.getAttribute("PV_DESCUENTO");if(!bolPasaODC){document.getElementById("COM_DIASCREDITO").value=objPov.getAttribute("PV_DIASCREDITO");if(objPov.getAttribute("MON_ID")!=0){document.getElementById("COM_MONEDA").value=objPov.getAttribute("MON_ID");}else{document.getElementById("COM_MONEDA").value=1;}RefreshMonedaODC();var intDiasTmp=parseInt(objPov.getAttribute("PV_DIAS_PROD"));var dcomFecha=$("#COM_FECHA").datepicker("getDate");var dnewComFecha=addDays(dcomFecha,intDiasTmp);$("#COM_FECHA_PROMESA").datepicker("setDate",dnewComFecha);intDiasTmp=parseInt(objPov.getAttribute("PV_DIAS_TRANSITO"))+parseInt(objPov.getAttribute("PV_DIAS_PROD"))+parseInt(objPov.getAttribute("PV_DIAS_INGRESO"));dcomFecha=$("#COM_FECHA").datepicker("getDate");dnewComFecha=addDays(dcomFecha,intDiasTmp);$("#COM_FECHA_DISP_VTA").datepicker("setDate",dnewComFecha);document.getElementById("COM_TASASEL1").value=objPov.getAttribute("TI_ID");UpdateTasaImpODC();}document.getElementById("FPV_MONTOCRED").value=objPov.getAttribute("PV_MONTOCRED");document.getElementById("COM_CONDPAGO").value=objPov.getAttribute("PV_CONDPAGO");document.getElementById("COM_METODO_ENVIO").value=objPov.getAttribute("PV_METODO_ENVIO");intCT_TIPOPERSPV=0;}if(bolPasaODC){DrawODCDeta(objODC,lstdeta);}},error:function(objeto,quepaso,otroobj){document.getElementById("PV_NOM").value="***************";alert("ODC prov1:"+objeto+" "+quepaso+" "+otroobj);}});}function ObtenPediODC(){var strPedimento=document.getElementById("COM_PEDIMENTO").value;if(strPedimento!=""){$("#dialogWait").dialog("open");ValidaClean("COM_PEDIMENTO");$.ajax({type:"POST",data:"PEDIMENTO="+strPedimento,scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"xml",url:"ODCMov.do?id=9",success:function(datoVal){var objPov=datoVal.getElementsByTagName("vta_pedimentos")[0];
if(objPov.getAttribute("PED_ID")==0){document.getElementById("COM_PEDIMENTO").focus();alert("El pedimento no existe");}else{document.getElementById("PED_ID").value=objPov.getAttribute("PED_ID");}$("#dialogWait").dialog("close");},error:function(objeto,quepaso,otroobj){alert("ODC PEDI1:"+objeto+" "+quepaso+" "+otroobj);$("#dialogWait").dialog("close");}});}}function ResetOperaActualODC(bolSelOpera,bolRefreshImpuesto,bolFolioAuto){if(bolSelOpera==undefined){bolSelOpera=true;}if(bolFolioAuto==null){bolFolioAuto=true;}if(bolSelOpera){$("#dialogWait").dialog("open");}d.getElementById("FPV_ID").value=0;d.getElementById("COM_FOLIO").value="";d.getElementById("COM_NOTAS").value="";d.getElementById("COM_TOT").value="0.0";d.getElementById("COM_IMPUESTO1").value="0.0";d.getElementById("COM_IMPUESTO2").value="0.0";d.getElementById("COM_IMPUESTO3").value="0.0";d.getElementById("COM_IMPORTE").value="0.0";d.getElementById("COM_DESC").value="";d.getElementById("COM_PRECIO").value="0.0";d.getElementById("COM_PROD").focus();d.getElementById("COM_TIPO").value="1";d.getElementById("COM_CONDPAGO").value="";d.getElementById("COM_METODOPAGO").value="";d.getElementById("COM_NUMCUENTA").value="";d.getElementById("COM_DIASCREDITO").value="0";d.getElementById("CDE_ID").value="0";d.getElementById("PV_NOM").value="";if(bolRefreshImpuesto==null){bolRefreshImpuesto=false;}if(bolRefreshImpuesto){d.getElementById("COM_TASASEL1").value=intIdTasa1;UpdateTasaImpODC();}OcultarAvisosODC();var grid=jQuery("#COM_GRID");grid.clearGridData();if(bolSelOpera){$("#dialogWait").dialog("close");}EvalSucursalODC();if(bolFolioAuto){GetFolioAuto();}intEsEditable=1;RevisaEdicionCompras();}function ChangeNotesODC(){var grid=jQuery("#COM_GRID");var id=grid.getGridParam("selrow");if(id!=null){var lstRowAct=grid.getRowData(id);lstRowAct.COMD_NOTAS=d.getElementById("NOTASMOD").value;grid.setRowData(id,lstRowAct);}$("#dialog2").dialog("close");}function SaveODC(){var bolPasa=true;if(parseFloat(document.getElementById("COM_TOT").value)==0){alert(lstMsg[56]);bolPasa=false;}else{if(parseFloat(document.getElementById("COM_TIPO").value)==0){alert(lstMsg[71]);bolPasa=false;}if(parseFloat(document.getElementById("SC_ID").value)==0){alert(lstMsg[73]);bolPasa=false;}if(parseFloat(document.getElementById("FPV_ID").value)==0){alert(lstMsg[74]);bolPasa=false;}if(parseFloat(document.getElementById("CDE_ID").value)==0){alert(lstMsg[76]);bolPasa=false;}if(parseFloat(document.getElementById("COM_MONEDA").value)==0){alert(lstMsg[80]);bolPasa=false;}if(document.getElementById("COM_FECHA").value==""){alert(lstMsg[72]);bolPasa=false;}if(bolPasa){SaveODCDo();}}}function SaveODCDo(){$("#dialogWait").dialog("open");var strPOST="";var strPrefijoMaster="COM";var strPrefijoDeta="COMD";var strKey="COM_ID";var strNomFormat="COMPRAS";strPOST+="SC_ID="+d.getElementById("SC_ID").value;strPOST+="&COM_ID="+d.getElementById("COM_ID").value;strPOST+="&"+strPrefijoMaster+"_TIPO="+d.getElementById("COM_TIPO").value;strPOST+="&"+strPrefijoMaster+"_FECHA="+d.getElementById("COM_FECHA").value;strPOST+="&"+strPrefijoMaster+"_FOLIO="+d.getElementById("COM_FOLIO").value;strPOST+="&PV_ID="+d.getElementById("FPV_ID").value;strPOST+="&"+strPrefijoMaster+"_PEDIMENTO=";strPOST+="&"+strPrefijoMaster+"_NOTAS="+d.getElementById("COM_NOTAS").value;strPOST+="&"+strPrefijoMaster+"_REFERENCIA="+d.getElementById("COM_REFERENCIA").value;strPOST+="&"+strPrefijoMaster+"_NOTASPIE="+d.getElementById("COM_NOTASPIE").value;strPOST+="&"+strPrefijoMaster+"_FORMADEPAGO="+d.getElementById("COM_FORMADEPAGO").value;strPOST+="&"+strPrefijoMaster+"_CONDPAGO="+d.getElementById("COM_CONDPAGO").value;strPOST+="&"+strPrefijoMaster+"_METODOPAGO="+d.getElementById("COM_METODOPAGO").value;strPOST+="&"+strPrefijoMaster+"_NUMCUENTA="+d.getElementById("COM_NUMCUENTA").value;strPOST+="&"+strPrefijoMaster+"_MONEDA="+d.getElementById("COM_MONEDA").value;strPOST+="&"+strPrefijoMaster+"_TASAPESO=0";if(document.getElementById("COM_USO_IEPS1").checked){strPOST+="&"+strPrefijoMaster+"_USO_IEPS=1";strPOST+="&"+strPrefijoMaster+"_TASA_IEPS="+d.getElementById("COM_TASA_IEPS").value;strPOST+="&"+strPrefijoMaster+"_IMPORTE_IEPS="+d.getElementById("COM_IMPORTE_IEPS").value;}else{strPOST+="&"+strPrefijoMaster+"_USO_IEPS=0";strPOST+="&"+strPrefijoMaster+"_TASA_IEPS=0";strPOST+="&"+strPrefijoMaster+"_IMPORTE_IEPS=0";}strPOST+="&"+strPrefijoMaster+"_DIASCREDITO="+d.getElementById("COM_DIASCREDITO").value;strPOST+="&"+strPrefijoMaster+"_TASA1="+dblTasaODC1;strPOST+="&"+strPrefijoMaster+"_TASA2="+dblTasaODC2;strPOST+="&"+strPrefijoMaster+"_TASA3="+dblTasaODC3;strPOST+="&"+"TI_ID="+document.getElementById("COM_TASASEL1").value;strPOST+="&"+"TI_ID2="+intIdTasaODC2;strPOST+="&"+"TI_ID3="+intIdTasaODC3;strPOST+="&"+strPrefijoMaster+"_IMPORTE="+d.getElementById("COM_IMPORTE").value;strPOST+="&"+strPrefijoMaster+"_IMPUESTO1="+d.getElementById("COM_IMPUESTO1").value;strPOST+="&"+strPrefijoMaster+"_TOTAL="+d.getElementById("COM_TOT").value;strPOST+="&"+strPrefijoMaster+"_NETO="+d.getElementById("COM_NETO").value;strPOST+="&PED_ID="+d.getElementById("PED_ID").value;strPOST+="&"+strPrefijoMaster+"_IMPUESTO2="+d.getElementById("COM_IMPUESTO2").value;strPOST+="&"+strPrefijoMaster+"_IMPUESTO3="+d.getElementById("COM_IMPUESTO3").value;strPOST+="&"+strPrefijoMaster+"_DESCUENTO="+d.getElementById("FPV_DESCUENTO").value;strPOST+="&"+strPrefijoMaster+"_METODO_ENVIO="+d.getElementById("COM_METODO_ENVIO").value;strPOST+="&"+"CDE_ID="+d.getElementById("CDE_ID").value;strPOST+="&"+strPrefijoMaster+"_FECHA_PROMESA="+d.getElementById("COM_FECHA_PROMESA").value;strPOST+="&"+strPrefijoMaster+"_FECHA_DISP_VTA="+d.getElementById("COM_FECHA_DISP_VTA").value;strPOST+="&"+strPrefijoMaster+"_TIPOFLETE="+d.getElementById("COM_TIPOFLETE").value;strPOST+="&TR_ID="+d.getElementById("TR_ID").value;strPOST+="&"+strPrefijoMaster+"_NUM_GUIA="+d.getElementById("COM_NUM_GUIA").value;var grid=jQuery("#COM_GRID");var arr=grid.getDataIDs();var intC=0;for(var i=0;i<arr.length;i++){var id=arr[i];var lstRow=grid.getRowData(id);intC++;strPOST+="&PR_ID"+intC+"="+lstRow.COMD_PR_ID;strPOST+="&"+strPrefijoDeta+"_EXENTO1"+intC+"="+lstRow.COMD_EXENTO1;strPOST+="&"+strPrefijoDeta+"_EXENTO2"+intC+"="+lstRow.COMD_EXENTO2;strPOST+="&"+strPrefijoDeta+"_EXENTO3"+intC+"="+lstRow.COMD_EXENTO3;strPOST+="&"+strPrefijoDeta+"_CVE"+intC+"="+lstRow.COMD_CVE;strPOST+="&"+strPrefijoDeta+"_DESCRIPCION"+intC+"="+lstRow.COMD_DESCRIPCION;strPOST+="&"+strPrefijoDeta+"_CANTIDAD"+intC+"="+lstRow.COMD_CANTIDAD;strPOST+="&"+strPrefijoDeta+"_RET_ISR"+intC+"="+lstRow.COMD_RET_ISR;strPOST+="&"+strPrefijoDeta+"_RET_IVA"+intC+"="+lstRow.COMD_RET_IVA;strPOST+="&"+strPrefijoDeta+"_RET_FLETE"+intC+"="+lstRow.COMD_RET_FLETE;strPOST+="&"+strPrefijoDeta+"_COSTO"+intC+"="+lstRow.COMD_COSTO;strPOST+="&"+strPrefijoDeta+"_COSTOREAL"+intC+"="+lstRow.COMD_COSTOREAL;strPOST+="&"+strPrefijoDeta+"_IMPORTE"+intC+"="+lstRow.COMD_IMPORTE;strPOST+="&"+strPrefijoDeta+"_TASAIVA1"+intC+"="+lstRow.COMD_TASAIVA1;strPOST+="&"+strPrefijoDeta+"_TASAIVA2"+intC+"="+lstRow.COMD_TASAIVA2;strPOST+="&"+strPrefijoDeta+"_TASAIVA3"+intC+"="+lstRow.COMD_TASAIVA3;strPOST+="&"+strPrefijoDeta+"_IMPUESTO1"+intC+"="+lstRow.COMD_IMPUESTO1;strPOST+="&"+strPrefijoDeta+"_IMPUESTO2"+intC+"="+lstRow.COMD_IMPUESTO2;strPOST+="&"+strPrefijoDeta+"_IMPUESTO3"+intC+"="+lstRow.COMD_IMPUESTO3;strPOST+="&"+strPrefijoDeta+"_NOSERIE"+intC+"="+lstRow.COMD_NOSERIE;strPOST+="&"+strPrefijoDeta+"_IMPORTEREAL"+intC+"="+lstRow.COMD_IMPORTEREAL;strPOST+="&"+strPrefijoDeta+"_DESCUENTO"+intC+"="+lstRow.COMD_DESCUENTO;strPOST+="&"+strPrefijoDeta+"_PORDESC"+intC+"="+lstRow.COMD_PORDESC;strPOST+="&"+strPrefijoDeta+"_COSTOFIJO"+intC+"="+lstRow.COMD_PRECFIJO;strPOST+="&"+strPrefijoDeta+"_NOTAS"+intC+"="+lstRow.COMD_NOTAS;strPOST+="&"+strPrefijoDeta+"_UNIDAD_MEDIDA"+intC+"="+lstRow.COMD_UNIDAD_MEDIDA;strPOST+="&"+strPrefijoDeta+"_MONEDA"+intC+"="+lstRow.COMD_MONEDA;strPOST+="&"+strPrefijoDeta+"_PARIDAD"+intC+"="+lstRow.COMD_PARIDAD;}strPOST+="&COUNT_ITEM="+intC;
$.ajax({type:"POST",data:encodeURI(strPOST),scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"html",url:"ODCMov.do?id=1",success:function(dato){dato=trim(dato);if(Left(dato,3)=="OK."){ResetOperaActualODC(false);if(bolAutorizarODC){var strHtml2=CreaHidden(strKey,dato.replace("OK.",""));openFormat(strNomFormat,"PDF",strHtml2);}else{alert(lstMsg[96]);}}else{alert(dato);}$("#dialogWait").dialog("close");},error:function(objeto,quepaso,otroobj){alert(":ODC Save:"+objeto+" "+quepaso+" "+otroobj);$("#dialogWait").dialog("close");}});}function GetODCModi(intODC){$.ajax({type:"POST",data:"COM_ID="+intODC,scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"xml",url:"ODCMov.do?id=8",success:function(datos){var objCompra=datos.getElementsByTagName("vta_compra")[0];var lstdeta=objCompra.getElementsByTagName("deta");if(parseInt(objCompra.getAttribute("COM_ANULADA"))==0){if(parseInt(objCompra.getAttribute("COM_STATUS"))!=3&&parseInt(objCompra.getAttribute("COM_STATUS"))!=4){ResetOperaActualODC(false,false,false);DrawODC(objCompra,lstdeta);$("#dialogView").dialog("close");}else{alert(lstMsg[68]);}}else{alert(lstMsg[51]);}},error:function(objeto,quepaso,otroobj){alert(":ptoExist:"+objeto+" "+quepaso+" "+otroobj);$("#dialogWait").dialog("close");}});}function DrawODC(objCompra,lstdeta){$("#dialogWait").dialog("open");MostrarAvisosODC(lstMsg[67]+" "+objCompra.getAttribute("COM_FOLIO"));document.getElementById("COM_ID").value=objCompra.getAttribute("COM_ID");document.getElementById("COM_FOLIO").value=objCompra.getAttribute("TOD_ID");document.getElementById("COM_FECHA").value=ObtenFecha(objCompra.getAttribute("COM_FECHA"));document.getElementById("SC_ID").value=objCompra.getAttribute("SC_ID");document.getElementById("COM_FOLIO").value=objCompra.getAttribute("COM_FOLIO");document.getElementById("FPV_ID").value=objCompra.getAttribute("PV_ID");document.getElementById("CDE_ID").value=objCompra.getAttribute("CDE_ID");document.getElementById("COM_NOTAS").value=objCompra.getAttribute("COM_NOTAS");document.getElementById("COM_REFERENCIA").value=objCompra.getAttribute("COM_REFERENCIA");document.getElementById("COM_NOTASPIE").value=objCompra.getAttribute("COM_NOTASPIE");document.getElementById("COM_FORMADEPAGO").value=objCompra.getAttribute("COM_FORMADEPAGO");document.getElementById("COM_CONDPAGO").value=objCompra.getAttribute("COM_CONDPAGO");document.getElementById("COM_METODOPAGO").value=objCompra.getAttribute("COM_METODOPAGO");document.getElementById("COM_NUMCUENTA").value=objCompra.getAttribute("COM_NUMCUENTA");document.getElementById("COM_MONEDA").value=objCompra.getAttribute("MON_ID");document.getElementById("COM_TASASEL1").value=objCompra.getAttribute("TI_ID");if(objCompra.getAttribute("COM_USO_IEPS")==1){document.getElementById("COM_USO_IEPS1").checked=true;}else{document.getElementById("COM_USO_IEPS2").checked=false;}document.getElementById("COM_TASA_IEPS").value=objCompra.getAttribute("COM_TASA_IEPS");document.getElementById("PED_ID").value=objCompra.getAttribute("PED_ID");document.getElementById("COM_DIASCREDITO").value=objCompra.getAttribute("COM_DIASCREDITO");document.getElementById("COM_FECHA_DISP_VTA").value=ObtenFecha(objCompra.getAttribute("COM_FECHA_DISP_VTA"));document.getElementById("COM_FECHA_PROMESA").value=ObtenFecha(objCompra.getAttribute("COM_FECHA_PROMESA"));intIdTasaODC1=objCompra.getAttribute("TI_ID");dblTasaODC1=objCompra.getAttribute("COM_TASA1");ObtenNomProvODC(objCompra,lstdeta,true);}function DrawODCDeta(objPedido,lstdeta){for(i=0;i<lstdeta.length;i++){var obj=lstdeta[i];var objImportes=new _ImporteCompra();objImportes.dblCantidad=obj.getAttribute("COMD_CANTIDAD");objImportes.dblPrecio=parseFloat(obj.getAttribute("COMD_COSTO"))/(1+(obj.getAttribute("COMD_TASAIVA1")/100));objImportes.dblPrecioReal=parseFloat(obj.getAttribute("COMD_COSTOREAL"))/(1+(obj.getAttribute("COMD_TASAIVA1")/100));objImportes.dblPorcDescGlobal=document.getElementById("FPV_DESCUENTO").value;objImportes.dblPorcDesc=obj.getAttribute("COMD_PORDESC");objImportes.dblExento1=obj.getAttribute("COMD_EXENTO1");objImportes.dblExento2=obj.getAttribute("COMD_EXENTO2");objImportes.dblExento3=obj.getAttribute("COMD_EXENTO3");objImportes.intDevo=0;objImportes.CalculaImporte();var dblImporte=objImportes.dblImporte;var datarow={COMD_ID:0,COMD_CVE:obj.getAttribute("COMD_CVE"),COMD_DESCRIPCION:obj.getAttribute("COMD_DESCRIPCION"),COMD_CANTIDAD:objImportes.dblCantidad,COMD_IMPORTE:dblImporte,COMD_COSTO:objImportes.dblPrecio,COMD_PORDESC:objImportes.dblPorcAplica,COMD_DESCUENTO:obj.getAttribute("COMD_DESCUENTO"),COMD_IMPUESTO1:objImportes.dblImpuesto1,COMD_NOTAS:obj.getAttribute("COMD_NOTAS"),COMD_TASAIVA1:obj.getAttribute("COMD_TASAIVA1"),COMD_DESGLOSA1:1,COMD_PR_ID:obj.getAttribute("PR_ID"),COMD_EXENTO1:obj.getAttribute("COMD_EXENTO1"),COMD_EXENTO2:obj.getAttribute("COMD_EXENTO2"),COMD_EXENTO3:obj.getAttribute("COMD_EXENTO3"),COMD_NOSERIE:obj.getAttribute("COMD_NOSERIE"),COMD_IMPORTEREAL:obj.getAttribute("COMD_IMPORTEREAL"),COMD_COSTOREAL:objImportes.dblPrecioReal,COMD_UNIDAD_MEDIDA:obj.getAttribute("COMD_UNIDAD_MEDIDA"),COMD_MONEDA:obj.getAttribute("COMD_MONEDA"),COMD_PARIDAD:obj.getAttribute("COMD_PARIDAD"),COMD_TASAIVA2:obj.getAttribute("COMD_TASAIVA2"),COMD_TASAIVA3:obj.getAttribute("COMD_TASAIVA3"),COMD_IMPUESTO2:obj.getAttribute("COMD_IMPUESTO2"),COMD_IMPUESTO3:obj.getAttribute("COMD_IMPUESTO3")};jQuery("#COM_GRID").addRowData(obj.getAttribute("COMD_ID"),datarow,"last");}setSumODC();$("#dialogWait").dialog("close");}function _ImporteCompra(){this.dblImporte=0;this.dblImpuesto1=0;this.dblImpuesto2=0;this.dblImpuesto3=0;this.dblImpuestoReal1=0;this.dblImpuestoReal2=0;this.dblImpuestoReal3=0;this.dblCantidad=0;this.dblPrecio=0;this.dblPorcDesc=0;this.dblPorcDescGlobal=0;this.dblPrecFijo=0;this.dblExento1=0;this.dblExento2=0;this.dblExento3=0;this.dblImporteReal=0;this.dblPrecioReal=0;this.intDevo=0;this.dblPorcAplica=0;this.intPrecioZeros=0;this.CalculaImporte=function CalculaImporte(){this.dblPorcDescGlobal=parseFloat(this.dblPorcDescGlobal);this.dblPorcDesc=parseFloat(this.dblPorcDesc);var dblPrecioAplica=parseFloat(this.dblPrecio);if(this.dblPrecFijo==0||this.intPrecioZeros==1){this.dblPorcAplica=0;if(this.dblPorcDescGlobal>0&&this.dblPorcDesc>0){if(this.dblPorcDescGlobal>this.dblPorcDesc){this.dblPorcAplica=this.dblPorcDescGlobal;}if(this.dblPorcDesc>this.dblPorcDescGlobal){this.dblPorcAplica=this.dblPorcDesc;}}else{if(this.dblPorcDescGlobal>0){this.dblPorcAplica=this.dblPorcDescGlobal;}if(this.dblPorcDesc>0){this.dblPorcAplica=this.dblPorcDesc;}}if(this.dblPorcAplica>0){dblPrecioAplica=dblPrecioAplica-(dblPrecioAplica*(this.dblPorcAplica/100));}}this.dblImporte=parseFloat(this.dblCantidad)*parseFloat(dblPrecioAplica);this.dblImporteReal=parseFloat(this.dblCantidad)*parseFloat(this.dblPrecioReal);if(parseInt(this.intDevo)==1){this.dblImporte=this.dblImporte*-1;}var dblBase1=this.dblImporte;var dblBase2=this.dblImporte;var dblBase3=this.dblImporte;if(parseInt(this.dblExento1)==1){dblBase1=0;}if(parseInt(this.dblExento2)==1){dblBase2=0;}if(parseInt(this.dblExento3)==1){dblBase3=0;}var tax=new Impuestos(dblTasaODC1,dblTasaODC2,dblTasaODC3,intSImpODC1_2,intSImpODC1_3,intSImpODC2_3);if(intPreciosconImp==1){tax.CalculaImpuesto(dblBase1,dblBase2,dblBase3);}else{tax.CalculaImpuestoMas(dblBase1,dblBase2,dblBase3);}if(parseInt(this.dblExento1)==0){this.dblImpuesto1=tax.dblImpuesto1;}if(parseInt(this.dblExento2)==0){this.dblImpuesto2=tax.dblImpuesto2;}if(parseInt(this.dblExento3)==0){this.dblImpuesto3=tax.dblImpuesto3;}var dblBaseReal1=this.dblImporteReal;var dblBaseReal2=this.dblImporteReal;var dblBaseReal3=this.dblImporteReal;if(parseInt(this.dblExento1)==1){dblBaseReal1=0;}if(parseInt(this.dblExento2)==1){dblBaseReal2=0;}if(parseInt(this.dblExento3)==1){dblBaseReal3=0;}if(intPreciosconImp==1){tax.CalculaImpuesto(dblBaseReal1,dblBaseReal2,dblBaseReal3);}else{tax.CalculaImpuestoMas(dblBaseReal1,dblBaseReal2,dblBaseReal3);
}if(parseInt(this.dblExento1)==0){this.dblImpuestoReal1=tax.dblImpuesto1;}if(parseInt(this.dblExento2)==0){this.dblImpuestoReal2=tax.dblImpuesto2;}if(parseInt(this.dblExento3)==0){this.dblImpuestoReal3=tax.dblImpuesto3;}if(this.intPrecioZeros==1){this.dblImporteReal=parseFloat(this.dblCantidad)*parseFloat(this.dblPrecio);}if(intPreciosconImp==0){this.dblImporteReal+=this.dblImpuestoReal1+this.dblImpuestoReal2+this.dblImpuestoReal3;this.dblImporte+=this.dblImpuesto1+this.dblImpuesto2+this.dblImpuesto3;}};}function EvalSucursalODC(){var grid=jQuery("#COM_GRID");var arr=grid.getDataIDs();var objSuc=document.getElementById("SC_ID");var objTasaSel=document.getElementById("COM_TASASEL1");var objProv=document.getElementById("FPV_ID");if(arr.length>0){objSuc.onmouseout=function(){this.disabled=false;};objSuc.onmouseleave=function(){this.disabled=false;};objSuc.onmouseover=function(){this.disabled=true;};objSuc.setAttribute("class","READONLY");objSuc.setAttribute("className","READONLY");objTasaSel.onmouseout=function(){this.disabled=false;};objTasaSel.onmouseleave=function(){this.disabled=false;};objTasaSel.onmouseover=function(){this.disabled=true;};objTasaSel.setAttribute("class","READONLY");objTasaSel.setAttribute("className","READONLY");objProv.setAttribute("class","READONLY");objProv.setAttribute("className","READONLY");objProv.disabled=true;}else{objSuc.disabled=false;objSuc.onmouseout=function(){var g=1;};objSuc.onmouseleave=function(){var g=1;};objSuc.onmouseover=function(){var g=1;};objSuc.setAttribute("class","outEdit");objSuc.setAttribute("className","outEdit");objTasaSel.disabled=false;objTasaSel.onmouseout=function(){var g=1;};objTasaSel.onmouseleave=function(){var g=1;};objTasaSel.onmouseover=function(){var g=1;};objTasaSel.setAttribute("class","outEdit");objTasaSel.setAttribute("className","outEdit");objProv.setAttribute("class","outEdit");objProv.setAttribute("className","outEdit");objProv.disabled=false;}}function UpdateTasaImpODC(){var objTasaSel=document.getElementById("COM_TASASEL1");$("#dialogWait").dialog("open");$.ajax({type:"POST",data:"TI_ID="+objTasaSel.value,scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"xml",url:"VtasMov.do?id=11",success:function(datos){var objPedido=datos.getElementsByTagName("vta_impuesto")[0];var lstdeta=objPedido.getElementsByTagName("vta_impuestos");for(var i=0;i<lstdeta.length;i++){var obj=lstdeta[i];intIdTasaODC1=objTasaSel.value;dblTasaODC1=obj.getAttribute("Tasa1");}_UpdateItemsODC();$("#dialogWait").dialog("close");},error:function(objeto,quepaso,otroobj){alert(":ODC Taxes:"+objeto+" "+quepaso+" "+otroobj);$("#dialogWait").dialog("close");}});}function CambioCostSendODC(){var grid=jQuery("#COM_GRID");var ids=grid.getGridParam("selrow");if(ids!=null){var dblNvoPrec=d.getElementById("_NvoCost").value;var bolClean=false;if(d.getElementById("_NvoClean1").checked){bolClean=true;}CambioCostDo(ids,dblNvoPrec,bolClean);}}function CambioCostDo(id,dblNvoCost,bolClean){var grid=jQuery("#COM_GRID");var lstRow=grid.getRowData(id);if(bolClean){lstRow.COMD_COSTO=lstRow.COMD_COSTOREAL;lstRow.COMD_PRECFIJO=0;}else{lstRow.COMD_COSTO=dblNvoCost;lstRow.COMD_PRECFIJO=1;}lstRowChangePrecioODC(lstRow,id,grid);document.getElementById("COM_PROD").focus();}function CambioQtySendODC(){var grid=jQuery("#COM_GRID");var ids=grid.getGridParam("selrow");if(ids!=null){var dblNvoQty=d.getElementById("_NvoQty").value;var bolClean=false;if(d.getElementById("_NvoClean1").checked){bolClean=true;}CambioQtyDo(ids,dblNvoQty,bolClean);}}function CambioQtyDo(id,dblNvoQty,bolClean){var grid=jQuery("#COM_GRID");var lstRow=grid.getRowData(id);lstRow.COMD_CANTIDAD=dblNvoQty;lstRowChangePrecioODC(lstRow,id,grid);document.getElementById("COM_PROD").focus();}function RefreshMonedaODC(){var objMoneda=document.getElementById("COM_MONEDA");}function RefreshTipoCompra(){var objTipo=document.getElementById("COM_TIPO");var objMetodo=document.getElementById("COM_METODOPAGO");var objNumCuenta=document.getElementById("COM_NUMCUENTA");var objReferencia=document.getElementById("COM_REFERENCIA");if(objTipo.value=="2"){objMetodo.parentNode.parentNode.style.display="none";objNumCuenta.parentNode.parentNode.style.display="none";objReferencia.parentNode.parentNode.style.display="none";}else{objMetodo.parentNode.parentNode.style.display="block";objNumCuenta.parentNode.parentNode.style.display="block";objReferencia.parentNode.parentNode.style.display="block";}}function addDays(myDate,days){return new Date(myDate.getTime()+days*24*60*60*1000);}function AplicaIEPS(){alert("AplicaIEPS");var objCOM_USO_IEPS1=document.getElementById("COM_USO_IEPS1");var objTasaIEPS=document.getElementById("COM_TASA_IEPS");if(!objCOM_USO_IEPS1.checked){objTasaIEPS.onmouseout=function(){this.disabled=false;};objTasaIEPS.onmouseleave=function(){this.disabled=false;};objTasaIEPS.onmouseover=function(){this.disabled=true;};objTasaIEPS.setAttribute("class","READONLY");objTasaIEPS.setAttribute("className","READONLY");}else{objTasaIEPS.disabled=false;objTasaIEPS.onmouseout=function(){var g=1;};objTasaIEPS.onmouseleave=function(){var g=1;};objTasaIEPS.onmouseover=function(){var g=1;};objTasaIEPS.setAttribute("class","outEdit");objTasaIEPS.setAttribute("className","outEdit");}}function AddItemEvtODCCant(event,obj){if(event.keyCode==13){d.getElementById("COM_CANT").focus();d.getElementById("COM_CANT").select();}}function GetFolioAuto(){$("#dialogWait").dialog("open");$.ajax({type:"POST",data:"TYPE_ID=6",scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"xml",url:"VtasMov.do?id=14",success:function(datos){var objsc=datos.getElementsByTagName("vta_folios")[0];var strFolioT=objsc.getAttribute("FOLIO");document.getElementById("COM_FOLIO").value=strFolioT;d.getElementById("COM_PROD").focus();$("#dialogWait").dialog("close");},error:function(objeto,quepaso,otroobj){alert(":Obten folio siguiente:"+objeto+" "+quepaso+" "+otroobj);d.getElementById("COM_PROD").focus();$("#dialogWait").dialog("close");}});}function _UpdateItemsODC(){var grid=jQuery("#COM_GRID");var arr=grid.getDataIDs();for(var i=0;i<arr.length;i++){var id=arr[i];var lstRow=grid.getRowData(id);lstRowChangePrecioODC(lstRow,id,grid);}}function clickVentana(){$("#dialogPCaptura").dialog("open");$("#dialogPCaptura").dialog("option","title","PARRILLA DE CAPTURA");var strHTML="<td>Capture el modelo o clave corta:<input type='text' id = 'txtModelo'>";strHTML+="<td>"+CreaBoton("","btnAgregar","Agregar","BuscaModelo();","left",false,false);strHTML+="<div id='TablaP'>";strHTML+="</div>";strHTML+="Total de Piezas:<input type='text' id = 'TotalP' value='0.0' disabled>";strHTML+="<p><input type='hidden' id = 'TotalM' value='0.0' disabled></p>";strHTML+="<p><input type='hidden' id = 'Descuento' value='0.0' onBlur='CalculaValores()'></p>";strHTML+="<p><input type='hidden' id = 'TotalSinIva' value='0.0' disabled></p>";strHTML+="<p><input type='hidden' id = 'IVA' value='0.0' disabled></p>";strHTML+="<p><input type='hidden' id = 'TotalaPagar' value='0.0' disabled></p>";strHTML+="<td>"+CreaBoton("","btnAceptar","Aceptar","AceptarBoton();","left",false,false);strHTML+="<td>&nbsp;</td>";strHTML+="<td>"+CreaBoton("","btnCancelar","Cancelar","CancelarBoton();","left",false,false);document.getElementById("dialogPCaptura_inside").innerHTML=strHTML;}function BuscaModelo(){var strPOST="strSC_ID="+document.getElementById("SC_ID").value;strPOST+="&Modelo="+document.getElementById("txtModelo").value;$.ajax({type:"POST",data:strPOST,scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"xml",url:"VtasMov.do?id=24",success:function(datos){var objCodBar=datos.getElementsByTagName("Productos")[0];var lstProd=objCodBar.getElementsByTagName("Producto");if(objTabla==null){var divMaster=document.getElementById("TablaP");objTabla=new ctrlTabla(divMaster,1,0,0,"","Mitabla");objTabla.CreaTabla();var objFila=objTabla.AnadeFila("","","","");
var objCelda=objFila.AnadeCelda("","","","");objCelda.AnadeCeldaContenido("Modelo");var objCelda=objFila.AnadeCelda("","","","");objCelda.AnadeCeldaContenido("Descripcion");var objCelda=objFila.AnadeCelda("","","","");objCelda.AnadeCeldaContenido("Color");var objCelda=objFila.AnadeCelda("","","","");objCelda.AnadeCeldaContenido("2/CH");var objCelda=objFila.AnadeCelda("","","","");objCelda.AnadeCeldaContenido("4/M");var objCelda=objFila.AnadeCelda("","","","");objCelda.AnadeCeldaContenido("6/G");var objCelda=objFila.AnadeCelda("","","","");objCelda.AnadeCeldaContenido("8/EG");var objCelda=objFila.AnadeCelda("","","","");objCelda.AnadeCeldaContenido("10/3M");var objCelda=objFila.AnadeCelda("","","","");objCelda.AnadeCeldaContenido("12/6M");var objCelda=objFila.AnadeCelda("","","","");objCelda.AnadeCeldaContenido("14/12M");var objCelda=objFila.AnadeCelda("","","","");objCelda.AnadeCeldaContenido("16/18M");var objCelda=objFila.AnadeCelda("","","","");objCelda.AnadeCeldaContenido("18/24M");var objCelda=objFila.AnadeCelda("","","","");objCelda.AnadeCeldaContenido("UNI");var objCelda=objFila.AnadeCelda("","","","");objCelda.AnadeCeldaContenido("Piezas");}for(var i=0;i<lstProd.length;i++,idT++){var obj=lstProd[i];var objFila=objTabla.AnadeFila("","","","");var objCelda=objFila.AnadeCelda("","","","");var objControl=new Control("idModelo"+idT,"text",10,obj.getAttribute("Modelo"),8,"Recalculo()",false,true);objCelda.AnadeCeldaControl(objControl.CreaControl());var objCelda=objFila.AnadeCelda("","","","");objCelda.AnadeCeldaContenido(obj.getAttribute("Descripcion"));var objCelda=objFila.AnadeCelda("","","","");var objControl=new Control("idColor"+idT,"text",10,obj.getAttribute("Color"),8,"Recalculo()",false,true);objCelda.AnadeCeldaControl(objControl.CreaControl());var objCelda=objFila.AnadeCelda("","","","");var objControl=new Control("idCH"+idT,"text",10,"0",8,"Recalculo()",false,true);objCelda.AnadeCeldaControl(objControl.CreaControl());var objCelda=objFila.AnadeCelda("","","","");var objControl=new Control("idM"+idT,"text",10,"0",8,"Recalculo()",false,true);objCelda.AnadeCeldaControl(objControl.CreaControl());var objCelda=objFila.AnadeCelda("","","","");var objControl=new Control("idG"+idT,"text",10,"0",8,"Recalculo()",false,true);objCelda.AnadeCeldaControl(objControl.CreaControl());var objCelda=objFila.AnadeCelda("","","","");var objControl=new Control("idXG"+idT,"text",10,"0",8,"Recalculo()",false,true);objCelda.AnadeCeldaControl(objControl.CreaControl());var objCelda=objFila.AnadeCelda("","","","");var objControl=new Control("idRN"+idT,"text",10,"0",8,"Recalculo()",false,true);objCelda.AnadeCeldaControl(objControl.CreaControl());var objCelda=objFila.AnadeCelda("","","","");var objControl=new Control("id3M"+idT,"text",10,"0",8,"Recalculo()",false,true);objCelda.AnadeCeldaControl(objControl.CreaControl());var objCelda=objFila.AnadeCelda("","","","");var objControl=new Control("id6M"+idT,"text",10,"0",8,"Recalculo()",false,true);objCelda.AnadeCeldaControl(objControl.CreaControl());var objCelda=objFila.AnadeCelda("","","","");var objControl=new Control("id12M"+idT,"text",10,"0",8,"Recalculo()",false,true);objCelda.AnadeCeldaControl(objControl.CreaControl());var objCelda=objFila.AnadeCelda("","","","");var objControl=new Control("id18M"+idT,"text",10,"0",8,"Recalculo()",false,true);objCelda.AnadeCeldaControl(objControl.CreaControl());var objCelda=objFila.AnadeCelda("","","","");var objControl=new Control("id24M"+idT,"text",10,"0",8,"Recalculo()",false,true);objCelda.AnadeCeldaControl(objControl.CreaControl());var objCelda=objFila.AnadeCelda("","","","");var objControl=new Control("idPiezas"+idT,"text",10,"0",8,"Recalculo()",false,true);objCelda.AnadeCeldaControl(objControl.CreaControl());var lstTallas=obj.getAttribute("Tallas").split(",");var objCelda=objFila.AnadeCelda("","","","");var objControl=new Control("idTallas"+idT,"hidden",10,lstTallas,8,"Recalculo()",false,true);objCelda.AnadeCeldaControl(objControl.CreaControl());for(var j=0;j<lstTallas.length;j++){var strTalla=lstTallas[j].toUpperCase();strTalla=strTalla.replace(" ","");switch(strTalla){case"2":case"CH":document.getElementById("idCH"+idT).disabled=false;break;case"4":case"M":document.getElementById("idM"+idT).disabled=false;break;case"6":case"G":document.getElementById("idG"+idT).disabled=false;break;case"8":case"EG":document.getElementById("idXG"+idT).disabled=false;break;case"10":case"3M":document.getElementById("idRN"+idT).disabled=false;break;case"12":case"6M":document.getElementById("id3M"+idT).disabled=false;break;case"14":case"12M":document.getElementById("id6M"+idT).disabled=false;break;case"16":case"18M":document.getElementById("id12M"+idT).disabled=false;break;case"18":case"24M":document.getElementById("id18M"+idT).disabled=false;break;case"UNI":document.getElementById("id24M"+idT).disabled=false;break;}}}numFilas=idT;document.getElementById("txtModelo").value="";document.getElementById("txtModelo").focus();},error:function(objeto,quepaso,otroobj){alert(":Series pto:"+objeto+" "+quepaso+" "+otroobj);}});}function AceptarBoton(){var strNombreCorto="";var strColor="";var strTalla="";var strTalla2="";var strCantidad="";for(var i=0;i<numFilas;i++){if(document.getElementById("idCH"+i).value!=0){strNombreCorto+=document.getElementById("idModelo"+i).value+",";strColor+=document.getElementById("idColor"+i).value+",";strCantidad+=document.getElementById("idCH"+i).value+",";strTalla+="2,";strTalla2+="CH,";}if(document.getElementById("idM"+i).value!=0){strNombreCorto+=document.getElementById("idModelo"+i).value+",";strColor+=document.getElementById("idColor"+i).value+",";strCantidad+=document.getElementById("idM"+i).value+",";strTalla+="4,";strTalla2+="M,";}if(document.getElementById("idG"+i).value!=0){strNombreCorto+=document.getElementById("idModelo"+i).value+",";strColor+=document.getElementById("idColor"+i).value+",";strCantidad+=document.getElementById("idG"+i).value+",";strTalla+="6,";strTalla2+="G,";}if(document.getElementById("idXG"+i).value!=0){strNombreCorto+=document.getElementById("idModelo"+i).value+",";strColor+=document.getElementById("idColor"+i).value+",";strCantidad+=document.getElementById("idXG"+i).value+",";strTalla+="8,";strTalla2+="EG,";}if(document.getElementById("idRN"+i).value!=0){strNombreCorto+=document.getElementById("idModelo"+i).value+",";strColor+=document.getElementById("idColor"+i).value+",";strCantidad+=document.getElementById("idRN"+i).value+",";strTalla+="10,";strTalla2+="3M,";}if(document.getElementById("id3M"+i).value!=0){strNombreCorto+=document.getElementById("idModelo"+i).value+",";strColor+=document.getElementById("idColor"+i).value+",";strCantidad+=document.getElementById("id3M"+i).value+",";strTalla+="12,";strTalla2+="6M,";}if(document.getElementById("id6M"+i).value!=0){strNombreCorto+=document.getElementById("idModelo"+i).value+",";strColor+=document.getElementById("idColor"+i).value+",";strCantidad+=document.getElementById("id6M"+i).value+",";strTalla+="14,";strTalla2+="12M,";}if(document.getElementById("id12M"+i).value!=0){strNombreCorto+=document.getElementById("idModelo"+i).value+",";strColor+=document.getElementById("idColor"+i).value+",";strCantidad+=document.getElementById("id12M"+i).value+",";strTalla+="16,";strTalla2+="28M,";}if(document.getElementById("id18M"+i).value!=0){strNombreCorto+=document.getElementById("idModelo"+i).value+",";strColor+=document.getElementById("idColor"+i).value+",";strCantidad+=document.getElementById("id18M"+i).value+",";strTalla+="18,";strTalla2+="24M,";}if(document.getElementById("id24M"+i).value!=0){strNombreCorto+=document.getElementById("idModelo"+i).value+",";strColor+=document.getElementById("idColor"+i).value+",";strCantidad+=document.getElementById("id24M"+i).value+",";strTalla+="UNI,";strTalla2+="UNI,";}}var strPOST="&NombreCorto="+strNombreCorto;strPOST+="&Colores="+strColor;strPOST+="&Tallas="+strTalla;strPOST+="&Tallas2="+strTalla2;strPOST+="&Cantidad="+strCantidad;$.ajax({type:"POST",data:strPOST,scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"xml",url:"VtasMov.do?id=26",success:function(datos){var lstXml=datos.getElementsByTagName("ElementosT")[0];
var lstElementos=lstXml.getElementsByTagName("ElementoT");var bolFind=false;var intMoneda=document.getElementById("COM_MONEDA").value;var dblParidad=1;for(var i=0;i<lstElementos.length;i++){var obj2=lstElementos[i];var objImportes=new _ImporteCompra();objImportes.dblCantidad=parseFloat(obj2.getAttribute("CANTIDAD"));var dblPrecio=obj2.getAttribute("PRECIO");objImportes.dblPuntos=parseFloat(obj2.getAttribute("PP_PUNTOS"));objImportes.dblVNegocio=parseFloat(obj2.getAttribute("PP_NEGOCIO"));objImportes.dblPrecio=parseFloat(dblPrecio);objImportes.dblPrecioReal=parseFloat(dblPrecio);objImportes.dblExento1=obj2.getAttribute("PR_EXENTO1");objImportes.dblExento2=obj2.getAttribute("PR_EXENTO2");objImportes.dblExento3=obj2.getAttribute("PR_EXENTO3");objImportes.intDevo=0;if(parseInt(obj2.getAttribute("PP_APDESC"))==0){objImportes.bolAplicDescPrec=false;}if(parseInt(obj2.getAttribute("PP_APDESCPTO"))==0){objImportes.bolAplicDescPto=false;}if(parseInt(obj2.getAttribute("PP_APDESCNEGO"))==0){objImportes.bolAplicDescVNego=false;}objImportes.CalculaImporte();var dblDescuento=objImportes.dblImporteDescuento;var dblImporte=objImportes.dblImporte;var datarow={COMD_ID:0,COMD_CANTIDAD:parseFloat(obj2.getAttribute("CANTIDAD")),COMD_DESCRIPCION:obj2.getAttribute("PR_DESCRIPCION"),COMD_IMPORTE:dblImporte,COMD_CVE:obj2.getAttribute("PR_CODIGO"),COMD_COSTO:obj2.getAttribute("PR_COSTOCOMPRA"),COMD_TASAIVA1:dblTasaODC1,COMD_TASAIVA2:dblTasaODC2,COMD_TASAIVA3:dblTasaODC3,COMD_DESGLOSA1:1,COMD_IMPUESTO1:objImportes.dblImpuesto1,COMD_IMPUESTO2:objImportes.dblImpuesto2,COMD_IMPUESTO3:objImportes.dblImpuesto3,COMD_PR_ID:obj2.getAttribute("PR_ID"),COMD_EXENTO1:obj2.getAttribute("PR_EXENTO1"),COMD_EXENTO2:obj2.getAttribute("PR_EXENTO2"),COMD_EXENTO3:obj2.getAttribute("PR_EXENTO3"),COMD_REQEXIST:obj2.getAttribute("PR_REQEXIST"),COMD_EXIST:obj2.getAttribute("PR_EXISTENCIA"),COMD_NOSERIE:"",COMD_ESREGALO:0,COMD_IMPORTEREAL:dblImporte,COMD_COSTOREAL:obj2.getAttribute("PR_COSTOCOMPRA"),COMD_DESCUENTO:dblDescuento,COMD_PORDESC:objImportes.dblPorcAplica,COMD_PRECFIJO:0,COMD_ESDEVO:0,COMD_CODBARRAS:obj2.getAttribute("PR_CODBARRAS"),COMD_NOTAS:"",COMD_RET_ISR:intRET_ISRODC,COMD_RET_IVA:intRET_IVAODC,COMD_RET_FLETE:intRET_FLETEODC,COMD_UNIDAD_MEDIDA:obj2.getAttribute("PR_UNIDADMEDIDA"),COMD_PUNTOS_U:objImportes.dblPuntos,COMD_NEGOCIO_U:objImportes.dblVNegocio,COMD_PUNTOS:objImportes.dblPuntosImporte,COMD_NEGOCIO:objImportes.dblVNegocioImporte,COMD_PR_CAT1:obj2.getAttribute("PR_CATEGORIA1"),COMD_PR_CAT2:obj2.getAttribute("PR_CATEGORIA2"),COMD_PR_CAT3:obj2.getAttribute("PR_CATEGORIA3"),COMD_PR_CAT4:obj2.getAttribute("PR_CATEGORIA4"),COMD_PR_CAT5:obj2.getAttribute("PR_CATEGORIA5"),COMD_PR_CAT6:obj2.getAttribute("PR_CATEGORIA6"),COMD_PR_CAT7:obj2.getAttribute("PR_CATEGORIA7"),COMD_PR_CAT8:obj2.getAttribute("PR_CATEGORIA8"),COMD_PR_CAT9:obj2.getAttribute("PR_CATEGORIA9"),COMD_PR_CAT10:obj2.getAttribute("PR_CATEGORIA10"),COMD_DESC_ORI:0,COMD_REGALO:0,COMD_ID_PROMO:0,COMD_DESC_PREC:parseInt(obj2.getAttribute("PP_APDESC")),COMD_DESC_PTO:parseInt(obj2.getAttribute("PP_APDESCPTO")),COMD_DESC_VN:parseInt(obj2.getAttribute("PP_APDESCNEGO")),COMD_DESC_LEAL:parseInt(obj2.getAttribute("PP_APDESCNEGO")),COMD_USA_SERIE:obj2.getAttribute("PR_USO_NOSERIE"),COMD_SERIES:"",COMD_SERIES_MPD:"",COMD_SERIES_O:"",COMD_SERIES_MPD_O:"",COMD_MONEDA:intMoneda,COMD_PARIDAD:dblParidad};itemIdODC++;jQuery("#COM_GRID").addRowData(itemIdODC,datarow,"last");d.getElementById("COM_PRECIO").value=dblPrecio;d.getElementById("COM_PROD").value="";d.getElementById("COM_PROD").focus();d.getElementById("COM_CANT").value=1;bolFind=true;_PromocionProd(itemIdODC);EvalSucursalODC();}if(!bolFind){}CancelarBoton();$("#dialogPCaptura").dialog("close");},error:function(objeto,quepaso,otroobj){alert(":Series pto:"+objeto+" "+quepaso+" "+otroobj);}});}function CancelarBoton(){$("#dialogPCaptura").dialog("close");objTabla=null;numFilas=0;idT=0;}function Recalculo(){var TotalP=0;for(var i=0;i<numFilas;i++){var TotalPiezas=0;TotalPiezas+=parseFloat(document.getElementById("idCH"+i).value);TotalPiezas+=parseFloat(document.getElementById("idM"+i).value);TotalPiezas+=parseFloat(document.getElementById("idG"+i).value);TotalPiezas+=parseFloat(document.getElementById("idXG"+i).value);TotalPiezas+=parseFloat(document.getElementById("idRN"+i).value);TotalPiezas+=parseFloat(document.getElementById("id3M"+i).value);TotalPiezas+=parseFloat(document.getElementById("id6M"+i).value);TotalPiezas+=parseFloat(document.getElementById("id12M"+i).value);TotalPiezas+=parseFloat(document.getElementById("id18M"+i).value);TotalPiezas+=parseFloat(document.getElementById("id24M"+i).value);document.getElementById("idPiezas"+i).value=parseFloat(TotalPiezas);TotalP+=TotalPiezas;document.getElementById("TotalP").value=TotalP;}}function CalculaValores(){var TotalsinIva=0;var Descuento=parseFloat(document.getElementById("Descuento").value);var Total=parseFloat(document.getElementById("TotalM").value);Descuento=Total*(Descuento/100);TotalsinIva=Total-Descuento;document.getElementById("TotalSinIva").value=TotalsinIva;var IVA=TotalsinIva*(0.16);document.getElementById("IVA").value=IVA;var TotalaPagar=TotalsinIva+IVA;document.getElementById("TotalaPagar").value=TotalaPagar;}function _PromocionProd(idItem){if(intSucOfertas&&bolCargaPromociones){var gridD=jQuery("#COM_GRID");var lstRow=gridD.getRowData(idItem);_CargaVarsProd(lstRow);setSumODC();}else{setSumODC();}}function getCosto(strCodigo){$("#dialogWait").dialog("open");$.ajax({type:"POST",data:"codigo="+strCodigo+"&SC_ID="+d.getElementById("SC_ID").value,scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"xml",url:"ODCMov.do?id=14",success:function(datoVal){var objCosto=datoVal.getElementsByTagName("Datos")[0];var lstCosto=objCosto.getElementsByTagName("costo")[0];document.getElementById("COM_PRECIO").value=lstCosto.getAttribute("PR_COSTO");$("#dialogWait").dialog("close");},error:function(objeto,quepaso,otroobj){alert("obtener Costo:"+objeto+" "+quepaso+" "+otroobj);$("#dialogWait").dialog("close");}});}function RevisaEdicionCompras(){if(intEsEditable!=1){document.getElementById("FPV_ID").disabled=true;document.getElementById("img_FPV_ID").style.display="none";}else{document.getElementById("FPV_ID").disabled=false;document.getElementById("img_FPV_ID").style.display="block";}}