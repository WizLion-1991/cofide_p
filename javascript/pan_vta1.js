var itemIdPAN=0;function pan_vta1(){}function initPanVta(){myLayout.close("west");myLayout.close("east");myLayout.close("south");myLayout.close("north");loadScren();}function loadScren(){$.ajax({url:"PtoVtaPan.jsp",dataType:"html",scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",success:function(datos){document.getElementById("MainPanel").innerHTML=datos;loadCategorias();InitJQGrid();}});}function loadCategorias(){$.ajax({type:"POST",data:"",scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"xml",url:"PtoVtaPanResource.jsp?id=1",success:function(datoVal){var objCte=datoVal.getElementsByTagName("categorias")[0];var lstdeta=objCte.getElementsByTagName("categoria");var strHtml="";for(i=0;i<lstdeta.length;i++){var obj=lstdeta[i];strHtml+='<button id="'+obj.getAttribute("id")+'" name="'+obj.getAttribute("id")+'" class="big_sel" onClick="viewCategoria('+obj.getAttribute("id")+')">'+obj.getAttribute("name")+"</button>";}document.getElementById("comand_button").innerHTML=strHtml;},error:function(objeto,quepaso,otroobj){alert(":categorias:"+objeto+" "+quepaso+" "+otroobj);}});}function viewCategoria(idValor){$.ajax({type:"POST",data:"categoria="+idValor+"&numCat=1",scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"xml",url:"PtoVtaPanResource.jsp?id=10",success:function(datoVal){var objCte=datoVal.getElementsByTagName("categorias")[0];var lstdeta=objCte.getElementsByTagName("categoria");var strHtml="";var intSep=0;for(i=0;i<lstdeta.length;i++){var obj=lstdeta[i];intSep++;strHtml+='<button id="'+obj.getAttribute("id")+'" name="'+obj.getAttribute("id")+'" class="big_sel" onClick="agregaImporte(this,'+obj.getAttribute("id")+","+obj.getAttribute("precio")+","+obj.getAttribute("prec_pza")+",'"+obj.getAttribute("name")+"')\">"+obj.getAttribute("name")+"</button>";if(intSep==8){strHtml+="<br>";intSep=0;}}strHtml+='<br><button id="Regresar_" name="Regresar_" class="big_sel" onClick="loadCategorias()">Regresar</button>';document.getElementById("comand_button").innerHTML=strHtml;},error:function(objeto,quepaso,otroobj){alert(":categorias:"+objeto+" "+quepaso+" "+otroobj);}});}function agregaImporte(objeto,id,precio,precio_pza,descripcion){var dblImporte=parseFloat(precio)*parseFloat(document.getElementById("Cantidad").value);if(parseFloat(document.getElementById("Cantidad").value)<1){if(parseFloat(precio_pza)>0){dblImporte=parseFloat(precio_pza)*(parseFloat(document.getElementById("Cantidad").value)*10);}}var dblDescuento=dblImporte*parseFloat(document.getElementById("Descuento").value)/100;var dblImporteconDescuento=dblImporte-dblDescuento;var datarow={TKTD_ID:id,TKTD_PR_ID:id,TKTD_DESCRIPCION:descripcion,TKTD_CANTIDAD:document.getElementById("Cantidad").value,TKTD_PRECIO:precio,TKTD_IMPORTE:dblImporte,TKTD_DESCUENTO:dblDescuento,TKTD_CON_DESCUENTO:dblImporteconDescuento,TKTD_PORCDESCUENTO:document.getElementById("Descuento").value};itemIdPAN++;jQuery("#list_deta").addRowData(itemIdPAN,datarow,"last");sumaImportes();document.getElementById("Cantidad").value=1;}function sumaImportes(){var dblSuma=0;var dblSumaCant=0;var grid=jQuery("#list_deta");var arr=grid.getDataIDs();for(var i=0;i<arr.length;i++){var id=arr[i];var lstRow=grid.getRowData(id);dblSuma+=parseFloat(lstRow.TKTD_CON_DESCUENTO);dblSumaCant+=parseFloat(lstRow.TKTD_CANTIDAD);}document.getElementById("Total1").value=FormatNumber(dblSuma,2,true);document.getElementById("Total2").value=FormatNumber(dblSumaCant,2,true);}function salirPtoVta(){myLayout.open("west");myLayout.open("east");myLayout.open("south");myLayout.open("north");document.getElementById("MainPanel").innerHTML="";var objMainFacPedi=objMap.getScreen("PANES1");objMainFacPedi.bolActivo=false;objMainFacPedi.bolMain=false;objMainFacPedi.bolInit=false;objMainFacPedi.idOperAct=0;}function plusCant(){document.getElementById("Cantidad").value=parseFloat(document.getElementById("Cantidad").value)+1;}function minusCant(){document.getElementById("Cantidad").value=parseFloat(document.getElementById("Cantidad").value)-1;}function plusCantPza(){if(parseFloat(document.getElementById("Cantidad").value)==1){document.getElementById("Cantidad").value=0;}document.getElementById("Cantidad").value=(parseFloat(document.getElementById("Cantidad").value)+0.1).toPrecision(1);}function minusCantPza(){if(parseFloat(document.getElementById("Cantidad").value)==1){document.getElementById("Cantidad").value=0;}document.getElementById("Cantidad").value=(parseFloat(document.getElementById("Cantidad").value)-0.1).toPrecision(1);}function plusDesc(){document.getElementById("Descuento").value=parseFloat(document.getElementById("Descuento").value)+1;}function minusDesc(){document.getElementById("Descuento").value=parseFloat(document.getElementById("Descuento").value)-1;}function InitJQGrid(){jQuery("#list_deta").jqGrid({datatype:"clientSide",editurl:"_blank.jsp",height:"auto",colNames:["","Id","Descripcion","Cantidad","Precio","Importe","Descuento","Importe c/d","% descuento"],colModel:[{name:"TKTD_ID",index:"TKTD_ID",hidden:true,editable:false,sortable:false,search:false},{name:"TKTD_PR_ID",index:"TKTD_PR_ID",width:50,align:"left",sortable:false,search:true},{name:"TKTD_DESCRIPCION",index:"TKTD_DESCRIPCION",width:150,align:"left",sortable:false,search:true},{name:"TKTD_CANTIDAD",index:"TKTD_CANTIDAD",width:80,align:"right",editable:true,formatter:"number",sortable:false,search:false},{name:"TKTD_PRECIO",index:"TKTD_PRECIO",width:80,align:"left",editable:true,formatter:"number",sortable:false,search:true},{name:"TKTD_IMPORTE",index:"TKTD_IMPORTE",width:80,align:"left",editable:true,formatter:"number",sortable:false,search:true},{name:"TKTD_DESCUENTO",index:"TKTD_DESCUENTO",width:80,align:"left",editable:true,formatter:"number",sortable:false,search:true},{name:"TKTD_CON_DESCUENTO",index:"TKTD_CON_DESCUENTO",width:80,align:"left",editable:true,formatter:"number",sortable:false,search:true},{name:"TKTD_PORCDESCUENTO",index:"TKTD_PORCDESCUENTO",width:80,align:"left",editable:true,formatter:"number",sortable:false,search:true}],sortname:"TKTD_ID",sortorder:"desc",viewrecords:true,caption:"Items vendidos",footerrow:true,userDataOnFooter:true,imgpath:"jqGrid/themes/steel/images",onSelectRow:function(id){}});}function Cancelar(){d.getElementById("Total1").value="0";d.getElementById("Total2").value="0";d.getElementById("Cantidad").value="1";d.getElementById("Descuento").value="0.0";loadCategorias();var grid=jQuery("#list_deta");grid.clearGridData();}function SavePtoVta(){if(parseFloat(d.getElementById("Total2").value)==0){alert("Necesita capturar un producto");return false;}$("#dialogWait").dialog("open");var strPOST="";var strPrefijoMaster="TKT";var strPrefijoDeta="TKTD";var strKey="TKT_ID";var strNomFormat="TICKET";var insSucSave=intSucDefa;var intCteSave=intCteDefa;var strFechaActual=trim(strHoyFecha);strFechaActual=Right(strFechaActual,2)+"/"+Mid(strFechaActual,5,2)+"/"+Left(strFechaActual,4);strPOST+="SC_ID="+insSucSave;strPOST+="&CT_ID="+intCteSave;strPOST+="&VE_ID=0";strPOST+="&PD_ID=1";strPOST+="&"+strPrefijoMaster+"_FOLIO=";strPOST+="&"+strPrefijoMaster+"_ESSERV=0";strPOST+="&"+strPrefijoMaster+"_MONEDA=0";strPOST+="&"+strPrefijoMaster+"_FECHA="+strFechaActual;strPOST+="&"+strPrefijoMaster+"_NOTAS="+"";strPOST+="&"+strPrefijoMaster+"_TOTAL="+d.getElementById("Total1").value;strPOST+="&"+strPrefijoMaster+"_TURNO="+d.getElementById("Turno").value;strPOST+="&"+strPrefijoMaster+"_IMPUESTO1="+"0";strPOST+="&"+strPrefijoMaster+"_IMPUESTO2="+"0";strPOST+="&"+strPrefijoMaster+"_IMPUESTO3="+"0";strPOST+="&"+strPrefijoMaster+"_IMPORTE="+d.getElementById("Total1").value;strPOST+="&"+strPrefijoMaster+"_RETISR="+"";strPOST+="&"+strPrefijoMaster+"_RETIVA="+"";strPOST+="&"+strPrefijoMaster+"_NETO="+"0.00";strPOST+="&"+strPrefijoMaster+"_NOTASPIE="+"";strPOST+="&"+strPrefijoMaster+"_REFERENCIA="+"";strPOST+="&"+strPrefijoMaster+"_CONDPAGO="+"";strPOST+="&"+strPrefijoMaster+"_METODOPAGO="+"";
strPOST+="&"+strPrefijoMaster+"_NUMCUENTA="+"";strPOST+="&"+strPrefijoMaster+"_FORMADEPAGO="+"";strPOST+="&"+strPrefijoMaster+"_NUMPEDI="+"";strPOST+="&"+strPrefijoMaster+"_FECHAPEDI="+"";strPOST+="&"+strPrefijoMaster+"_ADUANA="+"";strPOST+="&"+strPrefijoMaster+"_TIPOCOMP="+"1";strPOST+="&TIPOVENTA="+"";strPOST+="&"+strPrefijoMaster+"_TASA1="+"0.00";strPOST+="&"+strPrefijoMaster+"_TASA2="+"0.00";strPOST+="&"+strPrefijoMaster+"_TASA3="+"0.00";strPOST+="&"+"TI_ID="+"0";strPOST+="&"+"TI_ID2="+"0";strPOST+="&"+"TI_ID3="+"0";strPOST+="&"+strPrefijoMaster+"_TASAPESO="+"1.0";strPOST+="&"+strPrefijoMaster+"_DIASCREDITO="+"0";strPOST+="&"+strPrefijoMaster+"_POR_DESC="+"";strPOST+="&TR_ID="+"0";strPOST+="&ME_ID="+"0";strPOST+="&TF_ID="+"0";strPOST+="&"+strPrefijoMaster+"_NUM_GUIA="+"";strPOST+="&"+strPrefijoMaster+"_PUNTOS="+"";strPOST+="&"+strPrefijoMaster+"_NEGOCIO="+"";if(document.getElementById("FAC_CONSIGNACION1")!=null){if(document.getElementById("FAC_CONSIGNACION1").checked){strPOST+="&"+strPrefijoMaster+"_CONSIGNACION=1";}else{strPOST+="&"+strPrefijoMaster+"_CONSIGNACION=0";}}else{strPOST+="&"+strPrefijoMaster+"_CONSIGNACION=0";}strPOST+="&"+strPrefijoMaster+"_PERIODICIDAD="+"";strPOST+="&"+strPrefijoMaster+"_DIAPER="+"";strPOST+="&"+strPrefijoMaster+"_NO_EVENTOS="+"";var grid=jQuery("#list_deta");var arr=grid.getDataIDs();var intC=0;for(var i=0;i<arr.length;i++){var id=arr[i];var lstRow=grid.getRowData(id);intC++;strPOST+="&PR_ID"+intC+"="+lstRow.TKTD_PR_ID;strPOST+="&"+strPrefijoDeta+"_EXENTO1"+intC+"="+"0";strPOST+="&"+strPrefijoDeta+"_EXENTO2"+intC+"="+"0";strPOST+="&"+strPrefijoDeta+"_EXENTO3"+intC+"="+"0";strPOST+="&"+strPrefijoDeta+"_ESREGALO"+intC+"="+"0";strPOST+="&"+strPrefijoDeta+"_TASAIVA1"+intC+"="+"0";strPOST+="&"+strPrefijoDeta+"_TASAIVA2"+intC+"="+"0";strPOST+="&"+strPrefijoDeta+"_TASAIVA3"+intC+"="+"0";strPOST+="&"+strPrefijoDeta+"_IMPUESTO1"+intC+"="+"0";strPOST+="&"+strPrefijoDeta+"_IMPUESTO2"+intC+"="+"0";strPOST+="&"+strPrefijoDeta+"_IMPUESTO3"+intC+"="+"0";strPOST+="&"+strPrefijoDeta+"_PORDESC"+intC+"="+"0";strPOST+="&"+strPrefijoDeta+"_ESDEVO"+intC+"="+"0";strPOST+="&"+strPrefijoDeta+"_PRECFIJO"+intC+"="+"0";strPOST+="&"+strPrefijoDeta+"_NOTAS"+intC+"="+"0";strPOST+="&"+strPrefijoDeta+"_UNIDAD_MEDIDA"+intC+"="+"0";strPOST+="&"+strPrefijoDeta+"_PRECREAL"+intC+"="+"0";strPOST+="&"+strPrefijoDeta+"_CVE"+intC+"="+lstRow.TKTD_DESCRIPCION;strPOST+="&"+strPrefijoDeta+"_DESCRIPCION"+intC+"="+lstRow.TKTD_DESCRIPCION;strPOST+="&"+strPrefijoDeta+"_CANTIDAD"+intC+"="+lstRow.TKTD_CANTIDAD;strPOST+="&"+strPrefijoDeta+"_PRECIO"+intC+"="+lstRow.TKTD_PRECIO;strPOST+="&"+strPrefijoDeta+"_IMPORTE"+intC+"="+lstRow.TKTD_CON_DESCUENTO;strPOST+="&"+strPrefijoDeta+"_IMPORTEREAL"+intC+"="+lstRow.TKTD_IMPORTE;strPOST+="&"+strPrefijoDeta+"_DESCUENTO"+intC+"="+lstRow.TKTD_DESCUENTO;strPOST+="&"+strPrefijoDeta+"_PORDESC"+intC+"="+lstRow.TKTD_PORCDESCUENTO;}strPOST+="&COUNT_ITEM="+intC;strPOST+="&COUNT_PAGOS=1";strPOST+="&MCD_MONEDA1=1";strPOST+="&MCD_FOLIO1=";strPOST+="&MCD_FORMAPAGO1=EFECTIVO";strPOST+="&MCD_NOCHEQUE1=";strPOST+="&MCD_BANCO1=";strPOST+="&MCD_NOTARJETA1=";strPOST+="&MCD_TIPOTARJETA1=";strPOST+="&MCD_IMPORTE1=0.0";strPOST+="&MCD_TASAPESO1=1";strPOST+="&MCD_CAMBIO1=0.0";$.ajax({type:"POST",data:encodeURI(strPOST),scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"html",url:"VtasMov.do?id=1",success:function(dato){dato=trim(dato);if(Left(dato,3)=="OK."){Abrir_Link("JasperReport?REP_ID=40&boton_1=PDF&tkt_id="+dato.replace("OK.",""),"_reporte",500,600,0,0);}else{alert(dato);}d.getElementById("Total1").value="0";d.getElementById("Total2").value="0";d.getElementById("Cantidad").value="1";d.getElementById("Descuento").value="0.0";loadCategorias();var grid=jQuery("#list_deta");grid.clearGridData();$("#dialogWait").dialog("close");},error:function(objeto,quepaso,otroobj){alert(":pto9:"+objeto+" "+quepaso+" "+otroobj);$("#dialogWait").dialog("close");}});}function NewVta(){d.getElementById("Total1").value="0";d.getElementById("Total2").value="0";d.getElementById("Cantidad").value="1";d.getElementById("Descuento").value="0.0";loadCategorias();var grid=jQuery("#list_deta");grid.clearGridData();}function BorrarItem(){var grid=jQuery("#list_deta");var id=grid.getGridParam("selrow");if(id!=null){grid.delRowData(grid.getGridParam("selrow"));sumaImportes();}}function initPanRepo1(){MakeReportInside(5001,"","","1");}function initPanCierre(){}