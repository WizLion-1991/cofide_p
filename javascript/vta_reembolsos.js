var lastselBco=0;var dblCantidadMaximaPago=0;var dblFaltaXPagar=0;var idAnticipo=0;var intMonProv=1;var TC_OriAnti=0;var intUsaMonedaOriginal=0;var intEsReembolso=1;var contAddGrid=0;function vta_reembolsos(){}function Init_reembolsos(){var strHtml="<ul>"+getMenuItem("Reemb_SaveCobCtas();","Guardar Pago","images/ptovta/CircleSave.png")+getMenuItem("Reemb_Salir();","Salir","images/ptovta/exitBig.png")+"</ul>";document.getElementById("TOOLBAR").innerHTML=strHtml;d.getElementById("btn1").style.display="none";d.getElementById("RMB_PROVEEDOR_ID_ANT").style.display="none";d.getElementById("RMB_PROVEEDOR_NOM_ANT").style.display="none";d.getElementById("RMB_PROVEEDOR_NOM_ANT").style.display="none";d.getElementById("BTN_PROVEEDOR_ANT").style.display="none";d.getElementById("RMB_BANCO").style.display="";d.getElementById("RMB_RFC_TER_TRANS").style.display="";$("#RMB_GRID_ANTI").jqGrid("setGridState","hidden");d.getElementById("RMB_FALTA_USAR").value=0;document.getElementById("RMB_NOCHEQUE").style.display="none";document.getElementById("RMB_BCO_TRANS").style.display="none";document.getElementById("RMB_CTA_TRANS").style.display="none";document.getElementById("RMB_RFC_TER_TRANS").style.display="none";}var opcPopupProv;function Reemb_OpnDiagProvCob1(){OpnOpt("PROVEEDOR","grid","dialogProv",false,false);opcPopupProv=1;}function Reemb_OpnDiagProvCob2(){OpnOpt("PROVEEDOR","grid","dialogProv",false,false);opcPopupProv=2;}function Reemb_CargaAnticipos(){$("#dialogWait").dialog("open");var intPV=document.getElementById("RMB_PROVEEDOR_ID_ANT").value;if(intPV==0){ValidaShow("RMB_PROVEEDOR_ID_ANT","NECESITA SELECCIONAR UN PROVEEDOR");}else{var intMonPago=document.getElementById("RMB_MONEDA").value;var intMonDoc=document.getElementById("RMB_MONEDA").value;var strPOST="PV_ID="+intPV;strPOST+="&MONEDAPAGO="+intMonPago;$.ajax({type:"POST",data:strPOST,scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"xml",url:"ERP_CobrosCuentas.jsp?id=14",success:function(datos){var objsc=datos.getElementsByTagName("Anticipos")[0];var lstAnticipos=objsc.getElementsByTagName("Anticipo");jQuery("#RMB_GRID_ANTI").clearGridData();if(lstAnticipos.length!=0){for(var i=0;i<lstAnticipos.length;i++){var obj=lstAnticipos[i];var strFecha=obj.getAttribute("MP_FECHA");var intMoneda=0;if(document.getElementById("RMB_ANTI_MON_ORI").value=="0"){intMoneda=parseInt(obj.getAttribute("MP_MONEDA"));}else{intMoneda=parseInt(document.getElementById("RMB_MONEDA").value);}var txtMONEDA="";if(intMoneda==1){txtMONEDA="PESOS";}else{if(intMoneda==2){txtMONEDA="DOLARES";}else{if(intMoneda==3){txtMONEDA="EUROS";}}}strFecha=strFecha.substr(strFecha.length-2,strFecha.length)+"/"+strFecha.substr(4,2)+"/"+strFecha.substr(0,4);var dblMonProv=parseFloat(obj.getAttribute("MP_SALDO_ANTICIPO"));var strEsCampo=document.getElementById("RMB_ANTI_MON_ORI").value;if(strEsCampo=="1"){var datarow={GRID_ANTI_ID:obj.getAttribute("MP_ID"),GRID_ANTI_FECHA:strFecha,GRID_ANTI_ABONO:FormatNumber(obj.getAttribute("MP_SALDO_ANTICIPO"),intNumdecimal,true),GRID_ANTI_FOLIO:obj.getAttribute("MP_FOLIO"),GRID_ANTI_MONEDA:obj.getAttribute("MP_MONEDA"),GRID_ANTI_TASAPESO:obj.getAttribute("MP_TASAPESO"),GRID_ANTI_ORIGINAL:FormatNumber(obj.getAttribute("dblMP_ANTICIPO_ORIGINAL"),intNumdecimal,true),GRID_ANTI_MONEDA_LETRA:txtMONEDA,GRID_ANTI_MONEDAPROV:document.getElementById("RMB_MONEDA").value};jQuery("#RMB_GRID_ANTI").addRowData(i,datarow,"last");}else{var datarow={GRID_ANTI_ID:obj.getAttribute("MP_ID"),GRID_ANTI_FECHA:strFecha,GRID_ANTI_ABONO:obj.getAttribute("MP_SALDO_ANTICIPO"),GRID_ANTI_FOLIO:obj.getAttribute("MP_FOLIO"),GRID_ANTI_MONEDA:obj.getAttribute("MP_MONEDA"),GRID_ANTI_TASAPESO:obj.getAttribute("MP_TASAPESO"),GRID_ANTI_ORIGINAL:obj.getAttribute("dblMP_ANTICIPO_ORIGINAL"),GRID_ANTI_MONEDA_LETRA:txtMONEDA,GRID_ANTI_MONEDAPROV:document.getElementById("RMB_MONEDA").value};jQuery("#RMB_GRID_ANTI").addRowData(i,datarow,"last");}}$("#dialogWait").dialog("close");}else{alert("El proveedor seeleccionado no tiene anticipos");document.getElementById("RMB_ESANTICIPO2").checked=true;$("#dialogWait").dialog("close");$("#RMB_GRID_ANTI").jqGrid("setGridState","hidden");Reemb_EsAnticipo();}},error:function(objeto,quepaso,otroobj){alert(":ptoExist:"+objeto+" "+quepaso+" "+otroobj);$("#dialogWait").dialog("close");}});}}function Reemb_PeticionMonedaProv(){$("#dialogWait").dialog("open");var strPROV_ID=document.getElementById("RMB_PROVEEDOR_ID_ANT").value;if(strPROV_ID==""){strPROV_ID=0;}var strPOST="PROV_ID="+strPROV_ID;$.ajax({type:"POST",data:encodeURI(strPOST),scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"html",url:"ERP_CobrosCuentas.jsp?id=15",success:function(dato){if(!isNaN(dato)){Reemb_ObtenNomProvAntCobrosCta();intMonProv=parseInt(dato);jQuery("#RMB_GRID_ANTI").clearGridData();Reemb_CambiaBanco();}$("#dialogWait").dialog("close");},error:function(objeto,quepaso,otroobj){alert(":pto9:"+objeto+" "+quepaso+" "+otroobj);$("#dialogWait").dialog("close");}});}function Reemb_ObtenNomProvAntCobrosCta(){var strPV_ID=document.getElementById("RMB_PROVEEDOR_ID_ANT").value;var strPOST="&PV_ID="+strPV_ID;$("#dialogWait").dialog("open");$.ajax({type:"POST",data:strPOST,scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"html",url:"ERP_CobrosCuentas.jsp?id=11",success:function(datos){if(trim(datos)){var info=datos.split("|");document.getElementById("RMB_PROVEEDOR_NOM_ANT").value=info[0];document.getElementById("RMB_ANTI_MON_ORI").value=info[2];$("#dialogWait").dialog("close");}else{$("#dialogWait").dialog("close");}},error:function(objeto,quepaso,otroobj){alert(":ptoExist:"+objeto+" "+quepaso+" "+otroobj);$("#dialogWait").dialog("close");}});}function Reemb_CambiaBanco(){var intBanco=parseInt(document.getElementById("RMB_BANCO").value);var strPOST="&BC_ID="+intBanco;$.ajax({type:"POST",data:strPOST,scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"html",url:"ERP_CobrosCuentas.jsp?id=7",success:function(datos){},error:function(objeto,quepaso,otroobj){alert(":ptoExist:"+objeto+" "+quepaso+" "+otroobj);$("#dialogWait").dialog("close");}});}function Reemb_BuscaTasaCambioPago(){var intMonedaBanco=document.getElementById("RMB_MONEDA").value;var intMonedaSeleccionada=document.getElementById("RMB_MONEDA").value;var strFecha=document.getElementById("RMB_FECHA").value;var strPOST="&Moneda_1="+intMonedaSeleccionada;strPOST+="&Moneda_2="+intMonedaBanco;strPOST+="&fecha="+strFecha;if(document.getElementById("RMB_ESANTICIPO1").checked==false){$.ajax({type:"POST",data:strPOST,scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"xml",url:"ERP_CobrosCuentas.jsp?id=9",success:function(datos){var objsc=datos.getElementsByTagName("TasaCambio")[0];var lstTiks=objsc.getElementsByTagName("TasaCambios");var obj=lstTiks[0];var dblTC=obj.getAttribute("TC");var strOperacion=obj.getAttribute("Operacion");document.getElementById("RMB_OPERACION").value=strOperacion;if(dblTC==0){dblTC=1;}document.getElementById("RMB_TASA_CAMBIO_PAGO").value=dblTC;if(dblTC==1){document.getElementById("RMB_TASA_CAMBIO_PAGO").disabled=true;}else{document.getElementById("RMB_TASA_CAMBIO_PAGO").disabled=false;}$("#dialogWait").dialog("close");},error:function(objeto,quepaso,otroobj){alert(":ptoExist:"+objeto+" "+quepaso+" "+otroobj);$("#dialogWait").dialog("close");}});}}function Reemb_EsAnticipo(){var Sichecked=document.getElementById("RMB_ESANTICIPO1").checked;if(Sichecked==true){document.getElementById("RMB_MAX_PAGO").value=0;d.getElementById("RMB_PROVEEDOR_ID_ANT").style.display="";d.getElementById("RMB_PROVEEDOR_NOM_ANT").style.display="";d.getElementById("BTN_PROVEEDOR_ANT").style.display="";d.getElementById("RMB_GRID_ANTI").style.display="";$("#RMB_GRID_ANTI").jqGrid("setGridState","visible");d.getElementById("RMB_BANCO").style.display="none";
d.getElementById("RMB_METODO_PAGO").style.display="none";document.getElementById("RMB_MAX_PAGO").setAttribute("class","READONLY");document.getElementById("RMB_MAX_PAGO").setAttribute("className","READONLY");document.getElementById("RMB_MAX_PAGO").readOnly=true;d.getElementById("RMB_FALTA_USAR").value=0;d.getElementById("RMB_PROVEEDOR_ID_ANT").value="";d.getElementById("RMB_PROVEEDOR_NOM_ANT").value="";}else{document.getElementById("RMB_MAX_PAGO").value=0;d.getElementById("RMB_PROVEEDOR_ID_ANT").style.display="none";d.getElementById("RMB_PROVEEDOR_NOM_ANT").style.display="none";d.getElementById("BTN_PROVEEDOR_ANT").style.display="none";d.getElementById("RMB_GRID_ANTI").style.display="none";$("#RMB_GRID_ANTI").jqGrid("setGridState","hidden");jQuery("#RMB_GRID_ANTI").clearGridData();d.getElementById("RMB_BANCO").style.display="";d.getElementById("RMB_METODO_PAGO").style.display="";document.getElementById("RMB_MAX_PAGO").setAttribute("class","outEdit");document.getElementById("RMB_MAX_PAGO").setAttribute("className","outEdit");document.getElementById("RMB_MAX_PAGO").readOnly=false;d.getElementById("RMB_FALTA_USAR").value=0;}}function Reemb_ValidaMaximoxPagar(){var dblMaxPagar=parseFloat(document.getElementById("RMB_MAX_PAGO").value);if(dblMaxPagar<0){alert("El pago minimo debe ser positivo o cero");document.getElementById("RMB_MAX_PAGO").focus();document.getElementById("RMB_MAX_PAGO").value=0;}else{var Sichecked=document.getElementById("RMB_ESANTICIPO1").checked;if(Sichecked){Reemb_CalculaFaltaxPagar();var Sichecked=document.getElementById("RMB_ESANTICIPO2").checked;if(Sichecked){dblCantidadMaximaPago=parseFloat(document.getElementById("RMB_MAX_PAGO").value);}}else{document.getElementById("RMB_FALTA_USAR").value=document.getElementById("RMB_MAX_PAGO").value;}}}function Reemb_CalculaFaltaxPagar(){var dblTotal=parseFloat(document.getElementById("RMB_TOTAL").value);var Sichecked=document.getElementById("RMB_ESANTICIPO1").checked;if(Sichecked){dblCantidadMaximaPago=(document.getElementById("RMB_FALTA_USAR").value);dblTotal=parseFloat(document.getElementById("RMB_MAX_PAGO").value);}else{dblCantidadMaximaPago=(document.getElementById("RMB_MAX_PAGO").value);dblTotal=parseFloat(document.getElementById("RMB_TOTAL").value);}if(isNaN(dblCantidadMaximaPago)){dblCantidadMaximaPago=0;}if(isNaN(dblFaltaXPagar)){dblFaltaXPagar=0;}if(dblCantidadMaximaPago==0){dblFaltaXPagar=0;}dblFaltaXPagar=dblCantidadMaximaPago-dblTotal;if(!Sichecked){document.getElementById("RMB_FALTA_USAR").value=FormatNumber(dblFaltaXPagar,intNumdecimal,true);}else{}}function Reemb_selAntiRowCobCtas(rowid,status){var grid=jQuery("#RMB_GRID_ANTI");var lstRow=grid.getRowData(rowid);document.getElementById("RMB_MAX_PAGO").value=lstRow.GRID_ANTI_ABONO;document.getElementById("RMB_FALTA_USAR").value=lstRow.GRID_ANTI_ABONO;}function Reemb_searchTrxMasivaCtas(){if(document.getElementById("RMB_FALTA_USAR").value!=0){Reemb_BuscaTasaCambioPago();var Sichecked=document.getElementById("RMB_ESANTICIPO1").checked;var boolHaceOperacion=true;setTimeout(function(){var dblTasaCambio=document.getElementById("RMB_TASA_CAMBIO_PAGO").value;var strOperacion=document.getElementById("RMB_OPERACION").value;if(strOperacion=="M"){dblTasaCambio=1/dblTasaCambio;}if(Sichecked){}else{if(d.getElementById("RMB_BANCO").value==0){boolHaceOperacion=false;alert("Te falta seleccionar el banco");}if(d.getElementById("RMB_MONEDA").value==0){boolHaceOperacion=false;alert("Te falta seleccionar la moneda");}}if(boolHaceOperacion){var intPV_ID=d.getElementById("RMB_PROVEEDOR_ID").value;var strFecha1="";var strFecha2="";var strMoneda=d.getElementById("RMB_MONEDA").value;var strPOST="&CXP_ANULADO=0&intGlobal=1"+"&COB_MONEDA="+strMoneda;if(strFecha1!=""){strPOST+="&CXP_FECHA1="+strFecha1;}if(strFecha2==""){strFecha2=Reemb_FechaActual();}strPOST+="&CXP_FECHA2="+strFecha2;ValidaClean("RMB_PROVEEDOR_ID");if(intPV_ID==0){ValidaShow("RMB_PROVEEDOR_ID","NECESITA SELECCIONAR UN PROVEEDOR");}else{$("#dialogWait").dialog("open");strPOST+="&PV_ID="+intPV_ID;strPOST+="&intCXP_ID="+0;$.ajax({type:"POST",data:strPOST,scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"xml",url:"ERP_CobrosCuentas.jsp?id=5",success:function(datos){var objsc=datos.getElementsByTagName("vta_cuenta")[0];var lstTiks=objsc.getElementsByTagName("vta_cuentas");itemIdCobCtas=0;jQuery("#RMB_GRID_PROVDR").clearGridData();if(lstTiks.length!=0){for(i=0;i<lstTiks.length;i++){var obj=lstTiks[i];if(obj.getAttribute("dblCXP_SALDO")>0){var dblPagos=obj.getAttribute("dblCXP_TOTAL")-obj.getAttribute("dblCXP_SALDO");var strFecha=obj.getAttribute("strCXP_FECHA");var dblSaldoCambio=parseFloat(obj.getAttribute("dblCXP_SALDO"))*parseFloat(dblTasaCambio);strFecha=strFecha.substr(strFecha.length-2,strFecha.length)+"/"+strFecha.substr(4,2)+"/"+strFecha.substr(0,4);var intMoneda=obj.getAttribute("intCXP_MONEDA");var txtMONEDA="";if(intMoneda==1){txtMONEDA="PESOS";}else{if(intMoneda==2){txtMONEDA="DOLARES";}else{if(intMoneda==3){txtMONEDA="EUROS";}}}var datarow={GRID_PRV_PROVEEDOR:obj.getAttribute("strPV_RAZONSOCIAL"),GRID_PRV_ID:obj.getAttribute("intCXP"),GRID_PRV_ID_FAC:obj.getAttribute("intFac_id"),GRID_PRV_FECHA:strFecha,GRID_PRV_SALDO:obj.getAttribute("dblCXP_SALDO"),GRID_PRV_MONEDA:obj.getAttribute("intCXP_MONEDA"),GRID_PRV_MONEDA_LETRA:txtMONEDA};itemIdCobCtas++;jQuery("#RMB_GRID_PROVDR").addRowData(itemIdCobCtas,datarow,"last");}}Reemb_BuscaTasaCambioPago();$("#dialogWait").dialog("close");}else{alert("El proveedor seeleccionado no tiene cuentas por pagar ");document.getElementById("RMB_PROVEEDOR_ID").value="";document.getElementById("RMB_PROVEEDOR_NOM").value="";$("#dialogWait").dialog("close");}},error:function(objeto,quepaso,otroobj){alert(":ptoExist:"+objeto+" "+quepaso+" "+otroobj);$("#dialogWait").dialog("close");}});}}},100);}else{alert("Agrega el PAGO MAXIMO A REALIZAR ");}}function Reemb_FechaActual(){var fechaActual=new Date();var dia=fechaActual.getDate();var mes=fechaActual.getMonth()+1;var anio=fechaActual.getYear();if(dia<10){dia="0"+dia;}if(mes<10){mes="0"+mes;}if(anio<1000){anio+=1900;}var fechaHoy=dia+"/"+mes+"/"+anio;return fechaHoy;}function Reemb_ObtenNomProvAntCobrosCta2(){var strPV_ID=document.getElementById("RMB_PROVEEDOR_ID").value;if(strPV_ID==""){strPV_ID=0;}var strPOST="&PV_ID="+strPV_ID;$("#dialogWait").dialog("open");$.ajax({type:"POST",data:strPOST,scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"html",url:"ERP_CobrosCuentas.jsp?id=11",success:function(datos){if(trim(datos)){var info=datos.split("|");document.getElementById("RMB_PROVEEDOR_NOM").value=info[0];$("#dialogWait").dialog("close");}else{$("#dialogWait").dialog("close");}},error:function(objeto,quepaso,otroobj){alert(":ptoExist:"+objeto+" "+quepaso+" "+otroobj);$("#dialogWait").dialog("close");}});}function Reemb_editGridCXP(e){if(e.originalEvent.keyCode==13){var grid=jQuery("#RMB_GRID_PROVDR");var lstRow=grid.getRowData(lastselBco);var dato=document.getElementById((lastselBco)+"_GRID_PRV_IMPORTE").value;$("#dialogWait").dialog("open");lstRow.GRID_PRV_IMPORTE=0;grid.setRowData(lastselBco,lstRow);$("#dialogWait").dialog("close");grid.saveRow(lastselBco);lastselBco=0;}}function Reemb_BorrarGrid(){var grid=jQuery("#RMB_GRID_2");if(grid.getGridParam("selrow")!=null){var id=grid.getGridParam("selrow");var lstRow=grid.getRowData(id);$("#SioNO").dialog("open");$("#SioNO").dialog("option","title","¿Confirma que desea borrar?");document.getElementById("btnSI").onclick=function(){var patron=",";var faltaUsar=document.getElementById("RMB_FALTA_USAR").value;var importe=lstRow.GRID_CP_IMPORTE;faltaUsar=faltaUsar.replace(patron,"");importe=importe.replace(patron,"");document.getElementById("RMB_FALTA_USAR").value=FormatNumber((parseFloat(faltaUsar)+parseFloat(importe)),2,true,false,true,false);var total=document.getElementById("RMB_TOTAL").value;total=total.replace(patron,"");var ttal=document.getElementById("RMB_TOTAL").value=FormatNumber((parseFloat(total)-parseFloat(importe)),2,true,false,true,false);
grid.delRowData(grid.getGridParam("selrow"));$("#SioNO").dialog("close");};document.getElementById("btnNO").onclick=function(){$("#SioNO").dialog("close");};}else{alert("Selecciona un registro el la tabla");}}function Reemb_Salir(){myLayout.open("west");myLayout.open("east");myLayout.open("south");myLayout.open("north");document.getElementById("MainPanel").innerHTML="";var objMainFacPedi=objMap.getScreen("COBROSCTAS");objMainFacPedi.bolActivo=false;objMainFacPedi.bolMain=false;objMainFacPedi.bolInit=false;objMainFacPedi.idOperAct=0;}function Reemb_AgregarGrid(){var grid=jQuery("#RMB_GRID_PROVDR");var id=grid.getGridParam("selrow");var lstRow=grid.getRowData(id);if(grid.getGridParam("selrow")!=null){var boolExisteFac=0;var gridG1=jQuery("#RMB_GRID_2");var arrG1=gridG1.getDataIDs();for(var i=0;i<arrG1.length;i++){var idG1=arrG1[i];var lstRowG1=gridG1.getRowData(idG1);if(lstRow.GRID_PRV_ID==lstRowG1.GRID_CP_ID){boolExisteFac=1;}}if(boolExisteFac==0){$("#dialog").dialog("option","title","Agrega el importe");var div=document.getElementById("dialog");var faltaUsar=document.getElementById("RMB_FALTA_USAR").value;var patron=",";var faltaUsar=document.getElementById("RMB_FALTA_USAR").value;var saldo=lstRow.GRID_PRV_SALDO;faltaUsar=faltaUsar.replace(patron,"");saldo=saldo.replace(patron,"");var importeMostrar="";if(parseFloat(saldo)>parseFloat(faltaUsar)){importeMostrar=parseFloat(faltaUsar);}else{importeMostrar=parseFloat(saldo);}var strHtml=CreaTexto("","Reemb_Importe",FormatNumber(parseFloat(importeMostrar),2,true,false,true,false),40,40,true,false,"","left",0,"","","",false,1);strHtml+=CreaBoton("","NOTASBTN",lstMsg[31],"Reemb_AgregaGrid2()","center",false,true,0);div.innerHTML=strHtml;$("#dialog").dialog("open");}else{alert("Esa cuenta por pagar ya fue agregada");}}else{alert("Selecciona un registro de la tabla");}}function Reemb_AgregaGrid2(){var grid=jQuery("#RMB_GRID_PROVDR");var id=grid.getGridParam("selrow");var lstRow=grid.getRowData(id);var patron=",";var faltaUsar=document.getElementById("RMB_FALTA_USAR").value;var importe=document.getElementById("Reemb_Importe").value;faltaUsar=faltaUsar.replace(patron,"");importe=importe.replace(patron,"");if(parseFloat(importe)>parseFloat(lstRow.GRID_PRV_SALDO)){alert("El importe no puede ser mayor al saldo");}else{if(parseFloat(importe)>0){if(parseFloat(importe)>parseFloat(faltaUsar)){alert("El importe no puede ser mayor a el campo falta por usar");}else{var patron=",";var importe=document.getElementById("Reemb_Importe").value;importe=importe.replace(patron,"");var datarow={GRID_CP_PROVEEDOR:lstRow.GRID_PRV_PROVEEDOR,GRID_CP_ID:lstRow.GRID_PRV_ID,GRID_CP_ID_FAC:lstRow.GRID_PRV_ID_FAC,GRID_CP_FECHA:lstRow.GRID_PRV_FECHA,GRID_CP_MONEDA:lstRow.GRID_PRV_MONEDA_LETRA,GRID_CP_MONEDA_NUM:lstRow.GRID_PRV_MONEDA,GRID_CP_TASA:document.getElementById("RMB_TASA_CAMBIO_PAGO").value,GRID_CP_SALDO:lstRow.GRID_PRV_SALDO,GRID_CP_IMPORTE:importe};contAddGrid++;jQuery("#RMB_GRID_2").addRowData(contAddGrid,datarow,"last");document.getElementById("RMB_FALTA_USAR").value=FormatNumber((parseFloat(faltaUsar)-parseFloat(importe)),2,true,false,true,false);var total=document.getElementById("RMB_TOTAL").value;total=total.replace(patron,"");var ttal=document.getElementById("RMB_TOTAL").value=FormatNumber((parseFloat(total)+parseFloat(importe)),2,true,false,true,false);$("#dialog").dialog("close");}}else{alert("El importe debe ser mayor a 0.0");}}}function Reemb_SaveCobCtas(){var patron=",";var faltaUsar=document.getElementById("RMB_FALTA_USAR").value;var fecha=document.getElementById("RMB_FECHA").value;faltaUsar=faltaUsar.replace(patron,"");var grid=jQuery("#RMB_GRID_2");var arr=grid.getDataIDs();if(arr.length!=0){$("#dialogWait").dialog("open");var strPOST="";var intIdOper=3;var grid=jQuery("#RMB_GRID_2");var arr=grid.getDataIDs();var intContaPays=0;for(var i=0;i<arr.length;i++){var id=arr[i];var lstRow=grid.getRowData(id);if(lstRow.GRID_CP_IMPORTE>0){intContaPays++;}}var dblxCobrar=0;var dblPagado=0;dblPagado=parseFloat(d.getElementById("RMB_TOTAL").value);dblxCobrar=parseFloat(d.getElementById("RMB_TOTAL").value);strPOST+="FECHA="+(d.getElementById("RMB_FECHA").value);strPOST+="&BC_ID="+(d.getElementById("RMB_BANCO").value);strPOST+="&NOTAS="+encodeURIComponent(d.getElementById("RMB_CONCEPTO").value);strPOST+="&MONEDA="+d.getElementById("RMB_MONEDA").value;strPOST+="&TASAPESO="+(d.getElementById("RMB_TASA_CAMBIO_PAGO").value);strPOST+="&MONTOPAGOTOTAL="+dblPagado;var patron=",";var MONTOPAGOTOTALAMONEDA=document.getElementById("RMB_TOTAL").value;MONTOPAGOTOTALAMONEDA=MONTOPAGOTOTALAMONEDA.replace(patron,"");strPOST+="&MONTOPAGOTOTALAMONEDA="+(MONTOPAGOTOTALAMONEDA);var dblAnticipoUsar=parseFloat(d.getElementById("RMB_MAX_PAGO").value);var dblTasaCambioAnti=parseFloat(d.getElementById("RMB_TASA_CAMBIO_PAGO").value);var strOperacion=document.getElementById("RMB_OPERACION").value;if(dblTasaCambioAnti!=1){if(strOperacion=="D"){dblTasaCambioAnti=dblTasaCambioAnti;}else{dblTasaCambioAnti=1/dblTasaCambioAnti;}}else{dblTasaCambioAnti=1;}strPOST+="&TCANTIUSAR="+dblTasaCambioAnti;strPOST+="&ANTICIPOAUSAR="+dblAnticipoUsar;strPOST+="&MONEDAAPAGAR="+(d.getElementById("RMB_MONEDA").value);strPOST+="&TASADECAMBIOAPAGAR="+(d.getElementById("RMB_TASA_CAMBIO_PAGO").value);strPOST+="&TC_ORI_ANTI="+TC_OriAnti;var Sichecked=document.getElementById("RMB_ESANTICIPO1").checked;if(Sichecked){strPOST+="&USA_ANTI="+1;var gridAnt=jQuery("#RMB_GRID_ANTI");var idAnt=gridAnt.getGridParam("selrow");var lstRowAnt=gridAnt.getRowData(idAnt);idAnticipo=lstRowAnt.GRID_ANTI_ID;strPOST+="&ANTI_ID="+idAnticipo;strPOST+="&CANTIDAD_ANTI="+(d.getElementById("RMB_MAX_PAGO").value);strPOST+="&TASA_ANTI="+(d.getElementById("RMB_TASA_CAMBIO_PAGO").value);}else{strPOST+="&USA_ANTI="+0;if(strOperacion=="D"){strPOST+="&TASA_ANTI="+1/parseFloat(d.getElementById("RMB_TASA_CAMBIO_PAGO").value);}else{strPOST+="&TASA_ANTI="+(d.getElementById("RMB_TASA_CAMBIO_PAGO").value);}}for(var i=0;i<arr.length;i++){var id=arr[i];var lstRow=grid.getRowData(id);if(lstRow.GRID_CP_IMPORTE>0){strPOST+="&idTrx="+lstRow.GRID_CP_ID;strPOST+="&TipoDoc=4";strPOST+="&MONTOPAGO="+lstRow.GRID_CP_IMPORTE;strPOST+="&MONTOPAGOAMONEDA="+lstRow.GRID_CP_MONEDA_NUM;strPOST+="&MONENDAORIGINAL="+lstRow.GRID_CP_MONEDA_NUM;}}var strNomForm="REEMB";var strNomField="MPM_ID";strPOST+="&COUNT_PAGOS=1";strPOST+="&MPD_MONEDA1=1";strPOST+="&MPD_FOLIO1=";strPOST+="&MPD_FORMAPAGO1="+document.getElementById("RMB_METODO_PAGO").value;strPOST+="&MPD_NOCHEQUE1=0";strPOST+="&MPD_BANCO1=0";strPOST+="&MPD_NOTARJETA1=0";strPOST+="&MPD_TIPOTARJETA1=0";strPOST+="&MPD_IMPORTE1="+parseFloat(dblPagado);strPOST+="&MPD_TASAPESO1="+(d.getElementById("RMB_TASA_CAMBIO_PAGO").value);strPOST+="&MPD_CAMBIO1=0";strPOST+="&PROV_ID="+(d.getElementById("RMB_PROVEEDOR_ID").value);strPOST+="&PROV_ANTICIPO=0";strPOST+="&MCB_NOCHEQUE="+d.getElementById("RMB_NOCHEQUE").value;strPOST+="&MCB_CONCEPTO="+d.getElementById("RMB_CONCEPTO").value;strPOST+="&MCB_RFCBENEFICIARIO="+d.getElementById("RMB_RFC_TER_TRANS").value;strPOST+="&COB_BCO_TRANS="+d.getElementById("RMB_BCO_TRANS").value;strPOST+="&COB_CTA_TRANS="+d.getElementById("RMB_CTA_TRANS").value;strPOST+="&MPD_RFC_TERCEROS="+(document.getElementById("RMB_RFC_TER_TRANS").value);strPOST+="&EsReembolso=1";$.ajax({type:"POST",data:encodeURI(strPOST),scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"html",url:"ERP_CobrosCuentas.jsp?id="+intIdOper,success:function(dato){dato=trim(dato);if(Left(dato,3)=="OK."){jQuery("#RMB_GRID_2").clearGridData();jQuery("#RMB_GRID_PROVDR").clearGridData();jQuery("#RMB_GRID_ANTI").clearGridData();var Sichecked=document.getElementById("RMB_ESANTICIPO1").checked;if(Sichecked){}Reemb_Reset();$("#dialogPagos").dialog("close");$("#dialogWait").dialog("close");}else{alert(dato);}$("#dialogWait").dialog("close");},error:function(objeto,quepaso,otroobj){alert(":pto9:"+objeto+" "+quepaso+" "+otroobj);$("#dialogWait").dialog("close");}});}else{alert(lstMsg[10]);
$("#dialogWait").dialog("close");}}function Reemb_RevisaMetodoPago(){var Seleccion=document.getElementById("RMB_METODO_PAGO").value;var Sichecked=document.getElementById("RMB_ESANTICIPO2").checked;if(Sichecked){if(Seleccion=="CHEQUE"){document.getElementById("RMB_NOCHEQUE").style.display="";}else{document.getElementById("RMB_NOCHEQUE").style.display="none";}if(Seleccion=="TRANSFERENCIA ELECTRONICA"){document.getElementById("RMB_BCO_TRANS").style.display="";document.getElementById("RMB_CTA_TRANS").style.display="";document.getElementById("RMB_RFC_TER_TRANS").style.display="";}else{document.getElementById("RMB_BCO_TRANS").style.display="none";document.getElementById("RMB_CTA_TRANS").style.display="none";document.getElementById("RMB_RFC_TER_TRANS").style.display="none";document.getElementById("RMB_BCO_TRANS").value="Seleccione";document.getElementById("RMB_CTA_TRANS").value="";document.getElementById("RMB_RFC_TER_TRANS").value="";}}}function Reemb_Reset(){document.getElementById("RMB_CONCEPTO").value="";document.getElementById("RMB_TASA_CAMBIO_PAGO").value="1.0";document.getElementById("RMB_ESANTICIPO2").value=true;document.getElementById("RMB_BANCO").value=0;document.getElementById("RMB_METODO_PAGO").value=0;document.getElementById("RMB_PROVEEDOR_ID_ANT").value="";document.getElementById("RMB_PROVEEDOR_NOM_ANT").value="";document.getElementById("RMB_NOCHEQUE").value="";document.getElementById("RMB_BCO_TRANS").value=0;document.getElementById("RMB_CTA_TRANS").value="";document.getElementById("RMB_RFC_TER_TRANS").value="";document.getElementById("RMB_MAX_PAGO").value="0.0";document.getElementById("RMB_FALTA_USAR").value="0.0";document.getElementById("RMB_PROVEEDOR_ID").value="";document.getElementById("RMB_PROVEEDOR_NOM").value="";document.getElementById("RMB_TOTAL").value="0.0";jQuery("#RMB_GRID_2").clearGridData();jQuery("#RMB_GRID_PROVDR").clearGridData();jQuery("#RMB_GRID_ANTI").clearGridData();}