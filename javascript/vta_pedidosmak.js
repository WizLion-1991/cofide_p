var itemId=0;var lstPorcDesc=null;var bolPrice=false;var bolPorc=false;var bolCambioFecha=false;var bolDevol=false;var bolModiImpuesto=false;var bolPerPedido=false;var bolPerTicket=false;var bolPerFactura=false;var bolPerCotiza=false;var bolNolMLM=false;var bolPromociones=false;var intSucOfertas=intSucDefOfertas;var bolCargaPromociones=false;var bolDebugPtoVta=false;var bolSaveVta=true;var dblTasaVta1=dblTasa1;var dblTasaVta2=dblTasa2;var dblTasaVta3=dblTasa3;var intIdTasaVta1=intIdTasa1;var intIdTasaVta2=intIdTasa2;var intIdTasaVta3=intIdTasa3;var intSImpVta1_2=intSImp1_2;var intSImpVta1_3=intSImp1_3;var intSImpVta2_3=intSImp2_3;var intCT_TIPOPERS=0;var intCT_TIPOFAC=0;var strCT_USOIMBUEBLE="";var intRET_ISR=0;var intRET_IVA=0;var intRET_FLETE=1;var _objProdTmpz=null;var objTabla=null;var numFilas=0;var idT=0;var intContaIdGrid=0;var bolUsaOpnCte=false;var ContGridHistPediMak=0;function vta_pedidosmak(){}function initPediMak(){myLayout.close("west");myLayout.close("east");myLayout.close("south");myLayout.close("north");loadClientesScrenPediMak();}function initProdMak(){CargaGridSubCtePediMak();}function loadClientesScrenPediMak(){$.ajax({url:"ERP_PedidosMak.jsp",dataType:"html",scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",success:function(datos){document.getElementById("MainPanel").innerHTML=datos;document.getElementById("div_btnMosCte").style.display="none";document.getElementById("div_btnMosPed").style.display="none";document.getElementById("div_btnMosGPedidos").style.display="none";document.getElementById("div_btnMosTPedidos").style.display="none";document.getElementById("div_titulo").style.display="block";ObtieneNumPedidoPediMak();obtieneFechaPediMak();AddGridPediMak();PopupCtesPediMak();var strHtml="<table>"+"<tr>"+'<td id="btn_libreta"><i class = "fa fa-hdd-o" style="font-size:50px" onclick="Callbtn0PediMak();"></i></td>'+'<td id="btn_t"><i class = "fa fa-floppy-o" style="font-size:50px" onclick="SavePediMak()"></i></td>'+'<td id="btn_buscar"><i class = "fa fa-sign-out" style="font-size:50px" onclick="Callbtn9PediMak();"></i></td>'+"</tr>"+"</table>";document.getElementById("TOOLBAR").innerHTML=strHtml;}});}function PopupCtesPediMak(){var objSecModiVta=objMap.getScreen("CLIENT_MAK");if(objSecModiVta!=null){objSecModiVta.bolActivo=false;objSecModiVta.bolMain=false;objSecModiVta.bolInit=false;objSecModiVta.idOperAct=0;}OpnOpt("CLIENT_MAK","_ed","dialogCte",false,false,true);}function ObtieneProductoKeyPediMak(event){if(event.keyCode==13){ObtieneProductoPediMak(d.getElementById("FAC_PROD").value);}}function autoCompleteCtePediMak(){var IdSuc=document.getElementById("SC_ID").value;var IdTipo=document.getElementById("CC1_ID").value;var strFunction=new Function("event","ui","{"+"document.getElementById('SEARCHCTE').value = ui.item.id;"+"}");$("#SEARCHCTE").autocomplete({source:"autoctemak.jsp?ID=1&IdSuc="+IdSuc+"&IdTipo="+IdTipo,minLength:1,select:strFunction});}function MostrarBotonesPediMak(opc){if(opc==1){document.getElementById("div_infCte").style.display="block";document.getElementById("div_btnMosCte").style.display="none";document.getElementById("btn_mosCte").style.display="block";document.getElementById("btn_ocuCte").style.display="block";}if(opc==2){document.getElementById("div_pedidos").style.display="block";document.getElementById("div_btnMosPed").style.display="none";document.getElementById("btn_mosPed").style.display="block";document.getElementById("btn_ocuPed").style.display="block";}if(opc==3){document.getElementById("div_datosgenerales").style.display="block";document.getElementById("btn_mosDatGen").style.display="block";document.getElementById("btn_ocuDatGen").style.display="block";}if(opc==4){document.getElementById("div_gridpedido").style.display="block";document.getElementById("div_btnMosGPedidos").style.display="none";document.getElementById("btn_mosGPedidos").style.display="block";document.getElementById("btn_ocuGPedidos").style.display="block";}if(opc==5){document.getElementById("div_totalpedidos").style.display="block";document.getElementById("div_btnMosTPedidos").style.display="none";document.getElementById("btn_mosTPedidos").style.display="block";document.getElementById("btn_ocuTPedidos").style.display="block";}}function OcultarBotonesPediMak(opc){if(opc==1){document.getElementById("div_infCte").style.display="none";document.getElementById("div_btnMosCte").style.display="block";document.getElementById("btn_ocuCte").style.display="none";}if(opc==2){document.getElementById("div_pedidos").style.display="none";document.getElementById("div_btnMosPed").style.display="block";document.getElementById("btn_ocuPed").style.display="none";}if(opc==3){document.getElementById("div_datosgenerales").style.display="none";document.getElementById("btn_ocuDatGen").style.display="none";}if(opc==4){document.getElementById("div_gridpedido").style.display="none";document.getElementById("div_btnMosGPedidos").style.display="block";document.getElementById("btn_ocuGPedidos").style.display="none";}if(opc==5){document.getElementById("div_totalpedidos").style.display="none";document.getElementById("div_btnMosTPedidos").style.display="block";document.getElementById("btn_ocuTPedidos").style.display="none";}}function ObtieneNumPedidoPediMak(){$.ajax({type:"POST",data:"TYPE_ID="+"3",scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"xml",url:"VtasMov.do?id=14",success:function(datos){var objsc=datos.getElementsByTagName("vta_folios")[0];var strFolioT=objsc.getAttribute("FOLIO");document.getElementById("FAC_FOLIO").value=strFolioT;$("#dialogInv").dialog("close");},error:function(objeto,quepaso,otroobj){alert(":Obten folio siguiente:"+objeto+" "+quepaso+" "+otroobj);$("#dialogInv").dialog("close");}});}function ObtieneClientePediMak(){PopupCtesPediMak();}function AddGridPediMak(){jQuery("#FAC_GRID").jqGrid({url:"_blank.jsp",datatype:"xml",height:"auto",colNames:["CODIGO","DESCRIPCION","EXISTENCIA","DISPONIBLE","CANTIDAD","FACD_PUNTOS","FACD_NEGOCIO","PRECIO","FACD_ID","FAC_ID","IMPORTE","DESCUENTO","CORTESIA","FACD_PORDESC","MODIFICO PRECIO","FACD_TASAIVA2","FACD_TASAIVA1","FACD_TASAIVA3","FACD_DESGLOSA1","FACD_DESGLOSA2","FACD_USA_SERIE","FACD_SERIES","FACD_SERIES_MPD","FACD_SERIES_O","FACD_SERIES_MPD_O","FACD_DESGLOSA3","FACD_NEGO_ZERO","SUC_ID","FACD_IMPUESTO1","FACD_IMPUESTO2","FACD_IMPUESTO3","ID PRODUCTO","FACD_NOSERIE","FACD_ESREGALO","FACD_EXENTO1","FACD_IMPORTEREAL","FACD_EXENTO2","FACD_EXENTO3","FACD_REQEXIST","FACD_NOSERIE","FACD_ESREGALO","FACD_PRECREAL","FACD_ESDEVO","FACD_NOTAS","FACD_CODBARRAS","FACD_CANTPEDIDO","FACD_RET_ISR","FACD_RET_IVA","FACD_SINPRECIO","FACD_RET_FLETE","UNIDAD MEDIDA","FACD_PUNTOS_U","FACD_NEGOCIO_U","FACD_PR_CAT1","FACD_PR_CAT2","FACD_PR_CAT3","FACD_PR_CAT4","FACD_PR_CAT5","FACD_PR_CAT6","FACD_PR_CAT7","FACD_PR_CAT8","FACD_PR_CAT9","FACD_PR_CAT10","FACD_DESC_ORI","FACD_REGALO","FACD_ID_PROMO","FACD_DESC_PREC","FACD_DESC_PTO","FACD_DESC_VN","FACD_DESC_LEAL","ES BACKORDER","FACD_TIPO_BACKORDER","TIPO BACKORDER","FACD_DETALLE_BACKORDER"],colModel:[{name:"FACD_CVE",index:"CODIGO",hidden:false,editable:false,width:20,sortable:false,search:false},{name:"FACD_DESCRIPCION",index:"DESCRIPCION",hidden:false,editable:false,width:70,sortable:false,search:false},{name:"FACD_EXIST",align:"right",index:"EXISTENCIA",hidden:false,editable:false,width:40,sortable:false,search:false},{name:"FACD_DISPONIBLE",align:"right",index:"DISPONIBLE",hidden:false,editable:false,width:40,sortable:false,search:false},{name:"FACD_CANTIDAD",edittype:"text",editable:true,align:"right",index:"CANTIDAD",hidden:false,width:40,sortable:false,search:false},{name:"FACD_PUNTOS",index:"FACD_PUNTOS",hidden:true,editable:false,width:40,sortable:false,search:false},{name:"FACD_NEGOCIO",index:"FACD_NEGOCIO",hidden:true,editable:false,width:40,sortable:false,search:false},{name:"FACD_PRECIO",align:"right",index:"PRECIO",hidden:false,editable:false,width:40,sortable:false,search:false},{name:"FACD_ID",index:"FACD_ID",hidden:true,editable:false,width:40,sortable:false,search:false},{name:"FAC_ID",index:"FAC_ID",hidden:true,editable:false,width:40,sortable:false,search:false},{name:"FACD_IMPORTE",align:"right",index:"IMPORTE",hidden:false,editable:false,width:40,sortable:false,search:false},{name:"FACD_DESCUENTO",align:"right",index:"DESCUENTO",hidden:false,editable:false,width:40,sortable:false,search:false},{name:"FACD_CORTESIA",edittype:"text",editable:true,align:"right",index:"CORTESIA",hidden:false,width:40,sortable:false,search:false},{name:"FACD_PORDESC",index:"FACD_PORDESC",hidden:true,editable:false,width:40,sortable:false,search:false},{name:"FACD_PRECFIJO",index:"FACD_PRECFIJO",hidden:false,editable:false,width:40,sortable:false,search:false},{name:"FACD_TASAIVA2",index:"FACD_TASAIVA2",hidden:true,editable:false,width:40,sortable:false,search:false},{name:"FACD_TASAIVA1",index:"FACD_TASAIVA1",hidden:true,editable:false,width:40,sortable:false,search:false},{name:"FACD_TASAIVA3",index:"FACD_TASAIVA3",hidden:true,editable:false,width:40,sortable:false,search:false},{name:"FACD_DESGLOSA1",index:"FACD_DESGLOSA1",hidden:true,editable:false,width:40,sortable:false,search:false},{name:"FACD_DESGLOSA2",index:"FACD_DESGLOSA2",hidden:true,editable:false,width:40,sortable:false,search:false},{name:"FACD_USA_SERIE",index:"FACD_USA_SERIE",hidden:true,editable:false,width:40,sortable:false,search:false},{name:"FACD_SERIES",index:"FACD_SERIES",hidden:true,editable:false,width:40,sortable:false,search:false},{name:"FACD_SERIES_MPD",index:"FACD_SERIES_MPD",hidden:true,editable:false,width:40,sortable:false,search:false},{name:"FACD_SERIES_O",index:"FACD_SERIES_O",hidden:true,editable:false,width:40,sortable:false,search:false},{name:"FACD_SERIES_MPD_O",index:"FACD_SERIES_MPD_O",hidden:true,editable:false,width:40,sortable:false,search:false},{name:"FACD_DESGLOSA3",index:"FACD_DESGLOSA3",hidden:true,editable:false,width:40,sortable:false,search:false},{name:"FACD_NEGO_ZERO",index:"FACD_NEGO_ZERO",hidden:true,editable:false,width:40,sortable:false,search:false},{name:"SUC_ID",index:"SUC_ID",hidden:true,editable:false,width:40,sortable:false,search:false},{name:"FACD_IMPUESTO1",index:"FACD_IMPUESTO1",hidden:true,editable:false,width:40,sortable:false,search:false},{name:"FACD_IMPUESTO2",index:"FACD_IMPUESTO2",hidden:true,editable:false,width:40,sortable:false,search:false},{name:"FACD_IMPUESTO3",index:"FACD_IMPUESTO3",hidden:true,editable:false,width:40,sortable:false,search:false},{name:"FACD_PR_ID",align:"right",index:"ID PRODUCTO",hidden:true,editable:false,width:40,sortable:false,search:false},{name:"FACD_NOSERIE",index:"FACD_NOSERIE",hidden:true,editable:false,width:40,sortable:false,search:false},{name:"FACD_ESREGALO",index:"FACD_ESREGALO",hidden:true,editable:false,width:40,sortable:false,search:false},{name:"FACD_EXENTO1",index:"FACD_EXENTO1",hidden:true,editable:false,width:40,sortable:false,search:false},{name:"FACD_IMPORTEREAL",index:"FACD_IMPORTEREAL",hidden:true,editable:false,width:40,sortable:false,search:false},{name:"FACD_EXENTO2",index:"FACD_EXENTO2",hidden:true,editable:false,width:40,sortable:false,search:false},{name:"FACD_EXENTO3",index:"FACD_EXENTO3",hidden:true,editable:false,width:40,sortable:false,search:false},{name:"FACD_REQEXIST",index:"FACD_REQEXIST",hidden:true,editable:false,width:40,sortable:false,search:false},{name:"FACD_NOSERIE",index:"FACD_NOSERIE",hidden:true,editable:false,width:40,sortable:false,search:false},{name:"FACD_ESREGALO",index:"FACD_ESREGALO",hidden:true,editable:false,width:40,sortable:false,search:false},{name:"FACD_PRECREAL",index:"FACD_PRECREAL",hidden:true,editable:false,width:40,sortable:false,search:false},{name:"FACD_ESDEVO",index:"FACD_ESDEVO",hidden:true,editable:false,width:40,sortable:false,search:false},{name:"FACD_NOTAS",index:"FACD_NOTAS",hidden:true,editable:false,width:40,sortable:false,search:false},{name:"FACD_CODBARRAS",index:"FACD_CODBARRAS",hidden:true,editable:false,width:40,sortable:false,search:false},{name:"FACD_CANTPEDIDO",index:"FACD_CANTPEDIDO",hidden:true,editable:false,width:40,sortable:false,search:false},{name:"FACD_RET_ISR",index:"FACD_RET_ISR",hidden:true,editable:false,width:40,sortable:false,search:false},{name:"FACD_RET_IVA",index:"FACD_RET_IVA",hidden:true,editable:false,width:40,sortable:false,search:false},{name:"FACD_SINPRECIO",index:"FACD_SINPRECIO",hidden:true,editable:false,width:40,sortable:false,search:false},{name:"FACD_RET_FLETE",index:"FACD_RET_FLETE",hidden:true,editable:false,width:40,sortable:false,search:false},{name:"FACD_UNIDAD_MEDIDA",index:"UNIDAD MEDIDA",hidden:false,editable:false,width:40,sortable:false,search:false},{name:"FACD_PUNTOS_U",index:"FACD_PUNTOS_U",hidden:true,editable:false,width:40,sortable:false,search:false},{name:"FACD_NEGOCIO_U",index:"FACD_NEGOCIO_U",hidden:true,editable:false,width:40,sortable:false,search:false},{name:"FACD_PR_CAT1",index:"FACD_PR_CAT1",hidden:true,editable:false,width:40,sortable:false,search:false},{name:"FACD_PR_CAT2",index:"FACD_PR_CAT2",hidden:true,editable:false,width:40,sortable:false,search:false},{name:"FACD_PR_CAT3",index:"FACD_PR_CAT3",hidden:true,editable:false,width:40,sortable:false,search:false},{name:"FACD_PR_CAT4",index:"FACD_PR_CAT4",hidden:true,editable:false,width:40,sortable:false,search:false},{name:"FACD_PR_CAT5",index:"FACD_PR_CAT5",hidden:true,editable:false,width:40,sortable:false,search:false},{name:"FACD_PR_CAT6",index:"FACD_PR_CAT6",hidden:true,editable:false,width:40,sortable:false,search:false},{name:"FACD_PR_CAT7",index:"FACD_PR_CAT7",hidden:true,editable:false,width:40,sortable:false,search:false},{name:"FACD_PR_CAT8",index:"FACD_PR_CAT8",hidden:true,editable:false,width:40,sortable:false,search:false},{name:"FACD_PR_CAT9",index:"FACD_PR_CAT9",hidden:true,editable:false,width:40,sortable:false,search:false},{name:"FACD_PR_CAT10",index:"FACD_PR_CAT10",hidden:true,editable:false,width:40,sortable:false,search:false},{name:"FACD_DESC_ORI",index:"FACD_DESC_ORI",hidden:true,editable:false,width:40,sortable:false,search:false},{name:"FACD_REGALO",index:"FACD_REGALO",hidden:true,editable:false,width:40,sortable:false,search:false},{name:"FACD_ID_PROMO",index:"FACD_ID_PROMO",hidden:true,editable:false,width:40,sortable:false,search:false},{name:"FACD_DESC_PREC",index:"FACD_DESC_PREC",hidden:true,editable:false,width:40,sortable:false,search:false},{name:"FACD_DESC_PTO",index:"FACD_DESC_PTO",hidden:true,editable:false,width:40,sortable:false,search:false},{name:"FACD_DESC_VN",index:"FACD_DESC_VN",hidden:true,editable:false,width:40,sortable:false,search:false},{name:"FACD_DESC_LEAL",index:"FACD_DESC_LEAL",hidden:true,editable:false,width:40,sortable:false,search:false},{name:"FACD_ES_BACKORDER",index:"FACD_ES_BACKORDER",hidden:true,editable:false,width:40,sortable:false,search:false},{name:"FACD_TIPO_BACKORDER",index:"FACD_TIPO_BACKORDER",hidden:true,editable:false,width:40,sortable:false,search:false},{name:"FACD_TIPO_BACKORDER_LETRA",index:"FACD_TIPO_BACKORDER_LETRA",hidden:false,editable:false,width:40,sortable:false,search:false},{name:"FACD_DETALLE_BACKORDER",index:"FACD_DETALLE_BACKORDER",hidden:true,editable:false,width:40,sortable:false,search:false}],rowNum:20,autowidth:true,rowList:[20,20,40],pager:jQuery("#pager1"),sortname:"FACD_CVE",viewrecords:true,sortorder:"desc",caption:"PRODUCTOS",cellEdit:true,cellsubmit:"clientArray",editurl:"clientArray",afterSaveCell:function(rowid,name,val,iRow,iCol){if(name=="FACD_CANTIDAD"){CalculaImportesPediMak(rowid);
}},beforeEditCell:function(rowid,name,val,iRow,iCol){if(name=="FACD_CANTIDAD"){SaveCantAnterior(rowid);}}}).navGrid("#pager1",{edit:true,add:false,del:false});}function SaveCantAnterior(){var grid=jQuery("#FAC_GRID");var id=grid.getGridParam("selrow");if(id!=null){var lstRow=grid.getRowData(id);document.getElementById("CANTIDADANTERIOR").value=lstRow.FACD_CANTIDAD;}}function CalculaImportesPediMak(rowid){VtaModificaCantDoPediMak();}function VtaModificaCant(){var grid=jQuery("#FAC_GRID");var id=grid.getGridParam("selrow");if(id!=null){var lstRow=grid.getRowData(id);document.getElementById("Operac").value="CHANGE_CANTPD";$("#SioNO").dialog("option","title",lstMsg[132]);var div=document.getElementById("SioNO_inside");var strHtml=CreaTexto(lstMsg[89],"_NvoCant",lstRow.FACD_CANTIDAD,10,10,true,false,"","left",0,"","","",false,1);div.innerHTML=strHtml;$("#SioNO").dialog("open");}}function ObtieneSubClientePediMak(){if(document.getElementById("FCT_ID").value!=0||document.getElementById("FCT_ID").value!=""){var objSecModiVta=objMap.getScreen("SUBCLIENTES_MAK");if(objSecModiVta!=null){objSecModiVta.bolActivo=false;objSecModiVta.bolMain=false;objSecModiVta.bolInit=false;objSecModiVta.idOperAct=0;}OpnOpt("SUBCLIENTES_MAK","_ed","dlgMakSubCte",false,false,true);}else{alert("Seleccione a un cliente!!");}}function newDirCteFinalPediMak(){var objSecModiVta=objMap.getScreen("NVO_SUBCLIENTE");if(objSecModiVta!=null){objSecModiVta.bolActivo=false;objSecModiVta.bolMain=false;objSecModiVta.bolInit=false;objSecModiVta.idOperAct=0;}OpnOpt("NVO_SUBCLIENTE","_ed","dialog2",false,false,true);}function delDireccionCteFinalPediMak(){var grid=jQuery("#grd_DireccionesDFA");if(grid.getGridParam("selrow")!=null){var id=grid.getGridParam("selrow");var lstRow=grid.getRowData(id);var idDir=lstRow.DFA_ID;if(getUsoCteFinalPediMak(idDir)!=true){if(confirm("Atención: Confirma que desea eliminar la dirección")){grid.delRowData(grid.getGridParam("selrow"));deleteDireccionCteFinalPediMak(idDir);}}else{alert("Atención: Esta dirección no puede ser borrada, ya se uso en algunos documentos");}}else{alert("Selecciona un registro el la tabla");}}function saveDirCteFinalPediMak(){if(document.getElementById("FCT_ID").value==""||document.getElementById("FCT_ID").value=="0"){alert("ATENCIÓN: Primero debes seleccionar al cliente para asignarle mas direcciones de entrega.");}else{var strPost="";if(validaDatosCteFinalPediMak()!=0){strPost="&DFA_CALLE="+document.getElementById("DFA_CALLE").value;strPost+="&DFA_COLONIA="+document.getElementById("DFA_COLONIA").value;strPost+="&DFA_LOCALIDAD="+document.getElementById("DFA_LOCALIDAD").value;strPost+="&DFA_MUNICIPIO="+document.getElementById("DFA_MUNICIPIO").value;strPost+="&DFA_ESTADO="+document.getElementById("DFA_ESTADO").value;strPost+="&DFA_CP="+document.getElementById("DFA_CP").value;strPost+="&DFA_NUMERO="+document.getElementById("DFA_NUMERO").value;strPost+="&DFA_NUMINT="+document.getElementById("DFA_NUMINT").value;strPost+="&DFA_TELEFONO="+document.getElementById("DFA_TELEFONO").value;strPost+="&DFA_RAZONSOCIAL="+document.getElementById("DFA_RAZONSOCIAL").value;strPost+="&DFA_RFC="+document.getElementById("DFA_RFC").value;strPost+="&DFA_EMAIL="+document.getElementById("DFA_EMAIL").value;strPost+="&CT_ID="+document.getElementById("FCT_ID").value;strPost+="&DFA_PAIS="+document.getElementById("DFA_PAIS").value;strPost+="&DFA_CIUDAD="+document.getElementById("DFA_CIUDAD").value;if(document.getElementById("DFA_VISIBLE1").checked){strPost+="&DFA_VISIBLE="+1;}else{strPost+="&DFA_VISIBLE="+0;}$.ajax({type:"POST",data:strPost,scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"html",url:"ERP_PedidosMakProcs.jsp?id=3",success:function(datos){var strdireccion=document.getElementById("DFA_CALLE").value+" "+document.getElementById("DFA_COLONIA").value+" "+document.getElementById("DFA_MUNICIPIO").value+" "+document.getElementById("DFA_ESTADO").value;document.getElementById("cte_nomSubcte").value=document.getElementById("DFA_RAZONSOCIAL").value;document.getElementById("cte_rfcSubcte").value=document.getElementById("DFA_RFC").value;document.getElementById("CT_CLIENTEFINAL").value=datos;document.getElementById("cte_direccionSubCliente").value=strdireccion;document.getElementById("cte_telSubcte").value=document.getElementById("DFA_TELEFONO").value;$("#dialogWait").dialog("close");$("#dialog2").dialog("close");},error:function(objeto,quepaso,otroobj){alert(":pto:"+objeto+" "+quepaso+" "+otroobj);}});}}}function cancelDirCteFinalPediMak(){$("#dialog2").dialog("close");}function deleteDireccionCteFinalPediMak(idDir){$.ajax({type:"POST",data:"dir_id="+idDir,scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"html",url:"ERP_PedidosMakProcs.jsp?id=4",success:function(datos){if(datos.substring(0,2)=="OK"){alert("Dirección de entrega Eliminada...");}else{alert(datos);}$("#dialogWait").dialog("close");},error:function(objeto,quepaso,otroobj){alert(":pto:"+objeto+" "+quepaso+" "+otroobj);}});}function getUsoCteFinalPediMak(idDir){alert(idDir);$.ajax({type:"POST",data:"id_dir="+idDir,scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"html",url:"ERP_PedidosMakProcs.jsp?id=5",success:function(datos){if(datos.substring(0,2)=="OK"){return true;}else{return false;alert(datos);}$("#dialogWait").dialog("close");},error:function(objeto,quepaso,otroobj){alert(":pto:"+objeto+" "+quepaso+" "+otroobj);}});}function validaDatosCteFinalPediMak(){var strCalle=document.getElementById("DFA_CALLE").value;var strColonia=document.getElementById("DFA_COLONIA").value;var strMunicipio=document.getElementById("DFA_MUNICIPIO").value;var strEstado=document.getElementById("DFA_ESTADO").value;var strCp=document.getElementById("DFA_CP").value;var strNumero=document.getElementById("DFA_NUMERO").value;var strRazonS=document.getElementById("DFA_RAZONSOCIAL").value;var strRFC=document.getElementById("DFA_RFC").value;var strPais=document.getElementById("DFA_PAIS").value;if(strCalle==""){alert("Atención: Captura la calle");strCalle.focus();return 0;}if(strColonia==""){alert("Atención: Captura la Colonia");strColonia.focus();return 0;}if(strMunicipio==""){alert("Atención: Captura el municipio o Delegación");strMunicipio.focus();return 0;}if(strEstado==""){alert("Atención: Captura el Estado");strEstado.focus();return 0;}if(strCp==""){alert("Atención: Captura el Codigo Postal");strCp.focus();return 0;}if(strRazonS==""){alert("Atención: Captura la Razon social");strRazonS.focus();return 0;}if(strRFC==""){alert("Atención: Captura el RFC");strRFC.focus();return 0;}if(strNumero==""){alert("Atención: Captura el Numero");strRFC.focus();return 0;}if(strPais==0){alert("Atención: Captura el Pais");strRFC.focus();return 0;}return 1;}function CargaGridSubCtePediMak(){var idCte=document.getElementById("FCT_ID").value;var itemIdCob=0;$.ajax({type:"POST",data:"idCte="+idCte,scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"XML",url:"ERP_PedidosMakProcs.jsp?id=6",success:function(datos){jQuery("#grd_DireccionesDFA").clearGridData();var objsc=datos.getElementsByTagName("Subcliente")[0];var lstProds=objsc.getElementsByTagName("Subcliente_deta");for(var i=0;i<lstProds.length;i++){var obj=lstProds[i];var datarow={DFA_ID:obj.getAttribute("DFA_ID"),DFA_RAZONSOCIAL:obj.getAttribute("DFA_RAZONSOCIAL"),DFA_RFC:obj.getAttribute("DFA_RFC"),DFA_CALLE:obj.getAttribute("DFA_CALLE"),DFA_COLONIA:obj.getAttribute("DFA_COLONIA"),DFA_LOCALIDAD:obj.getAttribute("DFA_LOCALIDAD"),DFA_MUNICIPIO:obj.getAttribute("DFA_MUNICIPIO"),DFA_ESTADO:obj.getAttribute("DFA_ESTADO"),DFA_CP:obj.getAttribute("DFA_CP"),DFA_NUMERO:obj.getAttribute("DFA_NUMERO"),DFA_NUMINT:obj.getAttribute("DFA_NUMINT"),DFA_TELEFONO:obj.getAttribute("DFA_TELEFONO"),DFA_RAZONSOCIAL1:obj.getAttribute("DFA_RAZONSOCIAL"),DFA_EMAIL:obj.getAttribute("DFA_EMAIL"),CT_ID:obj.getAttribute("CT_ID"),DFA_CIUDAD:obj.getAttribute("DFA_CIUDAD")};
itemIdCob++;jQuery("#grd_DireccionesDFA").addRowData(itemIdCob,datarow,"last");}$("#dialogWait").dialog("close");},error:function(objeto,quepaso,otroobj){alert(":pto:"+objeto+" "+quepaso+" "+otroobj);}});}function salirPanSubCtePediMak(){$("#dlgMakSubCte").dialog("close");}function aceptarPanSubCtePediMak(){var grid=jQuery("#grd_DireccionesDFA");var id=grid.getGridParam("selrow");var lstRow=grid.getRowData(id);var strCalle=lstRow.DFA_CALLE;var strColonia=lstRow.DFA_COLONIA;var strLocalidad=lstRow.DFA_LOCALIDAD;var strMunicipio=lstRow.DFA_MUNICIPIO;var strEstado=lstRow.DFA_ESTADO;if(grid.getGridParam("selrow")!=null){document.getElementById("cte_nomSubcte").value=lstRow.DFA_RAZONSOCIAL;document.getElementById("cte_rfcSubcte").value=lstRow.DFA_RFC;document.getElementById("cte_direccionSubCliente").value=strCalle+" "+strColonia+" "+strLocalidad+" "+strMunicipio+" "+strEstado;document.getElementById("cte_telSubcte").value=lstRow.DFA_TELEFONO;document.getElementById("CT_CLIENTEFINAL").value=lstRow.DFA_ID;jQuery("#grd_DireccionesDFA").clearGridData();$("#dlgMakSubCte").dialog("close");}else{alert("Selecciona un Subcliente de la tabla");}}function ObtieneProductoBtnPediMak(){ObtieneProductoPediMak(d.getElementById("FAC_PROD").value);}function ObtieneProductoPediMak(strcodProd){var strCod=UCase(strcodProd);if(trim(strCod)!=""){var intDevo=d.getElementById("FAC_DEVO").value;var bolAgrupa=true;$("#dialogWait").dialog("open");var bolNvo=true;var idProd=0;if(bolAgrupa){var grid=jQuery("#FAC_GRID");var arr=grid.getDataIDs();for(var i=0;i<arr.length;i++){var id=arr[i];var lstRowAct=grid.getRowData(id);if(lstRowAct.FACD_CVE==strCod||lstRowAct.FACD_CODBARRAS==strCod){if(intDevo==1){if(lstRow.FACD_ESDEVO==1){idProd=id;bolNvo=false;break;}}else{idProd=id;bolNvo=false;break;}}}}if(bolNvo){$.ajax({type:"POST",data:encodeURI("PR_CODIGO="+strCod+"&SC_ID="+d.getElementById("pd_bodega").value+"&EMP_ID="+d.getElementById("EMP_ID").value),scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"xml",url:"ERP_PedidosMakProcs.jsp?id=10",success:function(datoVal){var objProd=datoVal.getElementsByTagName("vta_productos")[0];var Pr_Id=0;if(objProd!=undefined){Pr_Id=objProd.getAttribute("PR_ID");d.getElementById("FAC_DESC").value=objProd.getAttribute("PR_DESCRIPCION");$("#dialogWait").dialog("close");if(Pr_Id!=0){strCod=objProd.getAttribute("PR_CODIGO");}}var Ct_Id=d.getElementById("FCT_ID").value;var dblCantidad=d.getElementById("FAC_CANT").value;if(intDevo==1){dblCantidad=d.getElementById("FAC_CANT").value;}if(Pr_Id!=0){var dblExistencia=objProd.getAttribute("PR_EXISTENCIA");if(objProd.getAttribute("PR_REQEXIST")==1&&document.getElementById("FAC_TIPO").value!=3&&document.getElementById("FAC_TIPO").value!=5){$.ajax({type:"POST",data:"PR_ID="+Pr_Id,scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"html",url:"InvMov.do?id=1",success:function(datoExist){if(parseFloat(dblCantidad)>dblExistencia){alert(lstMsg[3]+"("+dblCantidad+") "+lstMsg[34]+strCod+"("+dblExistencia+") "+lstMsg[4]);var objSecModiVta=objMap.getScreen("BACKORDER_MAK");if(objSecModiVta!=null){objSecModiVta.bolActivo=false;objSecModiVta.bolMain=false;objSecModiVta.bolInit=false;objSecModiVta.idOperAct=0;}OpnOpt("BACKORDER_MAK","_ed","dlgMakBackOrder",false,false,true);}else{if(objProd.getAttribute("PR_USO_NOSERIE")==1){}else{AddItemPrecPediMak(objProd,Pr_Id,Ct_Id,dblCantidad,strCod,dblExistencia,intDevo);}}},error:function(objeto,quepaso,otroobj){alert(":ptoExist:"+objeto+" "+quepaso+" "+otroobj);$("#dialogWait").dialog("close");}});}else{AddItemPrecPediMak(objProd,Pr_Id,Ct_Id,dblCantidad,strCod,dblExistencia,intDevo);}}else{var objSecModiVta=objMap.getScreen("PRODUCTOS_MAK");if(objSecModiVta!=null){objSecModiVta.bolActivo=false;objSecModiVta.bolMain=false;objSecModiVta.bolInit=false;objSecModiVta.idOperAct=0;}OpnOpt("PRODUCTOS_MAK","_ed","dlgMakProductos",false,false,true);}},error:function(objeto,quepaso,otroobj){alert(":pto3:"+objeto+" "+quepaso+" "+otroobj);$("#dialogWait").dialog("close");}});}else{var Cantidad=d.getElementById("FAC_CANT").value;var gridD=jQuery("#FAC_GRID");var lstRow=gridD.getRowData(idProd);if(lstRow.FACD_USA_SERIE==1){}else{lstRow.FACD_CANTIDAD=parseFloat(lstRow.FACD_CANTIDAD)+parseFloat(Cantidad);if(lstRow.FACD_REQEXIST==1&&document.getElementById("FAC_TIPO").value!=3){if(parseFloat(lstRow.FACD_CANTIDAD)>parseFloat(lstRow.FACD_EXIST)){alert(lstMsg[3]+" "+lstRow.FACD_CVE+" "+lstMsg[4]);if(parseFloat(lstRow.FACD_EXIST)>0){lstRow.FACD_CANTIDAD=lstRow.FACD_EXIST;}else{lstRow.FACD_CANTIDAD=0;}}}if(intSucOfertas&&bolCargaPromociones){_LimpiaRegalosPromosPediMak(jQuery("#FAC_GRID"));}lstRowChangePrecioPediMak(lstRow,idProd,gridD);document.getElementById("FAC_PROD").value="";document.getElementById("FAC_PROD").focus();d.getElementById("FAC_CANT").value=0;$("#dialogWait").dialog("close");}}}document.getElementById("FAC_FOLIO").style.display="block";document.getElementById("cte_sucursal").style.display="block";document.getElementById("div_titulo").style.display="block";}function obtieneFechaPediMak(){$.ajax({type:"POST",data:"",scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"xml",url:"ERP_PedidosMakProcs.jsp?id=8",success:function(datos){var lstXml=datos.getElementsByTagName("fecha")[0];var lstprecio=lstXml.getElementsByTagName("fecha_deta");for(var i=0;i<lstprecio.length;i++){var obj=lstprecio[i];document.getElementById("FAC_FECHA").value=obj.getAttribute("fecha_pedido");document.getElementById("pd_fechValidez").value=obj.getAttribute("fecha_entrega");document.getElementById("pd_fech2").value=obj.getAttribute("fecha_surtido");}},error:function(objeto,quepaso,otroobj){alert(":pto9:"+objeto+" "+quepaso+" "+otroobj);$("#dialogWait").dialog("close");}});}function validaFechSurtidoPediMak(bandera){var strPost="";var strFechaPedido=document.getElementById("FAC_FECHA").value;var strFechaSurtido=document.getElementById("pd_fech2").value;var strFechaEntrega=document.getElementById("pd_fechValidez").value;strPost+="&FechaSurtido="+strFechaSurtido;strPost+="&FechaPedido="+strFechaPedido;strPost+="&FechaEntrega="+strFechaEntrega;strPost+="&boolBandera="+bandera;$.ajax({type:"POST",data:strPost,scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"xml",url:"ERP_PedidosMakProcs.jsp?id=9",success:function(datos){var lstXml=datos.getElementsByTagName("fecha")[0];var lstprecio=lstXml.getElementsByTagName("fecha_deta");for(var i=0;i<lstprecio.length;i++){var obj=lstprecio[i];if(obj.getAttribute("respuesta")!="OK"){alert(obj.getAttribute("respuesta"));if(bandera=="1"){document.getElementById("pd_fech2").value=obj.getAttribute("fecha");}if(bandera=="2"){document.getElementById("pd_fechValidez").value=obj.getAttribute("fecha");}}}},error:function(objeto,quepaso,otroobj){alert(":pto9:"+objeto+" "+quepaso+" "+otroobj);$("#dialogWait").dialog("close");}});}function AddItemPrecPediMak(objProd,Pr_Id,Ct_Id,Cantidad,strCod,dblExist,intDevo,strSeries){if(strSeries==null){strSeries="";}document.getElementById("pd_bodega").disabled=true;$.ajax({type:"POST",data:"PR_ID="+Pr_Id+"&CT_LPRECIOS="+document.getElementById("FCT_LPRECIOS").value+"&CANTIDAD="+Cantidad+"&FAC_MONEDA="+document.getElementById("FAC_MONEDA").value+"&CT_TIPO_CAMBIO="+document.getElementById("FAC_TTC_ID").value,scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"xml",url:"DamePrecio.do?id=4",success:function(datoPrec){var bolFind=false;var lstXml=datoPrec.getElementsByTagName("Precios")[0];var lstprecio=lstXml.getElementsByTagName("Precio");for(var i=0;i<lstprecio.length;i++){var obj2=lstprecio[i];var objImportes=new _ImporteVtaPediMak();objImportes.dblCantidad=Cantidad;var dblPrecio=obj2.getAttribute("precioUsar");objImportes.dblPuntos=parseFloat(obj2.getAttribute("puntos"));objImportes.dblVNegocio=parseFloat(obj2.getAttribute("negocio"));
objImportes.dblPrecio=parseFloat(dblPrecio);objImportes.dblPrecioReal=parseFloat(dblPrecio);objImportes.dblPorcDescGlobal=document.getElementById("FCT_DESCUENTO").value;objImportes.dblExento1=objProd.getAttribute("PR_EXENTO1");objImportes.dblExento2=objProd.getAttribute("PR_EXENTO2");objImportes.dblExento3=objProd.getAttribute("PR_EXENTO3");objImportes.intDevo=intDevo;if(parseInt(obj2.getAttribute("descuento"))==0){objImportes.bolAplicDescPrec=false;}if(parseInt(obj2.getAttribute("desc_pto"))==0){objImportes.bolAplicDescPto=false;}if(parseInt(obj2.getAttribute("desc_nego"))==0){objImportes.bolAplicDescVNego=false;}var bolAplicaMLM=true;if(document.getElementById("FAC_ES_MLM1")!=null&&document.getElementById("FAC_ES_MLM2")!=null){if(document.getElementById("FAC_ES_MLM2").checked){bolAplicaMLM=false;}}objImportes.bolUsoMLM=bolAplicaMLM;objImportes.CalculaImportePediMak();var dblDescuento=objImportes.dblImporteDescuento;var dblImporte=objImportes.dblImporte;var datarow={FACD_ID:0,FACD_CANTIDAD:Cantidad,FACD_DESCRIPCION:objProd.getAttribute("PR_DESCRIPCION"),FACD_IMPORTE:FormatNumber(dblImporte,2,true,false,true,false),FACD_CVE:strCod,FACD_PRECIO:FormatNumber(dblPrecio,2,true,false,true,false),FACD_TASAIVA1:dblTasaVta1,FACD_TASAIVA2:dblTasaVta2,FACD_TASAIVA3:dblTasaVta3,FACD_DESGLOSA1:1,FACD_IMPUESTO1:objImportes.dblImpuesto1,FACD_IMPUESTO2:objImportes.dblImpuesto2,FACD_IMPUESTO3:objImportes.dblImpuesto3,FACD_PR_ID:Pr_Id,FACD_EXENTO1:objProd.getAttribute("PR_EXENTO1"),FACD_EXENTO2:objProd.getAttribute("PR_EXENTO2"),FACD_EXENTO3:objProd.getAttribute("PR_EXENTO3"),FACD_REQEXIST:objProd.getAttribute("PR_REQEXIST"),FACD_EXIST:dblExist,FACD_NOSERIE:strSeries,FACD_ESREGALO:0,FACD_IMPORTEREAL:dblImporte,FACD_PRECREAL:dblPrecio,FACD_DESCUENTO:FormatNumber(dblDescuento,2,true,false,true,false),FACD_PORDESC:objImportes.dblPorcAplica,FACD_PRECFIJO:0,FACD_ESDEVO:intDevo,FACD_CODBARRAS:objProd.getAttribute("PR_CODBARRAS"),FACD_NOTAS:"",FACD_RET_ISR:intRET_ISR,FACD_RET_IVA:intRET_IVA,FACD_RET_FLETE:intRET_FLETE,FACD_UNIDAD_MEDIDA:objProd.getAttribute("PR_UNIDADMEDIDA"),FACD_PUNTOS_U:objImportes.dblPuntos,FACD_NEGOCIO_U:objImportes.dblVNegocio,FACD_PUNTOS:objImportes.dblPuntosImporte,FACD_NEGOCIO:objImportes.dblVNegocioImporte,FACD_PR_CAT1:objProd.getAttribute("PR_CAT1"),FACD_PR_CAT2:objProd.getAttribute("PR_CAT2"),FACD_PR_CAT3:objProd.getAttribute("PR_CAT3"),FACD_PR_CAT4:objProd.getAttribute("PR_CAT4"),FACD_PR_CAT5:objProd.getAttribute("PR_CAT5"),FACD_PR_CAT6:objProd.getAttribute("PR_CAT6"),FACD_PR_CAT7:objProd.getAttribute("PR_CAT7"),FACD_PR_CAT8:objProd.getAttribute("PR_CAT8"),FACD_PR_CAT9:objProd.getAttribute("PR_CAT9"),FACD_PR_CAT10:objProd.getAttribute("PR_CAT10"),FACD_DESC_ORI:0,FACD_REGALO:0,FACD_ID_PROMO:0,FACD_DESC_PREC:parseInt(obj2.getAttribute("descuento")),FACD_DESC_PTO:parseInt(obj2.getAttribute("desc_pto")),FACD_DESC_VN:parseInt(obj2.getAttribute("desc_nego")),FACD_DESC_LEAL:parseInt(obj2.getAttribute("desc_nego")),FACD_USA_SERIE:objProd.getAttribute("PR_USO_NOSERIE"),FACD_SERIES:strSeries,FACD_SERIES_MPD:"",FACD_SERIES_O:"",FACD_SERIES_MPD_O:"",FACD_CORTESIA:"0",FACD_DISPONIBLE:FormatNumber(objProd.getAttribute("PR_DISPONIBLE"),2,true,false,true,false)};itemId++;jQuery("#FAC_GRID").addRowData(itemId,datarow,"last");d.getElementById("FAC_PRECIO").value=dblPrecio;d.getElementById("FAC_PROD").value="";d.getElementById("FAC_PROD").focus();d.getElementById("FAC_CANT").value=0;d.getElementById("FAC_DESC").value=0;bolFind=true;if(intSucOfertas&&bolCargaPromociones){_LimpiaRegalosPromosPediMak(jQuery("#FAC_GRID"));}_PromocionProdPediMak(itemId);}if(!bolFind){ObtenNomCtePediMak();}$("#dialogWait").dialog("close");},error:function(objeto,quepaso,otroobj){alert(":pto4:"+objeto+" "+quepaso+" "+otroobj);$("#dialogWait").dialog("close");}});}function RefreshMonedaPediMak(){var objMoneda=document.getElementById("FAC_MONEDA");var objTipoCambio=document.getElementById("FAC_TASAPESO");if(objMoneda.value==1){objTipoCambio.value=1;objTipoCambio.setAttribute("class","READONLY");objTipoCambio.setAttribute("className","READONLY");objTipoCambio.readOnly=true;}else{objTipoCambio.value=1;objTipoCambio.setAttribute("class","outEdit");objTipoCambio.setAttribute("className","outEdit");objTipoCambio.readOnly=false;}}function _ImporteVtaPediMak(){this.dblImporte=0;this.dblImpuesto1=0;this.dblImpuesto2=0;this.dblImpuesto3=0;this.dblImpuestoReal1=0;this.dblImpuestoReal2=0;this.dblImpuestoReal3=0;this.dblCantidad=0;this.dblPrecio=0;this.dblPorcDesc=0;this.dblPorcDescGlobal=0;this.dblPrecFijo=0;this.dblExento1=0;this.dblExento2=0;this.dblExento3=0;this.dblImporteReal=0;this.dblPrecioReal=0;this.intDevo=0;this.dblPorcAplica=0;this.intPrecioZeros=0;this.dblImporteDescuento=0;this.dblPuntos=0;this.dblVNegocio=0;this.dblPuntosAplica=0;this.dblVNegocioAplica=0;this.dblPuntosImporte=0;this.dblVNegocioImporte=0;this.bolAplicDescPrec=true;this.bolAplicDescPto=true;this.bolAplicDescVNego=true;this.bolUsoMLM=true;this.CalculaImportePediMak=function CalculaImportePediMak(){this.dblPorcDescGlobal=parseFloat(this.dblPorcDescGlobal);this.dblPorcDesc=parseFloat(this.dblPorcDesc);var dblPrecioAplica=parseFloat(this.dblPrecio);this.dblPuntosAplica=this.dblPuntos;this.dblVNegocioAplica=this.dblVNegocio;this.dblPorcAplica=0;if(this.dblPorcDescGlobal>0&&this.dblPorcDesc>0){if(this.dblPorcDescGlobal>this.dblPorcDesc){this.dblPorcAplica=this.dblPorcDescGlobal;}if(this.dblPorcDesc>this.dblPorcDescGlobal){this.dblPorcAplica=this.dblPorcDesc;}if(this.dblPorcDesc==this.dblPorcDescGlobal){this.dblPorcAplica=this.dblPorcDesc;}}else{if(this.dblPorcDescGlobal>0){this.dblPorcAplica=this.dblPorcDescGlobal;}if(this.dblPorcDesc>0){this.dblPorcAplica=this.dblPorcDesc;}}if(this.dblPorcAplica>0){if(this.bolAplicDescPrec){dblPrecioAplica=dblPrecioAplica-(dblPrecioAplica*(this.dblPorcAplica/100));}if(this.bolAplicDescPto){this.dblPuntosAplica=this.dblPuntosAplica-(this.dblPuntosAplica*(this.dblPorcAplica/100));}if(this.bolAplicDescVNego){this.dblVNegocioAplica=this.dblVNegocioAplica-(this.dblVNegocioAplica*(this.dblPorcAplica/100));}}this.dblImporte=parseFloat(this.dblCantidad)*parseFloat(dblPrecioAplica);this.dblImporteReal=parseFloat(this.dblCantidad)*parseFloat(this.dblPrecioReal);if(this.dblImporteReal>0&&(this.dblImporteReal>this.dblImporte)){this.dblImporteDescuento=this.dblImporteReal-this.dblImporte;}if(parseInt(this.intDevo)==1){this.dblImporte=this.dblImporte*-1;}if(this.bolUsoMLM){this.dblPuntosImporte=parseFloat(this.dblCantidad)*parseFloat(this.dblPuntosAplica);this.dblVNegocioImporte=parseFloat(this.dblCantidad)*parseFloat(this.dblVNegocioAplica);}var dblBase1=this.dblImporte;var dblBase2=this.dblImporte;var dblBase3=this.dblImporte;if(parseInt(this.dblExento1)==1){dblBase1=0;}if(parseInt(this.dblExento2)==1){dblBase2=0;}if(parseInt(this.dblExento3)==1){dblBase3=0;}var tax=new Impuestos(dblTasaVta1,dblTasaVta2,dblTasaVta3,intSImpVta1_2,intSImpVta1_3,intSImpVta2_3);if(intPreciosconImp==1){tax.CalculaImpuesto(dblBase1,dblBase2,dblBase3);}else{tax.CalculaImpuestoMas(dblBase1,dblBase2,dblBase3);}if(parseInt(this.dblExento1)==0){this.dblImpuesto1=tax.dblImpuesto1;}if(parseInt(this.dblExento2)==0){this.dblImpuesto2=tax.dblImpuesto2;}if(parseInt(this.dblExento3)==0){this.dblImpuesto3=tax.dblImpuesto3;}var dblBaseReal1=this.dblImporteReal;var dblBaseReal2=this.dblImporteReal;var dblBaseReal3=this.dblImporteReal;if(parseInt(this.dblExento1)==1){dblBaseReal1=0;}if(parseInt(this.dblExento2)==1){dblBaseReal2=0;}if(parseInt(this.dblExento3)==1){dblBaseReal3=0;}if(intPreciosconImp==1){tax.CalculaImpuesto(dblBaseReal1,dblBaseReal2,dblBaseReal3);}else{tax.CalculaImpuestoMas(dblBaseReal1,dblBaseReal2,dblBaseReal3);}if(parseInt(this.dblExento1)==0){this.dblImpuestoReal1=tax.dblImpuesto1;}if(parseInt(this.dblExento2)==0){this.dblImpuestoReal2=tax.dblImpuesto2;}if(parseInt(this.dblExento3)==0){this.dblImpuestoReal3=tax.dblImpuesto3;}if(this.intPrecioZeros==1){this.dblImporteReal=parseFloat(this.dblCantidad)*parseFloat(this.dblPrecio);
}if(intPreciosconImp==0){this.dblImporteReal+=this.dblImpuestoReal1+this.dblImpuestoReal2+this.dblImpuestoReal3;this.dblImporte+=this.dblImpuesto1+this.dblImpuesto2+this.dblImpuesto3;}if(intPreciosconImp==1){if(this.dblImporteReal>0){var dblTotImpuesto=tax.dblImpuesto1+tax.dblImpuesto2+tax.dblImpuesto3;var dblTotImpuestoReal=tax.dblImpuestoReal1+tax.dblImpuestoReal2+tax.dblImpuestoReal3;if(this.dblImporteReal>0&&(this.dblImporteReal>this.dblImporte)){this.dblImporteDescuento=(this.dblImporteReal-dblTotImpuestoReal)-(this.dblImporte-dblTotImpuesto);}}}};}function _PromocionProdPediMak(idItem){if(intSucOfertas&&bolCargaPromociones){var gridD=jQuery("#FAC_GRID");_LimpiaRegalosPromosPediMak(gridD);var lstRow=gridD.getRowData(idItem);_CargaVarsProdPediMak(lstRow);setSumPediMak();}else{setSumPediMak();}}function _LimpiaRegalosPromosPediMak(grid){var arr=grid.getDataIDs();for(var t=0;t<arr.length;t++){var id=arr[t];var lstRowAct=grid.getRowData(id);if(parseInt(lstRowAct.FACD_REGALO)==1){grid.delRowData(id);}}}function _CargaVarsProdPediMak(lstRow){_InitVarsPediMak();if(_debugPromos){_LogPromosPediMak("Carga de variables del producto....");}var strLstCteVarsPost="";var strLstCteVarsPostKeys="";var strLstCteVarsPostProm="";for(var i=0;i<lstVars.length;i++){var objVar=lstVars[i];if(objVar.intSec==2){if(objVar.strNombre.indexOf("$cumpleClas")!=-1){if(!objVar.boolValor){if(_debugPromos){_LogPromosPediMak(objVar.strNombre+"Valida clasificaciones...");}var strNomClas=objVar.strNombre.replace("$cumpleClas","");for(var iClas=1;iClas<=10;iClas++){if(strNomClas.indexOf(iClas+"Prod(")!=-1){strNomClas=strNomClas.replace(iClas+"Prod(","");strNomClas=strNomClas.replace(")","");try{var _intValorClasRow=0;if(iClas==1){_intValorClasRow=parseInt(lstRow.FACD_PR_CAT1);}if(iClas==2){_intValorClasRow=parseInt(lstRow.FACD_PR_CAT2);}if(iClas==3){_intValorClasRow=parseInt(lstRow.FACD_PR_CAT3);}if(iClas==4){_intValorClasRow=parseInt(lstRow.FACD_PR_CAT4);}if(iClas==5){_intValorClasRow=parseInt(lstRow.FACD_PR_CAT5);}if(iClas==6){_intValorClasRow=parseInt(lstRow.FACD_PR_CAT6);}if(iClas==7){_intValorClasRow=parseInt(lstRow.FACD_PR_CAT7);}if(iClas==8){_intValorClasRow=parseInt(lstRow.FACD_PR_CAT8);}if(iClas==9){_intValorClasRow=parseInt(lstRow.FACD_PR_CAT9);}if(iClas==10){_intValorClasRow=parseInt(lstRow.FACD_PR_CAT10);}if(_debugPromos){_LogPromosPediMak(strNomClas+"vs "+_intValorClasRow);}if(parseInt(strNomClas)==_intValorClasRow){objVar.boolValor=true;}}catch(err){alert(err);}}}if(_debugPromos){_LogPromosPediMak("Cumple clas:"+objVar.boolValor);}}}else{if(objVar.strNombre.indexOf("$codigoProducto(")!=-1){if(!objVar.boolValor){if(_debugPromos){_LogPromosPediMak(objVar.strNombre+"Buscamos producto...");}var strNvaLstProdFind=objVar.strNombre.replace("$codigoProducto(","");strNvaLstProdFind=strNvaLstProdFind.replace(")","");strNvaLstProdFind=strNvaLstProdFind.replace(/"/g,"");var bolCumple=false;if(strNvaLstProdFind!=""){var _lstRecCve=strNvaLstProdFind.split(",");for(var km=0;km<_lstRecCve.length;km++){if(_debugPromos){_LogPromosPediMak("buscando producto "+_lstRecCve[km]+" vs "+lstRow.FACD_CVE);}if(trim(_lstRecCve[km])==trim(lstRow.FACD_CVE)){bolCumple=true;}}objVar.boolValor=bolCumple;}}}else{if(_debugPromos){_LogPromosPediMak(objVar.strNombre);}strLstCteVarsPostKeys+=objVar.intId+",";strLstCteVarsPost+=objVar.strNombre+",";strLstCteVarsPostProm+=objVar.intPromoId+",";}}}}if(strLstCteVarsPost!=""){var strPost="CT_ID="+document.getElementById("FCT_ID").value;strPost+="&SC_ID="+document.getElementById("SC_ID").value;strPost+="&PR_ID="+lstRow.FACD_PR_ID;strPost+="&VARS_ID="+strLstCteVarsPostKeys;strPost+="&VARS_VAR="+strLstCteVarsPost;strPost+="&VARS_PROM="+strLstCteVarsPostProm;$("#dialogWait2").dialog("open");$.ajax({type:"POST",data:strPost,scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"xml",url:_urlPromoMotor+"?id=3",success:function(datoVal){var objVariables=datoVal.getElementsByTagName("variables")[0];var _lstVariable=objVariables.getElementsByTagName("variable");for(var h=0;h<_lstVariable.length;h++){var objVariable=_lstVariable[h];for(var k=0;k<lstVars.length;k++){var objVar=lstVars[k];if(objVar.intSec==2&&objVar.intId==objVariable.getAttribute("var_id")&&objVar.intPromoId==objVariable.getAttribute("promo_id")){_AsignaVars(objVar,objVariable);}}}$("#dialogWait2").dialog("close");},error:function(objeto,quepaso,otroobj){$("#dialogWait2").dialog("close");alert(":promo ini:"+objeto+" "+quepaso+" "+otroobj);}});}}function _drawScNoSeriePediMak(objProd,Pr_Id,Ct_Id,intCantidad,strCod,dblExist,intDevo,idProd,strSeries){_objProdTmpz=objProd;if(strSeries==null){strSeries="";}$.ajax({type:"POST",data:"PR_ID="+Pr_Id,scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"xml",url:"InvMov.do?id=21",success:function(datos){var objCodBar=datos.getElementsByTagName("num_series")[0];var lstProd=objCodBar.getElementsByTagName("serie");var strOptionSelect="";for(i=0;i<lstProd.length;i++){var obj=lstProd[i];strOptionSelect+="<option value='"+obj.getAttribute("NO_SERIE")+"'>"+obj.getAttribute("NO_SERIE")+"</option>";}$("#dialog2").dialog("open");$("#dialog2").dialog("option","title",lstMsg[107]);var strHTML="<input type='hidden' id='_Pr_Id' value='"+Pr_Id+"'>";strHTML+="<input type='hidden' id='_Ct_Id' value='"+Ct_Id+"'>";strHTML+="<input type='hidden' id='_Cantidad' value='"+intCantidad+"'>";strHTML+="<input type='hidden' id='_strCod' value='"+strCod+"'>";strHTML+="<input type='hidden' id='_dblExist' value='"+dblExist+"'>";strHTML+="<input type='hidden' id='_intDevo' value='"+intDevo+"'>";strHTML+="<input type='hidden' id='_idProd' value='"+idProd+"'>";strHTML+="<table border=0 cellpadding=0>";strHTML+="<tr>";strHTML+="<td colspan=3>"+lstMsg[110]+"</td>";strHTML+="</tr>";strHTML+="<tr>";strHTML+="<td nowrap>&nbsp;"+lstMsg[172]+"<input type='text' id='search_cant' value='"+intCantidad+"' size='8' readonly disabled></td>";strHTML+="<td nowrap>&nbsp;</td>";strHTML+="<td nowrap>&nbsp;"+lstMsg[173]+"<input type='text' id='search_cant_sel' value='0' size='8' readonly disabled></td>";strHTML+="</tr>";strHTML+="<tr>";strHTML+="<td >"+lstMsg[174]+"<br><select id='series_origen' multiple>"+strOptionSelect+"</select></td>";strHTML+="<td ><input type='button' id='Agregar' value='"+lstMsg[176]+"' onclick='AgregaSerieX()'><br><input type='button' id='Quitar' value='"+lstMsg[177]+"' onClick='RemueveSerieX()'></td>";strHTML+="<td >"+lstMsg[175]+"<br><select id='series_destino' multiple ></select></td>";strHTML+="</tr>";strHTML+="<tr>";strHTML+="<td>"+CreaBoton("","ConfirmNoSerie1",lstMsg[111],"ConfirmNumSerie();","left",false,false)+"</td>";strHTML+="<td>&nbsp;</td>";strHTML+="<td>"+CreaBoton("","CancelNoSerie2",lstMsg[112],"CancelNumSerie();","left",false,false)+"</td>";strHTML+="</tr>";strHTML+="</table>";document.getElementById("dialog2_inside").innerHTML=strHTML;},error:function(objeto,quepaso,otroobj){alert(":Series pto:"+objeto+" "+quepaso+" "+otroobj);}});}function ObtenNomCtePediMak(objPedido,lstdeta,strTipoVta,bolPasaPedido,bolPasaCotiza){var intCte=document.getElementById("FCT_ID").value;if(bolPasaPedido==undefined){bolPasaPedido=false;}$.ajax({type:"POST",data:"CT_ID="+intCte,scriptCharset:"utf-8",contentType:"applicatƒion/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"xml",url:"VtasMov.do?id=9",success:function(datoVal){var objCte=datoVal.getElementsByTagName("vta_clientes")[0];if(objCte.getAttribute("CT_ID")==0){document.getElementById("CT_NOM").value="***************";ValidaShowPediMak("CT_NOM",lstMsg[28]);}else{document.getElementById("CT_NOM").value=objCte.getAttribute("CT_RAZONSOCIAL");document.getElementById("FCT_LPRECIOS").value=objCte.getAttribute("CT_LPRECIOS");document.getElementById("FCT_DIASCREDITO").value=objCte.getAttribute("CT_DIASCREDITO");document.getElementById("FAC_DIASCREDITO").value=objCte.getAttribute("CT_DIASCREDITO");document.getElementById("FCT_MONTOCRED").value=objCte.getAttribute("CT_MONTOCRED");
document.getElementById("FAC_TTC_ID").value=objCte.getAttribute("TTC_ID");document.getElementById("FAC_METODOPAGO").value=objCte.getAttribute("CT_METODODEPAGO");document.getElementById("FAC_FORMADEPAGO").value=objCte.getAttribute("CT_FORMADEPAGO");document.getElementById("FAC_NUMCUENTA").value=objCte.getAttribute("CT_CTABANCO1");document.getElementById("VE_ID").value=objCte.getAttribute("CT_VENDEDOR");intCT_TIPOPERS=objCte.getAttribute("CT_TIPOPERS");intCT_TIPOFAC=objCte.getAttribute("CT_TIPOFAC");strCT_USOIMBUEBLE=objCte.getAttribute("CT_USOIMBUEBLE");if(!bolPasaPedido){document.getElementById("FCT_DESCUENTO").value=objCte.getAttribute("CT_DESCUENTO");if(parseInt(objCte.getAttribute("MON_ID"))!=0){document.getElementById("FAC_MONEDA").value=objCte.getAttribute("MON_ID");RefreshMonedaPediMak();}if(parseInt(objCte.getAttribute("TI_ID"))!=0){document.getElementById("FAC_TASASEL1").value=objCte.getAttribute("TI_ID");document.getElementById("FAC_USE_IMP1").value=1;UpdateTasaImp();}if(parseInt(objCte.getAttribute("TI2_ID"))!=0){if(document.getElementById("FAC_TASASEL2")!=null){document.getElementById("FAC_TASASEL2").value=objCte.getAttribute("TI2_ID");document.getElementById("FAC_USE_IMP2").value=1;UpdateTasaImp2PediMak();}}if(parseInt(objCte.getAttribute("TI3_ID"))!=0){if(document.getElementById("FAC_TASASEL3")!=null){document.getElementById("FAC_TASASEL3").value=objCte.getAttribute("TI3_ID");document.getElementById("FAC_USE_IMP3").value=1;UpdateTasaImp2PediMak();}}ObtenDirecionesPediMak();ObtenClienteFinalPediMak();_PromocionCtePediMak();}}if(bolPasaPedido){DrawPedidoDetaenVentaPediMak(objPedido,lstdeta,strTipoVta);}if(bolPasaCotiza==null){bolPasaCotiza=false;}if(bolPasaCotiza){DrawCotizaDetaenVenta(objPedido,lstdeta,strTipoVta);}},error:function(objeto,quepaso,otroobj){document.getElementById("CT_NOM").value="***************";ValidaShowPediMak("CT_NOM",lstMsg[28]);alert(":pto:"+objeto+" "+quepaso+" "+otroobj);}});}function ValidaShowPediMak(strNomField,strMsg){}function UpdateTasaImp2PediMak(){var objTasaSel=document.getElementById("FAC_TASASEL2");$("#dialogWait").dialog("open");$.ajax({type:"POST",data:"TI2_ID="+objTasaSel.value,scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"xml",url:"VtasMov.do?id=17",success:function(datos){var objPedido=datos.getElementsByTagName("vta_impuesto")[0];var lstdeta=objPedido.getElementsByTagName("vta_impuestos");for(var i=0;i<lstdeta.length;i++){var obj=lstdeta[i];intIdTasaVta2=objTasaSel.value;dblTasaVta2=obj.getAttribute("Tasa2");}$("#dialogWait").dialog("close");},error:function(objeto,quepaso,otroobj){alert(":Impuestos 2:"+objeto+" "+quepaso+" "+otroobj);$("#dialogWait").dialog("close");}});}function ObtenDirecionesPediMak(){var bolExist=false;$.ajax({type:"POST",data:"ct_id="+document.getElementById("FCT_ID").value,scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"xml",url:"ERP_DireccionesEntrega.jsp?ID=1",success:function(datos){var lstDirecciones=datos.getElementsByTagName("Direcciones")[0];var lstDireccion=lstDirecciones.getElementsByTagName("direcciones");var objDir=document.getElementById("CT_DIRENTREGA");select_clear(objDir);for(j=0;j<lstDireccion.length;j++){bolExist=true;var objP=lstDireccion[j];if(j==0){select_add(objDir,"<-Seleccione->",0);}select_add(objDir,objP.getAttribute("dir_cliente"),objP.getAttribute("id_dir"));}if(bolExist==false){select_add(objDir,"<--No existen mas Direcciones-->",0);}},error:function(objeto,quepaso,otroobj){alert(":pto:"+objeto+" "+quepaso+" "+otroobj);}});}function ObtenClienteFinalPediMak(){var bolExist=false;$.ajax({type:"POST",data:"ct_id="+document.getElementById("FCT_ID").value,scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"xml",url:"ERP_ClienteFacturacion.jsp?ID=5",success:function(datos){var lstDirecciones=datos.getElementsByTagName("Direcciones")[0];var lstDireccion=lstDirecciones.getElementsByTagName("direcciones");var objDir=document.getElementById("CT_CLIENTEFINAL");select_clear(objDir);for(j=0;j<lstDireccion.length;j++){bolExist=true;var objP=lstDireccion[j];if(j==0){select_add(objDir,"<-Seleccione->",0);}select_add(objDir,objP.getAttribute("dir_cliente"),objP.getAttribute("id_dir"));}if(bolExist==false){select_add(objDir,"<--No existen mas Clientes-->",0);}},error:function(objeto,quepaso,otroobj){alert(":pto:"+objeto+" "+quepaso+" "+otroobj);}});}function _PromocionCtePediMak(){if(intSucOfertas&&bolCargaPromociones){_CargaVarsCte();}}function DrawPedidoDetaenVentaPediMak(objPedido,lstdeta,strTipoVta){for(i=0;i<lstdeta.length;i++){var obj=lstdeta[i];var objImportes=new _ImporteVtaPediMak();objImportes.dblCantidad=obj.getAttribute("PDD_CANTIDAD");if(parseInt(obj.getAttribute("PDD_EXENTO1"))==0){objImportes.dblPrecio=parseFloat(obj.getAttribute("PDD_PRECIO"))/(1+(obj.getAttribute("PDD_TASAIVA1")/100));objImportes.dblPrecioReal=parseFloat(obj.getAttribute("PDD_PRECREAL"))/(1+(obj.getAttribute("PDD_TASAIVA1")/100));}else{objImportes.dblPrecio=parseFloat(obj.getAttribute("PDD_PRECIO"));objImportes.dblPrecioReal=parseFloat(obj.getAttribute("PDD_PRECREAL"));}objImportes.dblPorcDescGlobal=document.getElementById("FCT_DESCUENTO").value;objImportes.dblPorcDesc=obj.getAttribute("PDD_PORDESC");objImportes.dblExento1=obj.getAttribute("PDD_EXENTO1");objImportes.dblExento2=obj.getAttribute("PDD_EXENTO2");objImportes.dblExento3=obj.getAttribute("PDD_EXENTO3");objImportes.intDevo=0;objImportes.dblPuntos=parseFloat(obj.getAttribute("PDD_PUNTOS"));objImportes.dblVNegocio=parseFloat(obj.getAttribute("PDD_VNEGOCIO"));if(obj.getAttribute("PDD_DESC_PREC")==0){objImportes.bolAplicDescPrec=false;}if(obj.getAttribute("PDD_DESC_PUNTOS")==0){objImportes.bolAplicDescPto=false;}if(obj.getAttribute("PDD_DESC_VNEGOCIO")==0){objImportes.bolAplicDescVNego=false;}if(obj.getAttribute("PR_REQEXIST")==1&&(strTipoVta=="FACTURA"||strTipoVta=="REMISION")){if(parseFloat(objImportes.dblCantidad)>parseFloat(obj.getAttribute("PR_EXISTENCIA"))){alert(lstMsg[3]+" "+obj.getAttribute("PDD_CVE")+" "+lstMsg[4]);if(parseFloat(obj.getAttribute("PR_EXISTENCIA"))>0){objImportes.dblCantidad=obj.getAttribute("PR_EXISTENCIA");}else{objImportes.dblCantidad=0;}}}var bolAplicaMLM=true;if(document.getElementById("FAC_ES_MLM1")!=null&&document.getElementById("FAC_ES_MLM2")!=null){if(document.getElementById("FAC_ES_MLM2").checked){bolAplicaMLM=false;}}objImportes.bolUsoMLM=bolAplicaMLM;objImportes.CalculaImportePediMak();var dblImporte=objImportes.dblImporte;var datarow={FACD_ID:0,FACD_CANTIDAD:objImportes.dblCantidad,FACD_CANTPEDIDO:obj.getAttribute("PDD_CANTIDAD"),FACD_DESCRIPCION:obj.getAttribute("PDD_DESCRIPCION"),FACD_IMPORTE:FormatNumber(dblImporte,2,true,false,true,false),FACD_CVE:obj.getAttribute("PDD_CVE"),FACD_PRECIO:FormatNumber(objImportes.dblPrecio,2,true,false,true,false),FACD_TASAIVA1:obj.getAttribute("PDD_TASAIVA1"),FACD_TASAIVA2:obj.getAttribute("PDD_TASAIVA2"),FACD_TASAIVA3:obj.getAttribute("PDD_TASAIVA3"),FACD_DESGLOSA1:1,FACD_IMPUESTO1:objImportes.dblImpuesto1,FACD_IMPUESTO2:objImportes.dblImpuesto2,FACD_IMPUESTO3:objImportes.dblImpuesto3,FACD_PR_ID:obj.getAttribute("PR_ID"),FACD_EXENTO1:obj.getAttribute("PDD_EXENTO1"),FACD_EXENTO2:obj.getAttribute("PDD_EXENTO2"),FACD_EXENTO3:obj.getAttribute("PDD_EXENTO3"),FACD_REQEXIST:obj.getAttribute("PR_REQEXIST"),FACD_EXIST:obj.getAttribute("PR_EXISTENCIA"),FACD_NOSERIE:"",FACD_ESREGALO:obj.getAttribute("PDD_ESREGALO"),FACD_IMPORTEREAL:objImportes.dblImporteReal,FACD_PRECREAL:objImportes.dblPrecioReal,FACD_DESCUENTO:FormatNumber(obj.getAttribute("PDD_DESCUENTO"),2,true,false,true,false),FACD_PORDESC:objImportes.dblPorcAplica,FACD_PRECFIJO:obj.getAttribute("PDD_PRECFIJO"),FACD_ESDEVO:0,FACD_CODBARRAS:obj.getAttribute("PR_CODBARRAS"),FACD_NOTAS:obj.getAttribute("PDD_COMENTARIO"),FACD_PUNTOS_U:objImportes.dblPuntos,FACD_NEGOCIO_U:objImportes.dblVNegocio,FACD_PUNTOS:objImportes.dblPuntosImporte,FACD_NEGOCIO:objImportes.dblVNegocioImporte,FACD_DESC_ORI:obj.getAttribute("PDD_DESC_ORI"),FACD_REGALO:obj.getAttribute("PDD_REGALO"),FACD_ID_PROMO:obj.getAttribute("PDD_ID_PROMO"),FACD_DESC_PREC:obj.getAttribute("PDD_DESC_PREC"),FACD_DESC_PTO:obj.getAttribute("PDD_DESC_PUNTOS"),FACD_DESC_VN:obj.getAttribute("PDD_DESC_VNEGOCIO"),FACD_DESC_LEAL:0};
jQuery("#FAC_GRID").addRowData(obj.getAttribute("PDD_ID"),datarow,"last");}setSumPediMak();$("#dialogWait").dialog("close");}function setSumPediMak(bolPromos){var grid=jQuery("#FAC_GRID");var arr=grid.getDataIDs();var dblSuma=0;var dblImpuesto1=0;var dblImpuesto2=0;var dblImpuesto3=0;var dblImporte=0;var dblImporteDesc=0;var dblImportePto=0;var dblImporteVn=0;var dblImporteReal=0;var dblImportePzas=0;var dblImportePtoReal=0;var dblImporteNegoReal=0;var dblImporteCredReal=0;var dblImporteImpuesto1Real=0;var dblImporteImpuesto2Real=0;var dblImporteImpuesto3Real=0;for(var i=0;i<arr.length;i++){var id=arr[i];var lstRow=grid.getRowData(id);dblSuma+=parseFloat(lstRow.FACD_IMPORTE.replace(",",""));dblImpuesto1+=parseFloat(lstRow.FACD_IMPUESTO1);dblImpuesto2+=parseFloat(lstRow.FACD_IMPUESTO2);dblImpuesto3+=parseFloat(lstRow.FACD_IMPUESTO3);dblImporte+=(parseFloat(lstRow.FACD_IMPORTE.replace(",",""))-parseFloat(lstRow.FACD_IMPUESTO1)-parseFloat(lstRow.FACD_IMPUESTO2)-parseFloat(lstRow.FACD_IMPUESTO3));dblImporteDesc+=parseFloat(lstRow.FACD_DESCUENTO.replace(",",""));dblImportePto+=parseFloat(lstRow.FACD_PUNTOS);dblImporteVn+=parseFloat(lstRow.FACD_NEGOCIO);dblImportePzas+=parseFloat(lstRow.FACD_CANTIDAD);dblImportePtoReal+=parseFloat(lstRow.FACD_CANTIDAD)*parseFloat(lstRow.FACD_PUNTOS_U);dblImporteNegoReal+=parseFloat(lstRow.FACD_CANTIDAD)*parseFloat(lstRow.FACD_NEGOCIO_U);dblImporteCredReal+=parseFloat(lstRow.FACD_CANTIDAD)*1;var dblTotlImpReal=parseFloat(lstRow.FACD_CANTIDAD)*parseFloat(lstRow.FACD_PRECREAL);var dblBase1=dblTotlImpReal;var dblBase2=dblTotlImpReal;var dblBase3=dblTotlImpReal;if(parseInt(lstRow.FACD_EXENTO1)==1){dblBase1=0;}if(parseInt(lstRow.FACD_EXENTO2)==1){dblBase2=0;}if(parseInt(lstRow.FACD_EXENTO3)==1){dblBase3=0;}var taxReal=new Impuestos(dblTasaVta1,dblTasaVta2,dblTasaVta3,intSImpVta1_2,intSImpVta1_3,intSImpVta2_3);if(intPreciosconImp==1){taxReal.CalculaImpuesto(dblBase1,dblBase2,dblBase3);}else{taxReal.CalculaImpuestoMas(dblBase1,dblBase2,dblBase3);}if(parseInt(lstRow.FACD_EXENTO1)==0){dblImporteImpuesto1Real=taxReal.dblImpuesto1;}if(parseInt(lstRow.FACD_EXENTO2)==0){dblImporteImpuesto2Real=taxReal.dblImpuesto2;}if(parseInt(lstRow.FACD_EXENTO3)==0){dblImporteImpuesto3Real=taxReal.dblImpuesto3;}if(intPreciosconImp==1){dblImporteReal+=dblTotlImpReal-dblImporteImpuesto1Real-dblImporteImpuesto2Real-dblImporteImpuesto3Real;}else{dblImporteReal+=dblTotlImpReal;}}var dblIEPS=0;if(document.getElementById("FAC_USO_IEPS1").checked){if(parseFloat(document.getElementById("FAC_TASA_IEPS").value)!=0){try{dblIEPS=dblImporte*(parseFloat(document.getElementById("FAC_TASA_IEPS").value)/100);}catch(err){}}else{alert(lstMsg[62]);document.getElementById("FAC_TASA_IEPS").focus();}var tax=new Impuestos(dblTasaVta1,dblTasaVta2,dblTasaVta3,intSImpVta1_2,intSImpVta1_3,intSImpVta2_3);tax.CalculaImpuestoMas(dblIEPS,0,0);dblImpuesto1+=tax.dblImpuesto1;dblSuma+=dblIEPS+tax.dblImpuesto1;}d.getElementById("FAC_IMPORTE_IEPS").value=FormatNumber(dblIEPS,intNumdecimal,true);d.getElementById("FAC_TOT").value=FormatNumber(dblSuma,2,true,false,true,false);d.getElementById("FAC_IMPUESTO1").value=FormatNumber(dblImpuesto1,2,true,false,true,false);d.getElementById("FAC_IMPUESTO2").value=FormatNumber(dblImpuesto2,intNumdecimal,true);d.getElementById("FAC_IMPUESTO3").value=FormatNumber(dblImpuesto3,intNumdecimal,true);d.getElementById("FAC_IMPORTE").value=FormatNumber(dblImporte,2,true,false,true,false);d.getElementById("FAC_DESCUENTO").value=FormatNumber(dblImporteDesc,2,true,false,true,false);d.getElementById("FAC_PUNTOS").value=FormatNumber(dblImportePto,intNumdecimal,true);d.getElementById("FAC_NEGOCIO").value=FormatNumber(dblImporteVn,intNumdecimal,true);d.getElementById("FAC_IMPORTE_REAL").value=FormatNumber(dblImporteReal,intNumdecimal,true);d.getElementById("FAC_PZAS").value=FormatNumber(dblImportePzas,intNumdecimal,true);d.getElementById("FAC_PUNTOS_REAL").value=FormatNumber(dblImportePtoReal,intNumdecimal,true);d.getElementById("FAC_NEGOCIO_REAL").value=FormatNumber(dblImporteNegoReal,intNumdecimal,true);d.getElementById("FAC_CREDITOS_REAL").value=FormatNumber(dblImporteCredReal,intNumdecimal,true);d.getElementById("FAC_IMPUESTO1_REAL").value=FormatNumber(dblImporteImpuesto1Real,intNumdecimal,true);d.getElementById("FAC_IMPUESTO2_REAL").value=FormatNumber(dblImporteImpuesto2Real,intNumdecimal,true);d.getElementById("FAC_IMPUESTO3_REAL").value=FormatNumber(dblImporteImpuesto3Real,intNumdecimal,true);if(parseInt(intEMP_TIPOPERS)==2&&parseInt(d.getElementById("FAC_TIPO").value)==1){if(intCT_TIPOPERS==1){var dblRetIsr=dblImporte*(dblFacRetISR/100);var dblRetIVA=0;if(dblImpuesto1>0){dblRetIVA=(dblImpuesto1/3)*2;}if(parseInt(intEMP_NO_ISR)==1){dblRetIsr=0;}if(parseInt(intEMP_NO_IVA)==1){dblRetIVA=0;}var dblImpNeto=dblSuma-dblRetIsr-dblRetIVA;document.getElementById("FAC_RETISR").value=FormatNumber(dblRetIsr,intNumdecimal,true);document.getElementById("FAC_RETIVA").value=FormatNumber(dblRetIVA,intNumdecimal,true);document.getElementById("FAC_NETO").value=FormatNumber(dblImpNeto,intNumdecimal,true);document.getElementById("FAC_RETISR").parentNode.parentNode.style.display="block";document.getElementById("FAC_RETIVA").parentNode.parentNode.style.display="block";document.getElementById("FAC_NETO").parentNode.parentNode.style.display="block";}else{document.getElementById("FAC_RETISR").parentNode.parentNode.style.display="none";document.getElementById("FAC_RETIVA").parentNode.parentNode.style.display="none";document.getElementById("FAC_NETO").parentNode.parentNode.style.display="none";document.getElementById("FAC_RETISR").value=FormatNumber(0,intNumdecimal,true);document.getElementById("FAC_RETIVA").value=FormatNumber(0,intNumdecimal,true);document.getElementById("FAC_NETO").value=FormatNumber(dblSuma,intNumdecimal,true);}}else{document.getElementById("FAC_RETISR").parentNode.parentNode.style.display="none";document.getElementById("FAC_RETIVA").parentNode.parentNode.style.display="none";document.getElementById("FAC_NETO").parentNode.parentNode.style.display="none";}if(bolPromos==null){bolPromos=true;}_PromocionTotPediMak(bolPromos);}function _PromocionTotPediMak(bolPromosExec){if(bolPromosExec){if(intSucOfertas&&bolCargaPromociones){var grid=jQuery("#FAC_GRID");var arr=grid.getDataIDs();if(arr.length>0){_CargaVarsTot("_PromocionFormulasPediMak();");}else{_ResetVarsProd();}}}}function _PromocionFormulasPediMak(){if(intSucOfertas&&bolCargaPromociones){_CargaCalculaFormulasPediMak(2);}}function _CargaCalculaFormulasPediMak(intFase){if(_debugPromos){_LogPromosPediMak("Vamos a calcular las formulas....");}$("#dialogWaitProm").dialog("open");_ResetAplicaOfertas(intFase);var bolAplicaPromo=false;var _lstPromo=objPromos.getElementsByTagName("promocion");for(var h=0;h<_lstPromo.length;h++){var objPromo=_lstPromo[h];if(objPromo.getAttribute("PROM_FASE")==intFase){bolAplicaPromo=true;var strFormulaAplica=objPromo.getAttribute("PROM_FORMULA");if(_debugPromos){_LogPromosPediMak("(1)strFormulaAplica:"+strFormulaAplica);}strFormulaAplica=strFormulaAplica.replace(/ y /g," && ");strFormulaAplica=strFormulaAplica.replace(/ o /g," || ");strFormulaAplica=strFormulaAplica.replace("$Hoy",strHoyFecha);for(var i=0;i<lstVars.length;i++){var objVar=lstVars[i];if(parseInt(objVar.intPromoId)==parseInt(objPromo.getAttribute("PROM_ID"))){var strValor=objVar.strValor;if(objVar.strTipoDato=="boolean"){strValor=objVar.boolValor;}if(objVar.strTipoDato=="integer"){strValor=objVar.intValor;}if(objVar.strTipoDato=="double"){strValor=objVar.dblValor;}if(objVar.strTipoDato=="date"){strValor=objVar.dateValor;}while(strFormulaAplica.indexOf(objVar.strNombre)!=-1){strFormulaAplica=strFormulaAplica.replace(objVar.strNombre,strValor);}}}var bolPasaPromo=false;strFormulaAplica="if("+strFormulaAplica+")bolPasaPromo=true;";try{eval(strFormulaAplica);}catch(error){alert("Error al ejecutar la formula:"+error);}if(_debugPromos){_LogPromosPediMak("(3)strFormulaAplica:"+strFormulaAplica+" "+bolPasaPromo);}if(bolPasaPromo){if(lstOfertasActivas==null){lstOfertasActivas=Array();
}var objOferta=new _ClassOferta();objOferta.intIdOferta=objPromo.getAttribute("PROM_ID");objOferta.strNombre=objPromo.getAttribute("PROM_NOMBRE");objOferta.strDesc=objPromo.getAttribute("PROM_DESCRIPCION");_intContaOfertas++;lstOfertasActivas[_intContaOfertas]=objOferta;}}}if(bolAplicaPromo){_drawOfertasPediMak();_AplicaOfertas();}else{$("#dialogWaitProm").dialog("close");}}function lstRowChangePrecioPediMak(lstRow,idUpdate,grid,bolSum){var objImportes=new _ImporteVtaPediMak();objImportes.dblCantidad=parseFloat(lstRow.FACD_CANTIDAD);objImportes.dblPrecio=parseFloat(lstRow.FACD_PRECIO.replace(",",""));objImportes.dblPrecioReal=parseFloat(lstRow.FACD_PRECREAL);objImportes.dblPuntos=parseFloat(lstRow.FACD_PUNTOS_U);objImportes.dblVNegocio=parseFloat(lstRow.FACD_NEGOCIO_U);objImportes.dblPorcDescGlobal=document.getElementById("FCT_DESCUENTO").value;objImportes.dblPorcDesc=lstRow.FACD_PORDESC;objImportes.dblPrecFijo=lstRow.FACD_PRECFIJO;objImportes.dblExento1=lstRow.FACD_EXENTO1;objImportes.dblExento2=lstRow.FACD_EXENTO2;objImportes.dblExento3=lstRow.FACD_EXENTO3;objImportes.intDevo=lstRow.FACD_ESDEVO;objImportes.intPrecioZeros=lstRow.FACD_SINPRECIO;if(lstRow.FACD_DESC_PREC==0){objImportes.bolAplicDescPrec=false;}if(lstRow.FACD_DESC_PTO==0){objImportes.bolAplicDescPto=false;}if(lstRow.FACD_DESC_VN==0){objImportes.bolAplicDescVNego=false;}var bolAplicaMLM=true;if(document.getElementById("FAC_ES_MLM1")!=null&&document.getElementById("FAC_ES_MLM2")!=null){if(document.getElementById("FAC_ES_MLM2").checked){bolAplicaMLM=false;}}objImportes.bolUsoMLM=bolAplicaMLM;objImportes.CalculaImportePediMak();lstRow.FACD_IMPORTE=FormatNumber(objImportes.dblImporte,2,true,false,true,false);lstRow.FACD_IMPUESTO1=objImportes.dblImpuesto1;lstRow.FACD_IMPUESTO2=objImportes.dblImpuesto2;lstRow.FACD_IMPUESTO3=objImportes.dblImpuesto3;lstRow.FACD_DESCUENTO=FormatNumber(objImportes.dblImporteDescuento,2,true,false,true,false);lstRow.FACD_IMPORTEREAL=objImportes.dblImporteReal;lstRow.FACD_PUNTOS=objImportes.dblPuntosImporte;lstRow.FACD_NEGOCIO=objImportes.dblVNegocioImporte;if(lstRow.FACD_NEGO_ZERO==1){lstRow.FACD_NEGOCIO=0;}grid.setRowData(idUpdate,lstRow);if(bolSum==null){bolSum=true;}if(bolSum){setSumPediMak();}}function _ImporteVtaPediMak(){this.dblImporte=0;this.dblImpuesto1=0;this.dblImpuesto2=0;this.dblImpuesto3=0;this.dblImpuestoReal1=0;this.dblImpuestoReal2=0;this.dblImpuestoReal3=0;this.dblCantidad=0;this.dblPrecio=0;this.dblPorcDesc=0;this.dblPorcDescGlobal=0;this.dblPrecFijo=0;this.dblExento1=0;this.dblExento2=0;this.dblExento3=0;this.dblImporteReal=0;this.dblPrecioReal=0;this.intDevo=0;this.dblPorcAplica=0;this.intPrecioZeros=0;this.dblImporteDescuento=0;this.dblPuntos=0;this.dblVNegocio=0;this.dblPuntosAplica=0;this.dblVNegocioAplica=0;this.dblPuntosImporte=0;this.dblVNegocioImporte=0;this.bolAplicDescPrec=true;this.bolAplicDescPto=true;this.bolAplicDescVNego=true;this.bolUsoMLM=true;this.CalculaImportePediMak=function CalculaImportePediMak(){this.dblPorcDescGlobal=parseFloat(this.dblPorcDescGlobal);this.dblPorcDesc=parseFloat(this.dblPorcDesc);var dblPrecioAplica=parseFloat(this.dblPrecio);this.dblPuntosAplica=this.dblPuntos;this.dblVNegocioAplica=this.dblVNegocio;this.dblPorcAplica=0;if(this.dblPorcDescGlobal>0&&this.dblPorcDesc>0){if(this.dblPorcDescGlobal>this.dblPorcDesc){this.dblPorcAplica=this.dblPorcDescGlobal;}if(this.dblPorcDesc>this.dblPorcDescGlobal){this.dblPorcAplica=this.dblPorcDesc;}if(this.dblPorcDesc==this.dblPorcDescGlobal){this.dblPorcAplica=this.dblPorcDesc;}}else{if(this.dblPorcDescGlobal>0){this.dblPorcAplica=this.dblPorcDescGlobal;}if(this.dblPorcDesc>0){this.dblPorcAplica=this.dblPorcDesc;}}if(this.dblPorcAplica>0){if(this.bolAplicDescPrec){dblPrecioAplica=dblPrecioAplica-(dblPrecioAplica*(this.dblPorcAplica/100));}if(this.bolAplicDescPto){this.dblPuntosAplica=this.dblPuntosAplica-(this.dblPuntosAplica*(this.dblPorcAplica/100));}if(this.bolAplicDescVNego){this.dblVNegocioAplica=this.dblVNegocioAplica-(this.dblVNegocioAplica*(this.dblPorcAplica/100));}}this.dblImporte=parseFloat(this.dblCantidad)*parseFloat(dblPrecioAplica);this.dblImporteReal=parseFloat(this.dblCantidad)*parseFloat(this.dblPrecioReal);if(this.dblImporteReal>0&&(this.dblImporteReal>this.dblImporte)){this.dblImporteDescuento=this.dblImporteReal-this.dblImporte;}if(parseInt(this.intDevo)==1){this.dblImporte=this.dblImporte*-1;}if(this.bolUsoMLM){this.dblPuntosImporte=parseFloat(this.dblCantidad)*parseFloat(this.dblPuntosAplica);this.dblVNegocioImporte=parseFloat(this.dblCantidad)*parseFloat(this.dblVNegocioAplica);}var dblBase1=this.dblImporte;var dblBase2=this.dblImporte;var dblBase3=this.dblImporte;if(parseInt(this.dblExento1)==1){dblBase1=0;}if(parseInt(this.dblExento2)==1){dblBase2=0;}if(parseInt(this.dblExento3)==1){dblBase3=0;}var tax=new Impuestos(dblTasaVta1,dblTasaVta2,dblTasaVta3,intSImpVta1_2,intSImpVta1_3,intSImpVta2_3);if(intPreciosconImp==1){tax.CalculaImpuesto(dblBase1,dblBase2,dblBase3);}else{tax.CalculaImpuestoMas(dblBase1,dblBase2,dblBase3);}if(parseInt(this.dblExento1)==0){this.dblImpuesto1=tax.dblImpuesto1;}if(parseInt(this.dblExento2)==0){this.dblImpuesto2=tax.dblImpuesto2;}if(parseInt(this.dblExento3)==0){this.dblImpuesto3=tax.dblImpuesto3;}var dblBaseReal1=this.dblImporteReal;var dblBaseReal2=this.dblImporteReal;var dblBaseReal3=this.dblImporteReal;if(parseInt(this.dblExento1)==1){dblBaseReal1=0;}if(parseInt(this.dblExento2)==1){dblBaseReal2=0;}if(parseInt(this.dblExento3)==1){dblBaseReal3=0;}if(intPreciosconImp==1){tax.CalculaImpuesto(dblBaseReal1,dblBaseReal2,dblBaseReal3);}else{tax.CalculaImpuestoMas(dblBaseReal1,dblBaseReal2,dblBaseReal3);}if(parseInt(this.dblExento1)==0){this.dblImpuestoReal1=tax.dblImpuesto1;}if(parseInt(this.dblExento2)==0){this.dblImpuestoReal2=tax.dblImpuesto2;}if(parseInt(this.dblExento3)==0){this.dblImpuestoReal3=tax.dblImpuesto3;}if(this.intPrecioZeros==1){this.dblImporteReal=parseFloat(this.dblCantidad)*parseFloat(this.dblPrecio);}if(intPreciosconImp==0){this.dblImporteReal+=this.dblImpuestoReal1+this.dblImpuestoReal2+this.dblImpuestoReal3;this.dblImporte+=this.dblImpuesto1+this.dblImpuesto2+this.dblImpuesto3;}if(intPreciosconImp==1){if(this.dblImporteReal>0){var dblTotImpuesto=tax.dblImpuesto1+tax.dblImpuesto2+tax.dblImpuesto3;var dblTotImpuestoReal=tax.dblImpuestoReal1+tax.dblImpuestoReal2+tax.dblImpuestoReal3;if(this.dblImporteReal>0&&(this.dblImporteReal>this.dblImporte)){this.dblImporteDescuento=(this.dblImporteReal-dblTotImpuestoReal)-(this.dblImporte-dblTotImpuesto);}}}};}function SaveVtaPediMak(){var bolPasa=true;if(d.getElementById("TOTALXPAGAR")!=null){if(parseInt(intEMP_TIPOPERS)==2&&intCT_TIPOPERS==1&&parseInt(d.getElementById("FAC_TIPO").value)==1){d.getElementById("TOTALXPAGAR").value=d.getElementById("FAC_NETO").value;}else{d.getElementById("TOTALXPAGAR").value=d.getElementById("FAC_TOT").value.replace(",","");}}if(d.getElementById("ADD_MABE")!=null){if(d.getElementById("ADD_MABE").value!=undefined){if(d.getElementById("ADD_MABE").value!=0){if(d.getElementById("USA_MABE1").checked){if(!ValidaMABE()){alert(lstMsg[63]);bolPasa=false;}}}}}if(d.getElementById("ADD_AMECE")!=null){if(d.getElementById("ADD_AMECE").value!=undefined){if(d.getElementById("ADD_AMECE").value!=0){if(d.getElementById("USA_AMECE1").checked){if(!ValidaAMECE()){alert(lstMsg[155]);bolPasa=false;}}}}}if(document.getElementById("ADD_SANOFI")!=null){if(document.getElementById("ADD_SANOFI").value!=undefined){if(document.getElementById("ADD_SANOFI").value!=0){if(document.getElementById("USA_SANOFI1").checked){if(!ValidaSANOFI()){alert(lstMsg[153]);bolPasa=false;}}}}}if(d.getElementById("ADD_FEMSA")!=null){if(d.getElementById("ADD_FEMSA").value!=undefined){if(d.getElementById("ADD_FEMSA").value!=0){if(d.getElementById("USA_FEMSA1").checked){if(!ValidaFEMSA()){alert(lstMsg[155]);bolPasa=false;}}}}}if(validaDatosPediMak()==false){bolPasa=false;}if(bolPasa){if(document.getElementById("FAC_TIPO").value!="3"&&document.getElementById("FAC_TIPO").value!="5"){if(parseFloat(document.getElementById("FAC_TOT").value.replace(",",""))==0){var aRespC=confirm(lstMsg[184]);
if(aRespC){SaveVtaDoPediMak();}}else{if(parseFloat(document.getElementById("FAC_DIASCREDITO").value)==0){OpnOpt("FORMPAGO","_ed","dialogPagos",false,false,true);var objMainFacPedi=objMap.getScreen("FORMPAGO");objMainFacPedi.bolActivo=false;objMainFacPedi.bolMain=false;objMainFacPedi.bolInit=false;objMainFacPedi.idOperAct=0;}else{SaveVtaDoPediMak();}}}else{SaveVtaDoPediMak();}}}function Callbtn0PediMak(){if(bolSaveVta){SaveVtaPediMak();}else{alert(lstMsg[161]);}}function SaveVtaDoPediMak(){$("#dialogPagos").dialog("close");$("#dialogWait").dialog("open");var strPOST="";var strPrefijoMaster="TKT";var strPrefijoDeta="TKTD";var strKey="TKT_ID";var strNomFormat="TICKET";if(d.getElementById("FAC_TIPO").value=="1"){strPrefijoMaster="FAC";strPrefijoDeta="FACD";strKey="FAC_ID";strNomFormat="FACTURA";}if(d.getElementById("FAC_TIPO").value=="3"){strPrefijoMaster="PD";strPrefijoDeta="PDD";strKey="PD_ID";strNomFormat="PEDIDO";}if(d.getElementById("FAC_TIPO").value=="5"){strPrefijoMaster="COT";strPrefijoDeta="COTD";strKey="COT_ID";strNomFormat="COTIZA";}strPOST+="SC_ID="+d.getElementById("pd_bodega").value;strPOST+="&CT_ID="+d.getElementById("FCT_ID").value;strPOST+="&VE_ID="+d.getElementById("VE_ID").value;strPOST+="&PD_ID="+d.getElementById("PD_ID").value;strPOST+="&COT_ID="+d.getElementById("COT_ID").value;strPOST+="&"+strPrefijoMaster+"_ESSERV=0";strPOST+="&"+strPrefijoMaster+"_MONEDA="+d.getElementById("FAC_MONEDA").value;strPOST+="&"+strPrefijoMaster+"_FECHA="+d.getElementById("FAC_FECHA").value;if(d.getElementById("FAC_TIPO").value=="3"){if(parseFloat(d.getElementById("PD_ID").value)>0){strPOST+="&"+strPrefijoMaster+"_FOLIO="+d.getElementById("FAC_FOLIO").value;}else{strPOST+="&"+strPrefijoMaster+"_FOLIO=";}}else{strPOST+="&"+strPrefijoMaster+"_FOLIO=";}strPOST+="&"+strPrefijoMaster+"_NOTAS="+encodeURIComponent(d.getElementById("FAC_NOTAS").value);strPOST+="&"+strPrefijoMaster+"_TOTAL="+d.getElementById("FAC_TOT").value.replace(",","");strPOST+="&"+strPrefijoMaster+"_IMPUESTO1="+d.getElementById("FAC_IMPUESTO1").value.replace(",","");strPOST+="&"+strPrefijoMaster+"_IMPUESTO2="+d.getElementById("FAC_IMPUESTO2").value;strPOST+="&"+strPrefijoMaster+"_IMPUESTO3="+d.getElementById("FAC_IMPUESTO3").value;strPOST+="&"+strPrefijoMaster+"_IMPORTE="+d.getElementById("FAC_IMPORTE").value.replace(",","");strPOST+="&"+strPrefijoMaster+"_RETISR="+d.getElementById("FAC_RETISR").value;strPOST+="&"+strPrefijoMaster+"_RETIVA="+d.getElementById("FAC_RETIVA").value;strPOST+="&"+strPrefijoMaster+"_NETO="+d.getElementById("FAC_NETO").value;strPOST+="&"+strPrefijoMaster+"_NOTASPIE="+encodeURIComponent(d.getElementById("FAC_NOTASPIE").value);strPOST+="&"+strPrefijoMaster+"_REFERENCIA="+d.getElementById("FAC_REFERENCIA").value;strPOST+="&"+strPrefijoMaster+"_CONDPAGO="+d.getElementById("FAC_CONDPAGO").value;strPOST+="&"+strPrefijoMaster+"_METODOPAGO="+d.getElementById("FAC_METODOPAGO").value;strPOST+="&"+strPrefijoMaster+"_NUMCUENTA="+d.getElementById("FAC_NUMCUENTA").value;strPOST+="&"+strPrefijoMaster+"_FORMADEPAGO="+d.getElementById("FAC_FORMADEPAGO").value;strPOST+="&"+strPrefijoMaster+"_NUMPEDI="+d.getElementById("FAC_NUMPEDI").value;strPOST+="&"+strPrefijoMaster+"_FECHAPEDI="+d.getElementById("FAC_FECHAPEDI").value;strPOST+="&"+strPrefijoMaster+"_ADUANA="+d.getElementById("FAC_ADUANA").value;strPOST+="&"+strPrefijoMaster+"_TIPOCOMP="+d.getElementById("FAC_TIPOCOMP").value;strPOST+="&TIPOVENTA="+d.getElementById("FAC_TIPO").value;strPOST+="&"+strPrefijoMaster+"_TASA1="+dblTasaVta1;strPOST+="&"+strPrefijoMaster+"_TASA2="+dblTasaVta2;strPOST+="&"+strPrefijoMaster+"_TASA3="+dblTasaVta3;strPOST+="&"+"TI_ID="+intIdTasaVta1;strPOST+="&"+"TI_ID2="+intIdTasaVta2;strPOST+="&"+"TI_ID3="+intIdTasaVta3;strPOST+="&"+strPrefijoMaster+"_TASAPESO="+d.getElementById("FAC_TASAPESO").value;strPOST+="&"+strPrefijoMaster+"_DIASCREDITO="+d.getElementById("FAC_DIASCREDITO").value;strPOST+="&"+strPrefijoMaster+"_POR_DESC="+d.getElementById("FCT_DESCUENTO").value;strPOST+="&TR_ID="+d.getElementById("TR_ID").value;strPOST+="&ME_ID="+d.getElementById("ME_ID").value;strPOST+="&TF_ID="+d.getElementById("TF_ID").value;if(d.getElementById("CT_DIRENTREGA")!=null){strPOST+="&CDE_ID="+d.getElementById("CT_DIRENTREGA").value;}if(d.getElementById("CT_CLIENTEFINAL")!=null){strPOST+="&DFA_ID="+d.getElementById("CT_CLIENTEFINAL").value;}if(d.getElementById("SYC_ID")!=null){strPOST+="&SYC_ID="+d.getElementById("SYC_ID").value;}strPOST+="&"+strPrefijoMaster+"_NUM_GUIA="+d.getElementById("FAC_NUM_GUIA").value;strPOST+="&"+strPrefijoMaster+"_PUNTOS="+d.getElementById("FAC_PUNTOS").value;strPOST+="&"+strPrefijoMaster+"_NEGOCIO="+d.getElementById("FAC_NEGOCIO").value;if(document.getElementById("FAC_USO_IEPS1").checked){strPOST+="&"+strPrefijoMaster+"_USO_IEPS=1";strPOST+="&"+strPrefijoMaster+"_TASA_IEPS="+d.getElementById("FAC_TASA_IEPS").value;strPOST+="&"+strPrefijoMaster+"_IMPORTE_IEPS="+d.getElementById("FAC_IMPORTE_IEPS").value;}else{strPOST+="&"+strPrefijoMaster+"_USO_IEPS=0";strPOST+="&"+strPrefijoMaster+"_TASA_IEPS=0";strPOST+="&"+strPrefijoMaster+"_IMPORTE_IEPS=0";}if(document.getElementById("FAC_CONSIGNACION1")!=null){if(document.getElementById("FAC_CONSIGNACION1").checked){strPOST+="&"+strPrefijoMaster+"_CONSIGNACION=1";}else{strPOST+="&"+strPrefijoMaster+"_CONSIGNACION=0";}}else{strPOST+="&"+strPrefijoMaster+"_CONSIGNACION=0";}if(d.getElementById("ADD_MABE").value!=undefined){if(d.getElementById("ADD_MABE").value!=0){if(d.getElementById("USA_MABE1").checked){strPOST+="&ADD_MABE=1";strPOST+="&MB_CODIGOPROVEEDOR="+d.getElementById("MB_CODIGOPROVEEDOR").value;strPOST+="&MB_PLANTA="+d.getElementById("MB_PLANTA").value;strPOST+="&MB_CALLE="+d.getElementById("MB_CALLE").value;strPOST+="&MB_NO_EXT="+d.getElementById("MB_NO_EXT").value;strPOST+="&MB_NO_INT="+d.getElementById("MB_NO_INT").value;strPOST+="&MB_ORDENCOMPRA="+d.getElementById("MB_ORDENCOMPRA").value;strPOST+="&MB_REFERENCIA1="+d.getElementById("MB_REFERENCIA1").value;}}}else{strPOST+="&ADD_MABE=0";}if(d.getElementById("ADD_SANOFI")!=null){if(d.getElementById("ADD_SANOFI").value!=undefined){if(d.getElementById("ADD_SANOFI").value!=0){if(d.getElementById("USA_SANOFI1").checked){if(d.getElementById("SNF_ODC_SP1").checked){strPOST+="&ADD_SANOFI=1";strPOST+="&USA_SANOFI1=1";strPOST+="&SNF_NUM_PROV="+d.getElementById("SNF_NUM_PROV").value;strPOST+="&SNF_NUM_ODC="+d.getElementById("SNF_NUM_ODC").value;strPOST+="&SNF_NUM_SOL="+d.getElementById("SNF_NUM_SOL").value;}if(d.getElementById("SNF_ODC_SP2").checked){strPOST+="&ADD_SANOFI=1";strPOST+="&USA_SANOFI2=1";strPOST+="&SNF_NUM_PROV="+d.getElementById("SNF_NUM_PROV").value;strPOST+="&SNF_NUM_SOL="+d.getElementById("SNF_NUM_SOL").value;strPOST+="&SNF_CUENTA_PUENTE="+d.getElementById("SNF_CUENTA_PUENTE").value;}}}}else{strPOST+="&ADD_SANOFI=0";}}else{strPOST+="&ADD_SANOFI=0";}if(d.getElementById("ADD_AMECE")!=null){if(d.getElementById("ADD_AMECE").value!=undefined){if(d.getElementById("ADD_AMECE").value!=0){if(d.getElementById("USA_AMECE1").checked){strPOST+="&ADD_AMECE=1";strPOST+="&HM_DIV="+d.getElementById("HM_DIV").value;strPOST+="&HM_SOC="+d.getElementById("HM_SOC").value;strPOST+="&HM_ON="+d.getElementById("HM_ON").value;strPOST+="&HM_REFERENCEDATE="+d.getElementById("HM_REFERENCEDATE").value;strPOST+="&HM_SELLER_ASSIGNED_IDENTIFIER_FOR_A_PARTY="+d.getElementById("HM_SELLER_ASSIGNED_IDENTIFIER_FOR_A_PARTY").value;strPOST+="&HM_NAME="+d.getElementById("HM_NAME").value;strPOST+="&HM_STREET="+d.getElementById("HM_STREET").value;strPOST+="&HM_CITY="+d.getElementById("HM_CITY").value;strPOST+="&HM_POSTALCODE="+d.getElementById("HM_POSTALCODE").value;}}}else{strPOST+="&ADD_AMECE=0";}}else{strPOST+="&ADD_AMECE=0";}if(d.getElementById("ADD_FEMSA")!=null){if(d.getElementById("ADD_FEMSA").value!=undefined){if(d.getElementById("ADD_FEMSA").value!=0){if(d.getElementById("USA_FEMSA1").checked){strPOST+="&ADD_FEMSA=1";strPOST+="&FEM_TIPO="+d.getElementById("FEM_TIPO").value;strPOST+="&FEM_SOC="+d.getElementById("FEM_SOC").value;
strPOST+="&FEM_NUM_PROV="+d.getElementById("FEM_NUM_PROV").value;strPOST+="&FEM_NUM_PED="+d.getElementById("FEM_NUM_PED").value;strPOST+="&FEM_MONEDA="+d.getElementById("FEM_MONEDA").value;strPOST+="&FEM_NUM_ENTR_SAP="+d.getElementById("FEM_NUM_ENTR_SAP").value;strPOST+="&FEM_NUM_REMI="+d.getElementById("FEM_NUM_REMI").value;strPOST+="&FEM_RET="+d.getElementById("FEM_RET").value;strPOST+="&FEM_CORREO="+d.getElementById("FEM_CORREO").value;}}}else{strPOST+="&ADD_FEMSA=0";}}else{strPOST+="&ADD_FEMSA=0";}if(d.getElementById("FAC_ESRECU1").checked){strPOST+="&"+strPrefijoMaster+"_ESRECU=1";}else{strPOST+="&"+strPrefijoMaster+"_ESRECU=0";}strPOST+="&"+strPrefijoMaster+"_PERIODICIDAD="+d.getElementById("FAC_PERIODICIDAD").value;strPOST+="&"+strPrefijoMaster+"_DIAPER="+d.getElementById("FAC_DIAPER").value;strPOST+="&"+strPrefijoMaster+"_NO_EVENTOS="+d.getElementById("FAC_NO_EVENTOS").value;if(document.getElementById("FAC_REGIMENFISCALcount")!=null&&document.getElementById("FAC_REGIMENFISCALcount")!=undefined){var intCuantosReg=document.getElementById("FAC_REGIMENFISCALcount").value;if(intCuantosReg>0){for(var iRegim=0;iRegim<intCuantosReg;iRegim++){if(d.getElementById("FAC_REGIMENFISCAL"+iRegim).checked){strPOST+="&"+strPrefijoMaster+"_REGIMENFISCAL="+d.getElementById("FAC_REGIMENFISCAL"+iRegim).value;}}}}var grid=jQuery("#FAC_GRID");var arr=grid.getDataIDs();var intC=0;for(var i=0;i<arr.length;i++){var id=arr[i];var lstRow=grid.getRowData(id);intC++;strPOST+="&PR_ID"+intC+"="+lstRow.FACD_PR_ID;strPOST+="&"+strPrefijoDeta+"_EXENTO1"+intC+"="+lstRow.FACD_EXENTO1;strPOST+="&"+strPrefijoDeta+"_EXENTO2"+intC+"="+lstRow.FACD_EXENTO2;strPOST+="&"+strPrefijoDeta+"_EXENTO3"+intC+"="+lstRow.FACD_EXENTO3;strPOST+="&"+strPrefijoDeta+"_CVE"+intC+"="+lstRow.FACD_CVE;strPOST+="&"+strPrefijoDeta+"_DESCRIPCION"+intC+"="+encodeURIComponent(lstRow.FACD_DESCRIPCION);strPOST+="&"+strPrefijoDeta+"_CANTIDAD"+intC+"="+lstRow.FACD_CANTIDAD;strPOST+="&"+strPrefijoDeta+"_RET_ISR"+intC+"="+lstRow.FACD_RET_ISR;strPOST+="&"+strPrefijoDeta+"_RET_IVA"+intC+"="+lstRow.FACD_RET_IVA;strPOST+="&"+strPrefijoDeta+"_RET_FLETE"+intC+"="+lstRow.FACD_RET_FLETE;strPOST+="&"+strPrefijoDeta+"_IMP_PUNTOS"+intC+"="+lstRow.FACD_PUNTOS;strPOST+="&"+strPrefijoDeta+"_IMP_VNEGOCIO"+intC+"="+lstRow.FACD_NEGOCIO;strPOST+="&"+strPrefijoDeta+"_PUNTOS"+intC+"="+lstRow.FACD_PUNTOS_U;strPOST+="&"+strPrefijoDeta+"_VNEGOCIO"+intC+"="+lstRow.FACD_NEGOCIO_U;strPOST+="&"+strPrefijoDeta+"_DESC_PREC"+intC+"="+lstRow.FACD_DESC_PREC;strPOST+="&"+strPrefijoDeta+"_DESC_PTO"+intC+"="+lstRow.FACD_DESC_PTO;strPOST+="&"+strPrefijoDeta+"_DESC_VN"+intC+"="+lstRow.FACD_DESC_VN;strPOST+="&"+strPrefijoDeta+"_DESC_ORI"+intC+"="+lstRow.FACD_DESC_ORI;strPOST+="&"+strPrefijoDeta+"_REGALO"+intC+"="+lstRow.FACD_REGALO;strPOST+="&"+strPrefijoDeta+"_ID_PROMO"+intC+"="+lstRow.FACD_ID_PROMO;if(intPreciosconImp==1){strPOST+="&"+strPrefijoDeta+"_PRECIO"+intC+"="+lstRow.FACD_PRECIO.replace(",","");if(lstRow.FACD_SINPRECIO==0){strPOST+="&"+strPrefijoDeta+"_PRECREAL"+intC+"="+lstRow.FACD_PRECREAL;}else{strPOST+="&"+strPrefijoDeta+"_PRECREAL"+intC+"="+0;}}else{var dblPrecioConImp=0;var dblPrecioRealConImp=0;if(lstRow.FACD_CANTIDAD>0){var dblBase1=0;var dblBase2=0;var dblBase3=0;var dblBaseReal1=0;var dblBaseReal2=0;var dblBaseReal3=0;var dblImpuesto1=0;var dblImpuesto2=0;var dblImpuesto3=0;var dblImpuestoReal1=0;var dblImpuestoReal2=0;var dblImpuestoReal3=0;if(parseInt(lstRow.FACD_EXENTO1)==0){dblBase1=lstRow.FACD_PRECIO.replace(",","");}if(parseInt(lstRow.FACD_EXENTO2)==0){dblBase2=lstRow.FACD_PRECIO.replace(",","");}if(parseInt(lstRow.FACD_EXENTO3)==0){dblBase3=lstRow.FACD_PRECIO.replace(",","");}if(parseInt(lstRow.FACD_EXENTO1)==0){dblBaseReal1=lstRow.FACD_PRECREAL;}if(parseInt(lstRow.FACD_EXENTO2)==0){dblBaseReal2=lstRow.FACD_PRECREAL;}if(parseInt(lstRow.FACD_EXENTO3)==0){dblBaseReal3=lstRow.FACD_PRECREAL;}var tax=new Impuestos(dblTasaVta1,dblTasaVta2,dblTasaVta3,intSImpVta1_2,intSImpVta1_3,intSImpVta2_3);tax.CalculaImpuestoMas(dblBase1,dblBase2,dblBase3);var tax2=new Impuestos(dblTasaVta1,dblTasaVta2,dblTasaVta3,intSImpVta1_2,intSImpVta1_3,intSImpVta2_3);tax2.CalculaImpuestoMas(dblBaseReal1,dblBaseReal2,dblBaseReal3);if(parseInt(lstRow.FACD_EXENTO1)==0){dblImpuesto1=tax.dblImpuesto1;}if(parseInt(lstRow.FACD_EXENTO2)==0){dblImpuesto2=tax.dblImpuesto2;}if(parseInt(lstRow.FACD_EXENTO3)==0){dblImpuesto3=tax.dblImpuesto3;}if(parseInt(lstRow.FACD_EXENTO1)==0){dblImpuestoReal1=tax2.dblImpuesto1;}if(parseInt(lstRow.FACD_EXENTO2)==0){dblImpuestoReal2=tax2.dblImpuesto2;}if(parseInt(lstRow.FACD_EXENTO3)==0){dblImpuestoReal3=tax2.dblImpuesto3;}dblPrecioConImp=(parseFloat(lstRow.FACD_PRECIO.replace(",",""))+dblImpuesto1+dblImpuesto2+dblImpuesto3);if(lstRow.FACD_SINPRECIO==0){dblPrecioRealConImp=(parseFloat(lstRow.FACD_PRECREAL)+dblImpuestoReal1+dblImpuestoReal2+dblImpuestoReal3);}else{dblPrecioRealConImp=(parseFloat(lstRow.FACD_PRECIO.replace(",",""))+dblImpuesto1+dblImpuesto2+dblImpuesto3);lstRow.FACD_IMPORTEREAL=dblPrecioRealConImp*lstRow.FACD_CANTIDAD;}}else{dblPrecioConImp=(parseFloat(lstRow.FACD_PRECIO.replace(",","")));dblPrecioRealConImp=(parseFloat(lstRow.FACD_PRECREAL));}strPOST+="&"+strPrefijoDeta+"_PRECIO"+intC+"="+dblPrecioConImp;if(lstRow.FACD_SINPRECIO==0){strPOST+="&"+strPrefijoDeta+"_PRECREAL"+intC+"="+dblPrecioRealConImp;}else{strPOST+="&"+strPrefijoDeta+"_PRECREAL"+intC+"="+0;}}strPOST+="&"+strPrefijoDeta+"_IMPORTE"+intC+"="+lstRow.FACD_IMPORTE.replace(",","");strPOST+="&"+strPrefijoDeta+"_TASAIVA1"+intC+"="+lstRow.FACD_TASAIVA1;strPOST+="&"+strPrefijoDeta+"_TASAIVA2"+intC+"=0"+lstRow.FACD_TASAIVA2;strPOST+="&"+strPrefijoDeta+"_TASAIVA3"+intC+"="+lstRow.FACD_TASAIVA3;strPOST+="&"+strPrefijoDeta+"_IMPUESTO1"+intC+"="+lstRow.FACD_IMPUESTO1;strPOST+="&"+strPrefijoDeta+"_IMPUESTO2"+intC+"="+lstRow.FACD_IMPUESTO2;strPOST+="&"+strPrefijoDeta+"_IMPUESTO3"+intC+"="+lstRow.FACD_IMPUESTO3;strPOST+="&"+strPrefijoDeta+"_ESREGALO"+intC+"="+lstRow.FACD_ESREGALO;strPOST+="&"+strPrefijoDeta+"_NOSERIE"+intC+"="+lstRow.FACD_NOSERIE;strPOST+="&"+strPrefijoDeta+"_IMPORTEREAL"+intC+"="+lstRow.FACD_IMPORTEREAL;strPOST+="&"+strPrefijoDeta+"_DESCUENTO"+intC+"="+lstRow.FACD_DESCUENTO.replace(",","");strPOST+="&"+strPrefijoDeta+"_PORDESC"+intC+"="+lstRow.FACD_PORDESC;strPOST+="&"+strPrefijoDeta+"_ESDEVO"+intC+"="+lstRow.FACD_ESDEVO;strPOST+="&"+strPrefijoDeta+"_PRECFIJO"+intC+"="+lstRow.FACD_PRECFIJO;strPOST+="&"+strPrefijoDeta+"_NOTAS"+intC+"="+encodeURIComponent(lstRow.FACD_NOTAS);strPOST+="&"+strPrefijoDeta+"_UNIDAD_MEDIDA"+intC+"="+lstRow.FACD_UNIDAD_MEDIDA;strPOST+="&strbackorder"+intC+"="+lstRow.FACD_DETALLE_BACKORDER;strPOST+="&strEsbackorder"+intC+"="+lstRow.FACD_ES_BACKORDER;strPOST+="&strTipoBackorder"+intC+"="+lstRow.FACD_TIPO_BACKORDER;if(lstRow.FACD_CORTESIA!=0){intC++;strPOST+="&PR_ID"+intC+"="+lstRow.FACD_PR_ID;strPOST+="&"+strPrefijoDeta+"_EXENTO1"+intC+"="+lstRow.FACD_EXENTO1;strPOST+="&"+strPrefijoDeta+"_EXENTO2"+intC+"="+lstRow.FACD_EXENTO2;strPOST+="&"+strPrefijoDeta+"_EXENTO3"+intC+"="+lstRow.FACD_EXENTO3;strPOST+="&"+strPrefijoDeta+"_CVE"+intC+"="+lstRow.FACD_CVE;strPOST+="&"+strPrefijoDeta+"_DESCRIPCION"+intC+"="+encodeURIComponent(lstRow.FACD_DESCRIPCION);strPOST+="&"+strPrefijoDeta+"_CANTIDAD"+intC+"="+lstRow.FACD_CORTESIA;strPOST+="&"+strPrefijoDeta+"_RET_ISR"+intC+"="+lstRow.FACD_RET_ISR;strPOST+="&"+strPrefijoDeta+"_RET_IVA"+intC+"="+lstRow.FACD_RET_IVA;strPOST+="&"+strPrefijoDeta+"_RET_FLETE"+intC+"="+lstRow.FACD_RET_FLETE;strPOST+="&"+strPrefijoDeta+"_IMP_PUNTOS"+intC+"="+lstRow.FACD_PUNTOS;strPOST+="&"+strPrefijoDeta+"_IMP_VNEGOCIO"+intC+"="+lstRow.FACD_NEGOCIO;strPOST+="&"+strPrefijoDeta+"_PUNTOS"+intC+"="+lstRow.FACD_PUNTOS_U;strPOST+="&"+strPrefijoDeta+"_VNEGOCIO"+intC+"="+lstRow.FACD_NEGOCIO_U;strPOST+="&"+strPrefijoDeta+"_DESC_PREC"+intC+"="+lstRow.FACD_DESC_PREC;strPOST+="&"+strPrefijoDeta+"_DESC_PTO"+intC+"="+lstRow.FACD_DESC_PTO;strPOST+="&"+strPrefijoDeta+"_DESC_VN"+intC+"="+lstRow.FACD_DESC_VN;strPOST+="&"+strPrefijoDeta+"_DESC_ORI"+intC+"="+lstRow.FACD_DESC_ORI;
strPOST+="&"+strPrefijoDeta+"_REGALO"+intC+"="+lstRow.FACD_REGALO;strPOST+="&"+strPrefijoDeta+"_ID_PROMO"+intC+"="+lstRow.FACD_ID_PROMO;if(intPreciosconImp==1){strPOST+="&"+strPrefijoDeta+"_PRECIO"+intC+"="+lstRow.FACD_PRECIO.replace(",","");if(lstRow.FACD_SINPRECIO==0){strPOST+="&"+strPrefijoDeta+"_PRECREAL"+intC+"="+lstRow.FACD_PRECREAL;}else{strPOST+="&"+strPrefijoDeta+"_PRECREAL"+intC+"="+0;}}else{var dblPrecioConImp=0;var dblPrecioRealConImp=0;if(lstRow.FACD_CANTIDAD>0){var dblBase1=0;var dblBase2=0;var dblBase3=0;var dblBaseReal1=0;var dblBaseReal2=0;var dblBaseReal3=0;var dblImpuesto1=0;var dblImpuesto2=0;var dblImpuesto3=0;var dblImpuestoReal1=0;var dblImpuestoReal2=0;var dblImpuestoReal3=0;if(parseInt(lstRow.FACD_EXENTO1)==0){dblBase1=lstRow.FACD_PRECIO.replace(",","");}if(parseInt(lstRow.FACD_EXENTO2)==0){dblBase2=lstRow.FACD_PRECIO.replace(",","");}if(parseInt(lstRow.FACD_EXENTO3)==0){dblBase3=lstRow.FACD_PRECIO.replace(",","");}if(parseInt(lstRow.FACD_EXENTO1)==0){dblBaseReal1=lstRow.FACD_PRECREAL;}if(parseInt(lstRow.FACD_EXENTO2)==0){dblBaseReal2=lstRow.FACD_PRECREAL;}if(parseInt(lstRow.FACD_EXENTO3)==0){dblBaseReal3=lstRow.FACD_PRECREAL;}var tax=new Impuestos(dblTasaVta1,dblTasaVta2,dblTasaVta3,intSImpVta1_2,intSImpVta1_3,intSImpVta2_3);tax.CalculaImpuestoMas(dblBase1,dblBase2,dblBase3);var tax2=new Impuestos(dblTasaVta1,dblTasaVta2,dblTasaVta3,intSImpVta1_2,intSImpVta1_3,intSImpVta2_3);tax2.CalculaImpuestoMas(dblBaseReal1,dblBaseReal2,dblBaseReal3);if(parseInt(lstRow.FACD_EXENTO1)==0){dblImpuesto1=tax.dblImpuesto1;}if(parseInt(lstRow.FACD_EXENTO2)==0){dblImpuesto2=tax.dblImpuesto2;}if(parseInt(lstRow.FACD_EXENTO3)==0){dblImpuesto3=tax.dblImpuesto3;}if(parseInt(lstRow.FACD_EXENTO1)==0){dblImpuestoReal1=tax2.dblImpuesto1;}if(parseInt(lstRow.FACD_EXENTO2)==0){dblImpuestoReal2=tax2.dblImpuesto2;}if(parseInt(lstRow.FACD_EXENTO3)==0){dblImpuestoReal3=tax2.dblImpuesto3;}dblPrecioConImp=(parseFloat(lstRow.FACD_PRECIO.replace(",",""))+dblImpuesto1+dblImpuesto2+dblImpuesto3);if(lstRow.FACD_SINPRECIO==0){dblPrecioRealConImp=(parseFloat(lstRow.FACD_PRECREAL)+dblImpuestoReal1+dblImpuestoReal2+dblImpuestoReal3);}else{dblPrecioRealConImp=(parseFloat(lstRow.FACD_PRECIO.replace(",",""))+dblImpuesto1+dblImpuesto2+dblImpuesto3);lstRow.FACD_IMPORTEREAL=dblPrecioRealConImp*lstRow.FACD_CANTIDAD;}}else{dblPrecioConImp=(parseFloat(lstRow.FACD_PRECIO.replace(",","")));dblPrecioRealConImp=(parseFloat(lstRow.FACD_PRECREAL));}strPOST+="&"+strPrefijoDeta+"_PRECIO"+intC+"="+dblPrecioConImp;if(lstRow.FACD_SINPRECIO==0){strPOST+="&"+strPrefijoDeta+"_PRECREAL"+intC+"="+dblPrecioRealConImp;}else{strPOST+="&"+strPrefijoDeta+"_PRECREAL"+intC+"="+0;}}strPOST+="&"+strPrefijoDeta+"_IMPORTE"+intC+"="+lstRow.FACD_IMPORTE.replace(",","");strPOST+="&"+strPrefijoDeta+"_TASAIVA1"+intC+"="+lstRow.FACD_TASAIVA1;strPOST+="&"+strPrefijoDeta+"_TASAIVA2"+intC+"=0"+lstRow.FACD_TASAIVA2;strPOST+="&"+strPrefijoDeta+"_TASAIVA3"+intC+"="+lstRow.FACD_TASAIVA3;strPOST+="&"+strPrefijoDeta+"_IMPUESTO1"+intC+"="+lstRow.FACD_IMPUESTO1;strPOST+="&"+strPrefijoDeta+"_IMPUESTO2"+intC+"="+lstRow.FACD_IMPUESTO2;strPOST+="&"+strPrefijoDeta+"_IMPUESTO3"+intC+"="+lstRow.FACD_IMPUESTO3;strPOST+="&"+strPrefijoDeta+"_ESREGALO"+intC+"="+lstRow.FACD_ESREGALO;strPOST+="&"+strPrefijoDeta+"_NOSERIE"+intC+"="+lstRow.FACD_NOSERIE;strPOST+="&"+strPrefijoDeta+"_IMPORTEREAL"+intC+"="+lstRow.FACD_IMPORTEREAL;strPOST+="&"+strPrefijoDeta+"_DESCUENTO"+intC+"="+lstRow.FACD_DESCUENTO.replace(",","");strPOST+="&"+strPrefijoDeta+"_PORDESC"+intC+"="+lstRow.FACD_PORDESC;strPOST+="&"+strPrefijoDeta+"_ESDEVO"+intC+"="+lstRow.FACD_ESDEVO;strPOST+="&"+strPrefijoDeta+"_PRECFIJO"+intC+"="+lstRow.FACD_PRECFIJO;strPOST+="&"+strPrefijoDeta+"_NOTAS"+intC+"="+encodeURIComponent(lstRow.FACD_NOTAS);strPOST+="&"+strPrefijoDeta+"_UNIDAD_MEDIDA"+intC+"="+lstRow.FACD_UNIDAD_MEDIDA;strPOST+="&strbackorder"+intC+"="+lstRow.FACD_DETALLE_BACKORDER;strPOST+="&strEsbackorder"+intC+"="+lstRow.FACD_ES_BACKORDER;strPOST+="&strTipoBackorder"+intC+"="+lstRow.FACD_TIPO_BACKORDER;}}strPOST+="&COUNT_ITEM="+intC;if(document.getElementById("FAC_TIPO").value!="3"&&document.getElementById("FAC_TIPO").value!="5"&&parseFloat(document.getElementById("FAC_TOT").value.replace(",",""))>0&&parseFloat(document.getElementById("FAC_DIASCREDITO").value)==0){strPOST+="&COUNT_PAGOS=5";strPOST+="&MCD_MONEDA1=1";strPOST+="&MCD_FOLIO1=";strPOST+="&MCD_FORMAPAGO1=EFECTIVO";strPOST+="&MCD_NOCHEQUE1=";strPOST+="&MCD_BANCO1=";strPOST+="&MCD_NOTARJETA1=";strPOST+="&MCD_TIPOTARJETA1=";strPOST+="&MCD_IMPORTE1="+(parseFloat(d.getElementById("Ef_1").value)-parseFloat(d.getElementById("Ef_2").value));strPOST+="&MCD_TASAPESO1=1";strPOST+="&MCD_CAMBIO1="+d.getElementById("Ef_2").value;strPOST+="&MCD_MONEDA2=1";strPOST+="&MCD_FOLIO2=";strPOST+="&MCD_FORMAPAGO2=CHEQUE";strPOST+="&MCD_NOCHEQUE2="+d.getElementById("Bc_2").value;strPOST+="&MCD_BANCO2="+d.getElementById("Bc_3").value;strPOST+="&MCD_NOTARJETA2=";strPOST+="&MCD_TIPOTARJETA2=";strPOST+="&MCD_IMPORTE2="+d.getElementById("Bc_1").value;strPOST+="&MCD_TASAPESO2=1";strPOST+="&MCD_CAMBIO2=0";strPOST+="&MCD_MONEDA3=1";strPOST+="&MCD_FOLIO3=";strPOST+="&MCD_FORMAPAGO3=TCREDITO";strPOST+="&MCD_NOCHEQUE3=";strPOST+="&MCD_BANCO3=";strPOST+="&MCD_NOTARJETA3="+d.getElementById("Tj_2").value;strPOST+="&MCD_TIPOTARJETA3="+d.getElementById("Tj_3").value;strPOST+="&MCD_IMPORTE3="+d.getElementById("Tj_1").value;strPOST+="&MCD_TASAPESO3=1";strPOST+="&MCD_CAMBIO3=0";strPOST+="&MCD_MONEDA4=1";strPOST+="&MCD_FOLIO4=";strPOST+="&MCD_FORMAPAGO4=SALDOFAVOR";strPOST+="&MCD_NOCHEQUE4=";strPOST+="&MCD_BANCO4=";strPOST+="&MCD_NOTARJETA4=";strPOST+="&MCD_TIPOTARJETA4=";strPOST+="&MCD_IMPORTE4="+d.getElementById("sf_1").value;strPOST+="&MCD_TASAPESO4=1";strPOST+="&MCD_CAMBIO4=0";var grid1=jQuery("#GRID_ANTIV");var lista=grid1.getGridParam("selarrrow");var dblTotalPagar=parseFloat(d.getElementById("sf_1").value);strPOST+="&MCD_NUMANTICIPOS="+lista.length;for(i=0;i<lista.length;i++){var idlast=lista[i];var lstRow=grid1.getRowData(idlast);if(parseFloat(lstRow.ANTI_ABONO)>=dblTotalPagar){strPOST+="&MCD_CANTUSAR"+(i+1)+"="+dblTotalPagar;strPOST+="&MCD_IDANTICIPO"+(i+1)+"="+lstRow.ANTI_ID;break;}else{strPOST+="&MCD_CANTUSAR"+(i+1)+"="+lstRow.ANTI_ABONO;strPOST+="&MCD_IDANTICIPO"+(i+1)+"="+lstRow.ANTI_ID;dblTotalPagar=dblTotalPagar-parseFloat(lstRow.ANTI_ABONO);}}strPOST+="&MCD_MONEDA5=1";strPOST+="&MCD_FOLIO5=";strPOST+="&MCD_FORMAPAGO5=TRANSFERENCIA BANCARIA";strPOST+="&MCD_NOCHEQUE5=";strPOST+="&MCD_BANCO5="+d.getElementById("tf_2").value;strPOST+="&MCD_NOTARJETA5="+d.getElementById("tf_3").value;strPOST+="&MCD_TIPOTARJETA5=";strPOST+="&MCD_IMPORTE5="+d.getElementById("tf_1").value;strPOST+="&MCD_TASAPESO5=1";strPOST+="&MCD_CAMBIO5=0";}else{strPOST+="&COUNT_PAGOS=1";strPOST+="&MCD_MONEDA1=1";strPOST+="&MCD_FOLIO1=";strPOST+="&MCD_FORMAPAGO1=EFECTIVO";strPOST+="&MCD_NOCHEQUE1=";strPOST+="&MCD_BANCO1=";strPOST+="&MCD_NOTARJETA1=";strPOST+="&MCD_TIPOTARJETA1=";strPOST+="&MCD_IMPORTE1=0.0";strPOST+="&MCD_TASAPESO1=1";strPOST+="&MCD_CAMBIO1=0.0";}$.ajax({type:"POST",data:encodeURI(strPOST),scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"html",url:"VtasMov.do?id=1",success:function(dato){dato=trim(dato);if(Left(dato,3)=="OK."){if(strNomFormat=="FACTURA"){if(intImprimeTicket==1){ImprimeconFolioTicket(dato.replace("OK.",""));}else{var strHtml=CreaHidden(strKey,dato.replace("OK.",""));openWhereverFormat("ERP_SendInvoice?id="+dato.replace("OK.",""),strNomFormat,"PDF",strHtml);}ResetOperaActualPediMak();}else{var bolImprimeDoc1=true;if(document.getElementById("FAC_TIPO").value==3){if(document.getElementById("FAC_ESRECU1")!=null){if(document.getElementById("FAC_ESRECU1").checked){var aRec=confirm(lstMsg[182]);if(aRec){var aRec2=confirm(lstMsg[194]);var strFechaUser="";var intFechaUserSel=0;if(aRec2){var aRec3=window.prompt(lstMsg[195],d.getElementById("FAC_FECHA").value);if(aRec3!=null&&aRec3!=""){strFechaUser=aRec3;intFechaUserSel=1;
}}var strFiltro="&USA_FECHAUSER="+intFechaUserSel+"&FAC_FECHA_US="+strFechaUser;bolImprimeDoc1=false;$.ajax({type:"POST",data:encodeURI("LST_PD_ID="+document.getElementById("PD_ID").value+strFiltro),scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"html",url:"ERP_FacRecu.jsp?id=1",success:function(dato){dato=trim(dato);if(Left(dato,3)=="OK."){alert(lstMsg[59]+" "+dato.replace("OK.",""));}else{alert(dato);}ResetOperaActualPediMak();$("#dialogWait").dialog("close");},error:function(objeto,quepaso,otroobj){alert(":pto9:"+objeto+" "+quepaso+" "+otroobj);$("#dialogWait").dialog("close");}});}}}}if(bolImprimeDoc1){SaveMensajes();if(intImprimeTicket==1){ImprimeconFolioTicket(dato.replace("OK.",""));}else{$("#SioNO1").dialog("open");$("#SioNO1").dialog("option","title","¿Desea Imprimir Formato con Imagenes?");document.getElementById("btnSI1").onclick=function(){ImprimeconFolioImagenesPediMak(strKey,dato,strNomFormat);$("#SioNO1").dialog("close");};document.getElementById("btnNO1").onclick=function(){ImprimeconFolioPediMak(strKey,dato,strNomFormat);$("#SioNO1").dialog("close");};}}}}else{alert(dato);}$("#dialogWait").dialog("close");},error:function(objeto,quepaso,otroobj){alert(":pto9:"+objeto+" "+quepaso+" "+otroobj);$("#dialogWait").dialog("close");}});}function SaveMensajes(){var strPost="";var gridMsj=jQuery("#GRD_MENSAJES");var arrMsj=gridMsj.getDataIDs();for(var i=0;i<arrMsj.length;i++){var id1=arrMsj[i];var lstRowAct=gridMsj.getRowData(id1);strPost+="&MSJ_ID_PD"+i+"="+lstRowAct.MSJG_ID_PD;strPost+="&MSJ_ID_USUARIO"+i+"="+lstRowAct.MSJG_ID_USUARIO;strPost+="&MSJ_USUARIO"+i+"="+lstRowAct.MSJG_USUARIO;strPost+="&MSJ_EMP_ID"+i+"="+lstRowAct.MSJG_EMP_ID;strPost+="&MSJ_SC_ID"+i+"="+lstRowAct.MSJG_SC_ID;strPost+="&MSJ_AREA"+i+"="+lstRowAct.MSJG_AREA;strPost+="&MSJ_NOTA"+i+"="+lstRowAct.MSJG_NOTA;strPost+="&MSJ_FECHA"+i+"="+lstRowAct.MSJG_FECHA;strPost+="&MSJ_HORA"+i+"="+lstRowAct.MSJG_HORA;}strPost+="&contador="+arrMsj.length;$.ajax({type:"POST",data:strPost,scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"XML",url:"ERP_PedidosMakProcs.jsp?id=24",success:function(datos){var objsc=datos.getElementsByTagName("vta_mensajes")[0];var lstProds=objsc.getElementsByTagName("vta_mensajes_deta");for(var i=0;i<lstProds.length;i++){var obj=lstProds[i];}$("#dialog").dialog("close");$("#dialogWait").dialog("close");},error:function(objeto,quepaso,otroobj){alert(":pto:"+objeto+" "+quepaso+" "+otroobj);}});}function SaveHistorialPediMak(){var strPost="";var gridMsj=jQuery("#GRD_MENSAJES");var arrMsj=gridMsj.getDataIDs();for(var i=0;i<arrMsj.length;i++){var id1=arrMsj[i];var lstRowAct=gridMsj.getRowData(id1);strPost+="&MSJ_ID_PD"+i+"="+lstRowAct.MSJG_ID_PD;strPost+="&MSJ_ID_USUARIO"+i+"="+lstRowAct.MSJG_ID_USUARIO;strPost+="&MSJ_USUARIO"+i+"="+lstRowAct.MSJG_USUARIO;strPost+="&MSJ_EMP_ID"+i+"="+lstRowAct.MSJG_EMP_ID;strPost+="&MSJ_SC_ID"+i+"="+lstRowAct.MSJG_SC_ID;strPost+="&MSJ_AREA"+i+"="+lstRowAct.MSJG_AREA;strPost+="&MSJ_NOTA"+i+"="+lstRowAct.MSJG_NOTA;strPost+="&MSJ_FECHA"+i+"="+lstRowAct.MSJG_FECHA;strPost+="&MSJ_HORA"+i+"="+lstRowAct.MSJG_HORA;}strPost+="&contador="+arrMsj.length;$.ajax({type:"POST",data:strPost,scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"XML",url:"ERP_PedidosMakProcs.jsp?id=24",success:function(datos){var objsc=datos.getElementsByTagName("vta_mensajes")[0];var lstProds=objsc.getElementsByTagName("vta_mensajes_deta");for(var i=0;i<lstProds.length;i++){var obj=lstProds[i];}$("#dialog").dialog("close");$("#dialogWait").dialog("close");},error:function(objeto,quepaso,otroobj){alert(":pto:"+objeto+" "+quepaso+" "+otroobj);}});}function ReiniciaPedidoPediMak(){$("#SioNO2").dialog("open");$("#SioNO2").dialog("option","title","¿Realizar otro pedido?");document.getElementById("btnSI2").onclick=function(){ResetOperaActualPediMak();$("#SioNO2").dialog("close");};document.getElementById("btnNO2").onclick=function(){Callbtn9PediMak();$("#SioNO2").dialog("close");};}function ImprimeconFolioPediMak(strKey,dato,strNomFormat){var strTipo="1";if(d.getElementById("FAC_TIPO").value=="3"){strTipo="2";}if(d.getElementById("FAC_TIPO").value=="4"){strTipo="3";}if(d.getElementById("FAC_TIPO").value=="5"){strTipo="5";}$.ajax({type:"POST",data:"KEY_ID="+strKey+"&TYPE_ID="+strTipo,scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"xml",url:"VtasMov.do?id=12",success:function(datos){var objsc=datos.getElementsByTagName("vta_folios")[0];var strFolioT=objsc.getAttribute("FOLIO");var strHtml2=CreaHidden(strKey,dato.replace("OK.",""));openFormat(strNomFormat,"PDF",strHtml2,strFolioT);},error:function(objeto,quepaso,otroobj){alert(":ImprimeFolio:"+objeto+" "+quepaso+" "+otroobj);}});ReiniciaPedidoPediMak();}function ImprimeconFolioImagenesPediMak(strKey,dato,strNomFormat){Abrir_Link("JasperReport?REP_ID=89&boton_1=PDF&PD_ID="+dato.replace("OK.",""),"_reporte",500,600,0,0);ReiniciaPedidoPediMak();}function ResetOperaActualPediMak(bolSelOpera){if(bolSelOpera==undefined){bolSelOpera=true;}if(bolSelOpera){$("#dialogWait").dialog("open");}bolSaveVta=true;d.getElementById("FCT_ID").value=intCteDefa;d.getElementById("FAC_FOLIO").value="";d.getElementById("FAC_NOTAS").value="";document.getElementById("FAC_NOTASPIE").value="";d.getElementById("FAC_TOT").value="0.0";d.getElementById("FAC_IMPUESTO1").value="0.0";d.getElementById("FAC_IMPUESTO2").value="0.0";d.getElementById("FAC_IMPUESTO3").value="0.0";d.getElementById("FAC_IMPORTE").value="0.0";d.getElementById("FAC_RETISR").value="0.0";d.getElementById("FAC_RETIVA").value="0.0";d.getElementById("FAC_NETO").value="0.0";d.getElementById("FAC_DESC").value="";d.getElementById("FAC_PRECIO").value="0.0";d.getElementById("VE_ID").value="0";d.getElementById("PD_ID").value="0";d.getElementById("VE_NOM").value="";d.getElementById("FAC_LPRECIOS").value=0;d.getElementById("FAC_DESCUENTO").value=0;intSucOfertas=intSucDefOfertas;d.getElementById("FAC_PROD").focus();if(!bolPerTicket){if(bolPerPedido){d.getElementById("FAC_TIPO").value=3;}if(bolPerFactura){d.getElementById("FAC_TIPO").value=1;}if(bolPerCotiza){d.getElementById("FAC_TIPO").value=5;}}else{d.getElementById("FAC_TIPO").value="2";}document.getElementById("FCT_ID").parentNode.style.display="block";d.getElementById("FAC_ESRECU2").checked=true;d.getElementById("FAC_PERIODICIDAD").value="1";d.getElementById("FAC_DIAPER").value="1";d.getElementById("FAC_NUMPEDI").value="";d.getElementById("FAC_FECHAPEDI").value="";d.getElementById("FAC_ADUANA").value="";d.getElementById("FAC_METODOPAGO").value="";d.getElementById("FAC_NUMCUENTA").value="";document.getElementById("FAC_USE_IMP1").value=0;InitImpDefaultPediMak();d.getElementById("FAC_TASASEL1").value=intIdTasaVta1;if(d.getElementById("FAC_TASASEL2")!=null){d.getElementById("FAC_TASASEL2").value=intIdTasaVta2;}if(d.getElementById("FAC_TASASEL3")!=null){d.getElementById("FAC_TASASEL3").value=intIdTasaVta3;}if(bolSelOpera){var grid=jQuery("#FAC_GRID");}grid.clearGridData();InitSIoNoEventsPediMak();LimpiaCamposPediMak();if(objMap.getXml("FORMPAGO")!=null&&d.getElementById("TOTALPAGADO")!=null){d.getElementById("TOTALPAGADO").value=0;d.getElementById("FPago1").value=0;d.getElementById("FPago2").value=0;d.getElementById("FPago3").value=0;d.getElementById("FPago4").value=0;d.getElementById("Ef_1").value="0.0";d.getElementById("Ef_2").value="0.0";d.getElementById("Bc_2").value="";d.getElementById("Bc_3").value="";d.getElementById("Bc_1").value="0.0";d.getElementById("Tj_2").value="";d.getElementById("Tj_3").value="";d.getElementById("Tj_1").value="0.0";d.getElementById("sf_1").value="0.0";}if(bolSelOpera){$("#dialogWait").dialog("close");}if(bolSelOpera){_ResetPromosAllPediMak();}document.getElementById("MainPanel").innerHTML="";var objSecModiVta=objMap.getScreen("PEDIDOS_MAK");if(objSecModiVta!=null){objSecModiVta.bolActivo=false;objSecModiVta.bolMain=false;
objSecModiVta.bolInit=false;objSecModiVta.idOperAct=0;}initPediMak();}function LimpiaCamposPediMak(){d.getElementById("FAC_FOLIO").value="";d.getElementById("cte_sucursal").value="";d.getElementById("CT_NOM").value="";d.getElementById("FCT_ID").value="";d.getElementById("cte_rfc").value="";d.getElementById("cte_direccion").value="";LimpiaSubClientePediMak();d.getElementById("FAC_PROD").value="";d.getElementById("FACD_SUBTOTAL_A").value="";d.getElementById("FAC_IMPORTE").value="";d.getElementById("FAC_DESCUENTO").value="";d.getElementById("FAC_IMPUESTO1").value="";d.getElementById("FAC_TOT").value="";}function InitImpDefaultPediMak(){dblTasaVta1=dblTasa1;dblTasaVta2=dblTasa2;dblTasaVta3=dblTasa3;intSImpVta1_2=intSImp1_2;intSImpVta1_3=intSImp1_3;intSImpVta2_3=intSImp2_3;}function InitSIoNoEventsPediMak(){document.getElementById("btnSI").onclick=function(){ConfirmaSIPediMak();};document.getElementById("btnNO").onclick=function(){ConfirmaNOPediMak();};}function ConfirmaSIPediMak(){if(d.getElementById("Operac").value=="Nva"){ResetOperaActualPediMak();}if(d.getElementById("Operac").value=="PORC_DESC"){PorcDescSendPediMak();}if(d.getElementById("Operac").value=="CHANGE_PRICE"){CambioPrecSendPediMak();}if(d.getElementById("Operac").value=="CHANGE_CANTPD"){VtaModificaCantDoPediMak();}d.getElementById("Operac").value="";$("#SioNO").dialog("close");}function VtaModificaCantDoPediMak(){var grid=jQuery("#FAC_GRID");var id=grid.getGridParam("selrow");if(id!=null){var lstRow=grid.getRowData(id);if(lstRow.FACD_PR_ID!=0){addHistorialPediMak("2",d.getElementById("CANTIDADANTERIOR").value,lstRow.FACD_CANTIDAD,lstRow.FACD_CVE);var dbldisponibilidad=parseFloat(lstRow.FACD_DISPONIBLE.replace(",",""));if(lstRow.FACD_REQEXIST==1&&document.getElementById("FAC_TIPO").value!=5){$.ajax({type:"POST",data:"PR_ID="+lstRow.FACD_PR_ID,scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"html",url:"InvMov.do?id=1",success:function(datoExist){if(parseFloat(lstRow.FACD_CANTIDAD)>dbldisponibilidad){var objSecModiVta=objMap.getScreen("BACKORDER_MAK");if(objSecModiVta!=null){objSecModiVta.bolActivo=false;objSecModiVta.bolMain=false;objSecModiVta.bolInit=false;objSecModiVta.idOperAct=0;}OpnOpt("BACKORDER_MAK","_ed","dlgMakBackOrder",false,false,true);}else{if(lstRow.FACD_REQEXIST==1){if(parseFloat(lstRow.FACD_CANTIDAD)>parseFloat(lstRow.FACD_EXIST)){alert(lstMsg[3]+" "+lstRow.FACD_CVE+" "+lstMsg[4]);if(parseFloat(lstRow.FACD_EXIST)>0){lstRow.FACD_CANTIDAD=lstRow.FACD_EXIST;}else{lstRow.FACD_CANTIDAD=0;}}}lstRowChangePrecioPediMak(lstRow,id,grid);}},error:function(objeto,quepaso,otroobj){alert(":ptoExist:"+objeto+" "+quepaso+" "+otroobj);$("#dialogWait").dialog("close");}});}else{lstRowChangePrecioPediMak(lstRow,id,grid);}}}}function ConfirmaNOPediMak(){$("#SioNO").dialog("close");}function _ResetPromosAllPediMak(){if(intSucOfertas&&bolCargaPromociones){_ResetVarsAllPediMak();}}function _ResetVarsAllPediMak(){_InitVarsPediMak();if(_debugPromos){_LogPromosPediMak("Reseteamos TODAS las promociones....");}for(var i=0;i<lstVars.length;i++){var objVar=lstVars[i];objVar.dblValor=0;objVar.intValor=0;objVar.strValor="";objVar.boolValor=false;objVar.dateValor=null;}lstOfertasActivas=null;_intContaOfertas=-1;_drawOfertasPediMak();var objCte=document.getElementById("FCT_ID");objCte.setAttribute("class","outEdit");objCte.setAttribute("className","outEdit");objCte.readOnly=false;objCte.disabled=false;}function _InitVarsPediMak(){bolSaveVta=true;if(lstVars==null){lstVars=Array();if(_debugPromos){_LogPromosPediMak("Iniciamos arreglo....");}var intContaPromos=-1;var _lstPromo=objPromos.getElementsByTagName("promocion");for(var h=0;h<_lstPromo.length;h++){var objPromo=_lstPromo[h];var objVariables=objPromo.getElementsByTagName("variables")[0];var _lstVariables=objVariables.getElementsByTagName("variable");if(_debugPromos){_LogPromosPediMak(objPromo.getAttribute("PROM_NOMBRE")+"_lstVariables:"+_lstVariables.length);}for(var i=0;i<_lstVariables.length;i++){intContaPromos++;var _objVariable=new _ClassVariable();_objVariable.intId=_lstVariables[i].getAttribute("PVAR_ID");_objVariable.strNombre=_lstVariables[i].getAttribute("PVAR_VARIABLE");_objVariable.intTipo=_lstVariables[i].getAttribute("PVAR_TIPO");_objVariable.intSec=_lstVariables[i].getAttribute("PVAR_SQL_CTE_PROD");_objVariable.intPromoId=objPromo.getAttribute("PROM_ID");_objVariable.strTipoDato=_lstVariables[i].getAttribute("PVAR_DATO");_objVariable.strScript=_lstVariables[i].getAttribute("PVAR_SCRIPT");lstVars[intContaPromos]=_objVariable;}}}}function _LogPromosPediMak(strMsg){if(navigator.userAgent.indexOf("Firefox")){console.log(strMsg);}else{alert(strMsg);}}function _drawOfertasPediMak(){if(lstOfertasActivas!=null){var objCte=document.getElementById("FCT_ID");objCte.setAttribute("class","READONLY");objCte.setAttribute("className","READONLY");objCte.readOnly=true;objCte.disabled=true;var strHMTL="<div id='Ofertas_activas'><img src='"+_urlImg1+"' border='0' id='OfertasGift1' /></br>";var strLstOfActivas="";for(var i=0;i<lstOfertasActivas.length;i++){var objOferta=lstOfertasActivas[i];strHMTL+="<div id='Oferta'>";strHMTL+=objOferta.strNombre;strHMTL+="&nbsp;<span class= 'Desc_promo'>";strHMTL+=objOferta.strDesc;strHMTL+="</span>";strHMTL+="</div>";strLstOfActivas+=objOferta.intIdOferta+",";}var strHMTL2="<div id='Ofertas_activas_list'>"+lstMsg[160]+"</div>"+strHMTL;strHMTL+="<input type='button' name='aplica_oferta' id='aplica_oferta' value='Continuar' onClick='_CierraDrawOfertas();'>";strHMTL2+="<input type='hidden' name='lst_ofertas' id='lst_ofertas' value='"+strLstOfActivas+"' >";strHMTL+="</div>";strHMTL2+="</div>";document.getElementById("PROMOS_LST").innerHTML=strHMTL2;}else{document.getElementById("PROMOS_LST").innerHTML="&nbsp;";}}function MensajesPediMak(){OpnOpt("MENSAJES_MAK","_ed","dlgMakMjs",false,false,true);}function Callbtn9PediMak(){myLayout.open("west");myLayout.open("east");myLayout.open("south");myLayout.open("north");document.getElementById("MainPanel").innerHTML="";var objMainFacPedi=objMap.getScreen("PEDIDOS_MAK");objMainFacPedi.bolActivo=false;objMainFacPedi.bolMain=false;objMainFacPedi.bolInit=false;objMainFacPedi.idOperAct=0;}function DatosClientePediMak(){if(document.getElementById("FCT_ID").value!=""||document.getElementById("FCT_ID").value!="0"){var objSecModiVta=objMap.getScreen("CLIE_GEN_MAK");if(objSecModiVta!=null){objSecModiVta.bolActivo=false;objSecModiVta.bolMain=false;objSecModiVta.bolInit=false;objSecModiVta.idOperAct=0;}OpnOpt("CLIE_GEN_MAK","_ed","dialogCte",false,false,true);}else{alert("Seleccione un cliente");}}function ExistenciasPediMak(){var grid=jQuery("#FAC_GRID");var id=grid.getGridParam("selrow");var lstRow=grid.getRowData(id);if(grid.getGridParam("selrow")!=null){var objSecModiVta=objMap.getScreen("EXISTENCIAS_MAK");if(objSecModiVta!=null){objSecModiVta.bolActivo=false;objSecModiVta.bolMain=false;objSecModiVta.bolInit=false;objSecModiVta.idOperAct=0;}OpnOpt("EXISTENCIAS_MAK","_ed","dlgMakExist",false,false,true);}else{alert("Selecciona un producto en la tabla");}}function ModificarPrecioPediMak(){var grid=jQuery("#FAC_GRID");var ids=grid.getGridParam("selrow");if(ids!=null){var lstRow=grid.getRowData(ids);document.getElementById("Operac").value="CHANGE_PRICE";$("#SioNO").dialog("option","title",lstMsg[7]);SavePrecAnt(lstRow.FACD_PRECIO.replace(",",""));var div=document.getElementById("SioNO_inside");var strHtml=CreaTexto(lstMsg[8],"_NvoPrecio",lstRow.FACD_PRECIO.replace(",",""),10,10,true,false,"","left",0,"","","",false,1);strHtml+=CreaRadio(lstMsg[9],"_NvoClean",0,false," ");div.innerHTML=strHtml;InitSIoNoEventsPediMak();$("#SioNO").dialog("open");}}function SavePrecAnt(strPrecioAnterior){if(document.getElementById("PRECIOANTERIOR").value!=strPrecioAnterior){document.getElementById("PRECIOANTERIOR").value=strPrecioAnterior;}}function PorcDescSendPediMak(){var grid=jQuery("#FAC_GRID");var ids=grid.getGridParam("selrow");if(ids!=null){var porDesc=d.getElementById("MiPordcDesc").value;
PorcDescDoPediMak(ids,porDesc);}}function PorcDescDoPediMak(id,dblPorc){var grid=jQuery("#FAC_GRID");var lstRow=grid.getRowData(id);lstRow.FACD_PORDESC=dblPorc;lstRowChangePrecioPediMak(lstRow,id,grid);document.getElementById("FAC_PROD").focus();}function CambioPrecSendPediMak(){var grid=jQuery("#FAC_GRID");var ids=grid.getGridParam("selrow");if(ids!=null){var lstRow=grid.getRowData(ids);addHistorialPediMak("3",d.getElementById("PRECIOANTERIOR").value,d.getElementById("_NvoPrecio").value,lstRow.FACD_CVE);var dblNvoPrec=d.getElementById("_NvoPrecio").value;var bolClean=false;if(d.getElementById("_NvoClean1").checked){bolClean=true;}CambioPrecDoPediMak(ids,dblNvoPrec,bolClean);}}function CambioPrecDoPediMak(id,dblNvoPrec,bolClean){var grid=jQuery("#FAC_GRID");var lstRow=grid.getRowData(id);if(bolClean){lstRow.FACD_PRECIO=lstRow.FACD_PRECREAL;lstRow.FACD_PRECFIJO=0;lstRow.FACD_SINPRECIO=0;}else{lstRow.FACD_PRECIO=dblNvoPrec;lstRow.FACD_PRECFIJO=1;lstRow.FACD_PRECREAL=lstRow.FACD_PRECIO.replace(",","");if(lstRow.FACD_PRECREAL==0){lstRow.FACD_SINPRECIO=1;lstRow.FACD_PRECREAL=lstRow.FACD_PRECIO.replace(",","");}}lstRowChangePrecioPediMak(lstRow,id,grid);document.getElementById("FAC_PROD").focus();}function LimpiaSubClientePediMak(){document.getElementById("cte_nomSubcte").value="";document.getElementById("cte_rfcSubcte").value="";document.getElementById("CT_CLIENTEFINAL").value="0";document.getElementById("cte_direccionSubCliente").value="";document.getElementById("cte_telSubcte").value="";}function BorrarRowPediMak(){var grid=jQuery("#FAC_GRID");if(grid.getGridParam("selrow")!=null){grid.delRowData(grid.getGridParam("selrow"));document.getElementById("FAC_PROD").focus();var arr=grid.getDataIDs();if(arr.length==0){document.getElementById("pd_bodega").disabled=false;}setSumPediMak();}}function InformacionProductoPediMak(){var objSecModiVta=objMap.getScreen("INFORMACION_MAK");if(objSecModiVta!=null){objSecModiVta.bolActivo=false;objSecModiVta.bolMain=false;objSecModiVta.bolInit=false;objSecModiVta.idOperAct=0;}OpnOpt("INFORMACION_MAK","_ed","dlgMakInformacion",false,false,true);}function validaDatosPediMak(){console.log(document.getElementById("FAC_FECHA").value);console.log(document.getElementById("FAC_MONEDA").value);console.log(document.getElementById("pd_bodega").value);console.log(document.getElementById("TR_ID").value);if(document.getElementById("FAC_FECHA").value=="0"||document.getElementById("FAC_FECHA").value==""||document.getElementById("FAC_FECHA").value==0||document.getElementById("FAC_FECHA").value=="Seleccione"){alert("Capture la Fecha Pedido");return false;}if(document.getElementById("FAC_MONEDA").value=="0"||document.getElementById("FAC_MONEDA").value==""||document.getElementById("FAC_MONEDA").value==0||document.getElementById("FAC_FECHA").value=="Seleccione"){alert("Capture la Fecha Entrega");return false;}if(document.getElementById("pd_bodega").value=="0"||document.getElementById("pd_bodega").value==""||document.getElementById("pd_bodega").value==0||document.getElementById("FAC_FECHA").value=="Seleccione"){alert("Capture la Bodega");return false;}if(document.getElementById("TR_ID").value=="0"||document.getElementById("TR_ID").value==""||document.getElementById("TR_ID").value==0||document.getElementById("FAC_FECHA").value=="Seleccione"){alert("Capture el transporte");return false;}return true;}function addHistorialPediMak(strIdMovimiento,strValorAnterior,strValorNuevo,IdProducto){var strPost="";var strPD_ID=document.getElementById("FAC_FOLIO").value;strPost+="&strIdMovimiento="+strIdMovimiento;strPost+="&strPD_ID="+strPD_ID;strPost+="&strValorAnterior="+strValorAnterior;strPost+="&strValorNuevo="+strValorNuevo;strPost+="&strIdProducto="+IdProducto;$.ajax({type:"POST",data:strPost,scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"XML",url:"ERP_PedidosMakProcs.jsp?id=25",success:function(datos){var objsc=datos.getElementsByTagName("vta_historial")[0];var lstProds=objsc.getElementsByTagName("vta_historial_deta");for(var i=0;i<lstProds.length;i++){var obj=lstProds[i];var datarowInfHisMak={GRDH_IDUSUARIO:obj.getAttribute("PEHIS_IDUSUARIO"),GRDH_NOMBRE:obj.getAttribute("PEHIS_NOMBRE"),GRDH_MOVIMIENTO:obj.getAttribute("PEHIS_MOVIMIENTO"),GRDH_DESCRIPCION:obj.getAttribute("PEHIS_DESCRIPCION"),GRDH_SUCURSAL:obj.getAttribute("SC_ID"),GRDH_EMPRESA:obj.getAttribute("EMP_ID"),GRDH_NUEVO:"1",GRDH_PEDIDOID:obj.getAttribute("PD_ID")};ContGridHistPediMak++;jQuery("#GRID_HISTORIAL").addRowData(ContGridHistPediMak,datarowInfHisMak,"last");}},error:function(objeto,quepaso,otroobj){alert(":pto:"+objeto+" "+quepaso+" "+otroobj);}});}function HistorialPedidoPediMak(){OpnOpt("HISTPAN_MAK","_ed","dlgMakHistrial",false,false,true);}function CamCatnidadbtnPediMak(){VtaModificaCantDoPediMak();}function SavePediMak(){Callbtn9PediMak();}