var lastselPagosCXP=0;var dblCantidadMaximaPago=0;var dblFaltaXPagar=0;var idAnticipo=0;var intMonProv=1;var TC_OriAnti=0;var intUsaMonedaOriginal=0;function vta_cobros_ctas(){}function InitAjustePagos(){myLayout.close("west");myLayout.close("east");myLayout.close("south");myLayout.close("north");var strHtml="<ul>"+getMenuItem("GuardaAjustaPagoCXP();","Guardar Pago","images/ptovta/CircleSave.png")+getMenuItem("CallbtnPagCXP4();","Salir","images/ptovta/exitBig.png")+"</ul>";document.getElementById("TOOLBAR").innerHTML=strHtml;d.getElementById("btn1").setAttribute("class","Oculto");d.getElementById("btn1").setAttribute("className","Oculto");}function Init_CobCtas(){myLayout.close("west");myLayout.close("east");myLayout.close("south");myLayout.close("north");var strHtml="<ul>"+getMenuItem("CallbtnPagCXP0();","Guardar Pago","images/ptovta/CircleSave.png")+getMenuItem("CallbtnPagCXP2();","Consultar Pagos","images/ptovta/VisMagnifier.png")+getMenuItem("CallbtnPagCXP3();","Salir","images/ptovta/exitBig.png")+"</ul>";document.getElementById("TOOLBAR").innerHTML=strHtml;document.getElementById("COB_MONEDA_PAGO").disabled=true;document.getElementById("COB_FALTA_MAX").disabled=true;document.getElementById("COB_NOM_PV").disabled=true;document.getElementById("ANTICIPO_TOTAL").disabled=true;document.getElementById("COB_NOCHEQUE").parentNode.parentNode.style.display="none";document.getElementById("COB_BCO_TRANS").parentNode.parentNode.style.display="none";document.getElementById("COB_CTA_TRANS").parentNode.parentNode.style.display="none";document.getElementById("MPD_RFC_TERCEROS").parentNode.parentNode.style.display="none";EsAnticipoCXP();document.getElementById("TASA_CAMBIO_PAGO").disabled=false;d.getElementById("btn1").setAttribute("class","Oculto");d.getElementById("btn1").setAttribute("className","Oculto");}var itemIdCobCtas=0;function OpnDiagProvCob(){OpnOpt("PROVEEDOR","grid","dialogProv",false,false);}function PeticionMonedaProvCXP(){$("#dialogWait").dialog("open");var strPROV_ID=document.getElementById("COB_CTAS_PV").value;var strPOST="PROV_ID="+strPROV_ID;$.ajax({type:"POST",data:encodeURI(strPOST),scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"html",url:"ERP_CobrosCuentas.jsp?id=15",success:function(dato){if(!isNaN(dato)){ObtenNomProvAntCobrosCta();intMonProv=parseInt(dato);document.getElementById("COB_MONEDA").value=dato;jQuery("#GRID_ANTICIPOS").clearGridData();jQuery("#COB_CTAS_GRID1").clearGridData();document.getElementById("COB_ESANTICIPO2").checked=true;document.getElementById("COB_ESANTICIPO1").disabled=false;CambiaBancoCXP();EsAnticipoCXP();document.getElementById("COB_TOTAL").value=0;ValidaMaximoxPagarCXP();}$("#dialogWait").dialog("close");},error:function(objeto,quepaso,otroobj){alert(":pto9:"+objeto+" "+quepaso+" "+otroobj);$("#dialogWait").dialog("close");}});}function AddCobCtas(){getTrxCtas(document.getElementById("COB_CTAS_TRX"));}function AddTrxEnter(event,obj){if(event.keyCode==13){getTrxCtas(obj);}}function getTrxCtas(obj){var intCXP_ID=document.getElementById("COB_CTAS_TRX").value;$.ajax({type:"POST",data:"intCXP_ID="+intCXP_ID+"&intGlobal=0",scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"xml",url:"ERP_CobrosCuentas.jsp?id=5",success:function(datoVal){var objXML=datoVal.getElementsByTagName("vta_cuentas")[0];if(objXML!=null){if(objXML.getAttribute("intCXP_ANULADO")==0){document.getElementById("COB_CTAS_NOM").value=objXML.getAttribute("strPV_RAZONSOCIAL");document.getElementById("COB_CTAS_FECHATRX").value=objXML.getAttribute("strCXP_FECHA");document.getElementById("COB_CTAS_FOLIO").value=objXML.getAttribute("intCXP_FOLIO");document.getElementById("COB_CTAS_TOTTRX").value=FormatNumber(objXML.getAttribute("dblCXP_TOTAL"),intNumdecimal,true);document.getElementById("COB_CTAS_TOTAL").value=FormatNumber(objXML.getAttribute("dblCXP_SALDO"),intNumdecimal,true);if(document.getElementById("COB_CTAS_TOTAL").value==document.getElementById("COB_CTAS_TOTTRX").value){SaveCobCtas();}else{alert("LA CUENTA "+obj.value+" con folio "+objXML.getAttribute("intCXP_FOLIO")+" YA ESTA PAGADA");}}else{alert("LA CUENTA "+obj.value+" con folio "+objXML.getAttribute("intCXP_FOLIO")+" ESTA ANULADA");}}else{alert("LA CUENTA "+obj.value+" NO EXISTE");}resetCobroCtas();},error:function(objeto,quepaso,otroobj){alert(":ptoExist:"+objeto+" "+quepaso+" "+otroobj);$("#dialogWait").dialog("close");}});document.getElementById("COB_CTAS_TRX").focus();document.getElementById("COB_CTAS_TRX").select();}function resetCobroCtas(){document.getElementById("COB_CTAS_NOM").value="";document.getElementById("COB_CTAS_FECHATRX").value="";document.getElementById("COB_CTAS_FOLIO").value="";document.getElementById("COB_NOCHEQUE").value="";document.getElementById("COB_BCO_TRANS").value="";document.getElementById("COB_CTA_TRANS").value="";document.getElementById("MPD_RFC_TERCEROS").value="";document.getElementById("COB_CTAS_TOTTRX").value="0.0";document.getElementById("COB_CTAS_TOTAL").value="0.0";document.getElementById("COB_CTAS_BCO").value="";document.getElementById("COB_CTAS_CONCEPTO").value="";document.getElementById("METPAG").value="";}function SaveCobCtas(){$("#dialogWait").dialog("open");var $tabs=$("#tabsCOBROSCTAS").tabs();var selected=$tabs.tabs("option","active");var intEMP_ID=0;var strPOST="";var dblPago=0;intEMP_ID=document.getElementById("EMP_ID").value;dblPago=document.getElementById("COB_CTAS_TOTAL").value;if(selected==0){strPOST="idTrx="+document.getElementById("COB_CTAS_TRX").value;strPOST+="&TipoDoc=4";strPOST+="&intEMP_ID="+intEMP_ID;strPOST+="&MONTOPAGO="+dblPago;strPOST+="&FECHA="+(document.getElementById("COB_CTAS_FECHA").value);strPOST+="&BC_ID="+(document.getElementById("COB_CTAS_BCO1").value);strPOST+="&NOTAS="+encodeURIComponent(document.getElementById("COB_CTAS_CONCEPTO").value);strPOST+="&MONEDA=1";strPOST+="&TASAPESO=1";strPOST+="&COB_CTAS_FOLIO="+document.getElementById("COB_CTAS_FOLIO").value;strPOST+="&COUNT_PAGOS=1";strPOST+="&MPD_MONEDA1=1";strPOST+="&MPD_FOLIO1=1";strPOST+="&MPD_FORMAPAGO1="+document.getElementById("METPAG").value;strPOST+="&MPD_NOCHEQUE1=0";strPOST+="&MPD_BANCO1="+(document.getElementById("COB_CTAS_BCO1").value);strPOST+="&MPD_NOTARJETA1=0";strPOST+="&MPD_TIPOTARJETA1=0";strPOST+="&MPD_IMPORTE1="+parseFloat(dblPago);strPOST+="&MPD_TASAPESO1=1";strPOST+="&MPD_CAMBIO1=0.0";document.getElementById("COB_CTAS_BTN4").disabled=true;document.getElementById("TOOLBAR").style.display="none";$.ajax({type:"POST",data:encodeURI(strPOST),scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"html",url:"ERP_CobrosCuentas.jsp?id=1",success:function(dato){dato=trim(dato);if(Left(dato,3)=="OK."){alert(lstMsg[105]);d.getElementById("COB_CTAS_TRX").value=0;d.getElementById("COB_CTAS_TRX").focus();d.getElementById("COB_CTAS_TRX").select();$("#dialogPagos").dialog("close");}else{alert(dato);}document.getElementById("COB_CTAS_BTN4").disabled=false;document.getElementById("TOOLBAR").style.display="block";$("#dialogWait").dialog("close");},error:function(objeto,quepaso,otroobj){alert(":pto9:"+objeto+" "+quepaso+" "+otroobj);$("#dialogWait").dialog("close");}});resetCobroCtas();}else{var intIdOper=3;var grid=jQuery("#COB_CTAS_GRID1");var arr=grid.getDataIDs();var intContaPays=0;for(var i=0;i<arr.length;i++){var id=arr[i];var lstRow=grid.getRowData(id);if(lstRow.COBD_CTAS_IMPORTE>0){intContaPays++;}}var dblxCobrar=0;var dblPagado=0;dblPagado=parseFloat(d.getElementById("COB_TOTAL").value);dblxCobrar=parseFloat(d.getElementById("COB_TOTAL").value);if((dblPagado==dblxCobrar||((dblPagado!=dblxCobrar)&&intContaPays==1))&&dblxCobrar>0){strPOST+="FECHA="+(d.getElementById("COB_CTAS_FECHA").value);strPOST+="&BC_ID="+(d.getElementById("COB_CTAS_BCO").value);strPOST+="&NOTAS="+encodeURIComponent(d.getElementById("COB_CTAS_CONCEPTO").value);strPOST+="&MONEDA="+(intMonProv);strPOST+="&TASAPESO="+(d.getElementById("TASA_CAMBIO_PAGO").value);
strPOST+="&MONTOPAGOTOTAL="+dblPagado;strPOST+="&MONTOPAGOTOTALAMONEDA="+(d.getElementById("COB_TOTAL").value);var dblAnticipoUsar=parseFloat(d.getElementById("ANTICIPO_USO").value);var dblTasaCambioAnti=parseFloat(d.getElementById("TASA_CAMBIO_PAGO").value);var strOperacion=document.getElementById("COB_OPERACION").value;if(dblTasaCambioAnti!=1){if(strOperacion=="D"){dblTasaCambioAnti=dblTasaCambioAnti;}else{dblTasaCambioAnti=1/dblTasaCambioAnti;}}else{dblTasaCambioAnti=1;}strPOST+="&TCANTIUSAR="+dblTasaCambioAnti;strPOST+="&ANTICIPOAUSAR="+dblAnticipoUsar;strPOST+="&MONEDAAPAGAR="+(d.getElementById("COB_MONEDA_PAGO").value);strPOST+="&TASADECAMBIOAPAGAR="+(d.getElementById("TASA_CAMBIO_PAGO").value);strPOST+="&TC_ORI_ANTI="+TC_OriAnti;if(parseFloat(document.getElementById("COB_COMISION").value)!=0){strPOST+="&COMISION="+document.getElementById("COB_COMISION").value;}var Sichecked=document.getElementById("COB_ESANTICIPO1").checked;if(Sichecked){strPOST+="&USA_ANTI="+1;strPOST+="&ANTI_ID="+idAnticipo;strPOST+="&CANTIDAD_ANTI="+(d.getElementById("ANTICIPO_USO").value);}else{strPOST+="&USA_ANTI="+0;if(strOperacion=="D"){strPOST+="&TASA_ANTI="+1/parseFloat(d.getElementById("TASA_CAMBIO_PAGO").value);}else{strPOST+="&TASA_ANTI="+(d.getElementById("TASA_CAMBIO_PAGO").value);}}for(var i=0;i<arr.length;i++){var id=arr[i];var lstRow=grid.getRowData(id);if(lstRow.COBD_CTAS_IMPORTE>0){strPOST+="&idTrx="+lstRow.COBD_CTAS_ID;strPOST+="&TipoDoc=4";strPOST+="&MONTOPAGO="+lstRow.COBD_CTAS_IMPORTE;strPOST+="&MONTOPAGOAMONEDA="+lstRow.COBD_CTAS_IMP_CAMBIO;strPOST+="&MONENDAORIGINAL="+lstRow.COBD_CTAS_MONEDA;}}var strNomForm="CBMASCUENTAS";var strNomField="MPM_ID";if(arr.length==1){intIdOper=1;strNomForm="CBCUENTAS";strNomField="MP_ID";}strPOST+="&COUNT_PAGOS=1";strPOST+="&MPD_MONEDA1=1";strPOST+="&MPD_FOLIO1=";strPOST+="&MPD_FORMAPAGO1="+document.getElementById("METPAG").value;strPOST+="&MPD_NOCHEQUE1=0";strPOST+="&MPD_BANCO1=0";strPOST+="&MPD_NOTARJETA1=0";strPOST+="&MPD_TIPOTARJETA1=0";strPOST+="&MPD_IMPORTE1="+parseFloat(dblPagado);strPOST+="&MPD_TASAPESO1="+(d.getElementById("COB_TASA_CAMBIO").value);strPOST+="&MPD_CAMBIO1=0";strPOST+="&PROV_ID="+(d.getElementById("COB_CTAS_PV").value);strPOST+="&PROV_ANTICIPO="+(d.getElementById("COB_FALTA_MAX").value);strPOST+="&PROV_ANTICIPO=";strPOST+="&MCB_NOCHEQUE="+d.getElementById("COB_NOCHEQUE").value;strPOST+="&COB_BCO_TRANS="+(d.getElementById("COB_BCO_TRANS").value);strPOST+="&COB_CTA_TRANS="+(d.getElementById("COB_CTA_TRANS").value);strPOST+="&MPD_RFC_TERCEROS="+(document.getElementById("MPD_RFC_TERCEROS").value);$.ajax({type:"POST",data:encodeURI(strPOST),scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"html",url:"ERP_CobrosCuentas.jsp?id="+intIdOper,success:function(dato){dato=trim(dato);if(Left(dato,3)=="OK."){openFormat(strNomForm,"PDF",CreaHidden(strNomField,dato.replace("OK.","")));jQuery("#COB_CTAS_GRID1").clearGridData();resetCobroMasCtas(true);var Sichecked=document.getElementById("COB_ESANTICIPO1").checked;if(Sichecked){CargaAnticiposCXP();}document.getElementById("COB_MAX_PAGO").value="0.0";document.getElementById("COB_FALTA_MAX").value="0.0";document.getElementById("ANTICIPO_TOTAL").value="0.0";document.getElementById("ANTICIPO_USO").value="0.0";document.getElementById("COB_NOCHEQUE").value="";$("#dialogPagos").dialog("close");$("#dialogWait").dialog("close");}else{alert(dato);}$("#dialogWait").dialog("close");},error:function(objeto,quepaso,otroobj){alert(":pto9:"+objeto+" "+quepaso+" "+otroobj);$("#dialogWait").dialog("close");}});}else{alert(lstMsg[10]);$("#dialogWait").dialog("close");}}}function Valida(){var intBanco=0;intBanco=d.getElementById("COB_CTAS_BCO");if(intBanco.value==0){alert("ERROR:Falta seleccionar un banco");return 0;}return 1;}function searchTrxMasivaCtas(boolBuscaMonedas){var _boolBuscaMonedasCtas=true;if(boolBuscaMonedas!=null){if(boolBuscaMonedas!=undefined){_boolBuscaMonedasCtas=boolBuscaMonedas;}}if(_boolBuscaMonedasCtas){BuscaTasaCambioCXPPago(true);}else{searchTrxMasivaCtasdo();}}function searchTrxMasivaCtasdo(){var Sichecked=document.getElementById("COB_ESANTICIPO1").checked;var boolHaceOperacion=true;setTimeout(function(){var dblTasaCambio=document.getElementById("TASA_CAMBIO_PAGO").value;var strOperacion=document.getElementById("COB_OPERACION").value;if(strOperacion=="M"){dblTasaCambio=1/dblTasaCambio;}if(Sichecked){}else{if(d.getElementById("COB_CTAS_BCO").value==0){boolHaceOperacion=false;alert("Te falta seleccionar el banco");}}if(boolHaceOperacion){var intPV_ID=d.getElementById("COB_CTAS_PV").value;var strFecha1=d.getElementById("COB_CTAS_FECHAS1").value;var strFecha2=d.getElementById("COB_CTAS_FECHAS2").value;var strMoneda=d.getElementById("COB_MONEDA").value;d.getElementById("COB_TOTAL").value=0;var strPOST="&CXP_ANULADO=0&intGlobal=1"+"&COB_MONEDA="+strMoneda;if(strFecha1!=""){strPOST+="&CXP_FECHA1="+strFecha1;}if(strFecha2==""){strFecha2=FechaActualCXP();}strPOST+="&CXP_FECHA2="+strFecha2;ValidaClean("COB_CTAS_PV");if(intPV_ID==0){ValidaShow("COB_CTAS_PV","NECESITA SELECCIONAR UN PROVEEDOR");document.getElementById("COB_TOTAL").value=0;ValidaMaximoxPagarCXP();}else{$("#dialogWait").dialog("open");strPOST+="&PV_ID="+intPV_ID;$.ajax({type:"POST",data:strPOST,scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"xml",url:"ERP_CobrosCuentas.jsp?id=5",success:function(datos){itemIdCobCtas=0;jQuery("#COB_CTAS_GRID1").clearGridData();setTimeout(function(){var objsc=datos.getElementsByTagName("vta_cuenta")[0];var lstTiks=objsc.getElementsByTagName("vta_cuentas");for(var iTk=0;iTk<lstTiks.length;iTk++){var obj=lstTiks[iTk];if(obj.getAttribute("dblCXP_SALDO")>0){var dblPagos=obj.getAttribute("dblCXP_TOTAL")-obj.getAttribute("dblCXP_SALDO");var strFecha=obj.getAttribute("strCXP_FECHA");var dblSaldoCambio=parseFloat(obj.getAttribute("dblCXP_SALDO"))*parseFloat(dblTasaCambio);strFecha=strFecha.substr(strFecha.length-2,strFecha.length)+"/"+strFecha.substr(4,2)+"/"+strFecha.substr(0,4);var datarow={COBD_CTAS_ID:obj.getAttribute("intCXP"),COBD_CTAS_FOLIO:obj.getAttribute("intCXP_FOLIO"),COBD_CTAS_FECHA:strFecha,COBD_CTAS_TOTAL:obj.getAttribute("dblCXP_TOTAL"),COBD_CTAS_PAGOS:dblPagos,COBD_CTAS_SALDO:obj.getAttribute("dblCXP_SALDO"),COBD_CTAS_SALDO_CAMBIO:dblSaldoCambio,COBD_CTAS_TIPO:"CUENTA",COBD_CTAS_IMPORTE:0,COBD_CTAS_IMP_CAMBIO:0,COBD_CTAS_MONEDA:obj.getAttribute("intCXP_MONEDA")};document.getElementById("ANTICIPO_USO").value=document.getElementById("ANTICIPO_TOTAL").value;document.getElementById("COB_FALTA_MAX").value=document.getElementById("COB_MAX_PAGO").value;itemIdCobCtas++;jQuery("#COB_CTAS_GRID1").addRowData(obj.getAttribute("intCXP"),datarow,"last");}}$("#dialogWait").dialog("close");document.getElementById("COB_TOTAL").value=0;ValidaMaximoxPagarCXP();},700);},error:function(objeto,quepaso,otroobj){alert(":ptoExist:"+objeto+" "+quepaso+" "+otroobj);$("#dialogWait").dialog("close");}});}}},100);}function resetCobroMasCtas(bolUpdateGrid){d.getElementById("COB_CTAS_TOTAL").value=0;d.getElementById("COB_NOCHEQUE").value="";d.getElementById("METPAG").value="";d.getElementById("COB_BCO_TRANS").value=0;d.getElementById("COB_CTA_TRANS").value="";d.getElementById("MPD_RFC_TERCEROS").value="";d.getElementById("COB_CTAS_CONCEPTO").value="";d.getElementById("COB_COMISION").value=0;if(bolUpdateGrid){searchTrxMasivaCtas();}else{$("#COB_CTAS_GRID1").jqGrid("clearGridData",true);}}function selRowCobCtas(rowid,status){editFilaCXP(rowid);RecalculoCXP();}function VerPagos(){OpnOpt("COBCTASVI","grid","dialog2",false,false);}function PagosAnulCtas(){var grid=jQuery("#COBCTASVI");if(grid.getGridParam("selrow")!=null){var lstRow=grid.getRowData(grid.getGridParam("selrow"));if(lstRow.MP_ANULADO=="NO"){$("#SioNO").dialog("open");$("#SioNO").dialog("option","title",lstMsg[17]);document.getElementById("btnSI").onclick=function(){$("#SioNO").dialog("close");PagosAnulDoCtas();};document.getElementById("btnNO").onclick=function(){$("#SioNO").dialog("close");
};}}}function PagosAnulDoCtas(){var grid=jQuery("#COBCTASVI");if(grid.getGridParam("selrow")!=null){var lstRow=grid.getRowData(grid.getGridParam("selrow"));if(lstRow.MP_ANULADO=="NO"){$("#dialogWait").dialog("open");var intKey=lstRow.MP_ID;var intId=2;var strNomKey="MP_ID";if(lstRow.MPM_ID!=0){intId=4;intKey=lstRow.MPM_ID;strNomKey="MPM_ID";}$.ajax({type:"POST",data:encodeURI(strNomKey+"="+intKey),scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"html",url:"ERP_CobrosCuentas.jsp?id="+intId,success:function(dato){dato=trim(dato);if(Left(dato,2)=="OK"){grid.trigger("reloadGrid");}else{alert(dato);}$("#dialogWait").dialog("close");},error:function(objeto,quepaso,otroobj){alert(":conanul:"+objeto+" "+quepaso+" "+otroobj);$("#dialogWait").dialog("close");}});}else{alert(lstMsg[16]);}}}function PagosCtasPrint(){var grid=jQuery("#COBCTASVI");if(grid.getGridParam("selrow")!=null){var lstRow=grid.getRowData(grid.getGridParam("selrow"));if(lstRow.MP_ES_REEMBOLSO==0){if(lstRow.MP_ANULADO=="NO"){if(lstRow.MPM_ID!=0){openFormat("CBMASCUENTAS","PDF",CreaHidden("MPM_ID",lstRow.MPM_ID));}else{openFormat("CBCUENTAS","PDF",CreaHidden("MP_ID",lstRow.MP_ID));}}}else{var grid=jQuery("#COBCTASVI");if(grid.getGridParam("selrow")!=null){var lstRow=grid.getRowData(grid.getGridParam("selrow"));if(lstRow.MP_ANULADO=="NO"){if(lstRow.MPM_ID!=0){openFormat("REEMB","PDF",CreaHidden("MPM_ID",lstRow.MPM_ID));}else{openFormat("CBCUENTAS","PDF",CreaHidden("MP_ID",lstRow.MP_ID));}}}}}}function CallbtnPagCXP0(){var dblAnticipoAUsar=parseFloat(document.getElementById("ANTICIPO_USO").value);var dblAnticipoDisponible=parseFloat(document.getElementById("ANTICIPO_TOTAL").value);if(parseFloat(document.getElementById("COB_FALTA_MAX").value)>=0&&parseFloat(document.getElementById("ANTICIPO_USO").value)>=0){if(dblAnticipoAUsar<=dblAnticipoDisponible){if(dblAnticipoAUsar<=dblAnticipoDisponible){SaveCobCtas();}else{alert(lstMsg[246]);document.getElementById("ANTICIPO_USO").focus();}}else{alert(lstMsg[247]);document.getElementById("COB_MONEDA_PAGO").focus();}}else{alert(lstMsg[248]);document.getElementById("COB_MAX_PAGO").focus();}}function CallbtnPagCXP2(){VerPagos();}function CallbtnPagCXP3(){myLayout.open("west");myLayout.open("east");myLayout.open("south");myLayout.open("north");document.getElementById("MainPanel").innerHTML="";var objMainFacPedi=objMap.getScreen("COBROSCTAS");objMainFacPedi.bolActivo=false;objMainFacPedi.bolMain=false;objMainFacPedi.bolInit=false;objMainFacPedi.idOperAct=0;}function CallbtnPagCXP4(){myLayout.open("west");myLayout.open("east");myLayout.open("south");myLayout.open("north");document.getElementById("MainPanel").innerHTML="";var objMainFacPedi=objMap.getScreen("AJS_PAGOSC");objMainFacPedi.bolActivo=false;objMainFacPedi.bolMain=false;objMainFacPedi.bolInit=false;objMainFacPedi.idOperAct=0;}function editGridCXP(e){if(e.originalEvent.keyCode==13){var dblFaltaParaPagar=dblFaltaXPagar;var dblTasaCambio=1;var strOperacion=document.getElementById("COB_OPERACION").value;var grid=jQuery("#COB_CTAS_GRID1");var lstRow=grid.getRowData(lastselPagosCXP);var dato=document.getElementById((lastselPagosCXP)+"_COBD_CTAS_IMPORTE").value;var intMonP=parseInt(document.getElementById("COB_MONEDA").value);var intMoneda=parseInt(document.getElementById("COB_MONEDA_PAGO").value);if(intMonP!=intMoneda){dblTasaCambio=parseFloat(document.getElementById("TASA_CAMBIO_PAGO").value);if(strOperacion=="D"){dblTasaCambio=1/dblTasaCambio;}}if(document.getElementById("COB_ESANTICIPO1").checked){dblFaltaXPagar=dblFaltaXPagar/dblTasaCambio;}var dblAPagar=0;if((parseFloat(dato)<dblFaltaXPagar)){if((parseFloat(dato)*dblTasaCambio)<=parseFloat(lstRow.COBD_CTAS_SALDO_CAMBIO)){dblAPagar=dato;}else{if(strOperacion=="D"){dblAPagar=parseFloat(lstRow.COBD_CTAS_SALDO)*dblTasaCambio;}else{dblAPagar=parseFloat(lstRow.COBD_CTAS_SALDO)/dblTasaCambio;}}}else{dblAPagar=dblFaltaParaPagar;}$("#dialogWait").dialog("open");lstRow.COBD_CTAS_IMPORTE=dblAPagar;if(intMonP==intMoneda){lstRow.COBD_CTAS_IMP_CAMBIO=dblAPagar;}else{lstRow.COBD_CTAS_IMP_CAMBIO=dblAPagar*dblTasaCambio;}grid.setRowData(lastselPagosCXP,lstRow);$("#dialogWait").dialog("close");grid.saveRow(lastselPagosCXP);RecalculoCXP();lastselPagosCXP=0;}}function editFilaCXP(id){var grid=jQuery("#COB_CTAS_GRID1");if(id!=lastselPagosCXP){grid.saveRow(lastselPagosCXP);grid.editRow(id,false);lastselPagosCXP=id;}}function RecalculoCXP(){setTimeout(function(){var grid=jQuery("#COB_CTAS_GRID1");var arr=grid.getDataIDs();var dblTotal=0;var dblNumero;var dblTasaCambio=parseFloat(document.getElementById("TASA_CAMBIO_PAGO").value);var dblTotalAntes=0;var strOperacion2=document.getElementById("COB_OPERACION").value;var dblOperacion=1;var intMonedaProv=intMonProv;var intMonedaDocumento=parseInt(document.getElementById("COB_MONEDA_PAGO").value);if(strOperacion2=="D"){dblOperacion=dblTasaCambio;dblTasaCambio=1/dblTasaCambio;}for(var i=0;i<arr.length;i++){var idRow=arr[i];dblNumero=0;var lstRow=grid.getRowData(idRow);if(document.getElementById((idRow)+"_COBD_CTAS_IMPORTE")!=null){dblNumero=parseFloat(document.getElementById(idRow+"_COBD_CTAS_IMPORTE").value);var dblTasaAPagar=parseFloat(document.getElementById("TASA_CAMBIO_PAGO").value);var strOperacion=document.getElementById("COB_OPERACION").value;if(strOperacion=="D"){dblTasaAPagar=1/dblTasaAPagar;}var Sichecked=document.getElementById("COB_ESANTICIPO1").checked;if(Sichecked){dblCantidadMaximaPago=document.getElementById("ANTICIPO_TOTAL").value;dblFaltaXPagar=document.getElementById("ANTICIPO_USO").value;}else{dblCantidadMaximaPago=document.getElementById("COB_MAX_PAGO").value;dblFaltaXPagar=document.getElementById("COB_FALTA_MAX").value;}var dblImporte=parseFloat(lstRow.COBD_CTAS_SALDO)*dblTasaAPagar;if(dblCantidadMaximaPago<=0){alert("No hay cantidad minima para pagar.");}else{var dblCalculoPago=0;if(intMonedaProv==intMonedaDocumento){dblCalculoPago=dblFaltaXPagar;}else{if(Sichecked){dblCalculoPago=dblFaltaXPagar/dblTasaAPagar;}else{dblCalculoPago=dblFaltaXPagar*dblTasaAPagar;}}if((dblCalculoPago)>parseFloat(lstRow.COBD_CTAS_SALDO)){dblImporte=lstRow.COBD_CTAS_SALDO_CAMBIO;}else{dblImporte=dblFaltaXPagar;}}document.getElementById(idRow+"_COBD_CTAS_IMPORTE").value=dblImporte;}else{dblNumero=parseFloat(lstRow.COBD_CTAS_IMPORTE);}dblTotal+=dblNumero*(dblTasaCambio);dblTotalAntes+=dblNumero;}d.getElementById("COB_CTAS_TOTAL").value=FormatNumber(dblTotalAntes*dblTasaCambio,2,true);d.getElementById("COB_TOTAL").value=FormatNumber(dblTotalAntes,2,true);if(dblTotal==0){document.getElementById("COB_CTAS_BCO").disabled=false;}else{document.getElementById("COB_MONEDA_PAGO").disabled=true;}if(parseFloat(document.getElementById("COB_MAX_PAGO").value)!=0&&document.getElementById("COB_MAX_PAGO").value!=""){CalculaFaltaxPagar();}if(parseFloat(document.getElementById("ANTICIPO_TOTAL").value)!=0&&document.getElementById("ANTICIPO_TOTAL").value!=""){CalculaFaltaxPagar();}},100);}function CambiaBancoCXP(){var intBanco=parseInt(document.getElementById("COB_CTAS_BCO").value);var strPOST="&BC_ID="+intBanco;$.ajax({type:"POST",data:strPOST,scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"html",url:"ERP_CobrosCuentas.jsp?id=7",success:function(datos){document.getElementById("TIPO_MONEDA_BANC").value=datos;document.getElementById("COB_MONEDA_PAGO").value=datos;BuscaTasaCambioCXPPago(true);},error:function(objeto,quepaso,otroobj){alert(":ptoExist:"+objeto+" "+quepaso+" "+otroobj);$("#dialogWait").dialog("close");}});}function BuscaTasaCambioCXP(){var intMonedaBanco=document.getElementById("TIPO_MONEDA_BANC").value;var intMonedaSeleccionada=document.getElementById("COB_MONEDA").value;var strPOST="&Moneda_1="+intMonedaBanco;strPOST+="&Moneda_2="+intMonedaSeleccionada;$.ajax({type:"POST",data:strPOST,scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"html",url:"ERP_CobrosCuentas.jsp?id=9",success:function(datos){datos=parseFloat(datos);
if(datos==0){datos=1;}document.getElementById("COB_TASA_CAMBIO").value=FormatNumber(datos,4,true);},error:function(objeto,quepaso,otroobj){alert(":ptoExist:"+objeto+" "+quepaso+" "+otroobj);$("#dialogWait").dialog("close");}});RecalculoCXP();}function PruebaCXP(){var grid=jQuery("#COB_CTAS_GRID1");var lstRow=grid.getRowData(lastselPagosCXP);var dblTasaCambio=1;var strOperacion=document.getElementById("COB_OPERACION").value;var dato=document.getElementById((lastselPagosCXP)+"_COBD_CTAS_IMPORTE").value;var intMonP=parseInt(document.getElementById("COB_MONEDA").value);var intMoneda=parseInt(document.getElementById("COB_MONEDA_PAGO").value);if(intMonP!=intMoneda){dblTasaCambio=parseFloat(document.getElementById("TASA_CAMBIO_PAGO").value);if(strOperacion=="D"){dblTasaCambio=1/dblTasaCambio;}}var dblAPagar=0;var intMonedaPago=parseInt(document.getElementById("COB_MONEDA_PAGO").value);var intMonedaDocumento=parseInt(document.getElementById("COB_MONEDA").value);if((parseFloat(dato)<dblFaltaXPagar)){if((parseFloat(dato)*dblTasaCambio)<=parseFloat(lstRow.COBD_CTAS_SALDO_CAMBIO)){dblAPagar=dato;}else{if(strOperacion=="D"){dblAPagar=parseFloat(lstRow.COBD_CTAS_SALDO)*dblTasaCambio;}else{dblAPagar=parseFloat(lstRow.COBD_CTAS_SALDO)/dblTasaCambio;}}}else{dblAPagar=dblFaltaXPagar;}$("#dialogWait").dialog("open");lstRow.COBD_CTAS_IMPORTE=dblAPagar;if(intMonedaPago==intMonedaDocumento){lstRow.COBD_CTAS_IMP_CAMBIO=dblAPagar;}else{lstRow.COBD_CTAS_IMP_CAMBIO=dblAPagar*dblTasaCambio;}grid.setRowData(lastselPagosCXP,lstRow);$("#dialogWait").dialog("close");grid.saveRow(lastselPagosCXP);RecalculoCXP();lastselPagosCXP=0;}function CargaAjustaPagoCXP(){var intPV_ID=d.getElementById("COB_CTAS_PV").value;var strFecha1=d.getElementById("COB_CTAS_FECHAS1").value;var strFecha2=d.getElementById("COB_CTAS_FECHAS2").value;var strMoneda=d.getElementById("COB_MONEDA").value;$("#dialogWait").dialog("open");resetCobroMasCtas(false);$.ajax({type:"POST",data:"PV_ID="+intPV_ID+"&CXP_FECHA1="+strFecha1+"&CXP_FECHA2="+strFecha2+"&CXP_ANULADO=0&intGlobal=1"+"&COB_MONEDA="+strMoneda,scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"xml",url:"ERP_CobrosCuentas.jsp?id=5",success:function(datos){var objsc=datos.getElementsByTagName("vta_cuenta")[0];var lstTiks=objsc.getElementsByTagName("vta_cuentas");itemIdCobCtas=0;for(i=0;i<lstTiks.length;i++){var obj=lstTiks[i];if(obj.getAttribute("dblCXP_SALDO")>0){var dblPagos=obj.getAttribute("dblCXP_TOTAL")-obj.getAttribute("dblCXP_SALDO");var strFecha=obj.getAttribute("strCXP_FECHA");strFecha=strFecha.substr(strFecha.length-2,strFecha.length)+"/"+strFecha.substr(4,2)+"/"+strFecha.substr(0,4);var datarow={COBD_CTAS_ID:obj.getAttribute("intCXP"),COBD_CTAS_FOLIO:obj.getAttribute("intCXP_FOLIO"),COBD_CTAS_FECHA:strFecha,COBD_CTAS_TOTAL:obj.getAttribute("dblCXP_TOTAL"),COBD_CTAS_PAGOS:dblPagos,COBD_CTAS_SALDO:obj.getAttribute("dblCXP_SALDO"),COBD_CTAS_SALDO_CAMBIO:0,COBD_CTAS_TIPO:"CUENTA",COBD_CTAS_IMPORTE:0,COBD_CTAS_IMP_CAMBIO:0,COBD_CTAS_MONEDA:obj.getAttribute("intCXP_MONEDA")};itemIdCobCtas++;jQuery("#COB_CTAS_GRID1").addRowData(itemIdCobCtas,datarow,"last");}}d.getElementById("COB_TASA_CAMBIO").value=1;$("#dialogWait").dialog("close");},error:function(objeto,quepaso,otroobj){alert(":ptoExist:"+objeto+" "+quepaso+" "+otroobj);$("#dialogWait").dialog("close");}});}function GuardaAjustaPagoCXP(){var $tabs=$("#tabsCOBROSCTAS").tabs();var selected=$tabs.tabs("option","active");var intEMP_ID=0;var strPOST="";var dblPago=0;intEMP_ID=document.getElementById("EMP_ID").value;dblPago=document.getElementById("COB_CTAS_TOTAL").value;var intIdOper=3;var grid=jQuery("#COB_CTAS_GRID1");var arr=grid.getDataIDs();var intContaPays=0;for(var i=0;i<arr.length;i++){var id=arr[i];var lstRow=grid.getRowData(id);if(lstRow.COBD_CTAS_IMPORTE>0){intContaPays++;}}var dblxCobrar=0;var dblPagado=0;dblPagado=parseFloat(d.getElementById("COB_TOTAL").value);dblxCobrar=parseFloat(d.getElementById("COB_TOTAL").value);if((dblPagado==dblxCobrar||((dblPagado!=dblxCobrar)&&intContaPays==1))&&dblxCobrar>0){strPOST+="FECHA="+(d.getElementById("COB_CTAS_FECHA").value);strPOST+="&BC_ID="+(d.getElementById("COB_CTAS_BCO").value);strPOST+="&NOTAS="+encodeURIComponent(d.getElementById("COB_CTAS_CONCEPTO").value);strPOST+="&MONEDA="+(d.getElementById("TIPO_MONEDA_BANC").value);strPOST+="&TASAPESO="+(d.getElementById("COB_TASA_CAMBIO").value);strPOST+="&MONTOPAGOTOTAL="+dblPagado;strPOST+="&MONTOPAGOTOTALAMONEDA="+(d.getElementById("COB_CTAS_TOTAL").value);for(var i=0;i<arr.length;i++){var id=arr[i];var lstRow=grid.getRowData(id);if(lstRow.COBD_CTAS_IMPORTE>0){strPOST+="&idTrx="+lstRow.COBD_CTAS_ID;strPOST+="&TipoDoc=4";strPOST+="&MONTOPAGO="+lstRow.COBD_CTAS_IMPORTE;strPOST+="&MONTOPAGOAMONEDA="+lstRow.COBD_CTAS_IMP_CAMBIO;strPOST+="&MONENDAORIGINAL="+lstRow.COBD_CTAS_MONEDA;}}var strNomForm="CBMASCUENTAS";var strNomField="MPM_ID";if(arr.length==1){intIdOper=1;strNomForm="CBCUENTAS";strNomField="MP_ID";}strPOST+="&COUNT_PAGOS=1";strPOST+="&MPD_MONEDA1=1";strPOST+="&MPD_FOLIO1=";strPOST+="&MPD_FORMAPAGO1=EFECTIVO";strPOST+="&MPD_NOCHEQUE1=0";strPOST+="&MPD_BANCO1=0";strPOST+="&MPD_NOTARJETA1=0";strPOST+="&MPD_TIPOTARJETA1=0";strPOST+="&MPD_IMPORTE1="+parseFloat(dblPagado);strPOST+="&MPD_TASAPESO1="+(d.getElementById("COB_TASA_CAMBIO").value);strPOST+="&MPD_CAMBIO1=0";$.ajax({type:"POST",data:encodeURI(strPOST),scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"html",url:"ERP_CobrosCuentas.jsp?id="+intIdOper,success:function(dato){dato=trim(dato);if(Left(dato,3)=="OK."){resetCobroMasCtas2CXP(true);$("#dialogPagos").dialog("close");}else{alert(dato);}$("#dialogWait").dialog("close");},error:function(objeto,quepaso,otroobj){alert(":pto9:"+objeto+" "+quepaso+" "+otroobj);$("#dialogWait").dialog("close");}});}else{alert(lstMsg[10]);$("#dialogWait").dialog("close");}setTimeout(function(){LimpiarGridCXP();},10000);}function resetCobroMasCtas2CXP(bolUpdateGrid){d.getElementById("COB_CTAS_TOTAL").value=0;if(bolUpdateGrid){CargaAjustaPagoCXP();}else{jQuery("#COB_CTAS_GRID1").clearGridData();}}function LimpiarGridCXP(){jQuery("#COB_CTAS_GRID1").clearGridData();itemIdCob=0;CargaAjustaPagoCXP();}function CargaAnticiposCXP(){$("#dialogWait").dialog("open");var intPV=document.getElementById("COB_CTAS_PV").value;var intMonPago=document.getElementById("COB_MONEDA_PAGO").value;var intMonDoc=document.getElementById("COB_MONEDA").value;var strPOST="PV_ID="+intPV;strPOST+="&MONEDAPAGO="+intMonPago;$.ajax({type:"POST",data:strPOST,scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"xml",url:"ERP_CobrosCuentas.jsp?id=14",success:function(datos){var objsc=datos.getElementsByTagName("Anticipos")[0];var lstAnticipos=objsc.getElementsByTagName("Anticipo");jQuery("#GRID_ANTICIPOS").clearGridData();document.getElementById("COB_ESANTICIPO1").disabled=false;if(lstAnticipos.length!=0){for(var i=0;i<lstAnticipos.length;i++){var obj=lstAnticipos[i];var strFecha=obj.getAttribute("MP_FECHA");var intMoneda=0;if(document.getElementById("COB_ANTI_MON_ORI").value=="0"){intMoneda=parseInt(obj.getAttribute("MP_MONEDA"));}else{intMoneda=parseInt(document.getElementById("COB_MONEDA").value);}var txtMONEDA="";if(intMoneda==1){txtMONEDA="PESOS";}else{if(intMoneda==2){txtMONEDA="DOLARES";}else{if(intMoneda==3){txtMONEDA="EUROS";}}}strFecha=strFecha.substr(strFecha.length-2,strFecha.length)+"/"+strFecha.substr(4,2)+"/"+strFecha.substr(0,4);var dblMonProv=parseFloat(obj.getAttribute("MP_SALDO_ANTICIPO"));var strEsCampo=document.getElementById("COB_ANTI_MON_ORI").value;if(strEsCampo=="1"){var datarow={ANTI_ID:obj.getAttribute("MP_ID"),ANTI_FECHA:strFecha,ANTI_ABONO:FormatNumber(obj.getAttribute("MP_SALDO_ANTICIPO"),intNumdecimal,true),ANTI_FOLIO:obj.getAttribute("MP_FOLIO"),ANTI_MONEDA:obj.getAttribute("MP_MONEDA"),ANTI_TASAPESO:obj.getAttribute("MP_TASAPESO"),ANTI_ORIGINAL:FormatNumber(obj.getAttribute("dblMP_ANTICIPO_ORIGINAL"),intNumdecimal,true),ANTI_MONEDA_LETRA:txtMONEDA,ANTI_MONEDAPROV:document.getElementById("COB_MONEDA").value};
jQuery("#GRID_ANTICIPOS").addRowData(i,datarow,"last");}else{var datarow={ANTI_ID:obj.getAttribute("MP_ID"),ANTI_FECHA:strFecha,ANTI_ABONO:obj.getAttribute("MP_SALDO_ANTICIPO"),ANTI_FOLIO:obj.getAttribute("MP_FOLIO"),ANTI_MONEDA:obj.getAttribute("MP_MONEDA"),ANTI_TASAPESO:obj.getAttribute("MP_TASAPESO"),ANTI_ORIGINAL:obj.getAttribute("dblMP_ANTICIPO_ORIGINAL"),ANTI_MONEDA_LETRA:txtMONEDA,ANTI_MONEDAPROV:document.getElementById("COB_MONEDA").value};jQuery("#GRID_ANTICIPOS").addRowData(i,datarow,"last");}}$("#dialogWait").dialog("close");}else{alert("El proveedor seeleccionado no tiene anticipos");document.getElementById("COB_ESANTICIPO1").disabled=true;document.getElementById("COB_ESANTICIPO2").checked=true;$("#dialogWait").dialog("close");$("#GRID_ANTICIPOS").jqGrid("setGridState","hidden");EsAnticipoCXP();}},error:function(objeto,quepaso,otroobj){alert(":ptoExist:"+objeto+" "+quepaso+" "+otroobj);$("#dialogWait").dialog("close");}});}function BuscaTasaCambioCXPPago(bolPasaSearchMasiva){if(bolPasaSearchMasiva==null){bolPasaSearchMasiva=false;}var intMonedaBanco=document.getElementById("COB_MONEDA").value;var intMonedaSeleccionada=document.getElementById("COB_MONEDA_PAGO").value;var strFecha=document.getElementById("COB_CTAS_FECHA").value;var strPOST="&Moneda_1="+intMonedaSeleccionada;strPOST+="&Moneda_2="+intMonedaBanco;strPOST+="&fecha="+strFecha;if(document.getElementById("COB_ESANTICIPO1").checked==false){$.ajax({type:"POST",data:strPOST,scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"xml",url:"ERP_CobrosCuentas.jsp?id=9",success:function(datos){var objsc=datos.getElementsByTagName("TasaCambio")[0];var lstTiks=objsc.getElementsByTagName("TasaCambios");var obj=lstTiks[0];var dblTC=obj.getAttribute("TC");var strOperacion=obj.getAttribute("Operacion");document.getElementById("COB_OPERACION").value=strOperacion;if(dblTC==0){dblTC=1;}document.getElementById("TASA_CAMBIO_PAGO").value=dblTC;if(dblTC==1){document.getElementById("TASA_CAMBIO_PAGO").disabled=false;}else{document.getElementById("TASA_CAMBIO_PAGO").disabled=false;}$("#dialogWait").dialog("close");if(bolPasaSearchMasiva){searchTrxMasivaCtas(false);}},error:function(objeto,quepaso,otroobj){alert(":ptoExist:"+objeto+" "+quepaso+" "+otroobj);$("#dialogWait").dialog("close");}});}}function ChecaCopatibilidadMonedaCXP(){var intMonPago=document.getElementById("COB_MONEDA_PAGO").value;var intMonBanco=document.getElementById("TIPO_MONEDA_BANC").value;if(intMonPago==0||intMonBanco==0){}else{if(intMonBanco!=intMonPago){alert("Se debe Pagar con la misma moneda en la que esta el banco");return false;}}return true;}function ValidaMaximoxPagarCXP(){var dblMaxPagar=parseFloat(document.getElementById("COB_MAX_PAGO").value);if(dblMaxPagar<0){alert("El pago minimo debe ser positivo o cero");document.getElementById("COB_MAX_PAGO").focus();}else{CalculaFaltaxPagar();var Sichecked=document.getElementById("COB_ESANTICIPO2").checked;if(Sichecked){dblCantidadMaximaPago=parseFloat(document.getElementById("COB_MAX_PAGO").value);}}}function CalculaFaltaxPagar(){var dblTotal=parseFloat(document.getElementById("COB_TOTAL").value);var Sichecked=document.getElementById("COB_ESANTICIPO1").checked;if(Sichecked){dblCantidadMaximaPago=(document.getElementById("ANTICIPO_TOTAL").value);dblTotal=parseFloat(document.getElementById("COB_TOTAL").value);}else{dblCantidadMaximaPago=(document.getElementById("COB_MAX_PAGO").value);dblTotal=parseFloat(document.getElementById("COB_TOTAL").value);}if(isNaN(dblCantidadMaximaPago)){dblCantidadMaximaPago=0;}if(isNaN(dblFaltaXPagar)){dblFaltaXPagar=0;}if(dblCantidadMaximaPago==0){dblFaltaXPagar=0;}dblFaltaXPagar=dblCantidadMaximaPago-dblTotal-parseFloat(document.getElementById("COB_COMISION").value);if(Sichecked){document.getElementById("ANTICIPO_TOTAL").value=FormatNumber(dblCantidadMaximaPago,intNumdecimal,true);document.getElementById("ANTICIPO_USO").value=FormatNumber(dblFaltaXPagar,intNumdecimal,true);}else{document.getElementById("COB_MAX_PAGO").value=FormatNumber(dblCantidadMaximaPago,intNumdecimal,true);document.getElementById("COB_FALTA_MAX").value=FormatNumber(dblFaltaXPagar,intNumdecimal,true);}}function InvierteParidadAPagarCXP(){var dblTasaCambio=parseFloat(document.getElementById("COB_TASA_CAMBIO").value);dblTasaCambio=1/dblTasaCambio;if(dblTasaCambio>=1){document.getElementById("TASA_CAMBIO_PAGO").value=FormatNumber(dblTasaCambio,4,true);}else{document.getElementById("TASA_CAMBIO_PAGO").value=dblTasaCambio;}}function EsAnticipoCXP(){var Sichecked=document.getElementById("COB_ESANTICIPO1").checked;if(Sichecked){document.getElementById("COB_MAX_PAGO").parentNode.parentNode.style.display="none";document.getElementById("COB_FALTA_MAX").parentNode.parentNode.style.display="none";document.getElementById("COB_MAX_PAGO").value=0;document.getElementById("COB_FALTA_MAX").value=0;document.getElementById("COB_COMISION").parentNode.parentNode.style.display="none";document.getElementById("COB_COMISION").value=0;document.getElementById("COB_CTAS_BCO").parentNode.parentNode.style.display="none";document.getElementById("METPAG").parentNode.parentNode.style.display="none";document.getElementById("COB_CTAS_BTN2").parentNode.parentNode.style.display="none";document.getElementById("ANTICIPO_TOTAL").parentNode.parentNode.style.display="block";document.getElementById("ANTICIPO_USO").parentNode.parentNode.style.display="block";document.getElementById("COB_NOCHEQUE").parentNode.parentNode.style.display="none";$("#GRID_ANTICIPOS").jqGrid("setGridState","visible");CargaAnticiposCXP();}else{document.getElementById("COB_MAX_PAGO").parentNode.parentNode.style.display="block";document.getElementById("COB_FALTA_MAX").parentNode.parentNode.style.display="block";document.getElementById("COB_COMISION").parentNode.parentNode.style.display="block";document.getElementById("COB_CTAS_BCO").parentNode.parentNode.style.display="block";document.getElementById("METPAG").parentNode.parentNode.style.display="block";document.getElementById("COB_CTAS_BTN2").parentNode.parentNode.style.display="block";document.getElementById("ANTICIPO_TOTAL").parentNode.parentNode.style.display="none";document.getElementById("ANTICIPO_USO").parentNode.parentNode.style.display="none";document.getElementById("ANTICIPO_TOTAL").value=0;document.getElementById("ANTICIPO_USO").value=0;$("#GRID_ANTICIPOS").jqGrid("setGridState","hidden");jQuery("#GRID_ANTICIPOS").clearGridData();}RevisaMetodoPagoCXP();}function FechaActualCXP(){var fechaActual=new Date();var dia=fechaActual.getDate();var mes=fechaActual.getMonth()+1;var anio=fechaActual.getYear();if(dia<10){dia="0"+dia;}if(mes<10){mes="0"+mes;}if(anio<1000){anio+=1900;}var fechaHoy=dia+"/"+mes+"/"+anio;return fechaHoy;}function selAntiRowCobCtas(rowid,status){var grid=jQuery("#GRID_ANTICIPOS");var lstRow=grid.getRowData(rowid);document.getElementById("ANTICIPO_TOTAL").value=lstRow.ANTI_ABONO;document.getElementById("ANTICIPO_USO").value=lstRow.ANTI_ABONO;if(document.getElementById("COB_ANTI_MON_ORI").value==0){document.getElementById("COB_MONEDA_PAGO").value=lstRow.ANTI_MONEDA;document.getElementById("TIPO_MONEDA_BANC").value=lstRow.ANTI_MONEDA;}else{document.getElementById("COB_MONEDA_PAGO").value=lstRow.ANTI_MONEDAPROV;document.getElementById("TIPO_MONEDA_BANC").value=lstRow.ANTI_MONEDAPROV;document.getElementById("COB_OPERACION").value="M";}if(document.getElementById("COB_MONEDA_PAGO").value==document.getElementById("COB_MONEDA").value){document.getElementById("TASA_CAMBIO_PAGO").value=1;}else{document.getElementById("TASA_CAMBIO_PAGO").value=lstRow.ANTI_TASAPESO;}var intMonDoc=document.getElementById("COB_MONEDA").value;idAnticipo=lstRow.ANTI_ID;TC_OriAnti=lstRow.ANTI_TASAPESO;if(lstRow.ANTI_MONEDA==1&&intMonDoc==2){document.getElementById("COB_OPERACION").value="D";}else{if(lstRow.ANTI_MONEDA==2&&intMonDoc==1){document.getElementById("COB_OPERACION").value="M";}else{if(lstRow.ANTI_MONEDA==2&&intMonDoc==3){document.getElementById("COB_OPERACION").value="D";
}else{if(lstRow.ANTI_MONEDA==3&&intMonDoc==2){document.getElementById("COB_OPERACION").value="M";}}}}}function RevisaMetodoPagoCXP(){var Seleccion=document.getElementById("METPAG").value;var Sichecked=document.getElementById("COB_ESANTICIPO1").checked;if(Sichecked){document.getElementById("COB_NOCHEQUE").parentNode.parentNode.style.display="none";}else{if(Seleccion=="CHEQUE"){document.getElementById("COB_NOCHEQUE").parentNode.parentNode.style.display="block";}else{document.getElementById("COB_NOCHEQUE").parentNode.parentNode.style.display="none";}if(Seleccion=="TRANSFERENCIA ELECTRONICA"){document.getElementById("COB_BCO_TRANS").parentNode.parentNode.style.display="block";document.getElementById("COB_CTA_TRANS").parentNode.parentNode.style.display="block";document.getElementById("MPD_RFC_TERCEROS").parentNode.parentNode.style.display="block";}else{document.getElementById("COB_BCO_TRANS").parentNode.parentNode.style.display="none";document.getElementById("COB_CTA_TRANS").parentNode.parentNode.style.display="none";document.getElementById("MPD_RFC_TERCEROS").parentNode.parentNode.style.display="none";document.getElementById("COB_BCO_TRANS").value="Seleccione";document.getElementById("COB_CTA_TRANS").value="";document.getElementById("MPD_RFC_TERCEROS").value="";}}}function RecalculaGridNuevaTasaCambioCXP(){var Sichecked=document.getElementById("COB_ESANTICIPO1").checked;var boolHaceOperacion=true;setTimeout(function(){var dblTasaCambio=document.getElementById("TASA_CAMBIO_PAGO").value;var strOperacion=document.getElementById("COB_OPERACION").value;if(strOperacion=="M"){dblTasaCambio=1/dblTasaCambio;}if(Sichecked){}else{if(d.getElementById("COB_CTAS_BCO").value==0){boolHaceOperacion=false;alert("Te falta seleccionar el banco");}}if(boolHaceOperacion){var intPV_ID=d.getElementById("COB_CTAS_PV").value;var strFecha1=d.getElementById("COB_CTAS_FECHAS1").value;var strFecha2=d.getElementById("COB_CTAS_FECHAS2").value;var strMoneda=d.getElementById("COB_MONEDA").value;d.getElementById("COB_TOTAL").value=0;var strPOST="&CXP_ANULADO=0&intGlobal=1"+"&COB_MONEDA="+strMoneda;if(strFecha1!=""){strPOST+="&CXP_FECHA1="+strFecha1;}if(strFecha2==""){strFecha2=FechaActualCXP();}strPOST+="&CXP_FECHA2="+strFecha2;ValidaClean("COB_CTAS_PV");if(intPV_ID==0){ValidaShow("COB_CTAS_PV","NECESITA SELECCIONAR UN PROVEEDOR");}else{$("#dialogWait").dialog("open");resetCobroMasCtas(false);strPOST+="&PV_ID="+intPV_ID;$.ajax({type:"POST",data:strPOST,scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"xml",url:"ERP_CobrosCuentas.jsp?id=5",success:function(datos){var objsc=datos.getElementsByTagName("vta_cuenta")[0];var lstTiks=objsc.getElementsByTagName("vta_cuentas");itemIdCobCtas=0;for(iTks=0;iTks<lstTiks.length;iTks++){var obj=lstTiks[iTks];if(obj.getAttribute("dblCXP_SALDO")>0){var dblPagos=obj.getAttribute("dblCXP_TOTAL")-obj.getAttribute("dblCXP_SALDO");var strFecha=obj.getAttribute("strCXP_FECHA");var dblSaldoCambio=parseFloat(obj.getAttribute("dblCXP_SALDO"))*parseFloat(dblTasaCambio);strFecha=strFecha.substr(strFecha.length-2,strFecha.length)+"/"+strFecha.substr(4,2)+"/"+strFecha.substr(0,4);var datarow={COBD_CTAS_ID:obj.getAttribute("intCXP"),COBD_CTAS_FOLIO:obj.getAttribute("intCXP_FOLIO"),COBD_CTAS_FECHA:strFecha,COBD_CTAS_TOTAL:obj.getAttribute("dblCXP_TOTAL"),COBD_CTAS_PAGOS:dblPagos,COBD_CTAS_SALDO:obj.getAttribute("dblCXP_SALDO"),COBD_CTAS_SALDO_CAMBIO:dblSaldoCambio,COBD_CTAS_TIPO:"CUENTA",COBD_CTAS_IMPORTE:0,COBD_CTAS_IMP_CAMBIO:0,COBD_CTAS_MONEDA:obj.getAttribute("intCXP_MONEDA")};itemIdCobCtas++;jQuery("#COB_CTAS_GRID1").addRowData(itemIdCobCtas,datarow,"last");}}document.getElementById("ANTICIPO_USO").value=document.getElementById("ANTICIPO_TOTAL").value;document.getElementById("COB_FALTA_MAX").value=document.getElementById("COB_MAX_PAGO").value;$("#dialogWait").dialog("close");},error:function(objeto,quepaso,otroobj){alert(":ptoExist:"+objeto+" "+quepaso+" "+otroobj);$("#dialogWait").dialog("close");}});}}},100);}function ObtenNomProvAntCobrosCta(){var strPV_ID=document.getElementById("COB_CTAS_PV").value;var strPOST="&PV_ID="+strPV_ID;$("#dialogWait").dialog("open");$.ajax({type:"POST",data:strPOST,scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"html",url:"ERP_CobrosCuentas.jsp?id=11",success:function(datos){if(trim(datos)){var info=datos.split("|");document.getElementById("COB_NOM_PV").value=info[0];document.getElementById("COB_ANTI_MON_ORI").value=info[2];$("#dialogWait").dialog("close");}else{$("#dialogWait").dialog("close");}},error:function(objeto,quepaso,otroobj){alert(":ptoExist:"+objeto+" "+quepaso+" "+otroobj);$("#dialogWait").dialog("close");}});}function CalculoComisionCobrosCta(){var dblComision=parseFloat(document.getElementById("COB_COMISION").value);var dblTotal=parseFloat(document.getElementById("COB_MAX_PAGO").value);if(dblComision>dblTotal){alert("La mision no puede ser mayor que el Maximo a pagar");document.getElementById("COB_COMISION").value=0;document.getElementById("COB_FALTA_MAX").value=dblTotal;}else{document.getElementById("COB_FALTA_MAX").value=dblTotal-dblComision;}}function cambioTasaCambioCXP(){searchTrxMasivaCtas(false);}