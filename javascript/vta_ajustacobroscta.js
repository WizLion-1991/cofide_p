function vta_ajustacobroscta(){}var lastselBco=0;var itemIdCob=0;function InitAjustePagos(){$("#dialogWait").dialog("open");myLayout.close("west");myLayout.close("east");myLayout.close("south");myLayout.close("north");var strHtml="<ul>"+getMenuItem("GuardaAjustaPagoCta();","Guardar Cobro","images/ptovta/CircleSave.png")+getMenuItem("SalirAjsCta();","Salir","images/ptovta/exitBig.png")+"</ul>";document.getElementById("TOOLBAR").innerHTML=strHtml;document.getElementById("btn1").style.display="none";itemIdCob=0;$("#dialogWait").dialog("close");}function GuardaAjustaPagoCta(){$("#dialogWait").dialog("open");var $tabs=$("#tabsCOBROSCTAS").tabs();var selected=$tabs.tabs("option","active");var intEMP_ID=0;var strPOST="";var dblPago=0;intEMP_ID=document.getElementById("EMP_ID").value;dblPago=document.getElementById("COB_CTAS_TOTAL").value;var intIdOper=3;var grid=jQuery("#COB_CTAS_GRID1");var arr=grid.getDataIDs();var intContaPays=0;for(var i=0;i<arr.length;i++){var id=arr[i];var lstRow=grid.getRowData(id);if(lstRow.COBD_CTAS_IMPORTE>0){intContaPays++;}}var dblxCobrar=0;var dblPagado=0;dblPagado=parseFloat(d.getElementById("COB_TOTAL").value);dblxCobrar=parseFloat(d.getElementById("COB_TOTAL").value);if((dblPagado==dblxCobrar||((dblPagado!=dblxCobrar)&&intContaPays==1))&&dblxCobrar>0){strPOST+="FECHA="+(d.getElementById("COB_CTAS_FECHA").value);strPOST+="&BC_ID="+(d.getElementById("COB_CTAS_BCO").value);strPOST+="&NOTAS="+encodeURI(d.getElementById("COB_CTAS_CONCEPTO").value);strPOST+="&MONEDA="+(d.getElementById("TIPO_MONEDA_BANC").value);strPOST+="&TASAPESO="+(d.getElementById("COB_TASA_CAMBIO").value);strPOST+="&MONTOPAGOTOTAL="+dblPagado;strPOST+="&MONTOPAGOTOTALAMONEDA="+(d.getElementById("COB_CTAS_TOTAL").value);for(var i=0;i<arr.length;i++){var id=arr[i];var lstRow=grid.getRowData(id);if(lstRow.COBD_CTAS_IMPORTE>0){strPOST+="&idTrx="+lstRow.COBD_CTAS_ID;strPOST+="&TipoDoc=4";strPOST+="&MONTOPAGO="+lstRow.COBD_CTAS_IMPORTE;strPOST+="&MONTOPAGOAMONEDA="+lstRow.COBD_CTAS_IMPORTE;strPOST+="&MONENDAORIGINAL="+lstRow.COBD_CTAS_MONEDA;}}var strNomForm="CBMASCUENTAS";var strNomField="MPM_ID";if(arr.length==1){intIdOper=1;strNomForm="CBCUENTAS";strNomField="MP_ID";}strPOST+="&COUNT_PAGOS=1";strPOST+="&MPD_MONEDA1=1";strPOST+="&MPD_FOLIO1=";strPOST+="&MPD_FORMAPAGO1=EFECTIVO";strPOST+="&MPD_NOCHEQUE1=0";strPOST+="&MPD_BANCO1=0";strPOST+="&MPD_NOTARJETA1=0";strPOST+="&MPD_TIPOTARJETA1=0";strPOST+="&MPD_IMPORTE1="+parseFloat(dblPagado);strPOST+="&MPD_TASAPESO1="+(d.getElementById("COB_TASA_CAMBIO").value);strPOST+="&MPD_CAMBIO1=0";$.ajax({type:"POST",data:encodeURI(strPOST),scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"html",url:"ERP_CobrosCuentas.jsp?id="+intIdOper,success:function(dato){dato=trim(dato);if(Left(dato,3)=="OK."){resetCobroMasCtas2CXP(true);$("#dialogPagos").dialog("close");}else{alert(dato);}$("#dialogWait").dialog("close");},error:function(objeto,quepaso,otroobj){alert(":pto9:"+objeto+" "+quepaso+" "+otroobj);$("#dialogWait").dialog("close");}});}else{alert(lstMsg[10]);$("#dialogWait").dialog("close");}setTimeout(function(){LimpiarGridCXP();},10000);}function LimpiarGridCXP(){jQuery("#COB_CTAS_GRID1").clearGridData();itemIdCob=0;CargaAjustaPagoCXP();}function SalirAjsCta(){myLayout.open("west");myLayout.open("east");myLayout.open("south");myLayout.open("north");document.getElementById("MainPanel").innerHTML="";var objMainFacPedi=objMap.getScreen("AJS_PAGOSC");objMainFacPedi.bolActivo=false;objMainFacPedi.bolMain=false;objMainFacPedi.bolInit=false;objMainFacPedi.idOperAct=0;}function CargaAjustaPagoCXP(){var intPV_ID=d.getElementById("COB_CTAS_PV").value;var strFecha1=d.getElementById("COB_CTAS_FECHAS1").value;var strFecha2=d.getElementById("COB_CTAS_FECHAS2").value;var strMoneda=d.getElementById("COB_MONEDA").value;$("#dialogWait").dialog("open");resetCobroMasCtas(false);$.ajax({type:"POST",data:"PV_ID="+intPV_ID+"&CXP_FECHA1="+strFecha1+"&CXP_FECHA2="+strFecha2+"&CXP_ANULADO=0&intGlobal=1"+"&COB_MONEDA="+strMoneda,scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"xml",url:"ERP_CobrosCuentas.jsp?id=5",success:function(datos){var objsc=datos.getElementsByTagName("vta_cuenta")[0];var lstTiks=objsc.getElementsByTagName("vta_cuentas");itemIdCobCtas=0;for(i=0;i<lstTiks.length;i++){var obj=lstTiks[i];if(obj.getAttribute("dblCXP_SALDO")>0){var dblPagos=obj.getAttribute("dblCXP_TOTAL")-obj.getAttribute("dblCXP_SALDO");var strFecha=obj.getAttribute("strCXP_FECHA");strFecha=strFecha.substr(strFecha.length-2,strFecha.length)+"/"+strFecha.substr(4,2)+"/"+strFecha.substr(0,4);var datarow={COBD_CTAS_ID:obj.getAttribute("intCXP"),COBD_CTAS_FOLIO:obj.getAttribute("intCXP_FOLIO"),COBD_CTAS_FECHA:strFecha,COBD_CTAS_TOTAL:obj.getAttribute("dblCXP_TOTAL"),COBD_CTAS_PAGOS:dblPagos,COBD_CTAS_SALDO:obj.getAttribute("dblCXP_SALDO"),COBD_CTAS_TIPO:"CUENTA",COBD_CTAS_MONEDA:obj.getAttribute("intCXP_MONEDA")};itemIdCobCtas++;jQuery("#COB_CTAS_GRID1").addRowData(itemIdCobCtas,datarow,"last");}}d.getElementById("COB_TASA_CAMBIO").value=1;$("#dialogWait").dialog("close");},error:function(objeto,quepaso,otroobj){alert(":ptoExist:"+objeto+" "+quepaso+" "+otroobj);$("#dialogWait").dialog("close");}});}function OpnDiagProvCob(){OpnOpt("PROVEEDOR","grid","dialogProv",false,false);}function resetCobroMasCtas(bolUpdateGrid){d.getElementById("COB_CTAS_TOTAL").value=0;if(bolUpdateGrid){searchTrxMasivaCtas();}else{jQuery("#COB_CTAS_GRID1").clearGridData();}}function ClickFueraGridAjustaCXP(){var grid=jQuery("#COB_CTAS_GRID1");var lstRow=grid.getRowData(lastselBco);var dblMonedaAPagar=1;var dato=document.getElementById((lastselBco)+"_COBD_CTAS_IMPORTE").value;var dblSaldo=parseFloat(lstRow.COBD_CTAS_SALDO);if(parseFloat(dato)>dblSaldo){lstRow.COBD_CTAS_IMPORTE=dblSaldo;lstRow.COBD_CTAS_IMP_CAMBIO=parseFloat(dblSaldo)*(dblMonedaAPagar);alert("No puede pagar mas de lo que debe");}else{lstRow.COBD_CTAS_IMPORTE=dato;lstRow.COBD_CTAS_IMP_CAMBIO=parseFloat(dato)*(dblMonedaAPagar);}grid.setRowData(lastselBco,lstRow);grid.saveRow(lastselBco);RecalculoAjusteCXP();lastselBco=0;}function editGridAjusteCXP(e){if(e.originalEvent.keyCode==13){var dblTasaCambio=1;var grid=jQuery("#COB_CTAS_GRID1");var lstRow=grid.getRowData(lastselBco);var dato=0;if(document.getElementById((lastselBco)+"_COBD_CTAS_IMPORTE")!=null){dato=document.getElementById((lastselBco)+"_COBD_CTAS_IMPORTE").value;}else{dato=lstRow.COBD_CTAS_IMPORTE;}if((parseFloat(dato)*dblTasaCambio)<=parseFloat(lstRow.COBD_CTAS_SALDO)){lstRow.COBD_CTAS_IMPORTE=dato;lstRow.COBD_CTAS_IMP_CAMBIO=parseFloat(dato)*(dblTasaCambio);grid.setRowData(lastselBco,lstRow);}else{lstRow.COBD_CTAS_IMPORTE=lstRow.COBD_CTAS_SALDO*parseFloat(document.getElementById("TASA_CAMBIO_PAGO").value);lstRow.COBD_CTAS_IMP_CAMBIO=parseFloat(lstRow.COBD_CTAS_IMPORTE)*(dblTasaCambio);grid.setRowData(lastselBco,lstRow);alert("No puede pagar mas de lo que debe");}grid.saveRow(lastselBco);RecalculoAjusteCXP();lastselBco=0;}}function RecalculoAjusteCXP(){setTimeout(function(){var grid=jQuery("#COB_CTAS_GRID1");var arr=grid.getDataIDs();var dblTotal=0;var dblNumero;var dblTasaCambio=1;var dblTotalAntes=0;for(var i=0;i<arr.length;i++){var idRow=arr[i];dblNumero=0;var lstRow=grid.getRowData(idRow);var dblTasaAPagar=1;if(document.getElementById(""+(i+1)+"_COBD_CTAS_IMPORTE")!=null){dblNumero=parseFloat(document.getElementById(""+(i+1)+"_COBD_CTAS_IMPORTE").value);var dblImporte=parseFloat(lstRow.COBD_CTAS_SALDO)*dblTasaAPagar;document.getElementById(""+(i+1)+"_COBD_CTAS_IMPORTE").value=dblImporte;}else{dblNumero=parseFloat(lstRow.COBD_CTAS_IMPORTE)*dblTasaAPagar;}dblTotal+=dblNumero*(dblTasaCambio);dblTotalAntes+=dblNumero;}d.getElementById("COB_TOTAL").value=FormatNumber(dblTotalAntes*dblTasaCambio,2,true);d.getElementById("COB_CTAS_TOTAL").value=FormatNumber(dblTotalAntes,2,true);},300);}function selAjusteRowCXP(rowid,status){editFilaAjusteCXP(rowid);RecalculoAjusteCXP();
}function editFilaAjusteCXP(id){var grid=jQuery("#COB_CTAS_GRID1");if(id!=lastselBco){grid.saveRow(lastselBco);grid.editRow(id,false);lastselBco=id;}}