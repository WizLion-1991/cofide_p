var itemId=0;var lastselBco=0;var idProd=0;function vta_producto(){}function InitPrecios(){var obscProd=objMap.getScreen("PROD");$("#dialogWait").dialog("open");var strPR_ID="0";if(document.getElementById("PR_ID")!=null&&document.getElementById("PR_ID")!="undefined"){strPR_ID=document.getElementById("PR_ID").value;}$.ajax({type:"POST",data:"PR_ID="+strPR_ID,scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"xml",url:"DamePrecio.do?id=1",success:function(datos){var lstXml=datos.getElementsByTagName("Precios")[0];var lstprecio=lstXml.getElementsByTagName("Precio");for(var i=0;i<lstprecio.length;i++){var obj=lstprecio[i];var inum=obj.getAttribute("num");var datarow={PP_ID:0,PR_ID:obj.getAttribute("pr_id"),LP_ID:obj.getAttribute("num"),PP_PRECIO:obj.getAttribute("precio"),PP_PRECIO_USD:obj.getAttribute("precio_usd"),PP_APDESC:obj.getAttribute("descuento"),PP_PTOSLEAL:obj.getAttribute("lealtad"),PP_PTOSLEALCAM:obj.getAttribute("lealtadCA"),PP_NOM:obj.getAttribute("nombre"),PP_PUNTOS:obj.getAttribute("puntos"),PP_NEGOCIO:obj.getAttribute("negocio"),PP_AP_DESC_PTO:obj.getAttribute("desc_pto"),PP_AP_DESC_NEGO:obj.getAttribute("desc_nego"),PP_PUBLICO:obj.getAttribute("publico"),PP_PUTILIDAD:obj.getAttribute("putilidad")};jQuery("#GRID1").addRowData(inum,datarow,"last");}$.ajax({type:"POST",data:"",scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"xml",url:"ERP_Inventario.jsp?id=10",success:function(datos){var lstXml=datos.getElementsByTagName("prodCat")[0];for(var h=1;h<=9;h++){var lstCat=lstXml.getElementsByTagName("Cat"+h);var sel=document.getElementById("PR_CATEGORIA"+h);select_clear(sel);select_add(sel,"SELECCIONE",0);for(var i=0;i<lstCat.length;i++){var objCat=lstCat[i];var idCat=objCat.getAttribute("id");var descCat=objCat.getAttribute("desc");select_add(sel,descCat,idCat);}}if(obscProd.objDataEdit!=null){var objDataItem=obscProd.objDataEdit.getElementsByTagName("vta_productos");for(var h=1;h<=9;h++){var idCatSel=objDataItem[0].getAttribute("PR_CATEGORIA"+h);document.getElementById("PR_CATEGORIA"+h).value=idCatSel;}refreshClas10(objDataItem[0].getAttribute("PR_CATEGORIA10"));}getProductosKit();},error:function(objeto,quepaso,otroobj){alert("Error en categorias: "+objeto+" "+quepaso+" "+otroobj);$("#dialogWait").dialog("close");}});},error:function(objeto,quepaso,otroobj){alert("Error en precios: "+objeto+" "+quepaso+" "+otroobj);$("#dialogWait").dialog("close");}});_ActButtonsOP("bt_calc_prec2",false);_ActButtonsOP("bt_calc_prec3",false);InitProdImg();_PreSelBodegas();}function EndPrecios(bolCerrarProd){if(bolCerrarProd==null){bolCerrarProd=true;}$("#dialogWait").dialog("open");var strCodigo=document.getElementById("PR_CODIGO").value;var grid=jQuery("#GRID1");var strLstNum="";var strLstPrec="";var strLstPrecUsd="";var strLstDesc="";var strLstPtos="";var strLstPtosC="";var strLstSuc="";var strLstPto="";var strLstNego="";var strLstPub="";var strLstApDescPto="";var strLstApDescNego="";var strLstPUtilidad="";var intCont=document.getElementById("SUC_LSTcount").value;var strSucDefa=document.getElementById("SC_ID").value;var bolFindDefa=false;for(var h=0;h<intCont;h++){var strComaS="";if(h+1<intCont){strComaS=",";}if(document.getElementById("SUC_LST"+h).checked){strLstSuc+=document.getElementById("SUC_LST"+h).value+strComaS;if(document.getElementById("SUC_LST"+h).value==strSucDefa){bolFindDefa=true;}}}if(!bolFindDefa){strLstSuc+=strSucDefa;}var arr=grid.getDataIDs();if(arr!=null){for(var i=0;i<arr.length;i++){var id=arr[i];var lstRowUp=grid.getRowData(id);var strComa="";if(i+1<arr.length){strComa=",";}if(isNaN(grid.getCell(id,3))){strLstNum+=grid.getCell(id,1)+strComa;strLstPrec+=document.getElementById(id+"_PP_PRECIO").value+strComa;strLstPrecUsd+=document.getElementById(id+"_PP_PRECIO_USD").value+strComa;strLstPtos+=document.getElementById(id+"_PP_PTOSLEAL").value+strComa;strLstPtosC+=document.getElementById(id+"_PP_PTOSLEALCAM").value+strComa;strLstPto+=document.getElementById(id+"_PP_PUNTOS").value+strComa;strLstNego+=document.getElementById(id+"_PP_NEGOCIO").value+strComa;strLstPub+=document.getElementById(id+"_PP_PUBLICO").value+strComa;if(document.getElementById(id+"_PP_AP_DESC_PTO").checked){strLstApDescPto+="1"+strComa;}else{strLstApDescPto+="0"+strComa;}if(document.getElementById(id+"_PP_AP_DESC_NEGO").checked){strLstApDescNego+="1"+strComa;}else{strLstApDescNego+="0"+strComa;}if(document.getElementById(id+"_PP_APDESC").checked){strLstDesc+="1"+strComa;}else{strLstDesc+="0"+strComa;}strLstPUtilidad+=document.getElementById(id+"_PP_PUTILIDAD").value+strComa;}else{strLstNum+=lstRowUp.LP_ID+strComa;strLstPrec+=lstRowUp.PP_PRECIO+strComa;strLstPrecUsd+=lstRowUp.PP_PRECIO_USD+strComa;strLstDesc+=lstRowUp.PP_APDESC+strComa;strLstPtos+=lstRowUp.PP_PTOSLEAL+strComa;strLstPtosC+=lstRowUp.PP_PTOSLEALCAM+strComa;strLstPto+=lstRowUp.PP_PUNTOS+strComa;strLstNego+=lstRowUp.PP_NEGOCIO+strComa;strLstPub+=lstRowUp.PP_PUBLICO+strComa;strLstApDescPto+=lstRowUp.PP_AP_DESC_PTO+strComa;strLstApDescNego+=lstRowUp.PP_AP_DESC_NEGO+strComa;strLstPUtilidad+=lstRowUp.PP_PUTILIDAD+strComa;}}var strPOST="PR_CODIGO="+strCodigo+"&LstSuc="+strLstSuc+"&LstNum="+strLstNum+"&LstPrec="+strLstPrec+"&LstDesc="+strLstDesc+"&LstPtos="+strLstPtos+"&LstPtosC="+strLstPtosC+"&LstPrecUSD="+strLstPrecUsd+"&LstPto="+strLstPto+"&LstNego="+strLstNego+"&LstPub="+strLstPub+"&LstApDPto="+strLstApDescPto+"&LstApDNego="+strLstApDescNego+"&LstPUtilidad="+strLstPUtilidad;strPOST=encodeURI(strPOST);$.ajax({type:"POST",data:strPOST,scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"html",url:"DamePrecio.do?id=2",success:function(datos){if(datos.substr(0,2)!="OK"){$("#dialogWait").dialog("close");alert(datos);}else{$("#dialogWait").dialog("close");if(bolCerrarProd){siesKit();_objSc.RestoreSave();_objSc=null;}}},error:function(objeto,quepaso,otroobj){alert("Paso siguiente: "+objeto+" "+quepaso+" "+otroobj);}});}else{$("#dialogWait").dialog("close");}}function selRowPrecios(rowid,status){if(rowid!==lstselRows[1]){jQuery("#GRID1").saveRow(lstselRows[1]);jQuery("#GRID1").editRow(rowid,false);lstselRows[1]=rowid;}}function keyPressPrecios(e){if(e.originalEvent.keyCode==13){jQuery("#GRID1").saveRow(lstselRows[1]);lstselRows[1]=0;}}function dblClickProd(id){var strNomMain=objMap.getNomMain();if(strNomMain=="PROD"){OpnEdit(document.getElementById("Ed"+strNomMain));var grid1=jQuery("#PROD");var idP=grid1.getGridParam("selrow");var lstRow=grid1.getRowData(idP);idProd=lstRow.PR_ID;}else{var grid=jQuery("#PROD");var lstVal=grid.getRowData(id);if(strNomMain=="INV"){document.getElementById("INV_PROD").value=lstVal.PR_CODIGO;document.getElementById("INV_DESC").value=lstVal.PR_DESCRIPCION;$("#dialogProd").dialog("close");AddItemIV();}else{if(strNomMain=="NCREDITO"){document.getElementById("NC_PROD").value=lstVal.PR_CODIGO;document.getElementById("NC_DESC").value=lstVal.PR_DESCRIPCION;$("#dialogProd").dialog("close");AddItemNC();}else{if(strNomMain=="COMPRAS"){document.getElementById("COM_PROD").value=lstVal.PR_CODIGO;document.getElementById("COM_DESC").value=lstVal.PR_DESCRIPCION;document.getElementById("COM_PRECIO").value=lstVal.PR_COSTOCOMPRA;AgregarProd();$("#dialogProd").dialog("close");}else{if(strNomMain=="REG_COM"){document.getElementById("COM_PROD").value=lstVal.PR_CODIGO;document.getElementById("COM_DESC").value=lstVal.PR_DESCRIPCION;document.getElementById("COM_PRECIO").value=lstVal.PR_COSTOCOMPRA;$("#dialogProd").dialog("close");}else{if(strNomMain=="CXPAGAR"){document.getElementById("CXP_PROD").value=lstVal.PR_CODIGO;document.getElementById("CXP_DESC").value=lstVal.PR_DESCRIPCION;document.getElementById("CXP_COSTO").value=lstVal.PR_COSTOCOMPRA;ObtenDatosProductoCXP();$("#dialogProd").dialog("close");}else{if(strNomMain=="REC_ODC_CX"){document.getElementById("COM_PROD").value=lstVal.PR_CODIGO;document.getElementById("COM_DESCRIPCION").value=lstVal.PR_DESCRIPCION;
document.getElementById("COM_PRECIO").value=lstVal.PR_COSTOCOMPRA;document.getElementById("COM_PR_ID_PROD").value=lstVal.PR_ID;$("#dialogProd").dialog("close");}else{if(strNomMain=="ETQ"){document.getElementById("CODIGO_PROD").value=lstVal.PR_CODIGO;$("#dialogProd").dialog("close");}else{if(strNomMain=="CON_INV"){document.getElementById("CI_CODIGO").value=lstVal.PR_CODIGO;document.getElementById("CI_DESCRIPCION").value=lstVal.PR_DESCRIPCION;$("#dialogProd").dialog("close");}else{if(strNomMain=="vta_combo"){document.getElementById("PR_CODIGO").value=lstVal.PR_CODIGO;document.getElementById("PR_DESCRIPCION").value=lstVal.PR_DESCRIPCIONCORTA;document.getElementById("PR_PRECIO").value=lstVal.PR_COSTOCOMPRA;document.getElementById("PR_ID").value=lstVal.PR_ID;$("#dialogProd").dialog("close");}else{var dialogDevo=$("#dialogDevo");var _bolDevo=false;if(dialogDevo!=null){if($("#dialogDevo").dialog("isOpen")){_bolDevo=true;}}if(!_bolDevo){document.getElementById("FAC_PROD").value=lstVal.PR_CODIGO;document.getElementById("FAC_DESC").value=lstVal.PR_DESCRIPCION;document.getElementById("FAC_CANT").focus();document.getElementById("FAC_CANT").select();$("#dialogProd").dialog("close");}else{document.getElementById("DEVO_ARTICULO").value=lstVal.PR_CODIGO;document.getElementById("DEVO_DESCRIPCION").value=lstVal.PR_DESCRIPCION;$("#dialogProd").dialog("close");}}}}}}}}}}}}function refreshClas10(strIdDefa){if(document.getElementById("PR_CATEGORIA9").value!="0"){var strPOST="idItem="+document.getElementById("PR_CATEGORIA9").value;$.ajax({type:"POST",data:strPOST,scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"xml",url:"ERP_Inventario.jsp?id=12",success:function(datos){var lstXml=datos.getElementsByTagName("vta_clasific")[0];var lstCat=lstXml.getElementsByTagName("clas");var sel=document.getElementById("PR_CATEGORIA10");select_clear(sel);select_add(sel,"SELECCIONE",0);for(var i=0;i<lstCat.length;i++){var objCat=lstCat[i];var idCat=objCat.getAttribute("id");var descCat=objCat.getAttribute("desc");select_add(sel,descCat,idCat);}if(strIdDefa!=null&&strIdDefa!=undefined){document.getElementById("PR_CATEGORIA10").value=strIdDefa;}},error:function(objeto,quepaso,otroobj){alert("Paso siguiente: "+objeto+" "+quepaso+" "+otroobj);}});}else{select_clear(document.getElementById("PR_CATEGORIA10"));}}function delProd(){var grid=jQuery("#GRDTAB6");if(grid.getGridParam("selrow")!=null){var id=grid.getGridParam("selrow");var lstRow=grid.getRowData(id);var strDes=lstRow.TXTCVETBL;if(confirm("¿Confirma que desea borrar el producto:"+" "+strDes)){grid.delRowData(grid.getGridParam("selrow"));}}else{alert("Selecciona un producto");}}function addProducto(){var strCve=document.getElementById("TXTCVETAB6").value;var strCan=document.getElementById("TXTCANTAB6").value;var strCod="";var intIdPr="";if(valDatos()!=0){searchProdcuto(strCve);}}function valDatos(){var strCod=document.getElementById("TXTCVETAB6");var strCan=document.getElementById("TXTCANTAB6");var dblTasaCambio=document.getElementById("TXTTASACAMBIO");if(strCod.value==""){alert("FAVOR DE CAPTURAR EL CODIGO DEL PRODCUTO");strCod.focus();return 0;}if(strCan.value=="0"){alert("LA CATIDAD DEBE SER MAYOR A 0");strCan.focus();return 0;}if(strCan.value==""){alert("ESPECIFIQUE LA CANTIDAD");strCan.focus();return 0;}if(dblTasaCambio.value==0||dblTasaCambio.value==""){alert("ESPECIFIQUE LA TASA DE CAMBIO");dblTasaCambio.focus();return 0;}return 1;}function searchProdcuto(string){$("#dialogWait").dialog("close");var grid2=jQuery("#GRDTAB6");var existDat=false;$.ajax({type:"POST",data:"cod="+string,scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"xml",url:"ERP_Inventario.jsp?id=13",success:function(datos){var lstProductos=datos.getElementsByTagName("productos")[0];var objProducto=lstProductos.getElementsByTagName("producto");for(l=0;l<objProducto.length;l++){existDat=true;}if(existDat){var objProducto1=lstProductos.getElementsByTagName("producto")[0];var intMonPaquete=document.getElementById("PR_MONEDA_VTA").value;var intMonProducto=objProducto1.getAttribute("PR_MONEDA_COSTO");var dblTasaCambio=document.getElementById("TXTTASACAMBIO").value;var dblCostoReposicion=objProducto1.getAttribute("PR_COSTOREPOSICION");if(intMonPaquete==1&&intMonProducto==2){dblCostoReposicion=objProducto1.getAttribute("PR_COSTOREPOSICION")*dblTasaCambio;}if(intMonPaquete==2&&intMonProducto==1){var CostoReposicion=parseFloat(objProducto1.getAttribute("PR_COSTOREPOSICION")/dblTasaCambio).toFixed(2);dblCostoReposicion=CostoReposicion;}var dblFactorSobrecosto=objProducto1.getAttribute("PR_FACTORSOBRECOSTO");var dblCantidad=document.getElementById("TXTCANTAB6").value;var dblTotal=(dblCostoReposicion)*(dblFactorSobrecosto)*(dblCantidad);var strMoneda=objProducto1.getAttribute("moneda1");if(strMoneda=="null"){strMoneda="PESOS";}var datarow={TXTCVETBL:objProducto1.getAttribute("PR_DESCRIPCION"),TXTCANTBL:document.getElementById("TXTCANTAB6").value,TXTCODTBL:objProducto1.getAttribute("PR_CODIGO"),HDDPRID:objProducto1.getAttribute("PR_ID"),TXTFACSOBRTBL:objProducto1.getAttribute("PR_FACTORSOBRECOSTO"),TXTCOSTREPTBL:dblCostoReposicion,TXTTOTALESTBL:dblTotal,TXTMONEDAORIGI:objProducto1.getAttribute("PR_MONEDA_COSTO"),TXTPRECIOORIGI:objProducto1.getAttribute("PR_COSTOREPOSICION"),TXTPRECIOCONV:dblCostoReposicion,TXTMONORIGlLETRA:strMoneda};itemId++;grid2.addRowData(itemId,datarow,"last");document.getElementById("TXTCVETAB6").value="";document.getElementById("TXTCANTAB6").value="";document.getElementById("TXTDESCTAB6").value="";var dbltotalPaquete=0;var arr=grid2.getDataIDs();for(var i=0;i<arr.length;i++){var id=arr[i];var lstRow=grid2.getRowData(id);dbltotalPaquete=dbltotalPaquete+parseFloat(lstRow.TXTTOTALESTBL);}jQuery(grid2).footerData("set",{TXTCVETBL:"PRECIO SUGERIDO",TXTTOTALESTBL:dbltotalPaquete});document.getElementById("PR_TOTALGRID").value=dbltotalPaquete;document.getElementById("TXTTOTALEDIT").value=dbltotalPaquete;}else{alert("Error:No existe el producto con codigo:"+document.getElementById("TXTCVETAB6").value);}$("#dialogWait").dialog("close");},error:function(objeto,quepaso,otroobj){$("#dialogWait").dialog("close");alert(":tarifas:"+objeto+" "+quepaso+" "+otroobj);}});}function validaSiEsKit(){}function siesKit(){if(document.getElementById("PR_ESKIT1").checked){var gridDat=jQuery("#GRDTAB6");var arr=gridDat.getDataIDs();if(arr.length==0){alert("Atencion: Usted indico que esto es un paquete pero la lista esta vacia!!");saveKit();}else{saveKit();}}else{var grid=jQuery("#PROD");grid.clearGridData();}}function saveKit(){$("#dialogWait2").dialog("open");var intConta=0;var strPost="";var grid=jQuery("#GRDTAB6");var arr=grid.getDataIDs();for(var i=0;i<arr.length;i++){var idRow=arr[i];intConta++;var lstRow=grid.getRowData(idRow);strPost+="&TXTCVETBL"+intConta+"="+encodeURIComponent(lstRow.TXTCVETBL);strPost+="&TXTCODTBL"+intConta+"="+encodeURIComponent(lstRow.TXTCODTBL);strPost+="&TXTCANTBL"+intConta+"="+lstRow.TXTCANTBL;strPost+="&HDDPRID"+intConta+"="+lstRow.HDDPRID;strPost+="&TXTFACSOBRTBL"+intConta+"="+lstRow.TXTFACSOBRTBL;strPost+="&TXTCOSTREPTBL"+intConta+"="+lstRow.TXTCOSTREPTBL;strPost+="&TXTMONEDAORIGI"+intConta+"="+lstRow.TXTMONORIGlLETRA;strPost+="&TXTTOTALESTBL"+intConta+"="+lstRow.TXTTOTALESTBL;strPost+="&TXTPRECIOORIGI"+intConta+"="+lstRow.TXTPRECIOORIGI;strPost+="&TXTPRECIOCONV"+intConta+"="+lstRow.TXTPRECIOCONV;}strPost+="&CONTADOR="+intConta;strPost+="&PRODUCTO="+document.getElementById("PR_CODIGO").value;strPost+="&IDPR="+idProd;$.ajax({type:"POST",data:strPost,scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"html",url:"ERP_Inventario.jsp?id=14",success:function(datos){if(datos.substring(0,2)=="OK"){}else{alert("Error:"+datos);}$("#dialogWait2").dialog("close");},error:function(objeto,quepaso,otroobj){alert(":tarifas:"+objeto+" "+quepaso+" "+otroobj);}});}function saveModiKit(){var intConta=0;
var strPost="";$("#dialogWait").dialog("open");var grid=jQuery("#GRDTAB6");var arr=grid.getDataIDs();for(var i=0;i<arr.length;i++){var idRow=arr[i];intConta++;var lstRow=grid.getRowData(idRow);strPost+="&TXTCVETBL"+intConta+"="+encodeURIComponent(lstRow.TXTCVETBL);strPost+="&TXTCODTBL"+intConta+"="+encodeURIComponent(lstRow.TXTCODTBL);strPost+="&TXTCANTBL"+intConta+"="+lstRow.TXTCANTBL;strPost+="&HDDPRID"+intConta+"="+lstRow.HDDPRID;strPost+="&TXTFACSOBRTBL"+intConta+"="+lstRow.TXTFACSOBRTBL;strPost+="&TXTCOSTREPTBL"+intConta+"="+lstRow.TXTCOSTREPTBL;strPost+="&TXTMONEDAORIGI"+intConta+"="+lstRow.TXTMONORIGlLETRA;strPost+="&TXTTOTALESTBL"+intConta+"="+lstRow.TXTTOTALESTBL;strPost+="&TXTPRECIOORIGI"+intConta+"="+lstRow.TXTPRECIOORIGI;strPost+="&TXTPRECIOCONV"+intConta+"="+lstRow.TXTPRECIOCONV;}strPost+="&CONTADOR="+intConta;strPost+="&PRODUCTO="+document.getElementById("PR_CODIGO").value;$.ajax({type:"POST",data:strPost,scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"html",url:"ERP_Inventario.jsp?id=14",success:function(datos){if(datos.substring(0,2)=="OK"){}else{alert("Error:"+datos);}$("#dialogWait").dialog("close");},error:function(objeto,quepaso,otroobj){alert(":tarifas:"+objeto+" "+quepaso+" "+otroobj);}});}function getProductosKit(){var grid=jQuery("#PROD");var id=grid.getGridParam("selrow");var lstRow=grid.getRowData(id);$.ajax({type:"POST",data:"idPr="+lstRow.PR_ID,scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"xml",url:"ERP_Inventario.jsp?id=15",success:function(datos){var lstProductos=datos.getElementsByTagName("productos")[0];var objProducto=lstProductos.getElementsByTagName("producto");var grid2=jQuery("#GRDTAB6");for(var i=0;i<objProducto.length;i++){var obj=objProducto[i];var datarow={TXTCODTBL:obj.getAttribute("PAQ_COD"),TXTCANTBL:obj.getAttribute("PAQ_CANTIDAD"),TXTCVETBL:obj.getAttribute("PAQ_DESCRIPCION"),HDDPRID:obj.getAttribute("PR_ID"),TXTFACSOBRTBL:obj.getAttribute("PAQ_FACSOBR"),TXTCOSTREPTBL:obj.getAttribute("PAQ_COSTREP"),TXTMONORIGlLETRA:obj.getAttribute("PAQ_MONEDAORIGI"),TXTTOTALESTBL:obj.getAttribute("PAQ_TOTALES"),TXTPRECIOORIGI:obj.getAttribute("PAQ_PRECIOORIGI"),TXTPRECIOCONV:obj.getAttribute("PAQ_PRECIOCONV")};itemId++;grid2.addRowData(itemId,datarow,"last");}$("#dialogWait").dialog("close");},error:function(objeto,quepaso,otroobj){$("#dialogWait").dialog("close");alert(":tarifas:"+objeto+" "+quepaso+" "+otroobj);}});}function deleteProdKits(){var grid=jQuery("#PROD");var id=grid.getGridParam("selrow");var lstRow=grid.getRowData(id);$("#dialogWait").dialog("open");$.ajax({type:"POST",data:"idPr="+lstRow.PR_ID,scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"html",url:"ERP_Inventario.jsp?id=16",success:function(datos){$("#dialogWait").dialog("close");},error:function(objeto,quepaso,otroobj){alert(":tarifas:"+objeto+" "+quepaso+" "+otroobj);}});}function editGrid(e){if(e.originalEvent.keyCode==13){var grid=jQuery("#GRDTAB6");grid.saveRow(lastselBco);lastselBco=0;}}function editFila(id){var grid=jQuery("#GRDTAB6");if(id!=lastselBco){grid.saveRow(lastselBco);grid.editRow(id,false);lastselBco=id;}}function ProdEdo(){var grid=jQuery("#PROD");if(grid.getGridParam("selrow")!=null){var lstVal=grid.getRowData(grid.getGridParam("selrow"));$("#tabsOptPROD").tabs("enable",1);$("#tabsOptPROD").tabs("option","active",1);var div=document.getElementById("screenOptPROD");var strHtml="<form method=post name=formUpload>";strHtml+=CreaHidden("PR_ID_EDO",lstVal.PR_ID);strHtml+=CreaDate(lstMsg[98],"FEC_INI","","","",0,"","","",false);strHtml+=CreaDate(lstMsg[99],"FEC_FIN","","","",0,"","","",false);strHtml+=CreaBoton("","importar",lstMsg[104],"ProdEdoDo();","left",false,false);strHtml+="</form>";div.innerHTML=strHtml;document.getElementById("VerDetaPROD").innerHTML=lstMsg[104];$("#FEC_INI").datepicker({changeMonth:true,changeYear:true});$("#FEC_FIN").datepicker({changeMonth:true,changeYear:true});$("#FEC_INI").datepicker("setDate",new Date());$("#FEC_FIN").datepicker("setDate",new Date());}}function ProdEdoDo(){var a=confirm(lstMsg[102]);var strTipo="PDF";if(a){strTipo="XLS";}var strHtml=CreaHidden("PR_ID_REPO",document.getElementById("PR_ID_EDO").value);strHtml+=CreaHidden("FEC_INI",document.getElementById("FEC_INI").value);strHtml+=CreaHidden("FEC_FIN",document.getElementById("FEC_FIN").value);openReport("EDO_CTA_PROD",strTipo,strHtml);}function ProdEdoMaster(){var grid=jQuery("#PROD");if(grid.getGridParam("selrow")!=null){var lstVal=grid.getRowData(grid.getGridParam("selrow"));$("#tabsOptPROD").tabs("enable",1);$("#tabsOptPROD").tabs("option","active",1);var div=document.getElementById("screenOptPROD");var strHtml="<form method=post name=formUpload>";strHtml+=CreaHidden("PR_CODIGO_REPO",lstVal.PR_CODIGO);strHtml+=CreaDate(lstMsg[98],"FEC_INI","","","",0,"","","",false);strHtml+=CreaDate(lstMsg[99],"FEC_FIN","","","",0,"","","",false);strHtml+=CreaBoton("","importar",lstMsg[104],"ProdEdoDoMaster();","left",false,false);strHtml+="</form>";div.innerHTML=strHtml;document.getElementById("VerDetaPROD").innerHTML=lstMsg[104];$("#FEC_INI").datepicker({changeMonth:true,changeYear:true});$("#FEC_FIN").datepicker({changeMonth:true,changeYear:true});$("#FEC_INI").datepicker("setDate",new Date());$("#FEC_FIN").datepicker("setDate",new Date());}}function ProdEdoDoMaster(){var a=confirm(lstMsg[102]);var strTipo="PDF";if(a){strTipo="XLS";}var strHtml=CreaHidden("PR_CODIGO",document.getElementById("PR_CODIGO_REPO").value);strHtml+=CreaHidden("FEC_INI",document.getElementById("FEC_INI").value);strHtml+=CreaHidden("FEC_FIN",document.getElementById("FEC_FIN").value);strHtml+=CreaHidden("FEC_BODEGA",intSucDefa);openReport("EDO_CTA_PROD",strTipo,strHtml);}function CalculaEAN13(){var grid=jQuery("#PROD");if(grid.getGridParam("selrow")!=null){var lstRow=grid.getRowData(grid.getGridParam("selrow"));$("#dialogWait").dialog("open");$.ajax({type:"POST",data:"PR_ID="+lstRow.PR_ID,scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"html",url:"ERP_Producto.jsp?id=11",success:function(datos){alert(datos);$("#dialogWait").dialog("close");},error:function(objeto,quepaso,otroobj){alert(":EAN 13:"+objeto+" "+quepaso+" "+otroobj);}});}}var _bolRefreshGridProds=false;var _bodegaWorkProd=0;var _IsExecuted=false;function EvalCols(){if(!_IsExecuted){var bolPreBodega=false;var bolInactivo=false;var ci=false;_IsExecuted=true;_bolRefreshGridProds=true;var intBodegaPre=0;var strNomMain=objMap.getNomMain();if(strNomMain=="PROD"){bolInactivo=true;}else{var grid=jQuery("#PROD");if(strNomMain=="INV"){grid.hideCol("PR_ACTIVO");bolPreBodega=true;intBodegaPre=document.getElementById("SC_ID").value;}else{if(strNomMain=="NCREDITO"){grid.hideCol("SC_ID");grid.hideCol("PR_ACTIVO");grid.hideCol("PR_COSTOCOMPRA");grid.hideCol("PV_ID");bolPreBodega=true;intBodegaPre=document.getElementById("SC_ID").value;}else{if(strNomMain=="COMPRAS"){grid.hideCol("PR_ACTIVO");bolPreBodega=true;intBodegaPre=document.getElementById("SC_ID").value;}else{if(strNomMain=="REG_COM"){grid.hideCol("PR_ACTIVO");bolPreBodega=true;intBodegaPre=document.getElementById("SC_ID").value;}else{if(strNomMain=="CXPAGAR"){grid.hideCol("PR_ACTIVO");bolPreBodega=true;intBodegaPre=document.getElementById("SC_ID").value;}else{if(strNomMain=="VENTAS"||strNomMain=="PEDIDO"){grid.hideCol("SC_ID");grid.hideCol("PR_ACTIVO");grid.hideCol("PR_COSTOCOMPRA");grid.hideCol("PV_ID");bolPreBodega=true;intBodegaPre=document.getElementById("SC_ID").value;}else{if(strNomMain=="NCREDITO2"){grid.hideCol("SC_ID");grid.hideCol("PR_ACTIVO");grid.hideCol("PR_COSTOCOMPRA");grid.hideCol("PV_ID");bolPreBodega=true;intBodegaPre=document.getElementById("SC_ID").value;}else{if(strNomMain=="CON_INV"){grid.hideCol("SC_ID");grid.hideCol("PR_ACTIVO");grid.hideCol("PR_COSTOCOMPRA");grid.hideCol("PV_ID");bolPreBodega=true;ci=true;intBodegaPre=document.getElementById("CI_BODEGA").value;
}else{bolPreBodega=false;bolInactivo=true;}}}}}}}}if(bolPreBodega){_bolRefreshGridProds=false;if(_bodegaWorkProd==0){if(ci){_bodegaWorkProd=document.getElementById("CI_BODEGA").value;}else{_bodegaWorkProd=document.getElementById("SC_ID").value;}_bolRefreshGridProds=true;}else{var intBodegaActual;if(ci){intBodegaActual=document.getElementById("CI_BODEGA").value;}else{intBodegaActual=document.getElementById("SC_ID").value;}if(parseFloat(_bodegaWorkProd)!=parseFloat(intBodegaActual)){if(ci){_bodegaWorkProd=document.getElementById("CI_BODEGA").value;}else{_bodegaWorkProd=document.getElementById("SC_ID").value;}_bolRefreshGridProds=true;}}grid.setGridParam({url:"CIP_TablaOp.jsp?ID=5&opnOpt=PROD&_search=true&PR_ACTIVO=1&SC_ID="+intBodegaPre});if(_bolRefreshGridProds){setTimeout("jQuery('#PROD').trigger('reloadGrid',[{page:1}])",1000);}}else{if(!bolInactivo){grid.setGridParam({url:"CIP_TablaOp.jsp?ID=5&opnOpt=PROD&_search=true&PR_ACTIVO=1"});if(_bolRefreshGridProds){setTimeout("jQuery('#PROD').trigger('reloadGrid',[{page:1}])",1000);}}}}}}function CambioPrecio1(){var grid=jQuery("#PROD");if(grid.getGridParam("selrow")!=null){var lstRow=grid.getRowData(grid.getGridParam("selrow"));var a=confirm(lstMsg[157]);if(a){$("#dialogWait").dialog("open");var strPost="PR_ID="+lstRow.PR_ID;$.ajax({type:"POST",data:strPost,scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"html",url:"DamePrecio.do?id=5",success:function(datos){if(datos.substr(0,2)!="OK"){alert(datos);}else{alert(lstMsg[106]);}$("#dialogWait").dialog("close");},error:function(objeto,quepaso,otroobj){alert("Cambios de precios: "+objeto+" "+quepaso+" "+otroobj);$("#dialogWait").dialog("close");}});}}}function redondeoDolares(numero){var original=parseFloat(numero);if(original>=10&&original<=50){var result=Math.round(original*100)/100;var numeros=String(result).split(".");var entero=numeros[0];var decimal=0;try{decimal=numeros[1];}catch(err){alert("No pudimos obtener la parte decimal");}if(decimal==undefined){decimal=0;}if(parseFloat(decimal)<=24){decimal=0;}else{if(parseFloat(decimal)>=25&&parseFloat(decimal)<=74){decimal=50;}else{if(parseFloat(decimal)>=75){decimal=0;entero=parseFloat(entero)+1;}}}result=parseFloat(entero)+"."+parseFloat(decimal);}else{result="0";}if(original<10){result=original;}if(original>50){result=redondeoPesos(original);}return result;}function redondeoPesos(numero){var original=parseFloat(numero);if(numero!="0"){var result=Math.round(original*100)/100;var numeros=String(result).split(".");var entero=numeros[0];var decimal=0;try{decimal=numeros[1];}catch(err){}if(decimal==undefined){decimal=0;}if(parseFloat(decimal)<50){decimal=0;}else{if(parseFloat(decimal)>=51){decimal=0;entero=parseFloat(entero)+1;}}result=parseFloat(entero)+"."+parseFloat(decimal);}else{result="0";}return result;}function ActPrecCal(){var $costo_repo=document.getElementById("PR_COSTOREPOSICION").value;var $flete=document.getElementById("PR_FLETE").value;var $add_valores=document.getElementById("PR_VALORES").value;var $dta=document.getElementById("PR_DTA").value;var $manejo_aduanal=document.getElementById("PR_MADUANAL").value;var $descuento_prov=document.getElementById("PR_DPROVEEDOR").value;var $porc_utilidad=0;var intMonedaProv=0;var intMonedaVta=document.getElementById("PR_MONEDA_VTA").value;$("#dialogWait").dialog("open");$.ajax({type:"POST",data:"",scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"xml",url:"DamePrecio.do?id=6",success:function(datos){var lstXml=datos.getElementsByTagName("formulas")[0];var lstFormula=lstXml.getElementsByTagName("formula");var grid=jQuery("#GRID1");var arr=grid.getDataIDs();for(var i=0;i<lstFormula.length;i++){var obj=lstFormula[i];if(obj.getAttribute("sentencia")!=""){var _nvo_prec1=0;var strFormula="_nvo_prec1 = "+obj.getAttribute("sentencia");strFormula=replaceCaracterAll(strFormula,"$costo_repo",$costo_repo);strFormula=replaceCaracterAll(strFormula,"$flete",$flete);strFormula=replaceCaracterAll(strFormula,"$add_valores",$add_valores);strFormula=replaceCaracterAll(strFormula,"$dta",$dta);strFormula=replaceCaracterAll(strFormula,"$manejo_aduanal",$manejo_aduanal);strFormula=replaceCaracterAll(strFormula,"$descuento_prov",$descuento_prov);if(arr!=null){for(var y=0;y<arr.length;y++){var id=arr[y];var lstRowUp=grid.getRowData(id);var intLPrecios=0;if(isNaN(grid.getCell(id,3))){intLPrecios=grid.getCell(id,1);}else{intLPrecios=lstRowUp.LP_ID;}var $precioX=0;if(parseInt(intMonedaVta)==1){if(isNaN(grid.getCell(id,3))){$precioX=document.getElementById(id+"_PP_PRECIO").value;}else{$precioX=lstRowUp.PP_PRECIO;}}else{if(isNaN(grid.getCell(id,3))){$precioX=document.getElementById(id+"_PP_PRECIO_USD").value;}else{$precioX=lstRowUp.PP_PRECIO_USD;}}if(parseInt(obj.getAttribute("redondeo_calculo"))==1){if(parseInt(obj.getAttribute("redondeo"))==1){$precioX=redondeoDolares($precioX);}if(parseInt(obj.getAttribute("redondeo"))==2){$precioX=redondeoDolares($precioX);}}strFormula=replaceCaracterAll(strFormula,"$precio"+intLPrecios,$precioX);if(parseInt(intLPrecios)==parseInt(obj.getAttribute("lp_id"))){if(isNaN(grid.getCell(id,3))){$porc_utilidad=document.getElementById(id+"_PP_PUTILIDAD").value;}else{$porc_utilidad=lstRowUp.PP_PUTILIDAD;}}}}strFormula=replaceCaracterAll(strFormula,"$porc_utilidad",$porc_utilidad);try{strFormula=replaceCaracterAll(strFormula,"$camb_proov",document.getElementById("PR_TCAMBIO_PROV").value);eval(strFormula);if(arr!=null){for(var y=0;y<arr.length;y++){var id=arr[y];var lstRowUp=grid.getRowData(id);var intLPrecios=0;if(isNaN(grid.getCell(id,3))){intLPrecios=grid.getCell(id,1);}else{intLPrecios=lstRowUp.LP_ID;}if(parseInt(intLPrecios)==parseInt(obj.getAttribute("lp_id"))){if(parseInt(intLPrecios)==1){_nvo_prec1=_nvo_prec1*parseFloat(document.getElementById("PR_TCAMBIO_TDA").value);}else{_nvo_prec1=_nvo_prec1*parseFloat(document.getElementById("PR_TCAMBIO_PROV").value);}if(parseInt(intMonedaVta)==1||parseInt(obj.getAttribute("conversion"))==0){if(isNaN(grid.getCell(id,3))){document.getElementById(id+"_PP_PRECIO").value=_nvo_prec1;}else{lstRowUp.PP_PRECIO=_nvo_prec1;grid.setRowData(id,lstRowUp);}}else{if(isNaN(grid.getCell(id,3))){document.getElementById(id+"_PP_PRECIO_USD").value=_nvo_prec1;}else{lstRowUp.PP_PRECIO_USD=_nvo_prec1;grid.setRowData(id,lstRowUp);}}}}}}catch(error){alert("Error al ejecutar la formula para el calculo del precio:"+error);}}}for(var i=0;i<lstFormula.length;i++){var obj=lstFormula[i];if(obj.getAttribute("sentencia")!=""){for(var h=0;h<arr.length;h++){var id=arr[h];var lstRowUp=grid.getRowData(id);var intLPrecios=0;if(isNaN(grid.getCell(id,3))){intLPrecios=grid.getCell(id,1);}else{intLPrecios=lstRowUp.LP_ID;}if(parseInt(intLPrecios)==parseInt(obj.getAttribute("lp_id"))){if(parseInt(intMonedaVta)==1||parseInt(obj.getAttribute("conversion"))==0){if(isNaN(grid.getCell(id,3))){var dblXRedondear=document.getElementById(id+"_PP_PRECIO").value;if(parseInt(obj.getAttribute("redondeo"))==1){dblXRedondear=redondeoPesos(dblXRedondear);}if(parseInt(obj.getAttribute("redondeo"))==2){dblXRedondear=redondeoDolares(dblXRedondear);}document.getElementById(id+"_PP_PRECIO").value=dblXRedondear;document.getElementById(id+"_PP_PRECIO_USD").value=0;}else{var dblXRedondear=lstRowUp.PP_PRECIO;if(parseInt(obj.getAttribute("redondeo"))==1){dblXRedondear=redondeoPesos(dblXRedondear);}if(parseInt(obj.getAttribute("redondeo"))==2){dblXRedondear=redondeoDolares(dblXRedondear);}lstRowUp.PP_PRECIO=dblXRedondear;lstRowUp.PP_PRECIO_USD=0;grid.setRowData(id,lstRowUp);}}else{if(isNaN(grid.getCell(id,3))){var dblXRedondear=document.getElementById(id+"_PP_PRECIO_USD").value;if(parseInt(obj.getAttribute("redondeo"))==1){dblXRedondear=redondeoPesos(dblXRedondear);}if(parseInt(obj.getAttribute("redondeo"))==2){dblXRedondear=redondeoDolares(dblXRedondear);}document.getElementById(id+"_PP_PRECIO_USD").value=dblXRedondear;document.getElementById(id+"_PP_PRECIO").value=0;}else{var dblXRedondear=lstRowUp.PP_PRECIO_USD;
if(parseInt(obj.getAttribute("redondeo"))==1){dblXRedondear=redondeoPesos(dblXRedondear);}if(parseInt(obj.getAttribute("redondeo"))==2){dblXRedondear=redondeoDolares(dblXRedondear);}lstRowUp.PP_PRECIO_USD=dblXRedondear;lstRowUp.PP_PRECIO=0;grid.setRowData(id,lstRowUp);}}}}}}$("#dialogWait").dialog("close");},error:function(objeto,quepaso,otroobj){alert("Cambios de precios formulas: "+objeto+" "+quepaso+" "+otroobj);$("#dialogWait").dialog("close");}});_ActButtonsOP("bt_calc_prec2",true);_ActButtonsOP("bt_calc_prec3",true);}function _ActButtonsOP(strNombre,bolActivo){var boton=document.getElementById(strNombre);var clAct="fg-button ui-state-default ui-priority-primary ui-corner-all";var clNAct="fg-button ui-state-default ui-state-disabled ui-corner-all";if(bolActivo){boton.disabled=false;boton.className=clAct;}else{boton.disabled=true;boton.className=clNAct;}}function ActPrecSave(){EndPrecios(false);_ActButtonsOP("bt_calc_prec2",false);_ActButtonsOP("bt_calc_prec3",false);}function ActPrecCan(){jQuery("#GRID1").clearGridData();InitPrecios();_ActButtonsOP("bt_calc_prec2",false);_ActButtonsOP("bt_calc_prec3",false);}function replaceCaracterAll(a,b,c){do{a=a.replace(b,c);}while(a.indexOf(b)>=0);return a;}function UpFileEmp(strNomFile){ValidaClean(strNomFile);if(document.getElementById(strNomFile).value==""){ValidaShow(strNomFile,lstMsg[13]);return false;}var strExtencion=Right(document.getElementById(strNomFile).value.toUpperCase(),3);if(strExtencion=="PNG"||strExtencion=="JPG"){ajaxImageUpload(strNomFile,document.getElementById("PR_ID").value);return true;}else{ValidaShow(strNomFile,"Formato no valido solo: .png o .jpg");return false;}return true;}function ajaxImageUpload(strNomFile,intPR_ID){$("#dialogWait").dialog("open");$.ajaxFileUpload({url:"ERP_UPImageProductos.jsp?PR_ID="+intPR_ID,secureuri:false,fileElementId:strNomFile,dataType:"json",success:function(data,status){if(typeof(data.error)!="undefined"){if(data.error!=""){alert(data.error);}}$("#dialogWait").dialog("close");alert("Imagen guardada Correctamente!");var strNomFileX="/iCommerce/images/ecomm/"+GetNomFile(document.getElementById(strNomFile).value);if(strNomFile=="PR_IMSGEN1"){document.getElementById("PR_NOMIMG1").value=strNomFileX;}else{document.getElementById("PR_NOMIMG2").value=strNomFileX;}InitProdImg();},error:function(data,status,e){alert(e);$("#dialogWait").dialog("close");}});return false;}function InitProdImg(){if(document.getElementById("PR_NOMIMG1").value==""){document.getElementById("PR_IMG1").src="images/image_PNG.png";}else{ImgLoadProd(document.getElementById("PR_NOMIMG1").value,"PR_IMG1");}if(document.getElementById("PR_NOMIMG2").value==""){document.getElementById("PR_IMG2").src="images/image_PNG.png";}else{ImgLoadProd(document.getElementById("PR_NOMIMG2").value,"PR_IMG2");}}function ImgLoadProd(sSrc,strNomImg){var pathArray=document.URL.split("/");var newPathname="";for(i=0;i<pathArray.length-1;i++){newPathname+=pathArray[i]+"/";}newPathname+=sSrc;var oImg=new Image();oImg.onload=function(){document.getElementById(strNomImg).src=oImg.src;};oImg.onerror=function(){document.getElementById(strNomImg).src="images/image_PNG.png";};oImg.src=newPathname+"?time="+new Date();}function GetNomFile(strNom){var pathArray=strNom.split("/");var newPathname=pathArray[pathArray.length-1];return newPathname;}function _PreSelBodegas(){var objsel_SUC_LST=document.getElementById("sel_SUC_LST");if(objsel_SUC_LST!=null){objsel_SUC_LST.checked=true;PCheckSelTodo(objsel_SUC_LST,"SUC_LST");}}function EvalBodegasInit(){_IsExecuted=false;if(_IsExecuted){EvalCols();}}function OpenDialogGpoPreciosProd(){OpnOpt("GPO_MODP","grid","dialogCte",false,false);}function CloseDialogGpoPreciosProd(){$("#dialogCte").dialog("close");}function SelectGpoPreciosProd(PMP_ID,PMP_DESCRIPCION){var select=document.getElementById("PR_GPO_MODI_PREC");var boolExiste=false;for(var i=0;i<select.length;i++){if(select.options[i].value==PMP_ID){boolExiste=true;break;}}if(!boolExiste){select.options[select.length]=new Option(PMP_DESCRIPCION,PMP_ID,true,true);}document.getElementById("PR_GPO_MODI_PREC").value=PMP_ID;CloseDialogGpoPreciosProd();}function EvalColsMasters(){if(!_IsExecuted){var bolPreBodega=false;var bolInactivo=false;var ci=false;_IsExecuted=true;_bolRefreshGridProds=true;var intBodegaPre=0;var strNomMain=objMap.getNomMain();if(strNomMain=="PROD"){bolInactivo=true;intBodegaPre=intSucDefa;var grid=jQuery("#PROD");grid.setGridParam({url:"CIP_TablaOp.jsp?ID=5&opnOpt=PROD&PR_ACTIVO=999&PR_ECOMM=999&_search=true&SC_ID="+intBodegaPre});if(_bolRefreshGridProds){setTimeout("jQuery('#PROD').trigger('reloadGrid',[{page:1}])",1000);}}else{var grid=jQuery("#PROD");if(strNomMain=="INV"){grid.hideCol("PR_ACTIVO");bolPreBodega=true;intBodegaPre=document.getElementById("SC_ID").value;}else{if(strNomMain=="NCREDITO"){grid.hideCol("SC_ID");grid.hideCol("PR_ACTIVO");grid.hideCol("PR_COSTOCOMPRA");grid.hideCol("PV_ID");bolPreBodega=true;intBodegaPre=document.getElementById("SC_ID").value;}else{if(strNomMain=="COMPRAS"){grid.hideCol("PR_ACTIVO");bolPreBodega=true;intBodegaPre=document.getElementById("SC_ID").value;}else{if(strNomMain=="REG_COM"){grid.hideCol("PR_ACTIVO");bolPreBodega=true;intBodegaPre=document.getElementById("SC_ID").value;}else{if(strNomMain=="CXPAGAR"){grid.hideCol("PR_ACTIVO");bolPreBodega=true;intBodegaPre=document.getElementById("SC_ID").value;}else{if(strNomMain=="VENTAS"||strNomMain=="PEDIDO"){grid.hideCol("SC_ID");grid.hideCol("PR_ACTIVO");grid.hideCol("PR_COSTOCOMPRA");grid.hideCol("PV_ID");bolPreBodega=true;intBodegaPre=document.getElementById("SC_ID").value;}else{if(strNomMain=="NCREDITO2"){grid.hideCol("SC_ID");grid.hideCol("PR_ACTIVO");grid.hideCol("PR_COSTOCOMPRA");grid.hideCol("PV_ID");bolPreBodega=true;intBodegaPre=document.getElementById("SC_ID").value;}else{if(strNomMain=="CON_INV"){grid.hideCol("SC_ID");grid.hideCol("PR_ACTIVO");grid.hideCol("PR_COSTOCOMPRA");grid.hideCol("PV_ID");bolPreBodega=true;ci=true;intBodegaPre=document.getElementById("CI_BODEGA").value;}else{bolPreBodega=false;bolInactivo=true;}}}}}}}}if(bolPreBodega){_bolRefreshGridProds=false;if(_bodegaWorkProd==0){if(ci){_bodegaWorkProd=document.getElementById("CI_BODEGA").value;}else{_bodegaWorkProd=document.getElementById("SC_ID").value;}_bolRefreshGridProds=true;}else{var intBodegaActual;if(ci){intBodegaActual=document.getElementById("CI_BODEGA").value;}else{intBodegaActual=document.getElementById("SC_ID").value;}if(parseFloat(_bodegaWorkProd)!=parseFloat(intBodegaActual)){if(ci){_bodegaWorkProd=document.getElementById("CI_BODEGA").value;}else{_bodegaWorkProd=document.getElementById("SC_ID").value;}_bolRefreshGridProds=true;}}grid.setGridParam({url:"CIP_TablaOp.jsp?ID=5&opnOpt=PROD&_search=true&PR_ACTIVO=1&PR_ECOMM=999&SC_ID="+intBodegaPre});if(_bolRefreshGridProds){setTimeout("jQuery('#PROD').trigger('reloadGrid',[{page:1}])",1000);}}else{if(!bolInactivo){grid.setGridParam({url:"CIP_TablaOp.jsp?ID=5&opnOpt=PROD&_search=true&PR_ACTIVO=1&PR_ECOMM=999"});if(_bolRefreshGridProds){setTimeout("jQuery('#PROD').trigger('reloadGrid',[{page:1}])",1000);}}}}}}function EvalBodegasInitMasters(){_IsExecuted=false;if(_IsExecuted){EvalColsMasters();}}function EditfactSobreCosto(){var grid=jQuery("#GRDTAB6");var id=grid.getGridParam("selrow");var lstRow=grid.getRowData(id);if(grid.getGridParam("selrow")!=null){$("#dialog").dialog("option","title","Editar Factor de Sobrecosto");var div=document.getElementById("dialog");var dblFactorSobrecosto=lstRow.TXTFACSOBRTBL.replace(",","");var strHtml=CreaTexto("","dblEditFactSobr",dblFactorSobrecosto.replace(",",""),40,40,true,false,"","left",0,"","","",false,1);strHtml+=CreaBoton("","NOTASBTN",lstMsg[31],"EditfactSobreCosto2()","center",false,true,0);div.innerHTML=strHtml;$("#dialog").dialog("open");}else{alert("Selecciona un registro de la tabla");}}function EditfactSobreCosto2(){var grid=jQuery("#GRDTAB6");var id=grid.getGridParam("selrow");var lstRow=grid.getRowData(id);lstRow.TXTFACSOBRTBL=d.getElementById("dblEditFactSobr").value;
grid.setRowData(id,lstRow);var dblCostoReposicion=parseFloat(lstRow.TXTCOSTREPTBL);var dblFactorSobrecosto=parseFloat(lstRow.TXTFACSOBRTBL);var dblCantidad=lstRow.TXTCANTBL;var dblTotal=(dblCostoReposicion)*(dblFactorSobrecosto)*(dblCantidad);lstRow.TXTTOTALESTBL=dblTotal;grid.setRowData(id,lstRow);var dbltotalPaquete=0;var arr1=grid.getDataIDs();var dbltmpTotal=0;for(var i=0;i<arr1.length;i++){var id1=arr1[i];var lstRow1=grid.getRowData(id1);dbltmpTotal=parseFloat(lstRow1.TXTTOTALESTBL);dbltotalPaquete=dbltotalPaquete+dbltmpTotal;}jQuery(grid).footerData("set",{TXTCVETBL:"PRECIO SUGERIDO",TXTTOTALESTBL:dbltotalPaquete});document.getElementById("PR_TOTALGRID").value=dbltotalPaquete;document.getElementById("TXTTOTALEDIT").value=dbltotalPaquete;$("#dialog").dialog("close");}function AddPrecioSug(){$("#dialogWait").dialog("open");var grid=jQuery("#GRID1");var id=grid.getGridParam("selrow");var lstRow=grid.getRowData(id);var arr=grid.getDataIDs();var id=arr[0];var lstRow=grid.getRowData(id);lstRow.PP_PRECIO=d.getElementById("TXTTOTALEDIT").value;grid.setRowData(id,lstRow);alert("Se añadio el precio sugerido a la lista de precios ");$("#dialogWait").dialog("close");}function SearchDescripcionProd(){var intIdPR=document.getElementById("TXTCVETAB6").value;var intIdSc=document.getElementById("SC_ID").value;var strPOST="intIdPR="+intIdPR+"&intIdSc="+intIdSc;$.ajax({type:"POST",data:strPOST,scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"xml",url:"ERP_Producto.jsp?id=22",success:function(datos){var lstXml=datos.getElementsByTagName("Pr_Desc")[0];var lstprecio=lstXml.getElementsByTagName("Pr_Desc_deta");for(var i=0;i<lstprecio.length;i++){var obj=lstprecio[i];document.getElementById("TXTDESCTAB6").value=obj.getAttribute("intIdPR");}},error:function(objeto,quepaso,otroobj){alert(":pto9:"+objeto+" "+quepaso+" "+otroobj);$("#dialogWait").dialog("close");}});}function SearchClaveProd(){var intIdPR=document.getElementById("TXTDESCTAB6").value;var intIdSc=document.getElementById("SC_ID").value;var strPOST="intIdPR="+intIdPR+"&intIdSc="+intIdSc;$.ajax({type:"POST",data:strPOST,scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"xml",url:"ERP_Producto.jsp?id=23",success:function(datos){var lstXml=datos.getElementsByTagName("Pr_Cod")[0];var lstprecio=lstXml.getElementsByTagName("Pr_Cod_deta");for(var i=0;i<lstprecio.length;i++){var obj=lstprecio[i];document.getElementById("TXTCVETAB6").value=obj.getAttribute("intIdPR");}},error:function(objeto,quepaso,otroobj){alert(":pto9:"+objeto+" "+quepaso+" "+otroobj);$("#dialogWait").dialog("close");}});}