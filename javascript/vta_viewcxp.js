var bolAnularCxp=false;var bolSoyMainCxp=false;var bolActivarCxp=false;var bolEsPedimento=false;var bolCerrarCxp=false;var strNomMainCxp=false;var strNomFormViewcxp="";var strKeyViewcxp="";var strNomFormatPrintcxp="";var strTipoVtaViewcxp="";var strNomOrderViewcxp="";function vta_viewcxp(){}function InitViewVcxp(){try{}catch(err){}strNomMainCxp=objMap.getNomMain();if(strNomMainCxp=="CXP_VIEW"){bolSoyMainCxp=true;}else{if(strNomMainCxp=="PEDI_MTO"){bolEsPedimento=true;}}if(bolEsPedimento){ActivaButtonscxp(false,true,false,true,true,false,false);}else{ActivaButtonscxp(false,false,false,!bolSoyMainCxp,false,false,false);}$("#dialogWait").dialog("open");$.ajax({type:"POST",data:"keys=98,460",scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"xml",url:"Acceso.do",success:function(datos){var objsc=datos.getElementsByTagName("Access")[0];var lstKeys=objsc.getElementsByTagName("key");for(i=0;i<lstKeys.length;i++){var obj=lstKeys[i];if(obj.getAttribute("id")==98&&obj.getAttribute("enabled")=="true"){bolAnularCxp=true;}if(obj.getAttribute("id")==460&&obj.getAttribute("enabled")=="true"){bolActivarCxp=true;}}$("#dialogWait").dialog("close");},error:function(objeto,quepaso,otroobj){alert(":pto:"+objeto+" "+quepaso+" "+otroobj);}});}function ViewDocxp(){bolSoyMaincxp=false;strNomMaincxp=objMap.getNomMain();if(strNomMaincxp=="CXP_VIEW"){bolSoyMaincxp=true;}var bolPasa=true;ValidaClean("CPX_TIPO");if(document.getElementById("CPX_TIPO").value==""||document.getElementById("CPX_TIPO").value=="0"){ValidaShow("CPX_TIPO","NECESITA SELECCIONAR EL TIPO DE VENTA");bolPasa=false;}if(bolPasa){if(bolEsPedimento){ActivaButtonscxp(false,true,false,true,true,false,false);}else{ActivaButtonscxp(bolAnularCxp,true,true,!bolSoyMaincxp,false,bolActivarCxp,true);}var strPrefijoMasterCXP="CXP";strNomOrderViewcxp="CXP_ID";strNomFormViewcxp="CTSVIEW";strKeyViewcxp="CXP_ID";strNomFormatPrintcxp="CXP";var strParams="&"+strPrefijoMasterCXP+"_ANULADO=999";strParams+="&"+strPrefijoMasterCXP+"_ESRECU=999";strParams+="&"+strPrefijoMasterCXP+"_ESRECU=999";if(document.getElementById("CXP_AUTORIZA1").checked){strParams+="&"+strPrefijoMasterCXP+"_AUTORIZA=1";}else{strParams+="&"+strPrefijoMasterCXP+"_AUTORIZA=0";}var strFecha1=document.getElementById("CPX_FECHA1").value;var strFecha2=document.getElementById("CPX_FECHA2").value;var strId=document.getElementById("CPX_ID").value;if(strId!="0"&&strId!=""){strParams+="&"+strKeyViewcxp+"="+strId+"";}else{if(strFecha1!=""&&strFecha2!=""){strParams+="&"+strPrefijoMasterCXP+"_FECHA1="+strFecha1+"&"+strPrefijoMasterCXP+"_FECHA2="+strFecha2+"";}if(document.getElementById("CPX_SUCURSAL").value!="0"){strParams+="&SC_ID="+document.getElementById("CPX_SUCURSAL").value+"";}if(document.getElementById("CPX_CLIENTE").value!="0"){strParams+="&PV_ID="+document.getElementById("CPX_CLIENTE").value+"";}if(document.getElementById("CPX_FOLIO").value!=""){strParams+="&"+strPrefijoMasterCXP+"_FOLIO="+document.getElementById("CPX_FOLIO").value+"";}if(document.getElementById("CPX_EMP").value!="0"){strParams+="&EMP_ID="+document.getElementById("CPX_EMP").value+"";}}var grid=jQuery("#CPX_GRID1");grid.setGridParam({url:"CIP_TablaOp.jsp?ID=5&opnOpt="+strNomFormViewcxp+"&_search=true"+strParams});grid.setGridParam({sortname:strNomOrderViewcxp}).trigger("reloadGrid");}}function ValidaCleancxp(strNomField){var objDivErr=document.getElementById("err_"+strNomField);if(objDivErr!=null){objDivErr.innerHTML="";objDivErr.setAttribute("class","");objDivErr.setAttribute("className","");}}function ValidaShowcxp(strNomField,strMsg){var objDivErr=document.getElementById("err_"+strNomField);objDivErr.setAttribute("class","");objDivErr.setAttribute("class","inError");objDivErr.setAttribute("className","inError");objDivErr.innerHTML="<img src='images/layout/report3_del.gif' border='0'>&nbsp;"+strMsg;}function CXPViewPrint(){var grid=jQuery("#CPX_GRID1");if(grid.getGridParam("selrow")!=null){var lstRow=grid.getRowData(grid.getGridParam("selrow"));var strHtml=CreaHidden("CXP_ID",lstRow.CXP_ID);openFormat("CUENTAXPAGAR","PDF",strHtml);}}function CXPViewAnul(){var grid=jQuery("#CPX_GRID1");if(grid.getGridParam("selrow")!=null&&bolAnularCxp){document.getElementById("SioNO_inside").innerHTML="";$("#SioNO").dialog("open");$("#SioNO").dialog("option","title",lstMsg[46]);document.getElementById("btnSI").onclick=function(){$("#SioNO").dialog("close");CXPViewAnulDo();};document.getElementById("btnNO").onclick=function(){$("#SioNO").dialog("close");};}}function CXPViewAnulDo(){var grid=jQuery("#CPX_GRID1");if(grid.getGridParam("selrow")!=null){$("#dialogWait").dialog("open");var lstRow=grid.getRowData(grid.getGridParam("selrow"));$.ajax({type:"POST",data:encodeURI("CXP_ID="+lstRow.CXP_ID),scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"html",url:"CXPMov.do?id=2",success:function(dato){dato=trim(dato);if(dato!="OK"){alert(dato);}grid.setGridParam({sortname:strNomOrderViewcxp}).trigger("reloadGrid");$("#dialogWait").dialog("close");},error:function(objeto,quepaso,otroobj){alert(":CTX 9:"+objeto+" "+quepaso+" "+otroobj);$("#dialogWait").dialog("close");}});}}function resetGridViewcxp(){var grid=jQuery("#VIEW_GRID1");grid.clearGridData();}function CXPViewSalir(){strNomMain=objMap.getNomMain();if(strNomMain!="VTAS_VIEW"){$("#dialogView").dialog("close");}}function CXPViewEdit(){strNomMain=objMap.getNomMain();var grid=jQuery("#CPX_GRID1");var idSel=grid.getGridParam("selrow");if(idSel!=null){var lstRow=grid.getRowData(idSel);if(lstRow.CXP_ANULADO=="NO"){if(strNomMain=="CXPAGAR"){GetCXPModi(idSel);}else{if(strNomMain=="SERVICIOS"){}}}}}function ActivaButtonscxp(bolAnular,bolPrint,bolRecurr,bolExit,bolPedimento,bolAutoriza,bolRepositorio){if(bolAnular){document.getElementById("vv_btnCancel").style.display="block";}else{document.getElementById("vv_btnCancel").style.display="none";}if(bolPrint){document.getElementById("vv_btnPrint").style.display="block";}else{document.getElementById("vv_btnPrint").style.display="none";}if(bolRecurr){document.getElementById("vv_btnrecycle").style.display="block";}else{document.getElementById("vv_btnrecycle").style.display="none";}if(bolExit){document.getElementById("vv_btnExit").style.display="block";}else{document.getElementById("vv_btnExit").style.display="none";}if(bolPedimento){document.getElementById("vv_btnSelCXP").style.display="block";}else{document.getElementById("vv_btnSelCXP").style.display="none";}if(bolAutoriza){document.getElementById("bt_CXP_AUT").style.display="block";}else{document.getElementById("bt_CXP_AUT").style.display="none";}if(bolRepositorio){document.getElementById("btrepoCXPPdf").style.display="block";}else{document.getElementById("btrepoCXPPdf").style.display="none";}}function OpnDiagCtecxp(){if(typeof bolUsaOpnProv!="undefined"){if(bolUsaOpnProv!=null){bolUsaOpnProv=false;}}OpnOpt("PROVEEDOR","grid","dialogProv",false,false);}function CXPAutoriza(){var grid=jQuery("#CPX_GRID1");if(grid.getGridParam("selrow")!=null&&bolActivarCxp){document.getElementById("SioNO_inside").innerHTML="";$("#SioNO").dialog("open");$("#SioNO").dialog("option","title",lstMsg[65]);document.getElementById("btnSI").onclick=function(){$("#SioNO").dialog("close");CXPAutorizaDo();};document.getElementById("btnNO").onclick=function(){$("#SioNO").dialog("close");};}}function CXPAutorizaDo(){var grid=jQuery("#CPX_GRID1");if(grid.getGridParam("selrow")!=null){$("#dialogWait").dialog("open");var lstRow=grid.getRowData(grid.getGridParam("selrow"));$.ajax({type:"POST",data:encodeURI("CXP_ID="+lstRow.CXP_ID),scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"html",url:"CXPMov.do?id=11",success:function(dato){dato=trim(dato);if(dato!="OK"){alert(dato);}grid.setGridParam({sortname:strNomOrderViewcxp}).trigger("reloadGrid");$("#dialogWait").dialog("close");},error:function(objeto,quepaso,otroobj){alert(":CXP Auto:"+objeto+" "+quepaso+" "+otroobj);
$("#dialogWait").dialog("close");}});}}function dblClickCXP(id){var strNomMain=objMap.getNomMain();var grid=jQuery("#CPX_GRID1");var lstVal=grid.getRowData(id);if(strNomMain=="NCREDITO2"||strNomMain=="NOTA_SRV2"){document.getElementById("FAC_IDNC").value=lstVal.CXP_ID;if(strNomMain=="NCREDITO2"){getDetaDevolucionesCXP("_fac");}else{getDetaDevolucionesServCXP("_fac");}}$("#dialogCte").dialog("close");}function CXPRepocitorio(){var grid=jQuery("#CPX_GRID1");if(grid.getGridParam("selrow")!=null){var objScreenRepo=objMap.getScreen("CPR_VIEW");if(objScreenRepo!=null){objScreenRepo.bolActivo=false;objScreenRepo.bolMain=false;objScreenRepo.bolInit=false;objScreenRepo.idOperAct=0;OpnOpt("CPR_VIEW","_ed","dialogProv",false,false,true);setTimeout("UpdateCXPDocs();",1500);}else{OpnOpt("CPR_VIEW","_ed","dialogProv",false,false,true);setTimeout("UpdateCXPDocs();",1500);}}}function CXPEliminaArchivo(){var grid=jQuery("#CPR_GRID");if(grid.getGridParam("selrow")!=null){var lstRow=grid.getRowData(grid.getGridParam("selrow"));var strCPR_ID=lstRow.CPR_ID;var strPOST="CPR_ID="+strCPR_ID;$("#dialogWait").dialog("open");$.ajax({type:"POST",data:encodeURI(strPOST),scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"html",url:"ERP_CuentasXPagarDocu.jsp?id=2",success:function(dato){dato=trim(dato);if(Left(dato,2)=="OK"){alert("Se ha quitado exitosamente");UpdateCXPDocs();}else{alert(dato);}$("#dialogWait").dialog("close");},error:function(objeto,quepaso,otroobj){alert(":CXP Pedi Doc. Delete:"+objeto+" "+quepaso+" "+otroobj);$("#dialogWait").dialog("close");}});}}function CXPSubirArchivo(){$("#dialogWait").dialog("open");var File=document.getElementById("CPR_FILE");var grid=jQuery("#CPX_GRID1");var lstRow=grid.getRowData(grid.getGridParam("selrow"));var strPOST="?CXP_ID="+lstRow.CXP_ID;if(File.value==""){alert("Requiere seleccionar un archivo");File.focus();$("#dialogWait").dialog("close");}else{if(Right(File.value.toUpperCase(),3)=="PDF"||Right(File.value.toUpperCase(),3)=="XML"){$.ajaxFileUpload({url:"ERP_UPFILECuentasXPagar.jsp"+strPOST,secureuri:false,fileElementId:"CPR_FILE",dataType:"json",success:function(data,status){if(typeof(data.error)!="undefined"){if(data.error!=""){alert(data.error);}else{alert("Archivo guardado Correctamente!");}}else{alert("Archivo guardado Correctamente!");}$("#dialogWait").dialog("close");UpdateCXPDocs();},error:function(data,status,e){alert(e);$("#dialogWait").dialog("close");}});}else{alert("Se aceptan archivos con extensi��n pdf");$("#dialogWait").dialog("close");File.focus();}}}function CXPCancelarArchivo(){$("#dialogProv").dialog("close");}function UpdateCXPDocs(){var grid=jQuery("#CPR_GRID");var grid2=jQuery("#CPX_GRID1");var lstRow=grid2.getRowData(grid2.getGridParam("selrow"));grid.setGridParam({url:"CIP_TablaOp.jsp?ID=5&opnOpt=CPR_GRID&_search=true&CXP_ID="+lstRow.CXP_ID,datatype:"xml"}).trigger("reloadGrid");}function CXPAbrirArchivo(){var grid=jQuery("#CPR_GRID");if(grid.getGridParam("selrow")!=null){var lstRow=grid.getRowData(grid.getGridParam("selrow"));var strPOST="CPR_ID="+lstRow.CPR_ID;$.ajax({type:"POST",data:encodeURI(strPOST),scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"html",url:"ERP_CuentasXPagarDocu.jsp?id=1",success:function(dato){Abrir_Link("document/CuentasXPagar/"+dato,"_new",200,200,0,0);},error:function(objeto,quepaso,otroobj){alert(":Carga Archivo:"+objeto+" "+quepaso+" "+otroobj);}});}}