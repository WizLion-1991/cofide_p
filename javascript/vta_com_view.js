var bolAnularOdc=false;var bolActivarOdc=false;var bolImprimirSinAutorizarOdc=false;var bolSoyMainOdc=false;var strNomMainOdc=false;var strNomFormViewOdc="";var strKeyViewOdc="";var strTipoVtaViewOdc="";var strNomOrderViewOdc="";function vta_com_view(){}function InitRegCompras(){document.getElementById("btn1").parentNode.setAttribute("class","Oculto");strNomMainOdc=objMap.getNomMain();if(strNomMainOdc=="COM_VIEW"){bolSoyMainOdc=true;}ActivaButtonsOdc(false,false,false,!bolSoyMainOdc,false,false);$("#dialogWait").dialog("open");$.ajax({type:"POST",data:"keys=149,150,451",scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"xml",url:"Acceso.do",success:function(datos){var objsc=datos.getElementsByTagName("Access")[0];var lstKeys=objsc.getElementsByTagName("key");for(i=0;i<lstKeys.length;i++){var obj=lstKeys[i];if(obj.getAttribute("id")==149&&obj.getAttribute("enabled")=="true"){bolAnularOdc=true;}if(obj.getAttribute("id")==150&&obj.getAttribute("enabled")=="true"){bolActivarOdc=true;}if(obj.getAttribute("id")==451&&obj.getAttribute("enabled")=="true"){bolImprimirSinAutorizarOdc=true;}}$("#dialogWait").dialog("close");},error:function(objeto,quepaso,otroobj){alert(":vta_com_view:"+objeto+" "+quepaso+" "+otroobj);}});}function OpnDiagProvCompReg(){OpnOpt("PROVEEDOR","grid","dialogProv",false,false);}function ViewDoOdc(){bolSoyMainOdc=false;strNomMainOdc=objMap.getNomMain();if(strNomMainOdc=="COM_VIEW"){bolSoyMainOdc=true;}var bolPasa=true;if(bolPasa){ActivaButtonsOdc(bolAnularOdc,true,!bolSoyMainOdc,!bolSoyMainOdc,bolActivarOdc,false);var strPrefijoMasterOdc="COM";strNomOrderViewOdc="COM_ID";strNomFormViewOdc="COMVIEWDO";strKeyViewOdc="COM_ID";var strParams="&"+strPrefijoMasterOdc+"_ANULADO=999";strParams+="&"+strPrefijoMasterOdc+"_ESRECU=999";var strFecha1=document.getElementById("VIEWC_FECHA1").value;var strFecha2=document.getElementById("VIEWC_FECHA2").value;var strId=document.getElementById("VIEWC_ID").value;if(strId!="0"&&strId!=""){strParams+="&"+strKeyViewOdc+"="+strId+"";}else{if(strFecha1!=""&&strFecha2!=""){strParams+="&"+strPrefijoMasterOdc+"_FECHA1="+strFecha1+"&"+strPrefijoMasterOdc+"_FECHA2="+strFecha2+"";}if(document.getElementById("VIEWC_SUCURSAL").value!="0"){strParams+="&SC_ID="+document.getElementById("VIEWC_SUCURSAL").value+"";}if(document.getElementById("VIEWC_PV_ID").value!="0"){strParams+="&PV_ID="+document.getElementById("VIEWC_PV_ID").value+"";}if(document.getElementById("VIEWC_FOLIO").value!=""){strParams+="&"+strPrefijoMasterOdc+"_FOLIO="+document.getElementById("VIEWC_FOLIO").value+"";}if(document.getElementById("VIEWC_EMP").value!="0"){strParams+="&EMP_ID="+document.getElementById("VIEWC_EMP").value+"";}var strLstCampos="";for(var i=0;i<document.getElementsByName("sel_campos").length;i++){if(document.getElementById("sel_campos"+i).checked){strLstCampos+=document.getElementById("sel_campos"+i).value+",";}}strParams+="&COM_STATUS="+strLstCampos;}var grid=jQuery("#VIEWC_GRID1");grid.setGridParam({url:"CIP_TablaOp.jsp?ID=5&opnOpt="+strNomFormViewOdc+"&_search=true"+strParams});grid.setGridParam({sortname:strNomOrderViewOdc}).trigger("reloadGrid");}}function ValidaCleanOdc(strNomField){var objDivErr=document.getElementById("err_"+strNomField);if(objDivErr!=null){objDivErr.innerHTML="";objDivErr.setAttribute("class","");objDivErr.setAttribute("className","");}}function ValidaShowOdc(strNomField,strMsg){var objDivErr=document.getElementById("err_"+strNomField);objDivErr.setAttribute("class","");objDivErr.setAttribute("class","inError");objDivErr.setAttribute("className","inError");objDivErr.innerHTML="<img src='images/layout/report3_del.gif' border='0'>&nbsp;"+strMsg;}function OdcViewPrint(){var grid=jQuery("#VIEWC_GRID1");if(grid.getGridParam("selrow")!=null){var lstRow=grid.getRowData(grid.getGridParam("selrow"));if(lstRow.COM_AUTORIZA=="SI"||bolImprimirSinAutorizarOdc){var strHtml=CreaHidden("COM_ID",lstRow.COM_ID);openFormat("COMPRAS","PDF",strHtml);}else{alert(lstMsg[93]);}}}function OdcViewAnul(){var grid=jQuery("#VIEWC_GRID1");if(grid.getGridParam("selrow")!=null&&bolAnularOdc){document.getElementById("SioNO_inside").innerHTML="";$("#SioNO").dialog("open");$("#SioNO").dialog("option","title",lstMsg[46]);document.getElementById("btnSI").onclick=function(){$("#SioNO").dialog("close");OdcViewAnulDo();};document.getElementById("btnNO").onclick=function(){$("#SioNO").dialog("close");};}}function OdcViewAnulDo(){var grid=jQuery("#VIEWC_GRID1");if(grid.getGridParam("selrow")!=null){$("#dialogWait").dialog("open");var lstRow=grid.getRowData(grid.getGridParam("selrow"));$.ajax({type:"POST",data:encodeURI("COM_ID="+lstRow.COM_ID),scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"html",url:"ODCMov.do?id=2",success:function(dato){dato=trim(dato);if(dato!="OK"){alert(dato);}grid.setGridParam({sortname:strNomOrderViewOdc}).trigger("reloadGrid");$("#dialogWait").dialog("close");},error:function(objeto,quepaso,otroobj){alert(":ODC Anul:"+objeto+" "+quepaso+" "+otroobj);$("#dialogWait").dialog("close");}});}}function resetGridViewOdc(){var grid=jQuery("#VIEW_GRID1");grid.clearGridData();}function OdcViewSalir(){strNomMain=objMap.getNomMain();if(strNomMain!="COM_VIEW"){$("#dialogView").dialog("close");}}function OdcViewEdit(){strNomMain=objMap.getNomMain();var grid=jQuery("#VIEWC_GRID1");var idSel=grid.getGridParam("selrow");if(idSel!=null){var lstRow=grid.getRowData(idSel);if(lstRow.COM_ANULADA=="NO"){if(strNomMain=="COMPRAS"){GetODCModi(idSel);}else{alert(lstMsg[66]);}}}}function OdcViewAutoriza(){var grid=jQuery("#VIEWC_GRID1");if(grid.getGridParam("selrow")!=null&&bolActivarOdc){document.getElementById("SioNO_inside").innerHTML="";$("#SioNO").dialog("open");$("#SioNO").dialog("option","title",lstMsg[65]);document.getElementById("btnSI").onclick=function(){$("#SioNO").dialog("close");OdcViewAutorizaDo();};document.getElementById("btnNO").onclick=function(){$("#SioNO").dialog("close");};}}function OdcViewAutorizaDo(){var grid=jQuery("#VIEWC_GRID1");if(grid.getGridParam("selrow")!=null){$("#dialogWait").dialog("open");var lstRow=grid.getRowData(grid.getGridParam("selrow"));$.ajax({type:"POST",data:encodeURI("COM_ID="+lstRow.COM_ID),scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"html",url:"ODCMov.do?id=3",success:function(dato){dato=trim(dato);if(dato!="OK"){alert(dato);}grid.setGridParam({sortname:strNomOrderViewOdc}).trigger("reloadGrid");$("#dialogWait").dialog("close");},error:function(objeto,quepaso,otroobj){alert(":ODC Anul:"+objeto+" "+quepaso+" "+otroobj);$("#dialogWait").dialog("close");}});}}function ActivaButtonsOdc(bolAnular,bolPrint,bolEdit,bolExit,bolAutorizar,bolMail){if(bolAnular){document.getElementById("bt_ODCV2").style.display="block";}else{document.getElementById("bt_ODCV2").style.display="none";}if(bolPrint){document.getElementById("bt_ODCV1").style.display="block";}else{document.getElementById("bt_ODCV1").style.display="none";}if(bolEdit){document.getElementById("bt_ODCV3").style.display="block";}else{document.getElementById("bt_ODCV3").style.display="none";}if(bolAutorizar){document.getElementById("bt_ODCV4").style.display="block";}else{document.getElementById("bt_ODCV4").style.display="none";}if(bolExit){document.getElementById("bt_ODCV5").style.display="block";}else{document.getElementById("bt_ODCV5").style.display="none";}if(bolMail){document.getElementById("bt_ODCV6").style.display="block";}else{document.getElementById("bt_ODCV6").style.display="none";}if(bolPrint){document.getElementById("bt_ODCIT").style.display="block";}else{document.getElementById("bt_ODCIT").style.display="none";}}function OdcViewClose(){var grid=jQuery("#VIEWC_GRID1");if(grid.getGridParam("selrow")!=null){$("#dialogWait").dialog("open");var lstRow=grid.getRowData(grid.getGridParam("selrow"));$.ajax({type:"POST",data:encodeURI("COM_ID="+lstRow.COM_ID),scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"html",url:"ODCMov.do?id=12",success:function(dato){dato=trim(dato);
if(dato!="OK"){alert(dato);}grid.setGridParam({sortname:strNomOrderViewOdc}).trigger("reloadGrid");$("#dialogWait").dialog("close");},error:function(objeto,quepaso,otroobj){alert(":ODC Close:"+objeto+" "+quepaso+" "+otroobj);$("#dialogWait").dialog("close");}});}}function OdcViewETPrint(){OpnOpt("IMP_ETOC","_ed","dialogProv",false,false,true);}function OdcViewETPrintAceptar(){var grid=jQuery("#VIEWC_GRID1");if(grid.getGridParam("selrow")!=null){var lstRow=grid.getRowData(grid.getGridParam("selrow"));var strEtiqueta=document.getElementById("ETOC_ETIQUETA").value;var strOC=lstRow.COM_ID;var strPOST="&COM_ID="+strOC;strPOST+="&ET_ID="+strEtiqueta;$("#dialogWait").dialog("open");Abrir_Link("ERP_com_recep.jsp?id=4"+strPOST,"_new",200,200,0,0);$("#dialogWait").dialog("close");}}function OdcViewETPrintCancelar(){$("#dialogProv").dialog("close");}