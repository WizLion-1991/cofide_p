var bolSoyMainFacPedi=false;var strNomMainFacPedi=false;var strNomFormViewFacPedi="";var strKeyViewFacPedi="";var strTipoVtaViewFacPedi="";var strNomOrderViewMerc="";var bolCambioFechaFacPedi=false;var dblTasaVtaFP1=dblTasa1;var dblTasaVtaFP2=dblTasa2;var dblTasaVtaFP3=dblTasa3;var intIdTasaVtaFP1=intIdTasa1;var intIdTasaVtaFP2=intIdTasa2;var intIdTasaVtaFP3=intIdTasa3;var intSImpVtaFP1_2=intSImp1_2;var intSImpVtaFP1_3=intSImp1_3;var intSImpVtaFP2_3=intSImp2_3;var intCT_TIPOPERSFP=0;var intCT_TIPOFACFP=0;var strCT_USOIMBUEBLEFP="";var intRET_ISRFP=0;var intRET_IVAFP=0;var intRET_FLETEFP=1;var strNomTabsScFP="#tabsPED_FACT5";function vta_fac_ped(){}function InitFacPedido(){document.getElementById("btn1").parentNode.setAttribute("class","Oculto");strNomMainFacPedi=objMap.getNomMain();if(strNomMainFacPedi=="PED_FACT5"||strNomMainFacPedi=="PED_FACT7"){bolSoyMainFacPedi=true;}if(strNomMainFacPedi=="PED_FACT7"){strNomTabsScFP="#tabsPED_FACT7";}if(bolSoyMainFacPedi){myLayout.close("west");myLayout.close("east");myLayout.close("south");myLayout.close("north");}var strHtml="<ul>"+getMenuItem("CallbtnFacPedi1();",lstMsg[128],"images/ptovta/CircleSave.png")+getMenuItem("CallbtnFacPedi3();",lstMsg[129],"images/ptovta/VisQty.png")+getMenuItem("CallbtnFacPedi4();",lstMsg[130],"images/ptovta/VisModi.png")+getMenuItem("CallbtnFacPedi2();",lstMsg[131],"images/ptovta/exitBig.png")+"</ul>";document.getElementById("TOOLBARCOM").innerHTML=strHtml;FacPediFormStyle();FacPediSelRegDefa();ActivaButtonsFacPedi(false,false);$(strNomTabsScFP).tabs("disable",1);$("#dialogWait").dialog("open");$.ajax({type:"POST",data:"keys=69,171",scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"xml",url:"Acceso.do",success:function(datos){var objsc=datos.getElementsByTagName("Access")[0];var lstKeys=objsc.getElementsByTagName("key");for(i=0;i<lstKeys.length;i++){var obj=lstKeys[i];if(obj.getAttribute("id")==69&&obj.getAttribute("enabled")=="true"){bolCambioFechaFacPedi=true;}}if(bolCambioFechaFacPedi){if($("#PD_FECHA").datepicker("isDisabled")){$("#PD_FECHA").datepicker("enable");}var objFecha=document.getElementById("PD_FECHA");objFecha.setAttribute("class","outEdit");objFecha.setAttribute("className","outEdit");objFecha.readOnly=false;}else{$("#PD_FECHA").datepicker("disable");}$("#dialogWait").dialog("close");setTimeout("ViewDoFacPedi();",3000);},error:function(objeto,quepaso,otroobj){alert(":Fact  Pedido:"+objeto+" "+quepaso+" "+otroobj);}});document.getElementById("btnSI").onclick=function(){FacPediConfirmaSI();};document.getElementById("btnNO").onclick=function(){FacPediConfirmaNO();};}function ViewDoFacPedi(){bolSoyMainFacPedi=false;strNomMainFacPedi=objMap.getNomMain();if(strNomMainFacPedi=="PED_FACT5"||strNomMainFacPedi=="PED_FACT7"){bolSoyMainFacPedi=true;}var bolPasa=true;if(bolPasa){ActivaButtonsFacPedi(true,true);var strPrefijoMasterOdc="PD";strNomOrderViewMerc="PD_ID";strNomFormViewFacPedi="PEDIFAC";if(strNomMainFacPedi=="PED_FACT7"){strNomFormViewFacPedi="PEDIFAC7";}strKeyViewFacPedi="PD_ID";var strParams="&"+strPrefijoMasterOdc+"_ANULADO=999";var strFecha1=document.getElementById("VIEWC_FECHA1").value;var strFecha2=document.getElementById("VIEWC_FECHA2").value;var strId=document.getElementById("VIEWC_ID").value;if(strId!="0"&&strId!=""){strParams+="&"+strKeyViewFacPedi+"="+strId+"";}else{if(strFecha1!=""&&strFecha2!=""){strParams+="&"+strPrefijoMasterOdc+"_FECHA1="+strFecha1+"&"+strPrefijoMasterOdc+"_FECHA2="+strFecha2+"";}if(document.getElementById("VIEWC_SUCURSAL").value!="0"){strParams+="&SC_ID="+document.getElementById("VIEWC_SUCURSAL").value+"";}if(document.getElementById("VIEWC_CT_ID").value!="0"){strParams+="&PV_ID="+document.getElementById("VIEWC_CT_ID").value+"";}if(document.getElementById("VIEWC_FOLIO").value!=""){strParams+="&"+strPrefijoMasterOdc+"_FOLIO="+document.getElementById("VIEWC_FOLIO").value+"";}if(document.getElementById("VIEWC_EMP").value!="0"){strParams+="&EMP_ID="+document.getElementById("VIEWC_EMP").value+"";}}var grid=jQuery("#VIEWC_GRID1");grid.setGridParam({url:"CIP_TablaOp.jsp?ID=5&opnOpt="+strNomFormViewFacPedi+"&_search=true"+strParams});grid.setGridParam({sortname:strNomOrderViewMerc}).trigger("reloadGrid");}}function resetGridViewFacPedi(){var grid=jQuery("#VIEW_GRID1");grid.clearGridData();}function ActivaButtonsFacPedi(bolSurte,bolPrint){if(bolSurte){document.getElementById("bt_FacPediV2").style.display="block";}else{document.getElementById("bt_FacPediV2").style.display="none";}if(bolPrint){document.getElementById("bt_FacPediV1").style.display="block";}else{document.getElementById("bt_FacPediV1").style.display="none";}}function FacPediPrint(){var grid=jQuery("#VIEWC_GRID1");if(grid.getGridParam("selrow")!=null){var lstRow=grid.getRowData(grid.getGridParam("selrow"));var strHtml=CreaHidden("PD_ID",lstRow.PD_ID);openFormat("PEDIDO","PDF",strHtml,lstRow.PD_FOLIO);}}function FacPedi(){var grid=jQuery("#VIEWC_GRID1");var arr=grid.getGridParam("selarrrow");if(arr.length!=0){var strItems="";for(var i=0;i<arr.length;i++){var id=arr[i];var lstRow=grid.getRowData(id);strItems+=lstRow.PD_ID+",";}strItems=strItems.substr(0,strItems.length-1);var grid2=jQuery("#PD_GRID");grid2.clearGridData();$.ajax({type:"POST",data:"PD_ID="+strItems,scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"xml",url:"VtasMov.do?id=8",success:function(datos){var lstpedidos=datos.getElementsByTagName("vta_pedido");var intCte=0;var bolCumpleCte=true;var bolCumpleEstatus=true;var bolCumpleAnulado=true;for(var l=0;l<lstpedidos.length;l++){var objPedido=lstpedidos[l];if(l==0){intCte=objPedido.getAttribute("CT_ID");}if(intCte!=objPedido.getAttribute("CT_ID")){bolCumpleCte=false;alert(lstMsg[154]);}if(objPedido.getAttribute("PD_ANULADA")!=0){bolCumpleAnulado=false;alert(lstMsg[51]+" "+objPedido.getAttribute("PD_FOLIO"));}if(objPedido.getAttribute("PD_STATUS")!=2&&objPedido.getAttribute("PD_STATUS")!=3&&objPedido.getAttribute("PD_STATUS")!=9){bolCumpleEstatus=false;alert(lstMsg[124]);}}if(bolCumpleCte&&bolCumpleAnulado&&bolCumpleEstatus){$(strNomTabsScFP).tabs("enable",1);$(strNomTabsScFP).tabs("option","active",1);document.getElementById("FPD_ID").value=strItems;DrawFacPedi(lstpedidos);$("#dialogView").dialog("close");}},error:function(objeto,quepaso,otroobj){alert(":surtido 1:"+objeto+" "+quepaso+" "+otroobj);$("#dialogWait").dialog("close");}});}}function DrawFacPedi(lstpedidos){$("#dialogWait").dialog("open");var strLstPediId="";var lstPediFolios="";for(var l=0;l<lstpedidos.length;l++){var objPedido=lstpedidos[l];lstPediFolios+=objPedido.getAttribute("PD_FOLIO")+",";strLstPediId+=objPedido.getAttribute("PD_ID")+",";}document.getElementById("PD_ID").value=strLstPediId;document.getElementById("SC_ID").value=lstpedidos[0].getAttribute("SC_ID");document.getElementById("FAC_DIASCREDITO").value=lstpedidos[0].getAttribute("PD_DIASCREDITO");document.getElementById("FAC_METODOPAGO").value=lstpedidos[0].getAttribute("PD_METODODEPAGO");document.getElementById("FCT_DESCUENTO").value=lstpedidos[0].getAttribute("PD_POR_DESCUENTO");document.getElementById("FAC_MONEDA").value=lstpedidos[0].getAttribute("PD_MONEDA");document.getElementById("PD_FOLIO").value=lstPediFolios;document.getElementById("FAC_REFERENCIA").value=lstPediFolios;document.getElementById("PD_OPER").value=strUserName;document.getElementById("FAC_TASASEL1").value=lstpedidos[0].getAttribute("TI_ID");dblTasaVtaFP1=lstpedidos[0].getAttribute("PD_TASA1");dblTasaVtaFP2=lstpedidos[0].getAttribute("PD_TASA2");dblTasaVtaFP3=lstpedidos[0].getAttribute("PD_TASA3");intIdTasaVtaFP1=lstpedidos[0].getAttribute("TI_ID");intIdTasaVtaFP2=lstpedidos[0].getAttribute("TI_ID2");intIdTasaVtaFP3=lstpedidos[0].getAttribute("TI_ID3");ObtenNomCteFacPedi(lstpedidos,true);}function ObtenNomCteFacPedi(lstpedidos,bolPasaPedido){var intCte=lstpedidos[0].getAttribute("CT_ID");if(bolPasaPedido==undefined){bolPasaPedido=false;}ValidaClean("PD_CLIE");$.ajax({type:"POST",data:"CT_ID="+intCte,scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"xml",url:"VtasMov.do?id=9",success:function(datoVal){var objCte=datoVal.getElementsByTagName("vta_clientes")[0];
if(objCte.getAttribute("CT_ID")==0){document.getElementById("PD_CLIE").value="***************";ValidaShow("CT_NOM",lstMsg[28]);}else{document.getElementById("FCT_ID").value=objCte.getAttribute("CT_ID");document.getElementById("PD_CLIE").value=objCte.getAttribute("CT_RAZONSOCIAL");document.getElementById("FCT_LPRECIOS").value=objCte.getAttribute("CT_LPRECIOS");document.getElementById("FCT_MONTOCRED").value=objCte.getAttribute("CT_MONTOCRED");intCT_TIPOPERSFP=objCte.getAttribute("CT_TIPOPERS");intCT_TIPOFACFP=objCte.getAttribute("CT_TIPOFAC");strCT_USOIMBUEBLEFP=objCte.getAttribute("CT_USOIMBUEBLE");}if(bolPasaPedido){DrawFacPediDeta(lstpedidos);}},error:function(objeto,quepaso,otroobj){document.getElementById("PD_CLIE").value="***************";alert("FacPedi 2:"+objeto+" "+quepaso+" "+otroobj);}});}function DrawFacPediDeta(lstpedidos){for(var l=0;l<lstpedidos.length;l++){var lstdeta=lstpedidos[l].getElementsByTagName("deta");for(var i=0;i<lstdeta.length;i++){var obj=lstdeta[i];var lstSeries="";var lstMPDSeries="";if(obj.getAttribute("PR_USO_NOSERIE")==1){var arrSeries=lstdeta[i].getElementsByTagName("series");for(var km=0;km<arrSeries.length;km++){var obj1=arrSeries[km];if(parseInt(obj1.getAttribute("MPD_SERIE_VENDIDO"))==0){lstSeries+=obj1.getAttribute("PL_NUMLOTE")+",";lstMPDSeries+=obj1.getAttribute("MPD_ID")+",";}}}var dblCantSurt=parseFloat(obj.getAttribute("PDD_CANTIDADSURTIDA"))-parseFloat(obj.getAttribute("PDD_CANT_FACT"));if(dblCantSurt<0){dblCantSurt=0;}if(dblCantSurt>0){var objImportes=new _ImporteFacPedi();objImportes.dblCantidad=dblCantSurt;objImportes.dblPrecio=parseFloat(obj.getAttribute("PDD_PRECIO"))/(1+(obj.getAttribute("PDD_TASAIVA1")/100));objImportes.dblPrecioReal=parseFloat(obj.getAttribute("PDD_PRECREAL"))/(1+(obj.getAttribute("PDD_TASAIVA1")/100));objImportes.dblPorcDesc=parseFloat(obj.getAttribute("PDD_PORDESC"));objImportes.dblExento1=obj.getAttribute("PDD_EXENTO1");objImportes.dblExento2=obj.getAttribute("PDD_EXENTO2");objImportes.dblExento3=obj.getAttribute("PDD_EXENTO3");objImportes.dblPrecFijo=obj.getAttribute("PDD_PRECFIJO");objImportes.dblPuntos=parseFloat(obj.getAttribute("PDD_PUNTOS"));objImportes.dblVNegocio=parseFloat(obj.getAttribute("PDD_VNEGOCIO"));if(obj.getAttribute("PDD_DESC_PREC")==0){objImportes.bolAplicDescPrec=false;}if(obj.getAttribute("PDD_DESC_PUNTOS")==0){objImportes.bolAplicDescPto=false;}if(obj.getAttribute("PDD_DESC_VNEGOCIO")==0){objImportes.bolAplicDescVNego=false;}var intSinPrecio=0;if(parseFloat(obj.getAttribute("PDD_PRECREAL"))==0){objImportes.intPrecioZeros=1;intSinPrecio=1;}objImportes.CalculaImporte();var dblImporte=objImportes.dblImporte;var dblImporteReal=objImportes.dblImporteReal;var dblImporteDescuento=objImportes.dblImporteDescuento;var datarow={PDD_ID:obj.getAttribute("PDD_ID"),PDD_CVE:obj.getAttribute("PDD_CVE"),PDD_DESCRIPCION:obj.getAttribute("PDD_DESCRIPCION"),PDD_CANTIDAD:obj.getAttribute("PDD_CANTIDAD"),PDD_SURTIDO:obj.getAttribute("PDD_CANTIDADSURTIDA"),PDD_XFACT:dblCantSurt,PDD_FACTURADO:obj.getAttribute("PDD_CANT_FACT"),PDD_PRECIO:objImportes.dblPrecio,PDD_PRECREAL:objImportes.dblPrecioReal,PDD_IMPORTE:dblImporte,PDD_IMPORTEREAL:dblImporteReal,PDD_PR_ID:obj.getAttribute("PR_ID"),PDD_FACTOR:0,PDD_USA_SERIE:obj.getAttribute("PR_USO_NOSERIE"),PDD_IMPUESTO1:objImportes.dblImpuesto1,PDD_EXENTO1:obj.getAttribute("PDD_EXENTO1"),PDD_EXENTO2:obj.getAttribute("PDD_EXENTO2"),PDD_EXENTO3:obj.getAttribute("PDD_EXENTO3"),PDD_RET_ISR:obj.getAttribute("PDD_RET_ISR"),PDD_RET_IVA:obj.getAttribute("PDD_RET_IVA"),PDD_RET_FLETE:obj.getAttribute("PDD_RET_FLETE"),PDD_TASAIVA1:obj.getAttribute("PDD_TASAIVA1"),PDD_TASAIVA2:obj.getAttribute("PDD_TASAIVA2"),PDD_TASAIVA3:obj.getAttribute("PDD_TASAIVA3"),PDD_IMPUESTO2:obj.getAttribute("PDD_IMPUESTO2"),PDD_IMPUESTO3:obj.getAttribute("PDD_IMPUESTO3"),PDD_SERIES:lstSeries,PDD_SERIES_MPD:lstMPDSeries,PDD_SERIES_O:lstSeries,PDD_SERIES_MPD_O:lstMPDSeries,PDD_ESREGALO:obj.getAttribute("PDD_ESREGALO"),PDD_NOSERIE:obj.getAttribute("PDD_NOSERIE"),PDD_DESCUENTO:dblImporteDescuento,PDD_PORDESC:obj.getAttribute("PDD_PORDESC"),PDD_ESDEVO:0,PDD_PRECFIJO:obj.getAttribute("PDD_PRECFIJO"),PDD_NOTAS:obj.getAttribute("PDD_NOTAS"),PDD_UNIDAD_MEDIDA:obj.getAttribute("PDD_UNIDAD_MEDIDA"),PDD_SINPRECIO:intSinPrecio,PDD_PUNTOS_U:objImportes.dblPuntos,PDD_NEGOCIO_U:objImportes.dblVNegocio,PDD_PUNTOS:objImportes.dblPuntosImporte,PDD_NEGOCIO:objImportes.dblVNegocioImporte,FACD_DESC_ORI:obj.getAttribute("PDD_DESC_ORI"),FACD_REGALO:obj.getAttribute("PDD_REGALO"),FACD_ID_PROMO:obj.getAttribute("PDD_ID_PROMO"),FACD_DESC_PREC:obj.getAttribute("PDD_DESC_PREC"),FACD_DESC_PTO:obj.getAttribute("PDD_DESC_PUNTOS"),FACD_DESC_VN:obj.getAttribute("PDD_DESC_VNEGOCIO"),FACD_DESC_LEAL:0};jQuery("#PD_GRID").addRowData(obj.getAttribute("PDD_ID"),datarow,"last");}}}SetSumFacPedi();$("#dialogWait").dialog("close");}function CallbtnFacPedi1(){SaveFacPedi();}function CallbtnFacPedi2(){var dblTot=$("#FAC_TOT").asNumber();var bolSalir=true;if(dblTot>0){bolSalir=confirm(lstMsg[125]);}if(bolSalir){$(strNomTabsScFP).tabs("option","active",0);$(strNomTabsScFP).tabs("disable",1);ViewDoFacPedi();}}function CallbtnFacPedi3(){FacPediModificaCant();}function CallbtnFacPedi4(){FacPediModificaPrecio();}function SetSumFacPedi(){var grid=jQuery("#PD_GRID");var arr=grid.getDataIDs();var dblSuma=0;var dblImpuesto1=0;var dblImporteSinDesc=0;var dblImporte=0;var dblImporteDesc=0;var dblBaseReal1=0;var dblBaseReal2=0;var dblBaseReal3=0;for(var i=0;i<arr.length;i++){var id=arr[i];var lstRow=grid.getRowData(id);dblSuma+=parseFloat(lstRow.PDD_IMPORTE);dblImpuesto1+=parseFloat(lstRow.PDD_IMPUESTO1);dblImporteSinDesc+=parseFloat(lstRow.PDD_IMPORTEREAL);dblImporte+=(parseFloat(lstRow.PDD_IMPORTE)-parseFloat(lstRow.PDD_IMPUESTO1));dblImporteDesc+=parseFloat(lstRow.PDD_DESCUENTO);if(lstRow.PDD_EXENTO1==0){dblBaseReal1+=parseFloat(lstRow.PDD_IMPORTEREAL);dblBaseReal2+=parseFloat(lstRow.PDD_IMPORTEREAL);dblBaseReal3+=parseFloat(lstRow.PDD_IMPORTEREAL);}}var taxReal=new Impuestos(dblTasaVtaFP1,dblTasaVtaFP2,dblTasaVtaFP3,intSImpVtaFP1_2,intSImpVtaFP1_3,intSImpVtaFP2_3);taxReal.CalculaImpuesto(dblBaseReal1,dblBaseReal2,dblBaseReal3);var dblImpuestoReal1=taxReal.dblImpuesto1;var dblImpuestoReal2=taxReal.dblImpuesto2;var dblImpuestoReal3=taxReal.dblImpuesto3;dblImporteSinDesc=dblImporteSinDesc-dblImpuestoReal1-dblImpuestoReal2-dblImpuestoReal3;var dblIEPS=0;if(document.getElementById("FAC_USO_IEPS1").checked){if(parseFloat(document.getElementById("FAC_TASA_IEPS").value)!=0){try{dblIEPS=dblImporte*(parseFloat(document.getElementById("FAC_TASA_IEPS").value)/100);}catch(err){}}else{alert(lstMsg[62]);document.getElementById("FAC_TASA_IEPS").focus();}var tax=new Impuestos(dblTasaVtaFP1,dblTasaVtaFP2,dblTasaVtaFP3,intSImpVtaFP1_2,intSImpVtaFP1_3,intSImpVtaFP2_3);tax.CalculaImpuestoMas(dblIEPS,0,0);dblImpuesto1+=tax.dblImpuesto1;dblSuma+=dblIEPS+tax.dblImpuesto1;}d.getElementById("FAC_IMPORTE_IEPS").value=FormatNumber(dblIEPS,intNumdecimal,true);d.getElementById("FAC_TOT").value=FormatNumber(dblSuma,intNumdecimal,true);d.getElementById("FAC_IMPUESTO1").value=FormatNumber(dblImpuesto1,intNumdecimal,true);d.getElementById("FACD_SUBTOTAL_A").value=FormatNumber(dblImporteSinDesc,intNumdecimal,true);d.getElementById("FAC_IMPORTE").value=FormatNumber(dblImporte,intNumdecimal,true);d.getElementById("FAC_DESCUENTO").value=FormatNumber(dblImporteDesc,intNumdecimal,true);$("#FAC_IMPORTE_IEPS").formatCurrency({colorize:true,region:"es-MX"});$("#FAC_TOT").formatCurrency({colorize:true,region:"es-MX"});$("#FACD_SUBTOTAL_A").formatCurrency({colorize:true,region:"es-MX"});$("#FAC_IMPUESTO1").formatCurrency({colorize:true,region:"es-MX"});$("#FAC_IMPORTE").formatCurrency({colorize:true,region:"es-MX"});$("#FAC_DESCUENTO").formatCurrency({colorize:true,region:"es-MX"});if(parseInt(intEMP_TIPOPERS)==2&&intCT_TIPOPERSFP==1&&d.getElementById("FAC_TIPO1").checked1){var dblRetIsr=dblImporte*(dblFacRetISR/100);var dblRetIVA=0;if(dblImpuesto1>0){dblRetIVA=(dblImpuesto1/3)*2;
}if(parseInt(intEMP_NO_ISR)==1){dblRetIsr=0;}if(parseInt(intEMP_NO_IVA)==1){dblRetIVA=0;}var dblImpNeto=dblSuma-dblRetIsr-dblRetIVA;document.getElementById("FAC_RETISR").value=FormatNumber(dblRetIsr,intNumdecimal,true);document.getElementById("FAC_RETIVA").value=FormatNumber(dblRetIVA,intNumdecimal,true);document.getElementById("FAC_NETO").value=FormatNumber(dblImpNeto,intNumdecimal,true);document.getElementById("FAC_RETISR").parentNode.parentNode.style.display="block";document.getElementById("FAC_RETIVA").parentNode.parentNode.style.display="block";document.getElementById("FAC_NETO").parentNode.parentNode.style.display="block";}else{document.getElementById("FAC_RETISR").parentNode.parentNode.style.display="none";document.getElementById("FAC_RETIVA").parentNode.parentNode.style.display="none";document.getElementById("FAC_NETO").parentNode.parentNode.style.display="none";}}function dblClickFacPedi(id){FacPedi();}function SaveFacPedi(){var dblTot=$("#FAC_TOT").asNumber();if(dblTot>0){var bolGuardar_=false;bolGuardar_=confirm(lstMsg[127]);if(bolGuardar_){SaveFacPediDo();}}else{alert(lstMsg[85]);}}function SaveFacPediDo(){$("#dialogWait").dialog("open");var strPOST="";var strPrefijoMaster="TKT";var strPrefijoDeta="TKTD";var strKey="TKT_ID";var strNomFormat="TICKET";var strTipoVta="2";if(d.getElementById("FAC_TIPO1").checked){strPrefijoMaster="FAC";strPrefijoDeta="FACD";strKey="FAC_ID";strNomFormat="FACTURA";strTipoVta="1";}strPOST+="SC_ID="+d.getElementById("SC_ID").value;strPOST+="&CT_ID="+d.getElementById("FCT_ID").value;strPOST+="&VE_ID="+d.getElementById("VE_ID").value;strPOST+="&PD_ID="+d.getElementById("FPD_ID").value;strPOST+="&"+strPrefijoMaster+"_ESSERV=0";strPOST+="&"+strPrefijoMaster+"_MONEDA="+d.getElementById("FAC_MONEDA").value;strPOST+="&"+strPrefijoMaster+"_FECHA="+d.getElementById("PD_FECHA").value;strPOST+="&"+strPrefijoMaster+"_FOLIO=";strPOST+="&"+strPrefijoMaster+"_NOTAS="+encodeURIComponent(d.getElementById("FAC_NOTAS").value);strPOST+="&"+strPrefijoMaster+"_TOTAL="+$("#FAC_TOT").asNumber();strPOST+="&"+strPrefijoMaster+"_IMPUESTO1="+$("#FAC_IMPUESTO1").asNumber();strPOST+="&"+strPrefijoMaster+"_IMPUESTO2="+d.getElementById("FAC_IMPUESTO2").value;strPOST+="&"+strPrefijoMaster+"_IMPUESTO3="+d.getElementById("FAC_IMPUESTO3").value;strPOST+="&"+strPrefijoMaster+"_IMPORTE="+$("#FAC_IMPORTE").asNumber();strPOST+="&"+strPrefijoMaster+"_RETISR="+d.getElementById("FAC_RETISR").value;strPOST+="&"+strPrefijoMaster+"_RETIVA="+d.getElementById("FAC_RETIVA").value;strPOST+="&"+strPrefijoMaster+"_NETO="+d.getElementById("FAC_NETO").value;strPOST+="&"+strPrefijoMaster+"_NOTASPIE="+encodeURIComponent(d.getElementById("FAC_NOTASPIE").value);strPOST+="&"+strPrefijoMaster+"_REFERENCIA="+d.getElementById("FAC_REFERENCIA").value;strPOST+="&"+strPrefijoMaster+"_CONDPAGO="+d.getElementById("FAC_CONDPAGO").value;strPOST+="&"+strPrefijoMaster+"_METODOPAGO="+d.getElementById("FAC_METODOPAGO").value;strPOST+="&"+strPrefijoMaster+"_NUMCUENTA="+d.getElementById("FAC_NUMCUENTA").value;strPOST+="&"+strPrefijoMaster+"_FORMADEPAGO="+d.getElementById("FAC_FORMADEPAGO").value;strPOST+="&"+strPrefijoMaster+"_NUMPEDI="+d.getElementById("FAC_NUMPEDI").value;strPOST+="&"+strPrefijoMaster+"_FECHAPEDI="+d.getElementById("FAC_FECHAPEDI").value;strPOST+="&"+strPrefijoMaster+"_ADUANA="+d.getElementById("FAC_ADUANA").value;strPOST+="&"+strPrefijoMaster+"_TIPOCOMP="+d.getElementById("FAC_TIPOCOMP").value;strPOST+="&TIPOVENTA="+strTipoVta;strPOST+="&"+strPrefijoMaster+"_TASA1="+dblTasaVtaFP1;strPOST+="&"+strPrefijoMaster+"_TASA2="+dblTasaVtaFP2;strPOST+="&"+strPrefijoMaster+"_TASA3="+dblTasaVtaFP3;strPOST+="&"+"TI_ID="+intIdTasaVtaFP1;strPOST+="&"+"TI_ID2="+intIdTasaVtaFP2;strPOST+="&"+"TI_ID3="+intIdTasaVtaFP3;strPOST+="&"+strPrefijoMaster+"_TASAPESO="+d.getElementById("FAC_TASAPESO").value;strPOST+="&"+strPrefijoMaster+"_DIASCREDITO="+d.getElementById("FAC_DIASCREDITO").value;strPOST+="&"+strPrefijoMaster+"_POR_DESC="+d.getElementById("FCT_DESCUENTO").value;strPOST+="&"+strPrefijoMaster+"_PUNTOS="+d.getElementById("FAC_PUNTOS").value;strPOST+="&"+strPrefijoMaster+"_NEGOCIO="+d.getElementById("FAC_NEGOCIO").value;if(document.getElementById("FAC_USO_IEPS1").checked){strPOST+="&"+strPrefijoMaster+"_USO_IEPS=1";strPOST+="&"+strPrefijoMaster+"_TASA_IEPS="+d.getElementById("FAC_TASA_IEPS").value;strPOST+="&"+strPrefijoMaster+"_IMPORTE_IEPS="+$("#FAC_IMPORTE_IEPS").asNumber();}else{strPOST+="&"+strPrefijoMaster+"_USO_IEPS=0";strPOST+="&"+strPrefijoMaster+"_TASA_IEPS=0";strPOST+="&"+strPrefijoMaster+"_IMPORTE_IEPS=0";}strPOST+="&ADD_MABE=0";strPOST+="&"+strPrefijoMaster+"_ESRECU=0";strPOST+="&"+strPrefijoMaster+"_PERIODICIDAD=0";strPOST+="&"+strPrefijoMaster+"_DIAPER=0";strPOST+="&INV=0";strPOST+="&FAC_PEDI=1";if(document.getElementById("FAC_REGIMENFISCALcount")!=null&&document.getElementById("FAC_REGIMENFISCALcount")!=undefined){var intCuantosReg=document.getElementById("FAC_REGIMENFISCALcount").value;if(intCuantosReg>0){for(var iRegim=0;iRegim<intCuantosReg;iRegim++){if(d.getElementById("FAC_REGIMENFISCAL"+iRegim).checked){strPOST+="&"+strPrefijoMaster+"_REGIMENFISCAL="+d.getElementById("FAC_REGIMENFISCAL"+iRegim).value;}}}}var grid=jQuery("#PD_GRID");var arr=grid.getDataIDs();var intC=0;for(var i=0;i<arr.length;i++){var id=arr[i];var lstRow=grid.getRowData(id);if(parseFloat(lstRow.PDD_XFACT)>0){intC++;strPOST+="&PR_ID"+intC+"="+lstRow.PDD_PR_ID;strPOST+="&"+strPrefijoDeta+"_EXENTO1"+intC+"="+lstRow.PDD_EXENTO1;strPOST+="&"+strPrefijoDeta+"_EXENTO2"+intC+"="+lstRow.PDD_EXENTO2;strPOST+="&"+strPrefijoDeta+"_EXENTO3"+intC+"="+lstRow.PDD_EXENTO3;strPOST+="&"+strPrefijoDeta+"_CVE"+intC+"="+lstRow.PDD_CVE;strPOST+="&"+strPrefijoDeta+"_DESCRIPCION"+intC+"="+encodeURIComponent(lstRow.PDD_DESCRIPCION);strPOST+="&"+strPrefijoDeta+"_CANTIDAD"+intC+"="+lstRow.PDD_XFACT;strPOST+="&"+strPrefijoDeta+"_RET_ISR"+intC+"="+lstRow.PDD_RET_ISR;strPOST+="&"+strPrefijoDeta+"_RET_IVA"+intC+"="+lstRow.PDD_RET_IVA;strPOST+="&"+strPrefijoDeta+"_RET_FLETE"+intC+"="+lstRow.PDD_RET_FLETE;strPOST+="&"+strPrefijoDeta+"_IMP_PUNTOS"+intC+"="+lstRow.FACD_PUNTOS;strPOST+="&"+strPrefijoDeta+"_IMP_VNEGOCIO"+intC+"="+lstRow.FACD_NEGOCIO;strPOST+="&"+strPrefijoDeta+"_PUNTOS"+intC+"="+lstRow.FACD_PUNTOS_U;strPOST+="&"+strPrefijoDeta+"_VNEGOCIO"+intC+"="+lstRow.FACD_NEGOCIO_U;strPOST+="&"+strPrefijoDeta+"_DESC_PREC"+intC+"="+lstRow.FACD_DESC_PREC;strPOST+="&"+strPrefijoDeta+"_DESC_PTO"+intC+"="+lstRow.FACD_DESC_PTO;strPOST+="&"+strPrefijoDeta+"_DESC_VN"+intC+"="+lstRow.FACD_DESC_VN;strPOST+="&"+strPrefijoDeta+"_DESC_ORI"+intC+"="+lstRow.FACD_DESC_ORI;strPOST+="&"+strPrefijoDeta+"_REGALO"+intC+"="+lstRow.FACD_REGALO;strPOST+="&"+strPrefijoDeta+"_ID_PROMO"+intC+"="+lstRow.FACD_ID_PROMO;if(intPreciosconImp==1){strPOST+="&"+strPrefijoDeta+"_PRECIO"+intC+"="+lstRow.PDD_PRECIO;if(lstRow.PDD_SINPRECIO==0){strPOST+="&"+strPrefijoDeta+"_PRECREAL"+intC+"="+lstRow.PDD_PRECREAL;}else{strPOST+="&"+strPrefijoDeta+"_PRECREAL"+intC+"="+0;}}else{var dblPrecioConImp=0;var dblPrecioRealConImp=0;if(lstRow.PDD_XFACT>0){var dblBase1=0;var dblBase2=0;var dblBase3=0;var dblBaseReal1=0;var dblBaseReal2=0;var dblBaseReal3=0;var dblImpuesto1=0;var dblImpuesto2=0;var dblImpuesto3=0;var dblImpuestoReal1=0;var dblImpuestoReal2=0;var dblImpuestoReal3=0;if(parseInt(lstRow.PDD_EXENTO1)==0){dblBase1=lstRow.PDD_PRECIO;}if(parseInt(lstRow.PDD_EXENTO2)==0){dblBase2=lstRow.PDD_PRECIO;}if(parseInt(lstRow.PDD_EXENTO3)==0){dblBase3=lstRow.PDD_PRECIO;}if(parseInt(lstRow.PDD_EXENTO1)==0){dblBaseReal1=lstRow.PDD_PRECREAL;}if(parseInt(lstRow.PDD_EXENTO2)==0){dblBaseReal2=lstRow.PDD_PRECREAL;}if(parseInt(lstRow.PDD_EXENTO3)==0){dblBaseReal3=lstRow.PDD_PRECREAL;}var tax=new Impuestos(dblTasaVtaFP1,dblTasaVtaFP2,dblTasaVtaFP3,intSImpVtaFP1_2,intSImpVtaFP1_3,intSImpVtaFP2_3);tax.CalculaImpuestoMas(dblBase1,dblBase2,dblBase3);var tax2=new Impuestos(dblTasaVtaFP1,dblTasaVtaFP2,dblTasaVtaFP3,intSImpVtaFP1_2,intSImpVtaFP1_3,intSImpVtaFP2_3);tax2.CalculaImpuestoMas(dblBaseReal1,dblBaseReal2,dblBaseReal3);
if(parseInt(lstRow.PDD_EXENTO1)==0){dblImpuesto1=tax.dblImpuesto1;}if(parseInt(lstRow.PDD_EXENTO2)==0){dblImpuesto2=tax.dblImpuesto2;}if(parseInt(lstRow.PDD_EXENTO3)==0){dblImpuesto3=tax.dblImpuesto3;}if(parseInt(lstRow.PDD_EXENTO1)==0){dblImpuestoReal1=tax2.dblImpuesto1;}if(parseInt(lstRow.PDD_EXENTO2)==0){dblImpuestoReal2=tax2.dblImpuesto2;}if(parseInt(lstRow.PDD_EXENTO3)==0){dblImpuestoReal3=tax2.dblImpuesto3;}dblPrecioConImp=(parseFloat(lstRow.PDD_PRECIO)+dblImpuesto1+dblImpuesto2+dblImpuesto3);dblPrecioRealConImp=(parseFloat(lstRow.PDD_PRECIO)+dblImpuesto1+dblImpuesto2+dblImpuesto3);lstRow.PDD_IMPORTEREAL=dblPrecioRealConImp*lstRow.PDD_XFACT;}else{dblPrecioConImp=(parseFloat(lstRow.PDD_PRECIO));dblPrecioRealConImp=(parseFloat(lstRow.PDD_PRECREAL));}strPOST+="&"+strPrefijoDeta+"_PRECIO"+intC+"="+dblPrecioConImp;strPOST+="&"+strPrefijoDeta+"_PRECREAL"+intC+"="+dblPrecioRealConImp;}strPOST+="&"+strPrefijoDeta+"_IMPORTE"+intC+"="+lstRow.PDD_IMPORTE;strPOST+="&"+strPrefijoDeta+"_TASAIVA1"+intC+"="+lstRow.PDD_TASAIVA1;strPOST+="&"+strPrefijoDeta+"_TASAIVA2"+intC+"=0"+lstRow.PDD_TASAIVA2;strPOST+="&"+strPrefijoDeta+"_TASAIVA3"+intC+"="+lstRow.PDD_TASAIVA3;strPOST+="&"+strPrefijoDeta+"_IMPUESTO1"+intC+"="+lstRow.PDD_IMPUESTO1;strPOST+="&"+strPrefijoDeta+"_IMPUESTO2"+intC+"="+lstRow.PDD_IMPUESTO2;strPOST+="&"+strPrefijoDeta+"_IMPUESTO3"+intC+"="+lstRow.PDD_IMPUESTO3;strPOST+="&"+strPrefijoDeta+"_ESREGALO"+intC+"="+lstRow.PDD_ESREGALO;strPOST+="&"+strPrefijoDeta+"_NOSERIE"+intC+"="+lstRow.PDD_SERIES;strPOST+="&"+strPrefijoDeta+"_SERIES_MPD"+intC+"="+lstRow.PDD_SERIES_MPD;strPOST+="&"+strPrefijoDeta+"_IMPORTEREAL"+intC+"="+lstRow.PDD_IMPORTEREAL;strPOST+="&"+strPrefijoDeta+"_DESCUENTO"+intC+"="+lstRow.PDD_DESCUENTO;strPOST+="&"+strPrefijoDeta+"_PORDESC"+intC+"="+lstRow.PDD_PORDESC;strPOST+="&"+strPrefijoDeta+"_ESDEVO"+intC+"="+lstRow.PDD_ESDEVO;strPOST+="&"+strPrefijoDeta+"_PRECFIJO"+intC+"="+lstRow.PDD_PRECFIJO;strPOST+="&"+strPrefijoDeta+"_NOTAS"+intC+"="+encodeURIComponent(lstRow.PDD_NOTAS);strPOST+="&"+strPrefijoDeta+"_UNIDAD_MEDIDA"+intC+"="+lstRow.PDD_UNIDAD_MEDIDA;strPOST+="&PDD_ID"+intC+"="+lstRow.PDD_ID;}}strPOST+="&COUNT_ITEM="+intC;strPOST+="&COUNT_PAGOS=1";strPOST+="&MCD_MONEDA1=1";strPOST+="&MCD_FOLIO1=";strPOST+="&MCD_FORMAPAGO1=EFECTIVO";strPOST+="&MCD_NOCHEQUE1=";strPOST+="&MCD_BANCO1=";strPOST+="&MCD_NOTARJETA1=";strPOST+="&MCD_TIPOTARJETA1=";strPOST+="&MCD_IMPORTE1=0.0";strPOST+="&MCD_TASAPESO1=1";strPOST+="&MCD_CAMBIO1=0.0";$.ajax({type:"POST",data:encodeURI(strPOST),scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"html",url:"VtasMov.do?id=1",success:function(dato){dato=trim(dato);if(Left(dato,3)=="OK."){d.getElementById("FAC_TOT").value="0";CallbtnFacPedi2();if(strNomFormat=="FACTURA"){var strHtml=CreaHidden(strKey,dato.replace("OK.",""));openWhereverFormat("ERP_SendInvoice?id="+dato.replace("OK.",""),strNomFormat,"PDF",strHtml);}else{FacPediImprimeconFolio(strKey,dato,strNomFormat);}}else{alert(dato);}$("#dialogWait").dialog("close");},error:function(objeto,quepaso,otroobj){alert(":Fac Pedi Save:"+objeto+" "+quepaso+" "+otroobj);$("#dialogWait").dialog("close");}});}function FacPediExit(){myLayout.open("west");myLayout.open("east");myLayout.open("south");myLayout.open("north");document.getElementById("MainPanel").innerHTML="";var objMainFacPedi=objMap.getScreen(strNomMainFacPedi);objMainFacPedi.bolActivo=false;objMainFacPedi.bolMain=false;objMainFacPedi.bolInit=false;objMainFacPedi.idOperAct=0;}function FacPediModificaCant(){var grid=jQuery("#PD_GRID");var id=grid.getGridParam("selrow");if(id!=null){var lstRow=grid.getRowData(id);document.getElementById("Operac").value="CHANGE_CANTPD";$("#SioNO").dialog("option","title",lstMsg[132]);var div=document.getElementById("SioNO_inside");var strHtml=CreaTexto(lstMsg[89],"_NvoCant",lstRow.PDD_XFACT,10,10,true,false,"","left",0,"","","",false,1);div.innerHTML=strHtml;$("#SioNO").dialog("open");}}function FacPediModificaCantDo(){var grid=jQuery("#PD_GRID");var id=grid.getGridParam("selrow");if(id!=null){var lstRow=grid.getRowData(id);var dblCantSurt=parseFloat(lstRow.PDD_SURTIDO)-parseFloat(lstRow.PDD_FACTURADO);if(parseFloat(document.getElementById("_NvoCant").value)>dblCantSurt){alert(lstMsg[133]);}else{if(lstRow.PDD_USA_SERIE==1){DrawSelSerie(lstRow,document.getElementById("_NvoCant").value,id);}else{lstRow.PDD_XFACT=document.getElementById("_NvoCant").value;lstRowChangePrecioFacPedi(lstRow,id,grid);}}}}function FacPediModificaPrecio(){var grid=jQuery("#PD_GRID");var ids=grid.getGridParam("selrow");if(ids!=null){var lstRow=grid.getRowData(ids);document.getElementById("Operac").value="CHANGE_PRECPD";$("#SioNO").dialog("option","title",lstMsg[78]);var div=document.getElementById("SioNO_inside");var strHtml=CreaTexto(lstMsg[8],"_NvoCost",lstRow.PDD_PRECIO,10,10,true,false,"","left",0,"","","",false,1);strHtml+=CreaRadio(lstMsg[9],"_NvoClean",0,false," ");div.innerHTML=strHtml;$("#SioNO").dialog("open");}}function FacPediModificaPrecioDo(){var grid=jQuery("#PD_GRID");var id=grid.getGridParam("selrow");if(id!=null){var lstRow=grid.getRowData(id);lstRow.PDD_PRECIO=document.getElementById("_NvoCost").value;lstRow.PDD_PRECREAL=document.getElementById("_NvoCost").value;lstRowChangePrecioFacPedi(lstRow,id,grid);}}function _ImporteFacPedi(){this.dblImporte=0;this.dblImpuesto1=0;this.dblImpuesto2=0;this.dblImpuesto3=0;this.dblImpuestoReal1=0;this.dblImpuestoReal2=0;this.dblImpuestoReal3=0;this.dblCantidad=0;this.dblPrecio=0;this.dblPorcDesc=0;this.dblPorcDescGlobal=0;this.dblPrecFijo=0;this.dblExento1=0;this.dblExento2=0;this.dblExento3=0;this.dblImporteReal=0;this.dblPrecioReal=0;this.intDevo=0;this.dblPorcAplica=0;this.intPrecioZeros=0;this.dblImporteDescuento=0;this.dblPuntos=0;this.dblVNegocio=0;this.dblPuntosAplica=0;this.dblVNegocioAplica=0;this.dblPuntosImporte=0;this.dblVNegocioImporte=0;this.bolAplicDescPrec=true;this.bolAplicDescPto=true;this.bolAplicDescVNego=true;this.bolUsoMLM=true;this.CalculaImporte=function CalculaImporte(){this.dblPorcDescGlobal=parseFloat(this.dblPorcDescGlobal);this.dblPorcDesc=parseFloat(this.dblPorcDesc);var dblPrecioAplica=parseFloat(this.dblPrecio);this.dblPuntosAplica=this.dblPuntos;this.dblVNegocioAplica=this.dblVNegocio;this.dblPorcAplica=0;if(this.dblPorcDescGlobal>0&&this.dblPorcDesc>0){if(this.dblPorcDescGlobal>this.dblPorcDesc){this.dblPorcAplica=this.dblPorcDescGlobal;}if(this.dblPorcDesc>this.dblPorcDescGlobal){this.dblPorcAplica=this.dblPorcDesc;}if(this.dblPorcDesc==this.dblPorcDescGlobal){this.dblPorcAplica=this.dblPorcDesc;}}else{if(this.dblPorcDescGlobal>0){this.dblPorcAplica=this.dblPorcDescGlobal;}if(this.dblPorcDesc>0){this.dblPorcAplica=this.dblPorcDesc;}}if(this.dblPorcAplica>0){if(this.bolAplicDescPrec){dblPrecioAplica=dblPrecioAplica-(dblPrecioAplica*(this.dblPorcAplica/100));}if(this.bolAplicDescPto){this.dblPuntosAplica=this.dblPuntosAplica-(this.dblPuntosAplica*(this.dblPorcAplica/100));}if(this.bolAplicDescVNego){this.dblVNegocioAplica=this.dblVNegocioAplica-(this.dblVNegocioAplica*(this.dblPorcAplica/100));}}this.dblImporte=parseFloat(this.dblCantidad)*parseFloat(dblPrecioAplica);this.dblImporteReal=parseFloat(this.dblCantidad)*parseFloat(this.dblPrecioReal);if(this.dblImporteReal>0&&(this.dblImporteReal>this.dblImporte)){this.dblImporteDescuento=this.dblImporteReal-this.dblImporte;}if(parseInt(this.intDevo)==1){this.dblImporte=this.dblImporte*-1;}if(this.bolUsoMLM){this.dblPuntosImporte=parseFloat(this.dblCantidad)*parseFloat(this.dblPuntosAplica);this.dblVNegocioImporte=parseFloat(this.dblCantidad)*parseFloat(this.dblVNegocioAplica);}var dblBase1=this.dblImporte;var dblBase2=this.dblImporte;var dblBase3=this.dblImporte;if(parseInt(this.dblExento1)==1){dblBase1=0;}if(parseInt(this.dblExento2)==1){dblBase2=0;}if(parseInt(this.dblExento3)==1){dblBase3=0;}var tax=new Impuestos(dblTasaVtaFP1,dblTasaVtaFP2,dblTasaVtaFP3,intSImpVtaFP1_2,intSImpVtaFP1_3,intSImpVtaFP2_3);if(intPreciosconImp==1){tax.CalculaImpuesto(dblBase1,dblBase2,dblBase3);
}else{tax.CalculaImpuestoMas(dblBase1,dblBase2,dblBase3);}if(parseInt(this.dblExento1)==0){this.dblImpuesto1=tax.dblImpuesto1;}if(parseInt(this.dblExento2)==0){this.dblImpuesto2=tax.dblImpuesto2;}if(parseInt(this.dblExento3)==0){this.dblImpuesto3=tax.dblImpuesto3;}var dblBaseReal1=this.dblImporteReal;var dblBaseReal2=this.dblImporteReal;var dblBaseReal3=this.dblImporteReal;if(parseInt(this.dblExento1)==1){dblBaseReal1=0;}if(parseInt(this.dblExento2)==1){dblBaseReal2=0;}if(parseInt(this.dblExento3)==1){dblBaseReal3=0;}if(intPreciosconImp==1){tax.CalculaImpuesto(dblBaseReal1,dblBaseReal2,dblBaseReal3);}else{tax.CalculaImpuestoMas(dblBaseReal1,dblBaseReal2,dblBaseReal3);}if(parseInt(this.dblExento1)==0){this.dblImpuestoReal1=tax.dblImpuesto1;}if(parseInt(this.dblExento2)==0){this.dblImpuestoReal2=tax.dblImpuesto2;}if(parseInt(this.dblExento3)==0){this.dblImpuestoReal3=tax.dblImpuesto3;}if(this.intPrecioZeros==1){this.dblImporteReal=parseFloat(this.dblCantidad)*parseFloat(this.dblPrecio);}if(intPreciosconImp==0){this.dblImporteReal+=this.dblImpuestoReal1+this.dblImpuestoReal2+this.dblImpuestoReal3;this.dblImporte+=this.dblImpuesto1+this.dblImpuesto2+this.dblImpuesto3;}if(intPreciosconImp==1){if(this.dblImporteReal>0){var dblTotImpuesto=tax.dblImpuesto1+tax.dblImpuesto2+tax.dblImpuesto3;var dblTotImpuestoReal=tax.dblImpuestoReal1+tax.dblImpuestoReal2+tax.dblImpuestoReal3;if(this.dblImporteReal>0&&(this.dblImporteReal>this.dblImporte)){this.dblImporteDescuento=(this.dblImporteReal-dblTotImpuestoReal)-(this.dblImporte-dblTotImpuesto);}}}};}function FacPediFormStyle(){d.getElementById("FACD_SUBTOTAL_A").setAttribute("class","ui-Total");d.getElementById("FAC_DESCUENTO").setAttribute("class","ui-Total");d.getElementById("FAC_IMPORTE").setAttribute("class","ui-Total");d.getElementById("FAC_IMPORTE").setAttribute("className","ui-Total");d.getElementById("FAC_IMPUESTO1").setAttribute("class","ui-Total");d.getElementById("FAC_IMPUESTO1").setAttribute("className","ui-Total");d.getElementById("FAC_IMPORTE_IEPS").setAttribute("class","ui-Total");d.getElementById("FAC_IMPORTE_IEPS").setAttribute("className","ui-Total");d.getElementById("FAC_TOT").setAttribute("class","ui-Total");d.getElementById("FAC_TOT").setAttribute("className","ui-Total");}function FacPediSelRegDefa(){if(document.getElementById("FAC_REGIMENFISCALcount")!=null&&document.getElementById("FAC_REGIMENFISCALcount")!=undefined){var intCuantosReg=document.getElementById("FAC_REGIMENFISCALcount").value;if(intCuantosReg>0){for(var iRegim=0;iRegim<intCuantosReg;iRegim++){d.getElementById("FAC_REGIMENFISCAL"+iRegim).checked=true;break;}}}}function FacPediImprimeconFolio(strKey,dato,strNomFormat){var strTipo="1";$.ajax({type:"POST",data:"KEY_ID="+strKey+"&TYPE_ID="+strTipo,scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"xml",url:"VtasMov.do?id=12",success:function(datos){var objsc=datos.getElementsByTagName("vta_folios")[0];var strFolioT=objsc.getAttribute("FOLIO");var strHtml2=CreaHidden(strKey,dato.replace("OK.",""));openFormat(strNomFormat,"PDF",strHtml2,strFolioT);},error:function(objeto,quepaso,otroobj){alert(":ImprimeFolio:"+objeto+" "+quepaso+" "+otroobj);}});}function FacPediConfirmaSI(){if(d.getElementById("Operac").value=="CHANGE_CANTPD"){FacPediModificaCantDo();}if(d.getElementById("Operac").value=="CHANGE_PRECPD"){FacPediModificaPrecioDo();}$("#SioNO").dialog("close");}function FacPediConfirmaNO(){$("#SioNO").dialog("close");}function lstRowChangePrecioFacPedi(lstRow,idUpdate,grid){var objImportes=new _ImporteFacPedi();objImportes.dblCantidad=parseFloat(lstRow.PDD_XFACT);objImportes.dblPrecio=parseFloat(lstRow.PDD_PRECIO);objImportes.dblPrecioReal=lstRow.PDD_PRECREAL;objImportes.dblPuntos=parseFloat(lstRow.FACD_PUNTOS_U);objImportes.dblVNegocio=parseFloat(lstRow.FACD_NEGOCIO_U);objImportes.dblPorcDescGlobal=document.getElementById("FCT_DESCUENTO").value;objImportes.dblPorcDesc=lstRow.PDD_PORDESC;objImportes.dblPrecFijo=lstRow.PDD_PRECFIJO;objImportes.dblExento1=lstRow.PDD_EXENTO1;objImportes.dblExento2=lstRow.PDD_EXENTO2;objImportes.dblExento3=lstRow.PDD_EXENTO3;objImportes.intDevo=lstRow.PDD_ESDEVO;objImportes.intPrecioZeros=lstRow.PDD_SINPRECIO;objImportes.CalculaImporte();lstRow.PDD_IMPORTE=objImportes.dblImporte;lstRow.PDD_IMPUESTO1=objImportes.dblImpuesto1;lstRow.PDD_DESCUENTO=objImportes.dblImporteDescuento;lstRow.PDD_IMPORTEREAL=objImportes.dblImporteReal;lstRow.FACD_PUNTOS=objImportes.dblPuntosImporte;lstRow.FACD_NEGOCIO=objImportes.dblVNegocioImporte;grid.setRowData(idUpdate,lstRow);SetSumFacPedi();}function DrawSelSerie(lstRow,dblCantidad,idRow){var strSeries=lstRow.PDD_SERIES;var strSeriesO=lstRow.PDD_SERIES_O;var lstSeries=strSeries.split(",");var lstSeriesO=strSeriesO.split(",");var strOptionSelect="";var strOptionSelectDest="";var intContSel1=0;for(i=0;i<lstSeriesO.length;i++){var obj=lstSeriesO[i];var boolExisteSerie=false;for(var y=0;y<lstSeries.length;y++){var objSerie=lstSeries[y];if(objSerie==obj){boolExisteSerie=true;intContSel1++;if(boolExisteSerie&&intContSel1>dblCantidad){boolExisteSerie=false;}}}if(!boolExisteSerie&&obj!=""){strOptionSelect+="<option value='"+obj+"'>"+obj+"</option>";}}var intContSel=0;for(i=0;i<lstSeriesO.length;i++){var obj=lstSeriesO[i];var boolExisteSerie=false;for(var y=0;y<lstSeries.length;y++){var objSerie=lstSeries[y];if(objSerie==obj){boolExisteSerie=true;intContSel++;}}if(boolExisteSerie&&intContSel<=dblCantidad){strOptionSelectDest+="<option value='"+obj+"'>"+obj+"</option>";}}if(intContSel>dblCantidad){intContSel=dblCantidad;}$("#dialog2").dialog("open");$("#dialog2").dialog("option","title",lstMsg[107]);var strHTML="<input type='hidden' id='_Pr_Id' value='"+lstRow.PDD_PR_ID+"'>";strHTML+="<input type='hidden' id='_Cantidad' value='"+dblCantidad+"'>";strHTML+="<input type='hidden' id='_idRow' value='"+idRow+"'>";strHTML+="<table border=0 cellpadding=0>";strHTML+="<tr>";strHTML+="<td colspan=3>"+lstMsg[110]+"</td>";strHTML+="</tr>";strHTML+="<tr>";strHTML+="<td nowrap>&nbsp;"+lstMsg[172]+"<input type='text' id='search_cant' value='"+dblCantidad+"' size='8' readonly disabled></td>";strHTML+="<td nowrap>&nbsp;</td>";strHTML+="<td nowrap>&nbsp;"+lstMsg[173]+"<input type='text' id='search_cant_sel' value='"+intContSel+"' size='8' readonly disabled></td>";strHTML+="</tr>";strHTML+="<tr>";strHTML+="<td >"+lstMsg[174]+"<br><select id='series_origen' multiple>"+strOptionSelect+"</select></td>";strHTML+="<td ><input type='button' id='Agregar' value='"+lstMsg[176]+"' onclick='AgregaSerieXFPC()'><br><input type='button' id='Quitar' value='"+lstMsg[177]+"' onClick='RemueveSerieXFPC()'></td>";strHTML+="<td >"+lstMsg[175]+"<br><select id='series_destino' multiple >"+strOptionSelectDest+"</select></td>";strHTML+="</tr>";strHTML+="<tr>";strHTML+="<td>"+CreaBoton("","ConfirmNoSerie1",lstMsg[111],"ConfirmNumSerieFPC();","left",false,false)+"</td>";strHTML+="<td>&nbsp;</td>";strHTML+="<td>"+CreaBoton("","CancelNoSerie2",lstMsg[112],"CancelNumSerieFPC();","left",false,false)+"</td>";strHTML+="</tr>";strHTML+="</table>";document.getElementById("dialog2_inside").innerHTML=strHTML;}function SaveSelSeries(){}function AgregaSerieXFPC(){var objSelOr=document.getElementById("series_origen");var objSelDest=document.getElementById("series_destino");var intXSurtir=parseInt(document.getElementById("search_cant").value);var intSurtido=parseInt(document.getElementById("search_cant_sel").value);for(var x=0;x<objSelOr.length;x++){if(objSelOr[x].selected){if(objSelDest.length+1<=intXSurtir){intSurtido++;document.getElementById("search_cant_sel").value=intSurtido;select_add(objSelDest,objSelOr[x].value,objSelOr[x].value);objSelOr.remove(x);}else{alert(lstMsg[178]);}}}}function RemueveSerieXFPC(){var objSelOr=document.getElementById("series_origen");var objSelDest=document.getElementById("series_destino");var intSurtido=parseInt(document.getElementById("search_cant_sel").value);for(var x=0;x<objSelDest.length;x++){if(objSelDest[x].selected){intSurtido--;
document.getElementById("search_cant_sel").value=intSurtido;select_add(objSelOr,objSelDest[x].value,objSelDest[x].value);objSelDest.remove(x);}}}function ConfirmNumSerieFPC(){var intXSurtir=parseInt(document.getElementById("search_cant").value);var intSurtido=parseInt(document.getElementById("search_cant_sel").value);if(intXSurtir==intSurtido){var _Pr_Id=document.getElementById("_Pr_Id").value;var _Cantidad=document.getElementById("_Cantidad").value;var _idProd=document.getElementById("_idRow").value;var objSelDest=document.getElementById("series_destino");var _strSeries="";for(var x=0;x<objSelDest.length;x++){_strSeries+=objSelDest[x].value+",";}$("#dialog2").dialog("close");var gridD=jQuery("#PD_GRID");var lstRow=gridD.getRowData(_idProd);lstRow.PDD_XFACT=parseFloat(_Cantidad);lstRow.PDD_NOSERIE=_strSeries;lstRow.PDD_SERIES=_strSeries;var strSeriesMPDO=lstRow.PDD_SERIES_MPD_O;var strSeriesO=lstRow.PDD_SERIES_O;var lstSeriesMPDO=strSeriesMPDO.split(",");var lstSeriesO=strSeriesO.split(",");var _strSeriesMPD0="";for(i=0;i<lstSeriesO.length;i++){var obj=lstSeriesO[i];var objMPDO=lstSeriesMPDO[i];for(var x=0;x<objSelDest.length;x++){_strSeries+=objSelDest[x].value+",";if(obj==objSelDest[x].value){_strSeriesMPD0+=objMPDO+",";}}}lstRow.PDD_SERIES_MPD=_strSeriesMPD0;lstRowChangePrecioFacPedi(lstRow,_idProd,gridD);$("#dialogWait").dialog("close");}else{alert(lstMsg[179]);}}function CancelNumSerieFPC(){$("#dialog2").dialog("close");_objProdTmpz=null;}