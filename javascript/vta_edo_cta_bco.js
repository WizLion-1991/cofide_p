var itemIdEdCtaBco=0;function vta_edo_cta_bco(){}function initEdoCtaBco(){myLayout.close("west");myLayout.close("east");myLayout.close("south");myLayout.close("north");d.getElementById("btn1").setAttribute("class","Oculto");d.getElementById("btn1").setAttribute("className","Oculto");ChangeStyleEdoCtaBco();$("#dialogWait").dialog("open");$.ajax({type:"POST",data:"",scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"xml",url:"ERP_EdoCtaBco.jsp?id=1",success:function(datos){var objSelDest=document.getElementById("ED_PERIODO");select_clear(objSelDest);var lstPer=datos.getElementsByTagName("periodo");for(i=0;i<lstPer.length;i++){var obj=lstPer[i];select_add(objSelDest,obj.getAttribute("valor"),obj.getAttribute("valor"));}},error:function(objeto,quepaso,otroobj){alert("edo_cta1:"+objeto+" "+quepaso+" "+otroobj);}});}function ChangeStyleEdoCtaBco(){d.getElementById("ED_INICIAL").setAttribute("class","textNumberReadOnly");d.getElementById("ED_INICIAL").setAttribute("className","textNumberReadOnly");d.getElementById("ED_CARGOS").setAttribute("class","textNumberReadOnly");d.getElementById("ED_CARGOS").setAttribute("className","textNumberReadOnly");d.getElementById("ED_ABONOS").setAttribute("class","textNumberReadOnly");d.getElementById("ED_ABONOS").setAttribute("className","textNumberReadOnly");d.getElementById("ED_FINAL").setAttribute("class","textNumberReadOnly");d.getElementById("ED_FINAL").setAttribute("className","textNumberReadOnly");}function OpnDiagBcoEdoCta(){OpnOpt("BANCOS","grid","dialogCte",false,false);}function RefreshBcoEdoCta(){$("#dialogCte").dialog("close");var intIdBco=document.getElementById("ED_BANCO").value;if(parseInt(intIdBco)!=0){$("#dialogWait").dialog("open");$.ajax({type:"POST",data:"BC_ID="+intIdBco,scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"xml",url:"ERP_EdoCtaBco.jsp?id=2",success:function(datos){var lstCte=datos.getElementsByTagName("banco");var bolExiste=false;for(i=0;i<lstCte.length;i++){var obj=lstCte[i];document.getElementById("ED_CUENTA").value=obj.getAttribute("cuenta");document.getElementById("ED_MONEDA").value=obj.getAttribute("moneda");document.getElementById("ED_NOMBRE").value=obj.getAttribute("nombre");document.getElementById("ED_PERIODO").value="";var grid=jQuery("#GRID_DETA");grid.clearGridData();bolExiste=true;}if(!bolExiste){alert(lstMsg[199]);$("#dialogWait").dialog("close");}else{RefreshListBco(false);}},error:function(objeto,quepaso,otroobj){alert("edo_cta2:"+objeto+" "+quepaso+" "+otroobj);}});}}function SalirEdoCtaBco(){myLayout.open("west");myLayout.open("east");myLayout.open("south");myLayout.open("north");document.getElementById("MainPanel").innerHTML="";var objMainFacPedi=objMap.getScreen("EDO_CTA_BC");objMainFacPedi.bolActivo=false;objMainFacPedi.bolMain=false;objMainFacPedi.bolInit=false;objMainFacPedi.idOperAct=0;}function RefreshListBco(bolWait){var intIdBco=document.getElementById("ED_BANCO").value;if(parseInt(intIdBco)!=0){if(bolWait!=null){if(bolWait){$("#dialogWait").dialog("open");}}else{$("#dialogWait").dialog("open");}var strPeriodo=document.getElementById("ED_PERIODO").value;var intIdMoneda=document.getElementById("ED_MONEDA").value;$.ajax({type:"POST",data:"BC_ID="+intIdBco+"&MON_ID="+intIdMoneda+"&Periodo="+strPeriodo.replace("/",""),scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"xml",url:"ERP_EdoCtaBco.jsp?id=3",success:function(datos){var lstCte=datos.getElementsByTagName("saldos");for(i=0;i<lstCte.length;i++){var obj=lstCte[i];document.getElementById("ED_INICIAL").value=FormatNumber(obj.getAttribute("inicial"),2,true,false,true,false);document.getElementById("ED_CARGOS").value=FormatNumber(obj.getAttribute("cargos"),2,true,false,true,false);document.getElementById("ED_ABONOS").value=FormatNumber(obj.getAttribute("abonos"),2,true,false,true,false);document.getElementById("ED_FINAL").value=FormatNumber(obj.getAttribute("final"),2,true,false,true,false);}RefreshGridListBco(intIdBco,intIdMoneda,strPeriodo);},error:function(objeto,quepaso,otroobj){alert("edo_cta3:"+objeto+" "+quepaso+" "+otroobj);}});}}function RefreshGridListBco(intIdBco,intIdMoneda,strPeriodo){var grid=jQuery("#GRID_DETA");grid.clearGridData();$.ajax({type:"POST",data:"BC_ID="+intIdBco+"&MON_ID="+intIdMoneda+"&Periodo="+strPeriodo.replace("/",""),scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"xml",url:"ERP_EdoCtaBco.jsp?id=4",success:function(datos){var lstCte=datos.getElementsByTagName("doc");var dblSaldo=parseFloat(document.getElementById("ED_INICIAL").value.replace(",","").replace(",",""));for(i=0;i<lstCte.length;i++){var obj=lstCte[i];var strStatus=obj.getAttribute("estatus");var dblCargo=parseFloat(obj.getAttribute("cargos"));var dblAbono=parseFloat(obj.getAttribute("abonos"));var dblParidad=parseFloat(obj.getAttribute("paridad"));var intIdMoneda=parseInt(obj.getAttribute("moneda"));if(dblParidad==0){dblParidad=1;}if(intIdMoneda==1){dblCargo=parseFloat(dblCargo)*dblParidad;dblAbono=parseFloat(dblAbono)*dblParidad;}else{dblCargo=parseFloat(dblCargo)/dblParidad;dblAbono=parseFloat(dblAbono)/dblParidad;}if(strStatus=="CONCILIADO"){dblSaldo+=dblCargo-dblAbono;}var strConcepto="";if(parseInt(obj.getAttribute("FAC_ID"))!=0){strConcepto=obj.getAttribute("beneficiario_fac")+"/FACTURA - "+obj.getAttribute("folio_fac");}else{if(parseInt(obj.getAttribute("TKT_ID"))!=0){strConcepto=obj.getAttribute("beneficiario_tkt")+"/TICKET - "+obj.getAttribute("folio_tkt");}else{if(parseInt(obj.getAttribute("CXP_ID"))!=0){strConcepto=obj.getAttribute("beneficiario_cxp")+"/CUENTA POR PAGAR - "+obj.getAttribute("folio_cxp");}else{if(parseInt(obj.getAttribute("MP_ID"))!=0){strConcepto=obj.getAttribute("beneficiario_cxp2")+"/CUENTA POR PAGAR - "+obj.getAttribute("folio_cxp2");}else{strConcepto=obj.getAttribute("concepto")+" "+obj.getAttribute("beneficiario");}}}}var datarow={DET_ID:obj.getAttribute("id"),DET_CONCEPTO:strConcepto,DET_FECHA:obj.getAttribute("fecha"),DET_DEPOSITO:dblCargo,DET_RETIRO:dblAbono,DET_SALDO:dblSaldo,DET_ESTATUS:strStatus};itemIdEdCtaBco++;grid.addRowData(itemIdEdCtaBco,datarow,"last");}var arr=grid.getDataIDs();for(var i=0;i<arr.length;i++){var id=arr[i];var lstRow=grid.getRowData(id);if(lstRow.DET_ESTATUS!="CONCILIADO"){grid.setCell(id,"DET_CONCEPTO","","advertencia","",false);grid.setCell(id,"DET_FECHA","","advertencia","",false);grid.setCell(id,"DET_DEPOSITO","","advertencia","",false);grid.setCell(id,"DET_RETIRO","","advertencia","",false);grid.setCell(id,"DET_SALDO","","advertencia","",false);grid.setCell(id,"DET_ESTATUS","","advertencia","",false);}}$("#dialogWait").dialog("close");},error:function(objeto,quepaso,otroobj){alert("edo_cta4:"+objeto+" "+quepaso+" "+otroobj);$("#dialogWait").dialog("close");}});}function VerDetalleEdoCtaBco(){var grid=jQuery("#GRID_DETA");if(grid.getGridParam("selrow")!=null){$("#dialogWait").dialog("open");var lstRowAct=grid.getRowData(grid.getGridParam("selrow"));var intIdBco=document.getElementById("ED_BANCO").value;var intIdMoneda=document.getElementById("ED_MONEDA").value;$.ajax({type:"POST",data:"BC_ID="+intIdBco+"&MON_ID="+intIdMoneda+"&FAC_ID="+lstRowAct.DET_ID,scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"xml",url:"ERP_EdoCtaBco.jsp?id=5",success:function(datos){var lstCte=datos.getElementsByTagName("doc");var strHTML="<table border=0>";strHTML+="<tr>";strHTML+="<th>&nbsp;</th>";strHTML+="<th>"+lstMsg[200]+"</th>";strHTML+="<th>"+lstMsg[201]+"</th>";strHTML+="<th>"+lstMsg[202]+"</th>";strHTML+="<th>"+lstMsg[203]+"</th>";strHTML+="<th>"+lstMsg[204]+"</th>";strHTML+="<th>"+lstMsg[205]+"</th>";strHTML+="<th>"+lstMsg[206]+"</th>";strHTML+="</tr>";var dblSaldo=0;for(i=0;i<lstCte.length;i++){var obj=lstCte[i];var dblCargo=obj.getAttribute("cargos");var dblAbono=obj.getAttribute("abonos");if(parseFloat(obj.getAttribute("paridad"))!=1){if(intIdMoneda==1){dblCargo=parseFloat(dblCargo)*parseFloat(obj.getAttribute("paridad"));
dblAbono=parseFloat(dblAbono)*parseFloat(obj.getAttribute("paridad"));}else{dblCargo=parseFloat(dblCargo)/parseFloat(obj.getAttribute("paridad"));dblAbono=parseFloat(dblAbono)/parseFloat(obj.getAttribute("paridad"));}}dblSaldo+=parseFloat(dblCargo)-parseFloat(dblAbono);strHTML+="<tr>";if(parseFloat(dblAbono)>0){strHTML+="<td><a href='javascript:ImprimirEdoCtaCobro("+obj.getAttribute("id")+","+obj.getAttribute("id_Masivo")+')\'><img border="0" src="images/ptovta/printer_64.png"></a></td>';}else{strHTML+="<td><a href='javascript:ImprimirEdoCtaFact("+obj.getAttribute("id_Fac")+')\'><img border="0" src="images/ptovta/printer_64.png"></a></td>';}strHTML+="<td>"+obj.getAttribute("fecha")+"</td>";if(obj.getAttribute("nc_folio")!="null"){strHTML+="<td>"+obj.getAttribute("nc_folio")+"</td>";}else{if(obj.getAttribute("mc_folio")!=""){strHTML+="<td>"+obj.getAttribute("mc_folio")+"</td>";}else{strHTML+="<td>"+obj.getAttribute("folio")+"</td>";}}strHTML+="<td>"+obj.getAttribute("concepto")+"</td>";strHTML+="<td align='right'>"+FormatNumber(dblCargo,2,true,false,true,false)+"</td>";strHTML+="<td align='right'>"+FormatNumber(dblAbono,2,true,false,true,false)+"</td>";strHTML+="<td align='right'>"+FormatNumber(dblSaldo,2,true,false,true,false)+"</td>";strHTML+="<td align='right'>"+obj.getAttribute("paridad")+"</td>";strHTML+="</tr>";}strHTML+="</table border=0>";document.getElementById("dialog2_inside").innerHTML=strHTML;$("#dialogWait").dialog("close");$("#dialog2").dialog("option","title",lstMsg[207]+" "+lstRowAct.DET_FOLIO);$("#dialog2").dialog("open");},error:function(objeto,quepaso,otroobj){alert("edo_cta4:"+objeto+" "+quepaso+" "+otroobj);}});}}function ImprimirEdoCtaBco(){var intIdBco=document.getElementById("ED_BANCO").value;var strPeriodo=document.getElementById("ED_PERIODO").value;var intIdMoneda=document.getElementById("ED_MONEDA").value;Abrir_Link("JasperReport?REP_ID=13"+"&boton_1=PDF&Banco="+intIdBco+"&Fecha_Inicial=&Fecha_Final=&Moneda="+intIdMoneda+"&Periodo="+strPeriodo.replace("/","")+"&EMP_ID="+intEMP_ID,"_reporte",500,600,0,0);}function ImprimirEdoCtaCobro(intMcId,intMcmId){if(parseInt(intMcmId)!=0){openFormat("COBROSMAS","PDF",CreaHidden("MCM_ID",intMcmId));}else{openFormat("COBROS","PDF",CreaHidden("MC_ID",intMcId));}}function ImprimirEdoCtaFact(intIdFact){var strHtml=CreaHidden("FAC_ID",intIdFact);openWhereverFormat("ERP_SendInvoice?id="+intIdFact,"FACTURA","PDF",strHtml);}