var bolSoyMainOdcCXP=false;var strNomMainOdc=false;var strNomFormViewOdcCXP="";var strKeyViewOdcCXP="";var strTipoVtaViewOdcCXP="";var strNomOrderViewOdcCXP="";var bolCompRecepdeMasCXP=false;var bolCambioFechaInvRecepCXP=false;var dblRecCXPTasa1=0;var dblRecCXPTasa2=0;var dblRecCXPTasa3=0;var dblRecCXPTasaIEPS=0;var intUsoIEPS=0;var intRecCXPSImpVta1_2=0;var intRecCXPSImpVta1_3=0;var intRecCXPSImpVta2_3=0;var intCntPtd=-1;function vta_com_recep_cxp(){}function InitRecepODCCXP(){document.getElementById("btn1").parentNode.setAttribute("class","Oculto");myLayout.close("west");myLayout.close("east");myLayout.close("south");myLayout.close("north");var strHtml="<ul>"+getMenuItem("CallbtnCompRecepCXP1();","Guardar Recepcion","images/ptovta/CircleSave.png")+getMenuItem("CallbtnCompRecepCXP3();","Modificar Cantidad","images/ptovta/VisQty.png")+getMenuItem("CallbtnCompRecepCXP4();","Modificar Costo","images/ptovta/VisModi.png")+getMenuItem("CallbtnCompRecepCXP5();","Borrar Producto","images/ptovta/VisClose.png")+getMenuItem("CallbtnCompRecepCXP2();","Salir","images/ptovta/exitBig.png")+"</ul>";document.getElementById("TOOLBARCOM").innerHTML=strHtml;ActivaButtonsRecepOdcCXP(false,false);$("#tabsREC_ODC_CX").tabs("disable",1);$("#tabsREC_ODC_CX").tabs({fx:{height:"toggle",opacity:"toggle"}});$("#dialogWait").dialog("open");$.ajax({type:"POST",data:"keys=168",scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"xml",url:"Acceso.do",success:function(datos){var objsc=datos.getElementsByTagName("Access")[0];var lstKeys=objsc.getElementsByTagName("key");for(i=0;i<lstKeys.length;i++){var obj=lstKeys[i];}$("#dialogWait").dialog("close");setTimeout("ViewDoOdcConfirmCXP();",3000);},error:function(objeto,quepaso,otroobj){alert(":Compras recepcion:"+objeto+" "+quepaso+" "+otroobj);}});document.getElementById("btnSI").onclick=function(){ConfirmaSIRecepCxp();};document.getElementById("btnNO").onclick=function(){ConfirmaNORecepCxp();};d.getElementById("COM_SUBTOT").setAttribute("class","ui-Total");d.getElementById("COM_IEPS").setAttribute("class","ui-Total");d.getElementById("COM_IVA").setAttribute("class","ui-Total");d.getElementById("COM_TOT").setAttribute("class","ui-Total");}function OpnDiagProvCompReg(){OpnOpt("PROVEEDOR","grid","dialogProv",false,false);}function ViewDoOdcConfirmCXP(){bolSoyMainOdcCXP=false;strNomMainOdc=objMap.getNomMain();if(strNomMainOdc=="REC_ODC_CX"){bolSoyMainOdcCXP=true;}var bolPasa=true;if(bolPasa){ActivaButtonsRecepOdcCXP(true,true);var strPrefijoMasterOdc="MP";strNomOrderViewOdcCXP="MP_ID";strNomFormViewOdcCXP="MPRECEPDO";strKeyViewOdcCXP="MP_ID";var strParams="";var strFecha1=document.getElementById("VIEWC_FECHA1").value;var strFecha2=document.getElementById("VIEWC_FECHA2").value;var strId=document.getElementById("VIEWC_ID").value;if(strId!="0"&&strId!=""){strParams+="&"+strKeyViewOdcCXP+"="+strId+"";}else{if(strFecha1!=""&&strFecha2!=""){strParams+="&"+strPrefijoMasterOdc+"_FECHA1="+strFecha1+"&"+strPrefijoMasterOdc+"_FECHA2="+strFecha2+"";}if(document.getElementById("VIEWC_SUCURSAL").value!="0"){strParams+="&SC_ID="+document.getElementById("VIEWC_SUCURSAL").value+"";}if(document.getElementById("VIEWC_PV_ID").value!="0"){strParams+="&PV_ID="+document.getElementById("VIEWC_PV_ID").value+"";}if(document.getElementById("VIEWC_FOLIO").value!=""){strParams+="&"+strPrefijoMasterOdc+"_FOLIO="+document.getElementById("VIEWC_FOLIO").value+"";}if(document.getElementById("VIEWC_EMP").value!="0"){strParams+="&EMP_ID="+document.getElementById("VIEWC_EMP").value+"";}}var grid=jQuery("#VIEWC_GRID1");grid.setGridParam({url:"CIP_TablaOp.jsp?ID=5&opnOpt="+strNomFormViewOdcCXP+"&_search=true"+strParams});grid.setGridParam({sortname:strNomOrderViewOdcCXP}).trigger("reloadGrid");}}function resetGridViewRecepOdcCXP(){var grid=jQuery("#VIEW_GRID1");grid.clearGridData();}function ActivaButtonsRecepOdcCXP(bolRecep,bolPrint){if(bolRecep){document.getElementById("bt_RepODCV1").style.display="none";}else{document.getElementById("bt_RepODCV1").style.display="none";}if(bolPrint){document.getElementById("bt_RepODCV2").style.display="block";}else{document.getElementById("bt_RepODCV2").style.display="none";}}function RecepOdcCXPPrint(){var grid=jQuery("#VIEWC_GRID1");if(grid.getGridParam("selrow")!=null){var lstRow=grid.getRowData(grid.getGridParam("selrow"));var strHtml=CreaHidden("COM_ID",lstRow.COM_ID);openFormat("COMRECEPDO","PDF",strHtml);}}function RecepOdcCXP(){var grid=jQuery("#VIEWC_GRID1");var arr=grid.getGridParam("selarrrow");if(arr.length!=0){var strItems="";for(var i=0;i<arr.length;i++){var id=arr[i];var lstRow=grid.getRowData(id);strItems+=lstRow.MP_ID+",";}strItems=strItems.substr(0,strItems.length-1);var grid2=jQuery("#COM_GRID");grid2.clearGridData();$.ajax({type:"POST",data:"INV_ID="+strItems,scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"xml",url:"ODCMov.do?id=8",success:function(datos){var objCompra=datos.getElementsByTagName("vta_compras")[0];var lstdeta=null;var objInv=null;var lstInv=null;DrawODCRecepCXP(objCompra,lstdeta,objInv,lstInv);$("#dialogView").dialog("close");},error:function(objeto,quepaso,otroobj){alert(":com recep1:"+objeto+" "+quepaso+" "+otroobj);$("#dialogWait").dialog("close");}});}}function DrawODCRecepCXP(objCompras,lstdeta,objInv,lstInv){var boEvalProv=true;var lstODC=objCompras.getElementsByTagName("vta_compra");var intProv=0;var intMonedaC=0;var intSucC=0;for(var i=0;i<lstODC.length;i++){var objCompra=lstODC[i];if(intProv==0){intProv=objCompra.getAttribute("PV_ID");}else{if(intProv!=objCompra.getAttribute("PV_ID")){boEvalProv=false;}}if(intMonedaC==0){intMonedaC=objCompra.getAttribute("MON_ID");}else{if(intMonedaC!=objCompra.getAttribute("MON_ID")){boEvalProv=false;}}if(intSucC==0){intSucC=objCompra.getAttribute("SC_ID");}else{if(intSucC!=objCompra.getAttribute("SC_ID")){boEvalProv=false;}}}if(boEvalProv){$("#dialogWait").dialog("open");$("#tabsREC_ODC_CX").tabs("enable",1);$("#tabsREC_ODC_CX").tabs("option","active",1);document.getElementById("COM_OPER").value=strUserName;document.getElementById("COM_PEDIMENTO").value="";document.getElementById("COM_FOLIOF").value="";document.getElementById("CXP_CGASTOS").value="0";document.getElementById("COM_DESCUENTO").value="0.0";var strListCOM_ID="";var strListCOM_FOLIO="";for(var i=0;i<lstODC.length;i++){var objCompra=lstODC[i];strListCOM_ID+=objCompra.getAttribute("COM_ID")+",";strListCOM_FOLIO+=objCompra.getAttribute("COM_FOLIO")+",";document.getElementById("SC_ID").value=objCompra.getAttribute("SC_ID");dblRecCXPTasa1=objCompra.getAttribute("COM_TASA1");dblRecCXPTasa2=objCompra.getAttribute("COM_TASA2");dblRecCXPTasa3=objCompra.getAttribute("COM_TASA3");dblRecCXPTasaIEPS=objCompra.getAttribute("COM_TASA_IEPS");intUsoIEPS=objCompra.getAttribute("COM_USO_IEPS");}document.getElementById("COM_ID").value=strListCOM_ID;document.getElementById("COM_FOLIO").value=strListCOM_FOLIO;ObtenNomProvODCRecepCXP(objCompras,lstdeta,objInv,lstInv,true);}else{alert(lstMsg[87]);}}function ObtenNomProvODCRecepCXP(objODC,lstdeta,objInv,lstInv,bolPasaODC){var objCompra=objODC.getElementsByTagName("vta_compra")[0];var intPv=objCompra.getAttribute("PV_ID");if(bolPasaODC==undefined){bolPasaODC=false;}ValidaClean("COM_PROV");$.ajax({type:"POST",data:"PV_ID="+intPv,scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"xml",url:"CXPMov.do?id=9",success:function(datoVal){var objPov=datoVal.getElementsByTagName("vta_proveedores")[0];if(objPov.getAttribute("PV_ID")==0){document.getElementById("COM_PROV").value="***************";alert("EL proveedor no existe");}else{document.getElementById("COM_PROV").value=objPov.getAttribute("PV_RAZONSOCIAL");if(objPov.getAttribute("PV_TIPOPERS")!=3){LoadDataCGastosRecep(3);document.getElementById("COM_PEDIMENTO").style.display="none";}else{LoadDataCGastosRecep(2);document.getElementById("COM_PEDIMENTO").style.display="block";
}}if(bolPasaODC){DrawODCDetaRecepCXP(objODC,lstdeta,objInv,lstInv);}},error:function(objeto,quepaso,otroobj){document.getElementById("PV_NOM").value="***************";alert("ODC prov1:"+objeto+" "+quepaso+" "+otroobj);}});}function DrawODCDetaRecepCXP(objCompras){var lstODC=objCompras.getElementsByTagName("vta_compra");for(var mn=0;mn<lstODC.length;mn++){var objCompra=lstODC[mn];var lstdeta=objCompra.getElementsByTagName("deta");var objInv=objCompra.getElementsByTagName("Inv");for(k=0;k<objInv.length;k++){var objInvD=objInv[k];var lstInv=objInvD.getElementsByTagName("detaInv");for(i=0;i<lstInv.length;i++){var obj=lstInv[i];var objDetaCompra=null;for(y=0;y<lstdeta.length;y++){var obj2=lstdeta[y];if(obj.getAttribute("MPD_IDORIGEN")==obj2.getAttribute("COMD_ID")){objDetaCompra=obj2;}}var dblCosto=0;var dblImporte=0;if(objDetaCompra!=null){var dblCantidadxConf=obj.getAttribute("MPD_ENTRADAS")-obj.getAttribute("MPD_CANT_CONF");if(dblCantidadxConf>0){dblCosto=objDetaCompra.getAttribute("COMD_COSTO");dblImporte=objDetaCompra.getAttribute("COMD_COSTO")*dblCantidadxConf;intCntPtd++;var datarow={COMD_ID:obj.getAttribute("MPD_ID"),COMD_CVE:objDetaCompra.getAttribute("COMD_CVE"),COMD_DESCRIPCION:objDetaCompra.getAttribute("COMD_DESCRIPCION"),COMD_CANTIDAD:dblCantidadxConf,COMD_CANTIDAD_CONF:dblCantidadxConf,COMD_IMPORTE:dblImporte,COMD_COSTO:dblCosto,COMD_NOTAS:objDetaCompra.getAttribute("COMD_NOTAS"),COMD_PR_ID:objDetaCompra.getAttribute("PR_ID"),COMD_MP_ID:obj.getAttribute("MP_ID"),COMD_DESCUENTO:0,COMD_PRORRATEO:0};jQuery("#COM_GRID").addRowData(intCntPtd,datarow,"last");}}else{alert(lstMsg[158]);}}}}SetSumODCRecepCXP();$("#dialogWait").dialog("close");}function CallbtnCompRecepCXP1(){SaveODCRecepCXP();}function CallbtnCompRecepCXP2(){$("#tabsREC_ODC_CX").tabs("option","active",0);$("#tabsREC_ODC_CX").tabs("disable",1);}function CallbtnCompRecepCXP3(){ModificaCantRecepCXP();}function CallbtnCompRecepCXP4(){ModificaCostoRecepCXP();}function CallbtnCompRecepCXP5(){BorraItemCostoRecepCXP();}function ModificaCostoRecepCXP(){var grid=jQuery("#COM_GRID");var ids=grid.getGridParam("selrow");if(ids!=null){var lstRow=grid.getRowData(ids);document.getElementById("Operac").value="CHANGE_COST";$("#SioNO").dialog("option","title",lstMsg[78]);var div=document.getElementById("SioNO_inside");var strHtml=CreaTexto(lstMsg[8],"_NvoCost",lstRow.COMD_COSTO,10,10,true,false,"","left",0,"","","",false,1);strHtml+=CreaRadio(lstMsg[9],"_NvoClean",0,false," ");div.innerHTML=strHtml;$("#SioNO").dialog("open");}}function ModificaCostoRecepCXPDo(){var grid=jQuery("#COM_GRID");var id=grid.getGridParam("selrow");if(id!=null){var lstRow=grid.getRowData(id);lstRow.COMD_COSTO=document.getElementById("_NvoCost").value;var dblImporte=0;if(parseInt(lstRow.COMD_PRORRATEO)==1){dblImporte=lstRow.COMD_COSTO*lstRow.COMD_CANTIDAD;}else{dblImporte=lstRow.COMD_COSTO*lstRow.COMD_CANTIDAD_CONF;}lstRow.COMD_IMPORTE=FormatNumber(dblImporte,intNumdecimal,true);grid.setRowData(id,lstRow);SetSumODCRecepCXP();}}function BorraItemCostoRecepCXP(){var grid=jQuery("#COM_GRID");if(grid.getGridParam("selrow")!=null){var lstRow=grid.getRowData(grid.getGridParam("selrow"));if(parseInt(lstRow.COMD_PRORRATEO)==1){grid.delRowData(grid.getGridParam("selrow"));document.getElementById("COM_PROD").focus();SetSumODCRecepCXP();}else{alert(lstMsg[165]);}}}function SetSumODCRecepCXP(){var grid=jQuery("#COM_GRID");var arr=grid.getDataIDs();var dblSuma=0;for(var i=0;i<arr.length;i++){var id=arr[i];var lstRow=grid.getRowData(id);dblSuma+=(parseFloat(lstRow.COMD_IMPORTE))-parseFloat((lstRow.COMD_DESCUENTO));}var tax=new Impuestos(dblRecCXPTasa1,dblRecCXPTasa2,dblRecCXPTasa3,intRecCXPSImpVta1_2,intRecCXPSImpVta1_3,intRecCXPSImpVta2_3);tax.CalculaImpuestoMas(dblSuma,0,0);var dblImpuesto1=tax.dblImpuesto1;var dblIEPS=0;if(intUsoIEPS==1){if(dblRecCXPTasaIEPS!=0){try{dblIEPS=dblSuma*(parseFloat(dblRecCXPTasaIEPS)/100);}catch(err){}tax=new Impuestos(dblRecCXPTasa1,dblRecCXPTasa2,dblRecCXPTasa3,intRecCXPSImpVta1_2,intRecCXPSImpVta1_3,intRecCXPSImpVta2_3);tax.CalculaImpuestoMas(dblIEPS,0,0);dblImpuesto1+=tax.dblImpuesto1;}}var dblTotal=dblImpuesto1+dblSuma+dblIEPS;d.getElementById("COM_SUBTOT").value=(dblSuma);d.getElementById("COM_IEPS").value=(dblIEPS);d.getElementById("COM_IVA").value=(dblImpuesto1);d.getElementById("COM_TOT").value=(dblTotal);$("#COM_SUBTOT").formatCurrency({colorize:true,region:"es-MX"});$("#COM_IEPS").formatCurrency({colorize:true,region:"es-MX"});$("#COM_IVA").formatCurrency({colorize:true,region:"es-MX"});$("#COM_TOT").formatCurrency({colorize:true,region:"es-MX"});}function dblClickODCRecepCXP(id){RecepOdcCXP();}function SaveODCRecepCXP(){var dblTot=parseFloat($("#COM_TOT").asNumber());if(dblTot>0){var grid=jQuery("#COM_GRID");var lstIds=grid.getDataIDs();var bolPasa=true;for(var i=0;i<lstIds.length;i++){var id=lstIds[i];var lstRow=grid.getRowData(id);if(lstRow.COMD_CGID==0){bolPasa=false;}}if(document.getElementById("COM_FOLIOF").value==""){alert(lstMsg[92]);bolPasa=false;}if(bolPasa){SaveODCRecepCXPDoCXP();}else{alert(lstMsg[91]);}}else{alert(lstMsg[85]);}}function SaveODCRecepCXPDoCXP(){$("#dialogWait").dialog("open");var strPOST="";strPOST+="COM_ID="+d.getElementById("COM_ID").value;strPOST+="&COM_FECHA="+d.getElementById("COM_FECHA_FACTURA").value;strPOST+="&CXP_FECHA_CONFIRMA="+d.getElementById("COM_FECHA").value;strPOST+="&COM_SUBTOT="+$("#COM_SUBTOT").asNumber();strPOST+="&COM_IEPS="+$("#COM_IEPS").asNumber();strPOST+="&COM_IMPUESTO1="+$("#COM_IVA").asNumber();strPOST+="&COM_IMPUESTO2=0";strPOST+="&COM_IMPUESTO3=0";strPOST+="&COM_TOT="+$("#COM_TOT").asNumber();strPOST+="&COM_PEDIMENTO="+d.getElementById("COM_PEDIMENTO").value;strPOST+="&PED_ID="+d.getElementById("PED_ID").value;strPOST+="&COM_FOLIOF="+d.getElementById("COM_FOLIOF").value;strPOST+="&COM_DESCUENTO="+d.getElementById("COM_DESCUENTO").value;strPOST+="&COM_UUID="+d.getElementById("COM_UUID").value;var grid=jQuery("#COM_GRID");var arr=grid.getDataIDs();var intC=0;for(var i=0;i<arr.length;i++){var id=arr[i];var lstRow=grid.getRowData(id);intC++;var tax=new Impuestos(dblRecCXPTasa1,dblRecCXPTasa2,dblRecCXPTasa3,intRecCXPSImpVta1_2,intRecCXPSImpVta1_3,intRecCXPSImpVta2_3);tax.CalculaImpuestoMas(lstRow.COMD_IMPORTE,0,0);var dblImpuesto1=tax.dblImpuesto1;strPOST+="&COMD_ID"+intC+"="+lstRow.COMD_ID;strPOST+="&COMD_MP_ID"+intC+"="+lstRow.COMD_MP_ID;strPOST+="&PR_ID"+intC+"="+lstRow.COMD_PR_ID;strPOST+="&COMD_CVE"+intC+"="+lstRow.COMD_CVE;strPOST+="&COMD_CANTIDADSURTIDA"+intC+"="+lstRow.COMD_CANTIDAD_CONF;strPOST+="&COMD_CANTIDAD"+intC+"="+lstRow.COMD_CANTIDAD;strPOST+="&COMD_CGID"+intC+"="+lstRow.COMD_CGID;strPOST+="&COMD_COSTO"+intC+"="+lstRow.COMD_COSTO;strPOST+="&COMD_DESCRIPCION"+intC+"="+lstRow.COMD_DESCRIPCION;strPOST+="&COMD_IMPORTE"+intC+"="+lstRow.COMD_IMPORTE;strPOST+="&COMD_DESCUENTO"+intC+"="+lstRow.COMD_DESCUENTO;strPOST+="&COMD_PRORRATEO"+intC+"="+lstRow.COMD_PRORRATEO;strPOST+="&COMD_IMPUESTO1"+intC+"="+dblImpuesto1;strPOST+="&COMD_IMPUESTO2"+intC+"=0";strPOST+="&COMD_IMPUESTO3"+intC+"=0";strPOST+="&COMD_EXENTO1"+intC+"=0";strPOST+="&COMD_EXENTO2"+intC+"=0";strPOST+="&COMD_EXENTO3"+intC+"=0";}strPOST+="&COUNT_ITEM="+intC;$.ajax({type:"POST",data:encodeURI(strPOST),scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"html",url:"ODCMov.do?id=11",success:function(dato){dato=trim(dato);if(Left(dato,3)=="OK."){var strHtml2=CreaHidden("CXP_ID",dato.replace("OK.",""));openFormat("CUENTAXPAGAR","PDF",strHtml2);CallbtnCompRecepCXP2();var gridV=jQuery("#VIEWC_GRID1");gridV.setGridParam({sortname:strNomOrderViewOdcCXP}).trigger("reloadGrid");}else{alert(dato);}$("#dialogWait").dialog("close");},error:function(objeto,quepaso,otroobj){alert(":ODC Recep Save:"+objeto+" "+quepaso+" "+otroobj);$("#dialogWait").dialog("close");}});}function RecepOdcExitCXP(){myLayout.open("west");myLayout.open("east");myLayout.open("south");myLayout.open("north");document.getElementById("MainPanel").innerHTML="";var objMainFacPedi=objMap.getScreen("REC_ODC_CX");
objMainFacPedi.bolActivo=false;objMainFacPedi.bolMain=false;objMainFacPedi.bolInit=false;objMainFacPedi.idOperAct=0;}function ObtenPediODCRecepCXP(){var strPedimento=document.getElementById("COM_PEDIMENTO").value;document.getElementById("PED_ID").value="";if(strPedimento!=""){$("#dialogWait").dialog("open");ValidaClean("COM_PEDIMENTO");$.ajax({type:"POST",data:"PEDIMENTO="+strPedimento,scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"xml",url:"ODCMov.do?id=9",success:function(datoVal){var objPov=datoVal.getElementsByTagName("vta_pedimentos")[0];if(objPov.getAttribute("PED_ID")==0){document.getElementById("COM_PEDIMENTO").focus();alert("El pedimento no existe");}else{if(objPov.getAttribute("PED_APLICADO")==1){document.getElementById("COM_PEDIMENTO").value="";document.getElementById("PED_ID").value=0;alert(lstMsg[192]);}else{document.getElementById("PED_ID").value=objPov.getAttribute("PED_ID");}}$("#dialogWait").dialog("close");},error:function(objeto,quepaso,otroobj){alert("ODC PEDI CXP1:"+objeto+" "+quepaso+" "+otroobj);$("#dialogWait").dialog("close");}});}}function AsignaGastoRecepCXP(){var grid=jQuery("#COM_GRID");var id=grid.getGridParam("selrow");if(id!=null){if(document.getElementById("CXP_CGASTOS").value!=0){var lstRow=grid.getRowData(id);lstRow.COMD_GASTOS=document.getElementById("CXP_CGASTOS").options[document.getElementById("CXP_CGASTOS").selectedIndex].text;lstRow.COMD_CGID=document.getElementById("CXP_CGASTOS").value;grid.setRowData(id,lstRow);}else{alert(lstMsg[86]);}}}function ModificaCantRecepCXP(){var grid=jQuery("#COM_GRID");var id=grid.getGridParam("selrow");if(id!=null){var lstRow=grid.getRowData(id);document.getElementById("Operac").value="CHANGE_CANT";$("#SioNO").dialog("option","title",lstMsg[88]);var div=document.getElementById("SioNO_inside");var strHtml=CreaTexto(lstMsg[89],"_NvoCant",lstRow.COMD_CANTIDAD_CONF,10,10,true,false,"","left",0,"","","",false,1);div.innerHTML=strHtml;$("#SioNO").dialog("open");}}function ModificaCantRecepCXPDo(){var grid=jQuery("#COM_GRID");var id=grid.getGridParam("selrow");if(id!=null){var lstRow=grid.getRowData(id);if(parseFloat(document.getElementById("_NvoCant").value)>lstRow.COMD_CANTIDAD){alert(lstMsg[90]);}else{lstRow.COMD_CANTIDAD_CONF=document.getElementById("_NvoCant").value;var dblImporte=lstRow.COMD_COSTO*lstRow.COMD_CANTIDAD_CONF;lstRow.COMD_IMPORTE=FormatNumber(dblImporte,intNumdecimal,true);grid.setRowData(id,lstRow);SetSumODCRecepCXP();}}}function ConfirmaSIRecepCxp(){if(d.getElementById("Operac").value=="CHANGE_CANT"){ModificaCantRecepCXPDo();}if(d.getElementById("Operac").value=="CHANGE_COST"){ModificaCostoRecepCXPDo();}$("#SioNO").dialog("close");}function ConfirmaNORecepCxp(){$("#SioNO").dialog("close");}function AsignaGastoRecepCXPAll(){if(document.getElementById("CXP_CGASTOS").value!=0){var grid=jQuery("#COM_GRID");var lstIds=grid.getDataIDs();for(var i=0;i<lstIds.length;i++){var id=lstIds[i];var lstRow=grid.getRowData(id);lstRow.COMD_GASTOS=document.getElementById("CXP_CGASTOS").options[document.getElementById("CXP_CGASTOS").selectedIndex].text;lstRow.COMD_CGID=document.getElementById("CXP_CGASTOS").value;grid.setRowData(id,lstRow);}}else{alert(lstMsg[86]);}}function AplicaDescRecepCXP(){var grid=jQuery("#COM_GRID");var descuento=document.getElementById("COM_DESCUENTO").value;var subtotal=$("#COM_SUBTOT").asNumber();var lstIds=grid.getDataIDs();for(var i=0;i<lstIds.length;i++){var id=lstIds[i];var lstRow=grid.getRowData(id);var dblPorTmp=parseFloat(lstRow.COMD_IMPORTE)/parseFloat(subtotal);var dblDescP=dblPorTmp*descuento;lstRow.COMD_DESCUENTO=FormatNumber(dblDescP,intNumdecimal,true,false,true,false);grid.setRowData(id,lstRow);}SetSumODCRecepCXP();}function OpnDiagComRecepPedi(){OpnOpt("PEDI_MTO","grid","dialogMLM",false,false);}function OpnDiagProdROCXP(){OpnOpt("PROD","grid","dialogProd",false,false);}function AgregaItemRCXP(){var dblCosto=document.getElementById("COM_PRECIO").value;var dblCantidad=document.getElementById("COM_CANT").value;var strCodigo=document.getElementById("COM_PROD").value;var strDescripcion=document.getElementById("COM_DESCRIPCION").value;var strPR_ID=document.getElementById("COM_PR_ID_PROD").value;var dblImporte=parseFloat(document.getElementById("COM_PRECIO").value)*parseFloat(dblCantidad);intCntPtd++;var datarow={COMD_ID:0,COMD_CVE:strCodigo,COMD_DESCRIPCION:strDescripcion,COMD_CANTIDAD:dblCantidad,COMD_CANTIDAD_CONF:0,COMD_IMPORTE:dblImporte,COMD_COSTO:dblCosto,COMD_NOTAS:"",COMD_PR_ID:strPR_ID,COMD_MP_ID:0,COMD_DESCUENTO:0,COMD_PRORRATEO:1};document.getElementById("COM_CANT").value=1;document.getElementById("COM_PRECIO").value=0;document.getElementById("COM_PR_ID_PROD").value=0;document.getElementById("COM_DESCRIPCION").value="";document.getElementById("COM_PROD").value="";jQuery("#COM_GRID").addRowData(intCntPtd,datarow,"last");SetSumODCRecepCXP();$("#dialogWait").dialog("close");}function AddItemEvtRCXP(event,objeto){if(event.keyCode==13){EvalProdRCXP(true);}}function EvalProdEvtRCXP(event,obj){if(event.keyCode==13){EvalProdRCXP(false);}}function EvalProdRCXP(bolAgrega){var strCod=UCase(d.getElementById("COM_PROD").value);if(trim(strCod)!=""){var bolNvo=true;var strDesc="";if(bolNvo){$("#dialogWait").dialog("open");$.ajax({type:"POST",data:encodeURI("PR_CODIGO="+strCod+"&SC_ID="+d.getElementById("SC_ID").value),scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"xml",url:"VtasMov.do?id=5",success:function(datoVal){var objProd=datoVal.getElementsByTagName("vta_productos")[0];var Pr_Id=0;if(objProd!=undefined){Pr_Id=objProd.getAttribute("PR_ID");d.getElementById("COM_DESCRIPCION").value=objProd.getAttribute("PR_DESCRIPCION");$("#dialogWait").dialog("close");if(Pr_Id!=0){strCod=objProd.getAttribute("PR_CODIGO");}}if(Pr_Id==0){alert(lstMsg[0]);document.getElementById("COM_PROD").focus();$("#dialogWait").dialog("close");}else{d.getElementById("COM_PR_ID_PROD").value=Pr_Id;d.getElementById("COM_PRECIO").value=objProd.getAttribute("PR_COSTOCOMPRA");if(bolAgrega){AgregaItemRCXP();}else{d.getElementById("COM_CANT").focus();d.getElementById("COM_CANT").select();}}},error:function(objeto,quepaso,otroobj){alert(":g:"+objeto+" "+quepaso+" "+otroobj);$("#dialogWait").dialog("close");}});}else{d.getElementById("COM_PROD").value=strDesc;d.getElementById("COM_PRECIO").value=0;d.getElementById("COM_CANT").focus();d.getElementById("COM_CANT").select();}}}function LoadDataCGastosRecep(intTipoCXP){$("#dialogWait").dialog("open");$.ajax({type:"POST",data:encodeURI("CXP_TIPO="+intTipoCXP),scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"xml",url:"CXPMov.do?id=10",success:function(datos){var objGastos=datos.getElementsByTagName("cgastos")[0];var lstGastos=objGastos.getElementsByTagName("cgasto");var objSelDest=document.getElementById("CXP_CGASTOS");select_clear(objSelDest);for(var i=0;i<lstGastos.length;i++){var obj=lstGastos[i];if(obj.getAttribute("hijos")==0){select_add(objSelDest,obj.getAttribute("desc"),obj.getAttribute("id"));}else{select_addOptGroup(objSelDest,obj.getAttribute("desc"),obj.getAttribute("id"));}}$("#dialogWait").dialog("close");},error:function(objeto,quepaso,otroobj){alert(":cgastos_cxp:"+objeto+" "+quepaso+" "+otroobj);$("#dialogWait").dialog("close");}});}