function vta_conteo_ciclico(){}var lastselConteo=0;function ocultar(){var grid=jQuery("#CC_GRID");grid.hideCol("CCD_CONTEO2");}function getArticulos(){var intSucursal=document.getElementById("CC_SUCURSAL").value;$.ajax({type:"POST",data:"SUCURSAL="+intSucursal,scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"html",url:"ERP_ConteoCiclico.jsp?id=2",success:function(datos){document.getElementById("CC_REGISTRO").value=datos;},error:function(objeto,quepaso,otroobj){alert(":pto2:"+objeto+" "+quepaso+" "+otroobj);}});}function generaBodega(){var intSucursal=document.getElementById("CC_SUCURSAL").value;$.ajax({type:"POST",data:"SUCURSAL="+intSucursal,scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"html",url:"ERP_ConteoCiclico.jsp?id=3",success:function(datos){document.getElementById("CC_BODEGA").value=intSucursal;document.getElementById("CC_STATUS").value=parseInt(datos);},error:function(objeto,quepaso,otroobj){alert(":pto2:"+objeto+" "+quepaso+" "+otroobj);}});}function viewGrid(){var intSucursal=document.getElementById("CC_SUCURSAL").value;if(intSucursal==0){alert("Selecciona una sucursal");return false;}var intstatus=document.getElementById("CC_STATUS").value;if(intstatus==0){alert("Selecciona un tipo de status ");return false;}$("#dialogWait").dialog("open");var intBodega=document.getElementById("CC_BODEGA").intSucursal;var strFechaFinal=document.getElementById("CC_FECHA").value;if(strFechaFinal==null){alert("Selecciona periodo de fecha ");return false;}getArticulos();var strPOST="&FECHAFINAL="+strFechaFinal;strPOST+="&SUCURSAL="+intSucursal;strPOST+="&BODEGA="+intBodega;$.ajax({type:"POST",data:strPOST,scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"xml",url:"ERP_ConteoCiclico.jsp?id=1",success:function(datos){var objsc=datos.getElementsByTagName("productos")[0];var lstinventarios=objsc.getElementsByTagName("Docs");jQuery("#CC_GRID").clearGridData();for(var i=0;i<lstinventarios.length;i++){var obj=lstinventarios[i];var mostrar={PR_ID:obj.getAttribute("Codigo"),PR_DESCRIPCION:obj.getAttribute("Descripcion"),CCD_CANT_EXIST:obj.getAttribute("Existencia")};jQuery("#CC_GRID").addRowData(i,mostrar,"last");}$("#dialogWait").dialog("close");},error:function(objeto,quepaso,otroobj){alert("ERROR  :"+objeto+" "+quepaso+" "+otroobj);$("#dialogWait").dialog("close");}});}function doSaveGrid(datos){var intIdSave=0;if(datos!=null){intIdSave=trim(datos).replace("OK","");}else{intIdSave=document.getElementById("CC_ID").value;}var intConta=0;var strPost="";strPost+="&CC_ID="+intIdSave;var grid=jQuery("#CC_GRID");var arr=grid.getDataIDs();for(var i=0;i<arr.length;i++){var idRow=arr[i];intConta++;var lstRow=grid.getRowData(idRow);strPost+="&PR_ID"+i+"="+lstRow.PR_ID;strPost+="&PR_DESCRIPCION"+i+"="+lstRow.PR_DESCRIPCION;strPost+="&CCD_CANT_EXIST"+i+"="+lstRow.CCD_CANT_EXIST;strPost+="&CCD_TEXTIL"+i+"="+lstRow.CCD_TEXTIL;strPost+="&CCD_ADERIBLE"+i+"="+lstRow.CCD_ADERIBLE;strPost+="&CCD_CONTEO1"+i+"="+lstRow.CCD_CONTEO1;strPost+="&CCD_CONTEO2"+i+"="+lstRow.CCD_CONTEO2;}strPost+="&CONTADOR="+intConta;$.ajax({type:"POST",data:encodeURI(strPost),scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"html",url:"ERP_ConteoCiclico.jsp?id=4",success:function(datos){if(datos.substring(0,2)=="OK"){_objSc.RestoreSave();_objSc=null;}else{alert(datos);}$("#dialogWait").dialog("close");},error:function(objeto,quepaso,otroobj){alert(":pto:"+objeto+" "+quepaso+" "+otroobj);}});}function verGrid(){var intIdSave=0;intIdSave=document.getElementById("CC_ID").value;ocultarConteo();$.ajax({type:"POST",data:"CC_ID="+intIdSave,scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"xml",url:"ERP_ConteoCiclico.jsp?id=5",success:function(datos){var objsc=datos.getElementsByTagName("lstDeta")[0];var lstinventarios=objsc.getElementsByTagName("deta");jQuery("#CC_GRID").clearGridData();for(var i=0;i<lstinventarios.length;i++){var obj=lstinventarios[i];var mostrar={CCD_ID:obj.getAttribute("IDD"),PR_ID:obj.getAttribute("Codigo"),PR_DESCRIPCION:obj.getAttribute("Descripcion"),CCD_CANT_EXIST:obj.getAttribute("Existencia"),CCD_CONTEO1:obj.getAttribute("Conteo_1"),CCD_CONTEO2:obj.getAttribute("Conteo_2"),CCD_TEXTIL:obj.getAttribute("Textil"),CCD_ADERIBLE:obj.getAttribute("Aderible"),CC_ID:obj.getAttribute("ID"),CCD_DIFERENCIA:obj.getAttribute("Diferencia")};jQuery("#CC_GRID").addRowData(i,mostrar,"last");}$("#dialogWait").dialog("close");},error:function(objeto,quepaso,otroobj){alert("ERROR  :"+objeto+" "+quepaso+" "+otroobj);$("#dialogWait").dialog("close");}});}function InitConteo(){}var lastselConteo=0;var flagGuardar=false;function editFilaConteo(id){flagGuardar=true;var grid=jQuery("#CC_GRID");if(id!==lastselConteo){grid.saveRow(lastselConteo);grid.editRow(id,false);lastselConteo=id;}}function editGridConteo(e){if(e.originalEvent.keyCode==13){var grid=jQuery("#CC_GRID");grid.saveRow(lastselConteo);lastselConteo=0;flagGuardar=false;}}function ocultarConteo(){document.getElementById("CC_BTN_AUTORIZAR").style.display="none";document.getElementById("CC_BTN_APLICAR").style.display="none";var grid=jQuery("#CC_GRID");var cond=document.getElementById("CC_STATUS").value;var botonU=document.getElementById("CC_BTN_CERRAR_CONT1");var botonD=document.getElementById("CC_BTN_CERRAR_CONT2");if(cond==1|cond==2){grid.hideCol("CCD_CONTEO2");botonD.style.display="none";grid.hideCol("CCD_DIFERENCIA");}if(cond==4){grid.hideCol("CCD_CONTEO1");botonU.style.display="none";grid.showCol("CCD_CONTEO2");botonD.style.display="block";grid.hideCol("CCD_DIFERENCIA");}if(cond==3|cond==5|cond==6){grid.hideCol("CCD_CONTEO1");grid.hideCol("CCD_CONTEO2");botonU.style.display="none";botonD.style.display="none";grid.showCol("CCD_DIFERENCIA");}if(document.getElementById("CC_BTN_APLICAR").style.display=="none"&cond==6){document.getElementById("CC_BTN_APLICAR").style.display="block";grid.showCol("CCD_DIFERENCIA");}if(document.getElementById("CC_BTN_AUTORIZAR").style.display=="none"&cond==5){document.getElementById("CC_BTN_AUTORIZAR").style.display="block";}}var banderaBorrar=false;function buscarConteo(){var condStat=document.getElementById("CC_STATUS").value;var comp=document.getElementById("CC_CODIGO").value;var grid=jQuery("#CC_GRID");if(condStat==3|condStat==6|condStat==5){alert("No puede agregar, los CONTEOS han sido CERRADOS");}else{if(flagGuardar){alert("DEBES GUARDAR LOS CAMPOS CON UN ENTER SOBRE EL CAMPO");flagGuardar=false;}else{var arr=grid.getDataIDs();for(var i=0;i<arr.length;i++){var id=arr[i];var lstRowAct=grid.getRowData(id);if(comp==lstRowAct.PR_ID){if(condStat==1|condStat==2){lstRowAct.CCD_CONTEO1=parseFloat(lstRowAct.CCD_CONTEO1)+1;grid.setRowData(id,lstRowAct);}if(condStat==4){lstRowAct.CCD_CONTEO2=parseFloat(lstRowAct.CCD_CONTEO2)+1;grid.setRowData(id,lstRowAct);}}}}}banderaBorrar=true;}function evalCCEvt(event,obj){if(event.keyCode==13){buscarConteo();if(banderaBorrar){document.getElementById("CC_CODIGO").value="";}}}function guardarDatos(){if(flagGuardar){alert("DEBES GUARDAR LOS CAMPOS CON UN ENTER SOBRE EL CAMPO");flagGuardar=false;}else{var intIdSave=0;intIdSave=document.getElementById("CC_ID").value;var intConta=0;var strPost="";strPost+="&CC_ID="+intIdSave;var grid=jQuery("#CC_GRID");var arr=grid.getDataIDs();for(var i=0;i<arr.length;i++){var idRow=arr[i];intConta++;var lstRow=grid.getRowData(idRow);strPost+="&PR_ID"+i+"="+lstRow.PR_ID;strPost+="&PR_DESCRIPCION"+i+"="+lstRow.PR_DESCRIPCION;strPost+="&CCD_CANT_EXIST"+i+"="+lstRow.CCD_CANT_EXIST;strPost+="&CCD_TEXTIL"+i+"="+lstRow.CCD_TEXTIL;strPost+="&CCD_ADERIBLE"+i+"="+lstRow.CCD_ADERIBLE;strPost+="&CCD_CONTEO1"+i+"="+lstRow.CCD_CONTEO1;if(conteo2){strPost+="&CCD_CONTEO2"+i+"="+lstRow.CCD_CONTEO2;}strPost+="&CCD_ID"+i+"="+lstRow.CCD_ID;strPost+="&CCD_DIFERENCIA"+i+"="+lstRow.CCD_DIFERENCIA;}strPost+="&CONTADOR="+intConta;
$.ajax({type:"POST",data:encodeURI(strPost),scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"html",url:"ERP_ConteoCiclico.jsp?id=4",success:function(datos){if(datos.substring(0,2)=="OK"){_objSc.RestoreSave();_objSc=null;}else{alert(datos);}$("#dialogWait").dialog("close");},error:function(objeto,quepaso,otroobj){alert(":pto:"+objeto+" "+quepaso+" "+otroobj);}});}}var conteo2=true;function cerrarConteo1(){conteo2=false;if(flagGuardar){alert("DEBES GUARDAR LOS CAMPOS CON UN ENTER SOBRE EL CAMPO");flagGuardar=false;}else{document.getElementById("CC_STATUS").value="";document.getElementById("CC_STATUS").value="4";var intIdSave=0;intIdSave=document.getElementById("CC_ID").value;var strPost="";strPost+="&CC_ID="+intIdSave;$.ajax({type:"POST",data:encodeURI(strPost),scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"html",url:"ERP_ConteoCiclico.jsp?id=6",success:function(datos){ocultarConteo();$("#dialogWait").dialog("close");},error:function(objeto,quepaso,otroobj){alert(":pto:"+objeto+" "+quepaso+" "+otroobj);}});}}function cerrarConteo2(){if(flagGuardar){alert("DEBES GUARDAR LOS CAMPOS CON UN ENTER SOBRE EL CAMPO");flagGuardar=false;}else{document.getElementById("CC_STATUS").value="";document.getElementById("CC_STATUS").value="5";var intIdSave=0;intIdSave=document.getElementById("CC_ID").value;var strPost="";strPost+="&CC_ID="+intIdSave;$.ajax({type:"POST",data:encodeURI(strPost),scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"html",url:"ERP_ConteoCiclico.jsp?id=7",success:function(datos){ocultarConteo();$("#dialogWait").dialog("close");if(document.getElementById("CC_BTN_AUTORIZAR").style.display=="none"){document.getElementById("CC_BTN_AUTORIZAR").style.display="block";}},error:function(objeto,quepaso,otroobj){alert(":pto:"+objeto+" "+quepaso+" "+otroobj);}});}}function autorizar(){if(flagGuardar){alert("DEBES GUARDAR LOS CAMPOS CON UN ENTER SOBRE EL CAMPO");flagGuardar=false;}else{document.getElementById("CC_STATUS").value="";document.getElementById("CC_STATUS").value="6";var intIdSave=0;intIdSave=document.getElementById("CC_ID").value;var strPost="";strPost+="&CC_ID="+intIdSave;$.ajax({type:"POST",data:encodeURI(strPost),scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"html",url:"ERP_ConteoCiclico.jsp?id=8",success:function(datos){ocultarConteo();$("#dialogWait").dialog("close");if(document.getElementById("CC_BTN_APLICAR").style.display=="none"){document.getElementById("CC_BTN_APLICAR").style.display="block";}},error:function(objeto,quepaso,otroobj){alert(":pto:"+objeto+" "+quepaso+" "+otroobj);}});}}function aplicar(){if(flagGuardar){alert("DEBES GUARDAR LOS CAMPOS CON UN ENTER SOBRE EL CAMPO");flagGuardar=false;}else{document.getElementById("CC_STATUS").value="";document.getElementById("CC_STATUS").value="3";var intIdSave=0;intIdSave=document.getElementById("CC_ID").value;var strPost="";strPost+="&CC_ID="+intIdSave;$.ajax({type:"POST",data:encodeURI(strPost),scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"html",url:"ERP_ConteoCiclico.jsp?id=9",success:function(datos){ocultarConteo();$("#dialogWait").dialog("close");alert("Los conteos se han cerrado,Guarde antes de salir");},error:function(objeto,quepaso,otroobj){alert(":pto:"+objeto+" "+quepaso+" "+otroobj);}});}}