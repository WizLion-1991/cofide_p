var intCT_TIPOPERSPV=0;var dblTasaVta1CXP=dblTasa1;var dblTasaVta2CXP=dblTasa2;var dblTasaVta3CXP=dblTasa3;var intIdTasaVtaCXP1=intIdTasa1;var intIdTasaVtaCXP2=intIdTasa2;var intIdTasaVtaCXP3=intIdTasa3;var intSImpVtaCXP1_2=intSImp1_2;var intSImpVtaCXP1_3=intSImp1_3;var intSImpVtaCXP2_3=intSImp2_3;var strNomTabCuentas="CXPAGAR";var intRET_ISRCXP=0;var intRET_IVACXP=0;var intRET_FLETECXP=1;var itemIdCXP=0;var bolSeleccionaCGastos=false;var bolUsaOpnProv=false;function vta_cuentas(){}function InitCuentas(){d.getElementById("btn1").setAttribute("class","Oculto");d.getElementById("CXP_OPER").value=strUserName;myLayout.close("west");myLayout.close("east");myLayout.close("south");myLayout.close("north");var strHtml="<ul>"+getMenuItem("CallbtnCXP0();","Guardar Cuenta","images/ptovta/CircleSave.png")+getMenuItem("CallbtnCXP1();","Nueva Cuenta","images/ptovta/VisPlus.png")+getMenuItem("CallbtnCXP2();","Consultar Cuenta","images/ptovta/VisMagnifier.png")+getMenuItem("CallbtnCXP8();","Notas","images/ptovta/VisNote.png")+getMenuItem("CallbtnCXP7();","Borrar Producto","images/ptovta/VisClose.png")+getMenuItem("CallbtnCXP9();","Salir","images/ptovta/exitBig.png")+"</ul>";document.getElementById("TOOLBAR").innerHTML=strHtml;document.getElementById("btnSI").onclick=function(){ConfirmaSICXP();};document.getElementById("btnNO").onclick=function(){ConfirmaNOCXP();};$("#dialogWait").dialog("open");$.ajax({type:"POST",data:"keys=453",scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"xml",url:"Acceso.do",success:function(datos){var objsc=datos.getElementsByTagName("Access")[0];var lstKeys=objsc.getElementsByTagName("key");for(i=0;i<lstKeys.length;i++){var obj=lstKeys[i];if(obj.getAttribute("id")==453&&obj.getAttribute("enabled")=="true"){bolSeleccionaCGastos=true;}}if(!bolSeleccionaCGastos){var objTasaSel1=document.getElementById("CXP_CGASTOS");objTasaSel1.onmouseout=function(){this.disabled=false;};objTasaSel1.onmouseleave=function(){this.disabled=false;};objTasaSel1.onmouseover=function(){this.disabled=true;};objTasaSel1.setAttribute("class","READONLY");objTasaSel1.setAttribute("className","READONLY");}$("#dialogWait").dialog("close");setTimeout("LoadDataCGastos();",1000);},error:function(objeto,quepaso,otroobj){alert(":permisos cxp:"+objeto+" "+quepaso+" "+otroobj);$("#dialogWait").dialog("close");}});}function OpnDiagProv(){bolUsaOpnProv=true;OpnOpt("PROVEEDOR","grid","dialogProv",false,false);}function ObtenNomProv(objCXP,lstdeta,bolPasaCXP){var intPv=document.getElementById("FPV_ID").value;if(bolPasaCXP==undefined){bolPasaCXP=false;}ValidaClean("PV_NOM");$.ajax({type:"POST",data:"PV_ID="+intPv,scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"xml",url:"CXPMov.do?id=9",success:function(datoVal){var objPov=datoVal.getElementsByTagName("vta_proveedores")[0];if(objPov.getAttribute("PV_ID")==0){document.getElementById("PV_NOM").value="***************";alert("EL proveedor no existe");}else{document.getElementById("PV_NOM").value=objPov.getAttribute("PV_RAZONSOCIAL");document.getElementById("FPV_LPRECIOS").value=objPov.getAttribute("PV_LPRECIOS");document.getElementById("FPV_MONTOCRED").value=objPov.getAttribute("PV_MONTOCRED");if(objPov.getAttribute("PV_TIPOPERS")!=3){document.getElementById("CXP_NUMPEDI").style.display="none";}else{document.getElementById("CXP_NUMPEDI").style.display="block";}intCT_TIPOPERSPV=objPov.getAttribute("PV_TIPOPERS");if(!bolPasaCXP){document.getElementById("FPV_DESCUENTO").value=objPov.getAttribute("PV_DESCUENTO");document.getElementById("FPV_DIASCREDITO").value=objPov.getAttribute("PV_DIASCREDITO");document.getElementById("CXP_DIASCREDITO").value=objPov.getAttribute("PV_DIASCREDITO");document.getElementById("CXP_CONDPAGO").value=objPov.getAttribute("PV_CONDPAGO");if(objPov.getAttribute("MON_ID")!=0){document.getElementById("CXP_MONEDA").value=objPov.getAttribute("MON_ID");}else{document.getElementById("CXP_MONEDA").value=1;}document.getElementById("CXP_TASASEL1").value=objPov.getAttribute("TI_ID");UpdateTasaImpCXP();}}if(bolPasaCXP){DrawCXPLoad(objCXP,lstdeta);}},error:function(objeto,quepaso,otroobj){document.getElementById("PV_NOM").value="***************";alert("CXP 1:"+objeto+" "+quepaso+" "+otroobj);}});}function OpnDiagProd(){OpnOpt("PROD","grid","dialogProd",false,false);}function SaveCXPDo(){$("#dialogWait").dialog("open");var strPOST="";var strPrefijoMaster="CXP";var strPrefijoDeta="CXPD";strPOST+="&PV_ID="+d.getElementById("FPV_ID").value;strPOST+="&CXP_ID="+d.getElementById("CXP_ID").value;strPOST+="&SC_ID="+d.getElementById("SC_ID").value;strPOST+="&"+strPrefijoMaster+"_FECHA="+d.getElementById("CXP_FECHA").value;strPOST+="&"+strPrefijoMaster+"_FECHA_CONFIRMA="+d.getElementById("CXP_FECHA_CONFIRMA").value;strPOST+="&"+strPrefijoMaster+"_FECHA_PROVISION="+d.getElementById("CXP_FECHA_PROVISION").value;strPOST+="&"+strPrefijoMaster+"_IMPORTE="+d.getElementById("CXP_IMPORTE").value;strPOST+="&"+strPrefijoMaster+"_IMPUESTO1="+d.getElementById("CXP_IMPUESTO1").value;strPOST+="&"+strPrefijoMaster+"_IMPUESTO2="+d.getElementById("CXP_IMPUESTO2").value;strPOST+="&"+strPrefijoMaster+"_IMPUESTO3="+d.getElementById("CXP_IMPUESTO3").value;strPOST+="&"+strPrefijoMaster+"_TOTAL="+d.getElementById("CXP_TOT").value;strPOST+="&"+strPrefijoMaster+"_RETISR="+d.getElementById("CXP_RETISR").value;strPOST+="&"+strPrefijoMaster+"_RETIVA="+d.getElementById("CXP_RETIVA").value;strPOST+="&"+strPrefijoMaster+"_NETO="+d.getElementById("CXP_NETO").value;strPOST+="&"+strPrefijoMaster+"_FECHA="+d.getElementById("CXP_FECHA").value;strPOST+="&"+strPrefijoMaster+"_REFERENCIA="+d.getElementById("CXP_REFERENCIA").value;strPOST+="&"+strPrefijoMaster+"_IDGASTO="+d.getElementById("CXP_CGASTOS").value;strPOST+="&"+strPrefijoMaster+"_NOTAS="+d.getElementById("CXP_NOTAS").value;strPOST+="&"+strPrefijoMaster+"_CONDPAGO="+d.getElementById("CXP_CONDPAGO").value;strPOST+="&"+strPrefijoMaster+"_MONEDA="+d.getElementById("CXP_MONEDA").value;strPOST+="&"+strPrefijoMaster+"_TASA1="+dblTasaVta1CXP;strPOST+="&"+strPrefijoMaster+"_TASA2="+dblTasaVta2CXP;strPOST+="&"+strPrefijoMaster+"_TASA3="+dblTasaVta3CXP;strPOST+="&"+"TI_ID="+document.getElementById("CXP_TASASEL1").value;strPOST+="&"+"TI_ID2="+intIdTasaVtaCXP2;strPOST+="&"+"TI_ID3="+intIdTasaVtaCXP3;strPOST+="&"+strPrefijoMaster+"_RETISR="+d.getElementById("CXP_RETISR").value;strPOST+="&"+strPrefijoMaster+"_RETIVA="+d.getElementById("CXP_RETIVA").value;strPOST+="&"+strPrefijoMaster+"_NOTASPIE="+d.getElementById("CXP_NOTASPIE").value;strPOST+="&"+strPrefijoMaster+"_FOLIO="+d.getElementById("CXP_REFERENCIA").value;strPOST+="&"+strPrefijoMaster+"_NUMPEDI="+d.getElementById("CXP_NUMPEDI").value;strPOST+="&"+strPrefijoMaster+"_COSTO="+d.getElementById("CXP_COSTO").value;strPOST+="&"+strPrefijoMaster+"_ADUANA=''";strPOST+="&"+strPrefijoMaster+"_PED_ID="+d.getElementById("CXP_PED_ID").value;strPOST+="&"+strPrefijoMaster+"_DIASCREDITO="+d.getElementById("CXP_DIASCREDITO").value;strPOST+="&"+strPrefijoMaster+"_UUID="+d.getElementById("CXP_UUID").value;strPOST+="&"+strPrefijoMaster+"_XMLFILE="+d.getElementById("CXP_DATA").value;strPOST+="&"+strPrefijoMaster+"_PDFFILE="+d.getElementById("CXP_PDF_FILE").value;if(document.getElementById("CXP_USO_IEPS1").checked){strPOST+="&"+strPrefijoMaster+"_USO_IEPS=1";strPOST+="&"+strPrefijoMaster+"_TASA_IEPS="+d.getElementById("CXP_TASA_IEPS").value;strPOST+="&"+strPrefijoMaster+"_IMPORTE_IEPS="+d.getElementById("CXP_IMPORTE_IEPS").value;}else{strPOST+="&"+strPrefijoMaster+"_USO_IEPS=0";strPOST+="&"+strPrefijoMaster+"_TASA_IEPS=0";strPOST+="&"+strPrefijoMaster+"_IMPORTE_IEPS=0";}var grid=jQuery("#CXP_GRID");var arr=grid.getDataIDs();var intC=0;for(var i=0;i<arr.length;i++){var id=arr[i];var lstRow=grid.getRowData(id);intC++;strPOST+="&PR_ID"+intC+"="+lstRow.CXPD_PR_ID;strPOST+="&"+strPrefijoDeta+"_EXENTO1"+intC+"="+lstRow.CXPD_EXENTO1;strPOST+="&"+strPrefijoDeta+"_EXENTO2"+intC+"="+lstRow.CXPD_EXENTO2;
strPOST+="&"+strPrefijoDeta+"_EXENTO3"+intC+"="+lstRow.CXPD_EXENTO3;strPOST+="&"+strPrefijoDeta+"_CVE"+intC+"="+lstRow.CXPD_CVE;strPOST+="&"+strPrefijoDeta+"_DESCRIPCION"+intC+"="+lstRow.CXPD_DESCRIPCION;strPOST+="&"+strPrefijoDeta+"_CANTIDAD"+intC+"="+lstRow.CXPD_CANTIDAD;strPOST+="&"+strPrefijoDeta+"_RET_ISR"+intC+"="+lstRow.CXPD_RET_ISR;strPOST+="&"+strPrefijoDeta+"_RET_IVA"+intC+"="+lstRow.CXPD_RET_IVA;strPOST+="&"+strPrefijoDeta+"_ADD_IVA"+intC+"="+lstRow.CXPD_ADD_IVA;strPOST+="&"+strPrefijoDeta+"_MINUS_IVA"+intC+"="+lstRow.CXPD_MINUS_IVA;if(intPreciosconImp==1){strPOST+="&"+strPrefijoDeta+"_COSTO"+intC+"="+lstRow.CXPD_COSTO;strPOST+="&"+strPrefijoDeta+"_COSTOREAL"+intC+"="+lstRow.CXPD_COSTOREAL;}else{var dblPrecioConImp=0;var dblPrecioRealConImp=0;if(lstRow.CXPD_CANTIDAD>0){var dblBase1=0;var dblBase2=0;var dblBase3=0;var dblBaseReal1=0;var dblBaseReal2=0;var dblBaseReal3=0;var dblImpuesto1=0;var dblImpuesto2=0;var dblImpuesto3=0;var dblImpuestoReal1=0;var dblImpuestoReal2=0;var dblImpuestoReal3=0;if(parseInt(lstRow.CXPD_EXENTO1)==0){dblBase1=lstRow.CXPD_COSTO;}if(parseInt(lstRow.CXPD_EXENTO2)==0){dblBase2=lstRow.CXPD_COSTO;}if(parseInt(lstRow.CXPD_EXENTO3)==0){dblBase3=lstRow.CXPD_COSTO;}if(parseInt(lstRow.CXPD_EXENTO1)==0){dblBaseReal1=lstRow.CXPD_COSTOREAL;}if(parseInt(lstRow.CXPD_EXENTO2)==0){dblBaseReal2=lstRow.CXPD_COSTOREAL;}if(parseInt(lstRow.CXPD_EXENTO3)==0){dblBaseReal3=lstRow.CXPD_COSTOREAL;}var tax=new Impuestos(lstRow.CXPD_TASAIVA1,dblTasaVta2CXP,dblTasaVta3CXP,intSImpVtaCXP1_2,intSImpVtaCXP1_3,intSImpVtaCXP2_3);tax.CalculaImpuestoMas(dblBase1,dblBase2,dblBase3);var tax2=new Impuestos(lstRow.CXPD_TASAIVA1,dblTasaVta2CXP,dblTasaVta3CXP,intSImpVtaCXP1_2,intSImpVtaCXP1_3,intSImpVtaCXP2_3);tax2.CalculaImpuestoMas(dblBaseReal1,dblBaseReal2,dblBaseReal3);if(parseInt(lstRow.CXPD_EXENTO1)==0){dblImpuesto1=tax.dblImpuesto1;}if(parseInt(lstRow.CXPD_EXENTO2)==0){dblImpuesto2=tax.dblImpuesto2;}if(parseInt(lstRow.CXPD_EXENTO3)==0){dblImpuesto3=tax.dblImpuesto3;}if(parseInt(lstRow.CXPD_EXENTO1)==0){dblImpuestoReal1=tax2.dblImpuesto1;}if(parseInt(lstRow.CXPD_EXENTO2)==0){dblImpuestoReal2=tax2.dblImpuesto2;}if(parseInt(lstRow.CXPD_EXENTO3)==0){dblImpuestoReal3=tax2.dblImpuesto3;}dblPrecioConImp=(parseFloat(lstRow.CXPD_COSTO)+dblImpuesto1+dblImpuesto2+dblImpuesto3);if(lstRow.CXPD_SINPRECIO==0){dblPrecioRealConImp=(parseFloat(lstRow.CXPD_COSTOREAL)+dblImpuestoReal1+dblImpuestoReal2+dblImpuestoReal3);}else{dblPrecioRealConImp=(parseFloat(lstRow.CXPD_COSTO)+dblImpuesto1+dblImpuesto2+dblImpuesto3);lstRow.CXPD_IMPORTEREAL=dblPrecioRealConImp*lstRow.CXPD_CANTIDAD;}}else{dblPrecioConImp=(parseFloat(lstRow.CXPD_COSTO));dblPrecioRealConImp=(parseFloat(lstRow.CXPD_COSTOREAL));}strPOST+="&"+strPrefijoDeta+"_COSTO"+intC+"="+dblPrecioConImp;strPOST+="&"+strPrefijoDeta+"_COSTOREAL"+intC+"="+dblPrecioRealConImp;}strPOST+="&"+strPrefijoDeta+"_IMPORTE"+intC+"="+lstRow.CXPD_IMPORTE;strPOST+="&"+strPrefijoDeta+"_TASAIVA1"+intC+"="+lstRow.CXPD_TASAIVA1;strPOST+="&"+strPrefijoDeta+"_TASAIVA2"+intC+"=0"+lstRow.CXPD_TASAIVA2;strPOST+="&"+strPrefijoDeta+"_TASAIVA3"+intC+"="+lstRow.CXPD_TASAIVA3;strPOST+="&"+strPrefijoDeta+"_IMPUESTO1"+intC+"="+lstRow.CXPD_IMPUESTO1;strPOST+="&"+strPrefijoDeta+"_IMPUESTO2"+intC+"="+lstRow.CXPD_IMPUESTO2;strPOST+="&"+strPrefijoDeta+"_IMPUESTO3"+intC+"="+lstRow.CXPD_IMPUESTO3;strPOST+="&"+strPrefijoDeta+"_NOTAS"+intC+"="+lstRow.CXPD_NOTAS;strPOST+="&"+strPrefijoDeta+"_GASTOID"+intC+"="+lstRow.CXPD_GASTOID;strPOST+="&"+strPrefijoDeta+"_COSTOSID"+intC+"="+lstRow.CXPD_COSTOSID;}strPOST+="&COUNT_ITEM="+intC;$.ajax({type:"POST",data:encodeURI(strPOST),scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"html",url:"CXPMov.do?id=1",success:function(dato){dato=trim(dato);if(Left(dato,3)=="OK."){ResetOperaActualCXP();var strHtml2=CreaHidden("CXP_ID",dato.replace("OK.",""));openFormat("CUENTAXPAGAR","PDF",strHtml2);}else{alert(dato);}$("#dialogWait").dialog("close");},error:function(objeto,quepaso,otroobj){alert(":pto9:"+objeto+" "+quepaso+" "+otroobj);$("#dialogWait").dialog("close");}});}function AddItemEvtCXP(event,obj){if(event.keyCode==13){AddItemCXP();}}function ValidaItemCXP(){var bolValido=true;var intIdProv=d.getElementById("FPV_ID").value;var lgnCantidad=d.getElementById("CXP_CANT").value;var strProd=d.getElementById("CXP_PROD").value;var dblCosto=d.getElementById("CXP_COSTO").value;try{intIdProv=parseInt(intIdProv);lgnCantidad=parseFloat(lgnCantidad);dblCosto=parseFloat(dblCosto);if(intIdProv==0){alert(lstMsg[231]);bolValido=false;}if(lgnCantidad==0){alert(lstMsg[232]);bolValido=false;}if(bolEvaluaCodigo){if(strProd==""){alert(lstMsg[233]);bolValido=false;}}}catch(error){alert(lstMsg[235]);bolValido=false;}return bolValido;}function AddItemCXP(){var strCod=UCase(d.getElementById("CXP_PROD").value);var strTipoCXP=UCase(d.getElementById("CXP_TIPO").value);if(strTipoCXP=="1"){bolEvaluaCodigo=false;}else{bolEvaluaCodigo=true;}if(ValidaItemCXP()){if(trim(strCod)!=""||(!bolEvaluaCodigo&&trim(strCod)=="")){var intDevo=d.getElementById("CXP_DEVO").value;var bolAgrupa=d.getElementById("CXP_AGRUPA1").checked;$("#dialogWait").dialog("open");var bolNvo=true;var idProd=0;if(bolAgrupa){var grid=jQuery("#CXP_GRID");var arr=grid.getDataIDs();if(bolEvaluaCodigo||trim(strCod)!=""){for(var i=0;i<arr.length;i++){var id=arr[i];var lstRowAct=grid.getRowData(id);if(lstRowAct.CXPD_CVE==strCod||lstRowAct.CXPD_CODBARRAS==strCod){if(intDevo==1){if(lstRow.CXPD_ESDEVO==1){idProd=id;bolNvo=false;break;}}else{idProd=id;bolNvo=false;break;}}}}else{for(var i=0;i<arr.length;i++){var id=arr[i];var lstRowAct=grid.getRowData(id);if(lstRowAct.CXPD_GASTOID==parseInt(d.getElementById("CXP_CGASTOS").value)){idProd=id;bolNvo=false;break;}}}}if(bolNvo){if(trim(strCod)==""){var Ct_Id=d.getElementById("FPV_ID").value;var dblCantidad=d.getElementById("CXP_CANT").value;var intGastos=parseInt(d.getElementById("CXP_CGASTOS").value);if(intGastos==0){alert("Debe seleccionar un centro de gastos");return false;}AddItemPrecCXP(null,0,Ct_Id,dblCantidad,strCod,0,intDevo,0,"");}else{$.ajax({type:"POST",data:"PR_CODIGO="+strCod+"&SC_ID="+d.getElementById("SC_ID").value,scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"xml",url:"VtasMov.do?id=5",success:function(datoVal){var objProd=datoVal.getElementsByTagName("vta_productos")[0];var Pr_Id=0;if(objProd!=undefined){Pr_Id=objProd.getAttribute("PR_ID");d.getElementById("CXP_DESC").value=objProd.getAttribute("PR_DESCRIPCION");if(Pr_Id!=0){strCod=objProd.getAttribute("PR_CODIGO");}}var Ct_Id=d.getElementById("FPV_ID").value;var dblCantidad=d.getElementById("CXP_CANT").value;if(Pr_Id!=0){var intCGastosProd=parseInt(objProd.getAttribute("GT_ID"));if(parseInt(intCGastosProd)==0){var intGastos=d.getElementById("CXP_CGASTOS").value;if(intGastos==0){alert(lstMsg[230]);return false;}else{AddItemPrecCXP(objProd,Pr_Id,Ct_Id,dblCantidad,strCod,0,intDevo,0,"");}}else{var intGastos=parseInt(d.getElementById("CXP_CGASTOS").value);if(intGastos!=intCGastosProd){if(bolSeleccionaCGastos){var intGastosIdx=d.getElementById("CXP_CGASTOS").selectedIndex;var txtGastos=d.getElementById("CXP_CGASTOS").options[intGastosIdx].text;var aConfirm1=confirm(lstMsg[224].replace("%1",txtGastos).replace("%2",""));if(!aConfirm1){d.getElementById("CXP_CGASTOS").value=intCGastosProd;intGastos=intCGastosProd;$.ajax({type:"POST",data:"GT_ID="+intCGastosProd,scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"html",url:"ERP_Producto.jsp?id=20",success:function(datos){AddItemPrecCXP(objProd,Pr_Id,Ct_Id,dblCantidad,strCod,0,intDevo,intCGastosProd,datos);},error:function(objeto,quepaso,otroobj){alert("Paso siguiente: "+objeto+" "+quepaso+" "+otroobj);}});}else{AddItemPrecCXP(objProd,Pr_Id,Ct_Id,dblCantidad,strCod,0,intDevo,0,"");}}else{d.getElementById("CXP_CGASTOS").value=intCGastosProd;intGastos=intCGastosProd;$.ajax({type:"POST",data:"GT_ID="+intCGastosProd,scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"html",url:"ERP_Producto.jsp?id=20",success:function(datos){AddItemPrecCXP(objProd,Pr_Id,Ct_Id,dblCantidad,strCod,0,intDevo,intCGastosProd,datos);
},error:function(objeto,quepaso,otroobj){alert("Paso siguiente: "+objeto+" "+quepaso+" "+otroobj);}});}}else{d.getElementById("CXP_CGASTOS").value=intCGastosProd;AddItemPrecCXP(objProd,Pr_Id,Ct_Id,dblCantidad,strCod,0,intDevo,0,"");}}}else{alert(lstMsg[0]);d.getElementById("CXP_DEVO").value=0;document.getElementById("CXP_PROD").focus();$("#dialogWait").dialog("close");}},error:function(objeto,quepaso,otroobj){alert(":pto3:"+objeto+" "+quepaso+" "+otroobj);$("#dialogWait").dialog("close");}});}}else{var Cantidad=d.getElementById("CXP_CANT").value;var gridD=jQuery("#CXP_GRID");var lstRow=gridD.getRowData(idProd);lstRow.CXPD_CANTIDAD=parseFloat(lstRow.CXPD_CANTIDAD)+parseFloat(Cantidad);lstRowChangePrecioCXP(lstRow,idProd,gridD);document.getElementById("CXP_PROD").value="";document.getElementById("CXP_PROD").focus();d.getElementById("CXP_CANT").value=1;d.getElementById("CXP_DEVO").value=0;setSumCXP();$("#dialogWait").dialog("close");}}}}function lstRowChangePrecioCXP(lstRow,idUpdate,grid){var objImportes=new _ImporteCXPItem();objImportes.dblCantidad=parseFloat(lstRow.CXPD_CANTIDAD);objImportes.dblPrecio=parseFloat(lstRow.CXPD_COSTO);objImportes.dblPrecioReal=lstRow.CXPD_COSTOREAL;objImportes.dblPorcDescGlobal=document.getElementById("FPV_DESCUENTO").value;objImportes.dblPorcDesc=lstRow.CXPD_PORDESC;objImportes.dblPrecFijo=lstRow.CXPD_PRECFIJO;objImportes.dblExento1=lstRow.CXPD_EXENTO1;objImportes.dblExento2=lstRow.CXPD_EXENTO2;objImportes.dblExento3=lstRow.CXPD_EXENTO3;objImportes.intDevo=lstRow.CXPD_ESDEVO;objImportes.intPrecioZeros=lstRow.CXPD_SINPRECIO;if(parseFloat(dblTasaVta1CXP)!=parseFloat(lstRow.CXPD_TASAIVA1)){objImportes.dblTasaVta1CXPe=lstRow.CXPD_TASAIVA1;objImportes.bolUsoImpEspecial=true;}objImportes.CalculaImporte();lstRow.CXPD_IMPORTE=objImportes.dblImporte;lstRow.CXPD_IMPUESTO1=objImportes.dblImpuesto1;lstRow.CXPD_PORDESC=objImportes.dblPorcAplica;if(parseFloat(objImportes.dblPorcAplica)>0){if(intPreciosconImp==1){lstRow.CXPD_DESCUENTO=parseFloat(objImportes.dblImporteReal)-(parseFloat(objImportes.dblImporte));}else{lstRow.CXPD_DESCUENTO=parseFloat(objImportes.dblImporteReal)-(parseFloat(objImportes.dblImporte)-parseFloat(objImportes.dblImpuesto1));}}else{lstRow.CXPD_DESCUENTO=0;}lstRow.CXPD_IMPORTEREAL=objImportes.dblImporteReal;grid.setRowData(idUpdate,lstRow);setSumCXP();}function AddItemPrecCXP(objProd,Pr_Id,Ct_Id,Cantidad,strCod,dblExist,intDevo,intGastos,txtGastos){var dblCosto=d.getElementById("CXP_COSTO").value;var bolFind=false;var addIVA=0;var minusIVA=0;if(d.getElementById("CXP_ADD_IVA").checked){addIVA=1;}if(d.getElementById("CXP_MINUS_IVA").checked){minusIVA=1;}var objImportes=new _ImporteCXPItem();objImportes.dblCantidad=Cantidad;objImportes.dblPrecio=parseFloat(dblCosto);objImportes.dblPrecioReal=parseFloat(dblCosto);objImportes.dblPorcDescGlobal=document.getElementById("FPV_DESCUENTO").value;var _strPR_DESCRIPCION="";var _PR_REQEXIST="0";var _strPR_CODBARRAS="";var _dblTasa1Usa=dblTasaVta1CXP;if(objProd!=null){objImportes.dblExento1=objProd.getAttribute("PR_EXENTO1");objImportes.dblExento2=objProd.getAttribute("PR_EXENTO2");objImportes.dblExento3=objProd.getAttribute("PR_EXENTO3");_strPR_DESCRIPCION=objProd.getAttribute("PR_DESCRIPCION");_PR_REQEXIST=objProd.getAttribute("PR_REQEXIST");_strPR_CODBARRAS=objProd.getAttribute("PR_CODBARRAS");if(objProd.getAttribute("PR_TASA_IVA")!=0){_dblTasa1Usa=objProd.getAttribute("PR_TASA_IVA_M");objImportes.bolUsoImpEspecial=true;objImportes.dblTasaVta1CXPe=_dblTasa1Usa;}}objImportes.intDevo=intDevo;if(addIVA==1||minusIVA==1){objImportes.dblExento1=1;}objImportes.CalculaImporte();if(intGastos==0){intGastos=d.getElementById("CXP_CGASTOS").value;var intGastosIdx=d.getElementById("CXP_CGASTOS").selectedIndex;txtGastos=d.getElementById("CXP_CGASTOS").options[intGastosIdx].text;}var txtCostos;var intCostosIdx=d.getElementById("CXP_CCOSTOS").selectedIndex;txtCostos=d.getElementById("CXP_CCOSTOS").options[intCostosIdx].text;var dblImporte=objImportes.dblImporte;var datarow={CXPD_ID:0,CXPD_CANTIDAD:Cantidad,CXPD_DESCRIPCION:_strPR_DESCRIPCION,CXPD_IMPORTE:dblImporte,CXPD_CVE:strCod,CXPD_COSTO:dblCosto,CXPD_TASAIVA1:_dblTasa1Usa,CXPD_DESGLOSA1:1,CXPD_IMPUESTO1:objImportes.dblImpuesto1,CXPD_PR_ID:Pr_Id,CXPD_EXENTO1:objImportes.dblExento1,CXPD_EXENTO2:objImportes.dblExento2,CXPD_EXENTO3:objImportes.dblExento3,CXPD_REQEXIST:_PR_REQEXIST,CXPD_EXIST:dblExist,CXPD_NOSERIE:"",CXPD_ESREGALO:0,CXPD_IMPORTEREAL:dblImporte,CXPD_COSTOREAL:dblCosto,CXPD_DESCUENTO:0,CXPD_PORDESC:objImportes.dblPorcAplica,CXPD_PRECFIJO:0,CXPD_ESDEVO:intDevo,CXPD_CODBARRAS:_strPR_CODBARRAS,CXPD_NOTAS:"",CXPD_RET_ISR:intRET_ISRCXP,CXPD_RET_IVA:intRET_IVACXP,CXPD_RET_FLETE:intRET_FLETECXP,CXPD_GASTOID:intGastos,CXPD_GASTO:txtGastos,CXPD_ADD_IVA:addIVA,CXPD_MINUS_IVA:minusIVA,CXPD_COSTOS:txtCostos,CXPD_COSTOSID:intCostosIdx};itemIdCXP++;jQuery("#CXP_GRID").addRowData(itemIdCXP,datarow,"last");d.getElementById("CXP_COSTO").value=dblCosto;d.getElementById("CXP_PROD").value="";d.getElementById("CXP_PROD").focus();d.getElementById("CXP_CANT").value=1;d.getElementById("CXP_DEVO").value=0;bolFind=true;setSumCXP();if(!bolFind){ObtenNomProv();}$("#dialogWait").dialog("close");}function setSumCXP(){var grid=jQuery("#CXP_GRID");var arr=grid.getDataIDs();var dblSuma=0;var dblImpuesto1=0;var dblImporte=0;for(var i=0;i<arr.length;i++){var id=arr[i];var lstRow=grid.getRowData(id);if(lstRow.CXPD_ADD_IVA==1||lstRow.CXPD_MINUS_IVA==1){if(lstRow.CXPD_ADD_IVA==1){dblImpuesto1+=parseFloat(lstRow.CXPD_IMPORTE);dblSuma+=parseFloat(lstRow.CXPD_IMPORTE);}if(lstRow.CXPD_MINUS_IVA==1){dblImpuesto1-=parseFloat(lstRow.CXPD_IMPORTE);dblSuma-=parseFloat(lstRow.CXPD_IMPORTE);}}else{dblSuma+=parseFloat(lstRow.CXPD_IMPORTE);dblImpuesto1+=parseFloat(lstRow.CXPD_IMPUESTO1);dblImporte+=(parseFloat(lstRow.CXPD_IMPORTE)-parseFloat(lstRow.CXPD_IMPUESTO1));}}var dblIEPS=0;if(document.getElementById("CXP_USO_IEPS1").checked){if(parseFloat(document.getElementById("CXP_TASA_IEPS").value)!=0){try{dblIEPS=dblImporte*(parseFloat(document.getElementById("CXP_TASA_IEPS").value)/100);}catch(err){}}else{alert(lstMsg[62]);document.getElementById("CXP_TASA_IEPS").focus();}var tax=new Impuestos(dblTasaVta1CXP,dblTasaVta2CXP,dblTasaVta3CXP,intSImpVtaCXP1_2,intSImpVtaCXP1_3,intSImpVtaCXP2_3);tax.CalculaImpuestoMas(dblIEPS,0,0);dblImpuesto1+=tax.dblImpuesto1;dblSuma+=dblIEPS+tax.dblImpuesto1;}d.getElementById("CXP_IMPORTE_IEPS").value=FormatNumber(dblIEPS,intNumdecimal,true);d.getElementById("CXP_TOT").value=FormatNumber(dblSuma,intNumdecimal,true);d.getElementById("CXP_IMPUESTO1").value=FormatNumber(dblImpuesto1,intNumdecimal,true);d.getElementById("CXP_IMPORTE").value=FormatNumber(dblImporte,intNumdecimal,true);if(parseInt(intEMP_TIPOPERS)==1&&intCT_TIPOPERSPV==2&&parseInt(d.getElementById("CXP_TIPO").value)==1){var dblRetIsr=dblImporte*(dblFacRetISR/100);var dblRetIVA=0;if(dblImpuesto1>0){dblRetIVA=(dblImpuesto1/3)*2;}if(parseInt(intEMP_NO_ISR)==1){dblRetIsr=0;}if(parseInt(intEMP_NO_IVA)==1){dblRetIVA=0;}var dblImpNeto=dblSuma-dblRetIsr-dblRetIVA;document.getElementById("CXP_RETISR").value=FormatNumber(dblRetIsr,intNumdecimal,true);document.getElementById("CXP_RETIVA").value=FormatNumber(dblRetIVA,intNumdecimal,true);document.getElementById("CXP_NETO").value=FormatNumber(dblImpNeto,intNumdecimal,true);document.getElementById("CXP_RETISR").parentNode.parentNode.style.display="block";document.getElementById("CXP_RETIVA").parentNode.parentNode.style.display="block";document.getElementById("CXP_NETO").parentNode.parentNode.style.display="block";}else{document.getElementById("CXP_RETISR").parentNode.parentNode.style.display="none";document.getElementById("CXP_RETIVA").parentNode.parentNode.style.display="none";document.getElementById("CXP_NETO").parentNode.parentNode.style.display="none";}EvalSucursalCXP();}function _ImporteCXPItem(){this.dblImporte=0;this.dblImpuesto1=0;this.dblImpuesto2=0;this.dblImpuesto3=0;this.dblImpuestoReal1=0;this.dblImpuestoReal2=0;this.dblImpuestoReal3=0;this.dblCantidad=0;
this.dblPrecio=0;this.dblPorcDesc=0;this.dblPorcDescGlobal=0;this.dblPrecFijo=0;this.dblExento1=0;this.dblExento2=0;this.dblExento3=0;this.dblImporteReal=0;this.dblPrecioReal=0;this.intDevo=0;this.dblPorcAplica=0;this.intPrecioZeros=0;this.bolUsoImpEspecial=false;this.dblTasaVta1CXPe=0;this.CalculaImporte=function CalculaImporte(){this.dblPorcDescGlobal=parseFloat(this.dblPorcDescGlobal);this.dblPorcDesc=parseFloat(this.dblPorcDesc);var dblPrecioAplica=parseFloat(this.dblPrecio);if(this.dblPrecFijo==0||this.intPrecioZeros==1){this.dblPorcAplica=0;if(this.dblPorcDescGlobal>0&&this.dblPorcDesc>0){if(this.dblPorcDescGlobal>this.dblPorcDesc){this.dblPorcAplica=this.dblPorcDescGlobal;}if(this.dblPorcDesc>this.dblPorcDescGlobal){this.dblPorcAplica=this.dblPorcDesc;}}else{if(this.dblPorcDescGlobal>0){this.dblPorcAplica=this.dblPorcDescGlobal;}if(this.dblPorcDesc>0){this.dblPorcAplica=this.dblPorcDesc;}}if(this.dblPorcAplica>0){dblPrecioAplica=dblPrecioAplica-(dblPrecioAplica*(this.dblPorcAplica/100));}}this.dblImporte=parseFloat(this.dblCantidad)*parseFloat(dblPrecioAplica);this.dblImporteReal=parseFloat(this.dblCantidad)*parseFloat(this.dblPrecioReal);if(parseInt(this.intDevo)==1){this.dblImporte=this.dblImporte*-1;}var dblBase1=this.dblImporte;var dblBase2=this.dblImporte;var dblBase3=this.dblImporte;if(parseInt(this.dblExento1)==1){dblBase1=0;}if(parseInt(this.dblExento2)==1){dblBase2=0;}if(parseInt(this.dblExento3)==1){dblBase3=0;}var tax=new Impuestos(dblTasaVta1CXP,dblTasaVta2CXP,dblTasaVta3CXP,intSImpVtaCXP1_2,intSImpVtaCXP1_3,intSImpVtaCXP2_3);if(this.bolUsoImpEspecial){tax=new Impuestos(this.dblTasaVta1CXPe,dblTasaVta2CXP,dblTasaVta3CXP,intSImpVtaCXP1_2,intSImpVtaCXP1_3,intSImpVtaCXP2_3);}if(intPreciosconImp==1){tax.CalculaImpuesto(dblBase1,dblBase2,dblBase3);}else{tax.CalculaImpuestoMas(dblBase1,dblBase2,dblBase3);}if(parseInt(this.dblExento1)==0){this.dblImpuesto1=tax.dblImpuesto1;}if(parseInt(this.dblExento2)==0){this.dblImpuesto2=tax.dblImpuesto2;}if(parseInt(this.dblExento3)==0){this.dblImpuesto3=tax.dblImpuesto3;}var dblBaseReal1=this.dblImporteReal;var dblBaseReal2=this.dblImporteReal;var dblBaseReal3=this.dblImporteReal;if(parseInt(this.dblExento1)==1){dblBaseReal1=0;}if(parseInt(this.dblExento2)==1){dblBaseReal2=0;}if(parseInt(this.dblExento3)==1){dblBaseReal3=0;}if(intPreciosconImp==1){tax.CalculaImpuesto(dblBaseReal1,dblBaseReal2,dblBaseReal3);}else{tax.CalculaImpuestoMas(dblBaseReal1,dblBaseReal2,dblBaseReal3);}if(parseInt(this.dblExento1)==0){this.dblImpuestoReal1=tax.dblImpuesto1;}if(parseInt(this.dblExento2)==0){this.dblImpuestoReal2=tax.dblImpuesto2;}if(parseInt(this.dblExento3)==0){this.dblImpuestoReal3=tax.dblImpuesto3;}if(this.intPrecioZeros==1){this.dblImporteReal=parseFloat(this.dblCantidad)*parseFloat(this.dblPrecio);}if(intPreciosconImp==0){this.dblImporteReal+=this.dblImpuestoReal1+this.dblImpuestoReal2+this.dblImpuestoReal3;this.dblImporte+=this.dblImpuesto1+this.dblImpuesto2+this.dblImpuesto3;}};}function CXPDrop(){var grid=jQuery("#CXP_GRID");if(grid.getGridParam("selrow")!=null){grid.delRowData(grid.getGridParam("selrow"));document.getElementById("CXP_PROD").focus();setSumCXP();}}function CallbtnCXP7(){CXPDrop();}function CallbtnCXP9(){myLayout.open("west");myLayout.open("east");myLayout.open("south");myLayout.open("north");var objMainFacPedi=objMap.getScreen("CXPAGAR");objMainFacPedi.bolActivo=false;objMainFacPedi.bolMain=false;objMainFacPedi.bolInit=false;objMainFacPedi.idOperAct=0;document.getElementById("MainPanel").innerHTML="";}function CallbtnCXP8(){var grid=jQuery("#CXP_GRID");var id=grid.getGridParam("selrow");if(id!=null){var lstRowAct=grid.getRowData(id);var strHTML=CreaTextArea(lstMsg[30],"NOTASMOD",lstRowAct.CXPD_NOTAS,5,80,"",0,0,3,0);strHTML+=CreaBoton("","NOTASBTN",lstMsg[31],"ChangeNotesCXP()","center",false,true,0);$("#dialog2").dialog("option","title",lstMsg[29]);document.getElementById("dialog2").innerHTML=strHTML;$("#dialog2").dialog("option","width",500);$("#dialog2").dialog("open");document.getElementById("NOTASMOD").focus();}}function ChangeNotesCXP(){var grid=jQuery("#CXP_GRID");var id=grid.getGridParam("selrow");if(id!=null){var lstRowAct=grid.getRowData(id);lstRowAct.CXPD_NOTAS=d.getElementById("NOTASMOD").value;grid.setRowData(id,lstRowAct);}$("#dialog2").dialog("close");}function CallbtnCXP0(){SaveCXP();}function CallbtnCXP1(){$("#SioNO").dialog("option","title","��Confirma que desea borrar la operacion actual e iniciar una nueva?");d.getElementById("Operac").value="Nva";document.getElementById("SioNO_inside").innerHTML="";$("#SioNO").dialog("open");}function ResetOperaActualCXP(){d.getElementById("CXP_ID").value=0;d.getElementById("FPV_ID").value=0;d.getElementById("CXP_CGASTOS").value=0;d.getElementById("CXP_FOLIO").value="";d.getElementById("PV_NOM").value="";d.getElementById("CXP_NOTAS").value="";d.getElementById("CXP_NOTASPIE").value="";d.getElementById("CXP_REFERENCIA").value="";d.getElementById("CXP_CONDPAGO").value="";d.getElementById("CXP_DIASCREDITO").value="0";d.getElementById("CXP_TOT").value="0.0";d.getElementById("CXP_IMPUESTO1").value="0.0";d.getElementById("CXP_IMPUESTO2").value="0.0";d.getElementById("CXP_IMPUESTO3").value="0.0";d.getElementById("CXP_IMPORTE").value="0.0";d.getElementById("CXP_RETISR").value="0.0";d.getElementById("CXP_RETIVA").value="0.0";d.getElementById("CXP_NETO").value="0.0";d.getElementById("CXP_DESC").value="";d.getElementById("CXP_COSTO").value="0.0";d.getElementById("CXP_ADD_IVA").checked=false;d.getElementById("CXP_MINUS_IVA").checked=false;d.getElementById("CXP_UUID").value="";d.getElementById("CXP_PROD").focus();d.getElementById("CXP_NUMPEDI").value="";d.getElementById("CXP_PED_ID").value="";d.getElementById("CXP_DATA").value="";d.getElementById("CXP_PDF_FILE").value="";var objMonedaSel=document.getElementById("CXP_MONEDA");objMonedaSel.disabled=false;objMonedaSel.onmouseout=function(){var g=1;};objMonedaSel.onmouseleave=function(){var g=1;};objMonedaSel.onmouseover=function(){var g=1;};objMonedaSel.setAttribute("class","outEdit");objMonedaSel.setAttribute("className","outEdit");OcultarAvisosCXP();var grid=jQuery("#CXP_GRID");grid.clearGridData();}function OcultarAvisosCXP(){}function ConfirmaSICXP(){if(d.getElementById("Operac").value=="Nva"){ResetOperaActualCXP();}d.getElementById("Operac").value="";$("#SioNO").dialog("close");}function ConfirmaNOCXP(){$("#SioNO").dialog("close");}function SaveCXP(){var bolPasa=true;if(parseFloat(document.getElementById("CXP_TOT").value)==0){alert(lstMsg[56]);bolPasa=false;}else{if(d.getElementById("TOTALXPAGAR")!=null){if(parseInt(intEMP_TIPOPERS)==1&&intCT_TIPOPERSPV==2&&parseInt(d.getElementById("CXP_TIPO").value)==1){d.getElementById("TOTALXPAGAR").value=d.getElementById("CXP_NETO").value;}else{d.getElementById("TOTALXPAGAR").value=d.getElementById("CXP_TOT").value;}}if(d.getElementById("CXP_FECHA_PROVISION")==""){alert(lstMsg[229]);bolPasa=false;}if(parseFloat(document.getElementById("CXP_IMPUESTO1").value)>0){var objTasaSel=document.getElementById("CXP_TASASEL1");}if(bolPasa){SaveCXPDo();}}}function CallbtnCXP2(){d.getElementById("Operac").value="";bolEsPedimento=false;var objViewCXP1_=objMap.getScreen("CXP_VIEW");if(objViewCXP1_!=null){objViewCXP1_.bolActivo=false;objViewCXP1_.bolMain=false;objViewCXP1_.bolInit=false;objViewCXP1_.idOperAct=0;}OpnOpt("CXP_VIEW","_ed","dialogView",false,false,true);}function GetCXPModi(intIdCXP){$.ajax({type:"POST",data:"CXP_ID="+intIdCXP,scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"xml",url:"CXPMov.do?id=8",success:function(datos){var objCXP=datos.getElementsByTagName("vta_cxpagar")[0];var lstdeta=objCXP.getElementsByTagName("deta");if(objCXP.getAttribute("CXP_ANULADO")==0){ResetOperaActualCXP(false);OpenCXP(objCXP,lstdeta);$("#dialogView").dialog("close");}else{alert(lstMsg[51]);}},error:function(objeto,quepaso,otroobj){alert(":ptoExist:"+objeto+" "+quepaso+" "+otroobj);$("#dialogWait").dialog("close");}});}function OpenCXP(objCXP,lstdeta){$("#dialogWait").dialog("open");
document.getElementById("CXP_ID").value=objCXP.getAttribute("CXP_ID");MostrarAvisosCXP(lstMsg[64]+objCXP.getAttribute("CXP_ID"));document.getElementById("CXP_FOLIO").value=objCXP.getAttribute("CXP_FOLIO");document.getElementById("SC_ID").value=objCXP.getAttribute("SC_ID");document.getElementById("FPV_ID").value=objCXP.getAttribute("PV_ID");document.getElementById("CXP_NOTAS").value=objCXP.getAttribute("CXP_NOTAS");document.getElementById("CXP_NOTASPIE").value=objCXP.getAttribute("CXP_NOTASPIE");document.getElementById("CXP_CONDPAGO").value=objCXP.getAttribute("CXP_CONDPAGO");document.getElementById("CXP_REFERENCIA").value=objCXP.getAttribute("CXP_REFERENCIA");document.getElementById("CXP_NUMPEDI").value=objCXP.getAttribute("CXP_NUMPEDI");document.getElementById("CXP_DIASCREDITO").value=objCXP.getAttribute("CXP_DIASCREDITO");document.getElementById("FPV_DESCUENTO").value=objCXP.getAttribute("CXP_DESCUENTO");if(objCXP.getAttribute("CXP_MONEDA")!=0){document.getElementById("CXP_MONEDA").value=objCXP.getAttribute("CXP_MONEDA");}else{document.getElementById("CXP_MONEDA").value=1;}document.getElementById("CXP_UUID").value=objCXP.getAttribute("CXP_UUID");document.getElementById("CXP_TASASEL1").value=objCXP.getAttribute("TI_ID");UpdateTasaImpCXP();ObtenNomProv(objCXP,lstdeta,true);}function DrawCXPLoad(objCXP,lstdeta){for(var i=0;i<lstdeta.length;i++){var obj=lstdeta[i];var objImportes=new _ImporteCXPItem();objImportes.dblCantidad=obj.getAttribute("CXPD_CANTIDAD");if(parseInt(obj.getAttribute("CXPD_EXENTO1"))==1){objImportes.dblPrecio=parseFloat(obj.getAttribute("CXPD_COSTO"));objImportes.dblPrecioReal=parseFloat(obj.getAttribute("CXPD_COSTOREAL"));}else{objImportes.dblPrecio=parseFloat(obj.getAttribute("CXPD_COSTO"))/(1+(obj.getAttribute("CXPD_TASAIVA1")/100));objImportes.dblPrecioReal=parseFloat(obj.getAttribute("CXPD_COSTOREAL"))/(1+(obj.getAttribute("CXPD_TASAIVA1")/100));}objImportes.dblPorcDescGlobal=document.getElementById("FPV_DESCUENTO").value;objImportes.dblPorcDesc=obj.getAttribute("CXPD_PORDESC");objImportes.dblExento1=obj.getAttribute("CXPD_EXENTO1");objImportes.dblExento2=obj.getAttribute("CXPD_EXENTO2");objImportes.dblExento3=obj.getAttribute("CXPD_EXENTO3");objImportes.intDevo=0;if(parseFloat(dblTasaVta1CXP)!=parseFloat(obj.getAttribute("CXPD_TASAIVA1"))){objImportes.dblTasaVta1CXPe=obj.getAttribute("CXPD_TASAIVA1");objImportes.bolUsoImpEspecial=true;}objImportes.CalculaImporte();var dblImporte=objImportes.dblImporte;var datarow={CXPD_ID:0,CXPD_CANTIDAD:objImportes.dblCantidad,CXPD_CANTPEDIDO:obj.getAttribute("CXPD_CANTIDAD"),CXPD_DESCRIPCION:obj.getAttribute("CXPD_DESCRIPCION"),CXPD_IMPORTE:dblImporte,CXPD_CVE:obj.getAttribute("CXPD_CVE"),CXPD_COSTO:objImportes.dblPrecio,CXPD_TASAIVA1:obj.getAttribute("CXPD_TASAIVA1"),CXPD_DESGLOSA1:1,CXPD_IMPUESTO1:objImportes.dblImpuesto1,CXPD_PR_ID:obj.getAttribute("PR_ID"),CXPD_EXENTO1:obj.getAttribute("CXPD_EXENTO1"),CXPD_EXENTO2:obj.getAttribute("CXPD_EXENTO2"),CXPD_EXENTO3:obj.getAttribute("CXPD_EXENTO3"),CXPD_REQEXIST:obj.getAttribute("PR_REQEXIST"),CXPD_EXIST:obj.getAttribute("PR_EXISTENCIA"),CXPD_NOSERIE:"",CXPD_ESREGALO:obj.getAttribute("CXPD_ESREGALO"),CXPD_IMPORTEREAL:objImportes.dblImporteReal,CXPD_COSTOREAL:objImportes.dblPrecioReal,CXPD_DESCUENTO:obj.getAttribute("CXPD_DESCUENTO"),CXPD_PORDESC:objImportes.dblPorcAplica,CXPD_PRECFIJO:obj.getAttribute("CXPD_PRECFIJO"),CXPD_ESDEVO:0,CXPD_CODBARRAS:obj.getAttribute("PR_CODBARRAS"),CXPD_NOTAS:obj.getAttribute("CXPD_COMENTARIO"),CXPD_GASTOID:obj.getAttribute("GT_ID"),CXPD_GASTO:obj.getAttribute("GT_NOM"),CXPD_RET_ISR:obj.getAttribute("CXPD_RET_ISR"),CXPD_RET_IVA:obj.getAttribute("CXPD_RET_IVA"),CXPD_ADD_IVA:obj.getAttribute("CXPD_ADD_IVA"),CXPD_MINUS_IVA:obj.getAttribute("CXPD_MINUS_IVA"),CXPD_COSTOS:obj.getAttribute("CC_NOMBRE"),CXPD_COSTOSID:obj.getAttribute("CC_ID")};jQuery("#CXP_GRID").addRowData(obj.getAttribute("CXPD_ID"),datarow,"last");}setSumCXP();$("#dialogWait").dialog("close");}function MostrarAvisosCXP(strMsg){var label=document.getElementById("LABELAVISOS");label.innerHTML=strMsg;label.setAttribute("class","Mostrar");label.setAttribute("className","Mostrar");label.setAttribute("class","ui-Total");label.setAttribute("className","ui-Total");}function OcultarAvisosCXP(){var label=document.getElementById("LABELAVISOS");label.innerHTML="";label.setAttribute("class","Oculto");label.setAttribute("className","Oculto");}function OpnDiagCon_Pago(){OpnOpt("CON_PAGO","grid","dialogCon",false,false);}function OpnDiagCxpPedi(){OpnOpt("PEDI_MTO","grid","dialogMLM",false,false);}function ObtenPediCXP(){var strPedimento=document.getElementById("CXP_NUMPEDI").value;document.getElementById("CXP_PED_ID").value="";if(strPedimento!=""){$("#dialogWait").dialog("open");ValidaClean("CXP_NUMPEDI");$.ajax({type:"POST",data:"PEDIMENTO="+strPedimento,scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"xml",url:"ODCMov.do?id=9",success:function(datoVal){var objPov=datoVal.getElementsByTagName("vta_pedimentos")[0];if(objPov.getAttribute("PED_ID")==0){document.getElementById("CXP_NUMPEDI").focus();alert("El pedimento no existe");}else{if(objPov.getAttribute("PED_APLICADO")==1){document.getElementById("CXP_NUMPEDI").value="";document.getElementById("CXP_PED_ID").value=0;alert(lstMsg[192]);}else{document.getElementById("CXP_PED_ID").value=objPov.getAttribute("PED_ID");}}$("#dialogWait").dialog("close");},error:function(objeto,quepaso,otroobj){alert("CXP new:"+objeto+" "+quepaso+" "+otroobj);$("#dialogWait").dialog("close");}});}}function UpdateTasaImpCXP(){var objTasaSel=document.getElementById("CXP_TASASEL1");$("#dialogWait").dialog("open");$.ajax({type:"POST",data:"TI_ID="+objTasaSel.value,scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"xml",url:"VtasMov.do?id=11",success:function(datos){var objPedido=datos.getElementsByTagName("vta_impuesto")[0];var lstdeta=objPedido.getElementsByTagName("vta_impuestos");for(var i=0;i<lstdeta.length;i++){var obj=lstdeta[i];dblTasaVta1CXP=obj.getAttribute("Tasa1");}$("#dialogWait").dialog("close");},error:function(objeto,quepaso,otroobj){alert(":ODC Taxes:"+objeto+" "+quepaso+" "+otroobj);$("#dialogWait").dialog("close");}});}function EvalSucursalCXP(){var grid=jQuery("#CXP_GRID");var arr=grid.getDataIDs();var objSuc=document.getElementById("SC_ID");var objTasaSel=document.getElementById("CXP_TASASEL1");var objMonedaSel=document.getElementById("CXP_MONEDA");if(arr.length>0){objSuc.onmouseout=function(){this.disabled=false;};objSuc.onmouseleave=function(){this.disabled=false;};objSuc.onmouseover=function(){this.disabled=true;};objSuc.setAttribute("class","READONLY");objSuc.setAttribute("className","READONLY");objMonedaSel.onmouseout=function(){this.disabled=false;};objMonedaSel.onmouseleave=function(){this.disabled=false;};objMonedaSel.onmouseover=function(){this.disabled=true;};objMonedaSel.setAttribute("class","READONLY");objMonedaSel.setAttribute("className","READONLY");}else{objSuc.disabled=false;objSuc.onmouseout=function(){var g=1;};objSuc.onmouseleave=function(){var g=1;};objSuc.onmouseover=function(){var g=1;};objSuc.setAttribute("class","outEdit");objSuc.setAttribute("className","outEdit");objTasaSel.disabled=false;objTasaSel.onmouseout=function(){var g=1;};objTasaSel.onmouseleave=function(){var g=1;};objTasaSel.onmouseover=function(){var g=1;};objTasaSel.setAttribute("class","outEdit");objTasaSel.setAttribute("className","outEdit");objMonedaSel.disabled=false;objMonedaSel.onmouseout=function(){var g=1;};objMonedaSel.onmouseleave=function(){var g=1;};objMonedaSel.onmouseover=function(){var g=1;};objMonedaSel.setAttribute("class","outEdit");objMonedaSel.setAttribute("className","outEdit");}}function ObtenDatosProductoCXP(){$("#dialogWait").dialog("open");$.ajax({type:"POST",data:encodeURI("PR_CODIGO="+document.getElementById("CXP_PROD").value+"&SC_ID="+d.getElementById("SC_ID").value),scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"xml",url:"VtasMov.do?id=5",success:function(datoVal){var objProd=datoVal.getElementsByTagName("vta_productos")[0];
var intPr_Id=objProd.getAttribute("PR_ID");var intGT_ID=objProd.getAttribute("GT_ID");if(intPr_Id!=0){document.getElementById("CXP_CGASTOS").value=intGT_ID;}$("#dialogWait").dialog("close");},error:function(objeto,quepaso,otroobj){alert(":cgastos_cxp:"+objeto+" "+quepaso+" "+otroobj);$("#dialogWait").dialog("close");}});}function LoadDataCGastos(){$("#dialogWait").dialog("open");$.ajax({type:"POST",data:encodeURI("CXP_TIPO="+document.getElementById("CXP_TIPO").value),scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"xml",url:"CXPMov.do?id=10",success:function(datos){var objGastos=datos.getElementsByTagName("cgastos")[0];var lstGastos=objGastos.getElementsByTagName("cgasto");var objSelDest=document.getElementById("CXP_CGASTOS");select_clear(objSelDest);for(var i=0;i<lstGastos.length;i++){var obj=lstGastos[i];if(obj.getAttribute("hijos")==0){select_add(objSelDest,obj.getAttribute("desc"),obj.getAttribute("id"));}else{select_addOptGroup(objSelDest,obj.getAttribute("desc"),obj.getAttribute("id"));}}$("#dialogWait").dialog("close");},error:function(objeto,quepaso,otroobj){alert(":cgastos_cxp:"+objeto+" "+quepaso+" "+otroobj);$("#dialogWait").dialog("close");}});}function SuvirArchivoXML_CXP(){var File=document.getElementById("CXP_DATA");if(File.value==""){alert("Requiere seleccionar un archivo");File.focus();}else{if(Right(File.value.toUpperCase(),3)=="XML"){$.ajaxFileUpload({url:"ERP_UPFileXML.jsp",secureuri:false,fileElementId:"CXP_DATA",dataType:"json",success:function(data,status){if(typeof(data.error)!="undefined"){if(data.error!=""){alert(data.error);}else{document.getElementById("CXP_UUID").value=data.strUUID;}}$("#dialogWait").dialog("close");},error:function(data,status,e){alert(e);$("#dialogWait").dialog("close");}});}else{alert("Se aceptan archivos con extensi��n xml");File.focus();}}}function SubirArchivoPDF_CXP(){var File=document.getElementById("CXP_PDF_FILE");if(File.value==""){alert("Requiere seleccionar un archivo");File.focus();}else{if(Right(File.value.toUpperCase(),3)=="PDF"){$.ajaxFileUpload({url:"ERP_UPFILEPDF_CXP.jsp",secureuri:false,fileElementId:"CXP_PDF_FILE",dataType:"json",success:function(data,status){if(typeof(data.error)!="undefined"){if(data.error!=""){alert(data.error);}else{alert(data.msg);}}$("#dialogWait").dialog("close");},error:function(data,status,e){alert(e);$("#dialogWait").dialog("close");}});}else{alert("Se aceptan archivos con extensi��n xml");File.focus();}}}