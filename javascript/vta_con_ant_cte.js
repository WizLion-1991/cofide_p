var itemIdEdCta=0;function vta_con_ant_cte(){}function CACIni(){myLayout.close("west");myLayout.close("east");myLayout.close("south");myLayout.close("north");d.getElementById("btn1").setAttribute("class","Oculto");d.getElementById("btn1").setAttribute("className","Oculto");}function OpnDiagCteConsAnti(){OpnOpt("CLIENTES","grid","dialogCte",false,false);}function RefreshDatosCteConsAnt(){var intIdCliente=document.getElementById("CTE_ID").value;$("#dialogWait").dialog("open");var strPOST="CT_ID="+intIdCliente;$.ajax({type:"POST",data:strPOST,scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"xml",url:"ERP_ConAntCte.jsp?id=2",success:function(datos){var lstAnts=datos.getElementsByTagName("clientes")[0];var lstAnt=lstAnts.getElementsByTagName("cliente");if(lstAnt.length!=0){var obj=lstAnt[0];document.getElementById("CTE_NOMBRE").value=obj.getAttribute("CT_RAZONSOCIAL");document.getElementById("CAC_MONEDA").value=parseInt(obj.getAttribute("MON_ID"));RefreshCteConsAnt();}else{$("#dialogWait").dialog("close");}},error:function(objeto,quepaso,otroobj){alert("edo_cta2:"+objeto+" "+quepaso+" "+otroobj);$("#dialogWait").dialog("close");}});}function RefreshCteConsAnt(){$("#dialogCte").dialog("close");$("#dialogWait").dialog("open");var intIdCliente=document.getElementById("CTE_ID").value;var intMon_ID=document.getElementById("CAC_MONEDA").value;var bolVerUtilizados="";if(document.getElementById("CAC_UTILIZADOS").checked){bolVerUtilizados="1";}else{bolVerUtilizados="0";}var bolVerAnulados="";if(document.getElementById("CAC_ANULADOS").checked){bolVerAnulados="1";}else{bolVerAnulados="0";}var strPOST="CT_ID="+intIdCliente;strPOST+="&MON_ID="+intMon_ID;strPOST+="&CAC_UTILIZADOS="+bolVerUtilizados;strPOST+="&CAC_ANULADO="+bolVerAnulados;$.ajax({type:"POST",data:strPOST,scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"xml",url:"ERP_ConAntCte.jsp?id=1",success:function(datos){var lstAnts=datos.getElementsByTagName("anticipos")[0];var lstAnt=lstAnts.getElementsByTagName("anticipo");var grid=jQuery("#CAC_GRID");grid.clearGridData();if(lstAnt.length!=0){for(var i=0;i<lstAnt.length;i++){var obj=lstAnt[i];var datarow={MC_ID:obj.getAttribute("MC_ID"),MC_FOLIO:obj.getAttribute("MC_FOLIO"),MC_FECHA:obj.getAttribute("MC_FECHA"),MC_TXTMONEDA:obj.getAttribute("MC_TXTMONEDA"),MC_ESTATUS:obj.getAttribute("MC_ESTATUS"),MC_SALDO_ORIGINAL:obj.getAttribute("MC_ANTICIPO_ORIGINAL"),MC_SALDO_ANTICIPO:obj.getAttribute("MC_SALDO_ANTICIPO"),MC_ANULADO:obj.getAttribute("MC_ANULADO"),MC_MONEDA:obj.getAttribute("MC_MONEDA"),MC_TXTANULADO:obj.getAttribute("MC_TXTANULADO")};itemIdEdCta++;grid.addRowData(itemIdEdCta,datarow,"last");}}else{alert("El cliente no tiene anticipos");}$("#dialogWait").dialog("close");},error:function(objeto,quepaso,otroobj){alert("edo_cta2:"+objeto+" "+quepaso+" "+otroobj);$("#dialogWait").dialog("close");}});}function SalirConsAntCte(){myLayout.open("west");myLayout.open("east");myLayout.open("south");myLayout.open("north");document.getElementById("MainPanel").innerHTML="";var objMainFacPedi=objMap.getScreen("CONA_CTE");objMainFacPedi.bolActivo=false;objMainFacPedi.bolMain=false;objMainFacPedi.bolInit=false;objMainFacPedi.idOperAct=0;}function OpenConsultaUsoAnticipo(){var grid=jQuery("#CAC_GRID");if(grid.getGridParam("selrow")!=null){var lstRowAct=grid.getRowData(grid.getGridParam("selrow"));var strPOST="MC_ID="+lstRowAct.MC_ID;$("#dialogWait").dialog("open");$.ajax({type:"POST",data:strPOST,scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"xml",url:"ERP_ConAntCte.jsp?id=3",success:function(datos){$("#dialogWait").dialog("close");var lstAnts=datos.getElementsByTagName("pagos")[0];var lstAnt=lstAnts.getElementsByTagName("pago");var strHTML="<table border=1>";strHTML+="<tr>";strHTML+="<th>&nbsp;</th>";strHTML+="<th>"+"FOLIO FACTURA"+"</th>";strHTML+="<th>"+"FECHA FACTURA"+"</th>";strHTML+="<th>"+"FECHA PAGO"+"</th>";strHTML+="<th>"+"MONEDA PAGO"+"</th>";strHTML+="<th>"+"IMPORTE USADO"+"</th>";strHTML+="<th>"+"TASA DE CAMBIO"+"</th>";strHTML+="</tr>";for(i=0;i<lstAnt.length;i++){var obj=lstAnt[i];strHTML+="<tr>";strHTML+="<td><a href='javascript:ImprimirFACTURA("+obj.getAttribute("MC_ID")+","+obj.getAttribute("MCM_ID")+')\'><img border="0" src="images/ptovta/printer_64.png"></a></td>';strHTML+="<td>"+obj.getAttribute("facFOLIO")+"</td>";strHTML+="<td>"+obj.getAttribute("facFECHA")+"</td>";strHTML+="<td>"+obj.getAttribute("MC_FECHA")+"</td>";strHTML+="<td>"+obj.getAttribute("txtMONEDA")+"</td>";strHTML+="<td align='right'>"+FormatNumber(parseFloat(obj.getAttribute("MC_ABONO")),2,true,false,true,false)+"</td>";strHTML+="<td align='right'>"+FormatNumber(parseFloat(obj.getAttribute("MC_TASAPESO")),2,true,false,true,false)+"</td>";strHTML+="</tr>";}strHTML+="</table>";document.getElementById("dialog2_inside").innerHTML=strHTML;$("#dialogWait").dialog("close");$("#dialog2").dialog("option","title","HISTORIAL DE MOVIMIENTOS DEL ANTICIPO:"+" "+lstRowAct.MC_FOLIO);$("#dialog2").dialog("open");},error:function(objeto,quepaso,otroobj){alert("edo_cta4:"+objeto+" "+quepaso+" "+otroobj);$("#dialogWait").dialog("close");}});}}function ImprimirFACTURA(intMC_ID,intMCM_ID){if(intMCM_ID==0){openFormat("COBROS","PDF",CreaHidden("MC_ID",intMC_ID));}else{openFormat("COBROSMAS","PDF",CreaHidden("MCM_ID",intMCM_ID));}}