var itemIdEdCta=0;function vta_edo_cta_cte(){}function initEdoCtaCte(){var strNomMain=objMap.getNomMain();if(strNomMain=="PEDIDOS_MAK"){document.getElementById("ED_CLIENTE").value=document.getElementById("FCT_ID").value;RefreshCteEdoCta();RefreshList();RefreshCteEdoCta();RefreshList();}else{myLayout.close("west");myLayout.close("east");myLayout.close("south");myLayout.close("north");if(strNomMain!="C_TELEM"){d.getElementById("btn1").setAttribute("class","Oculto");d.getElementById("btn1").setAttribute("className","Oculto");}ChangeStyleEdoCta();$("#dialogWait").dialog("open");$.ajax({type:"POST",data:"",scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"xml",url:"ERP_EdoCta.jsp?id=1",success:function(datos){var objSelDest=document.getElementById("ED_PERIODO");select_clear(objSelDest);var lstPer=datos.getElementsByTagName("periodo");for(i=0;i<lstPer.length;i++){var obj=lstPer[i];select_add(objSelDest,obj.getAttribute("valor"),obj.getAttribute("valor"));}},error:function(objeto,quepaso,otroobj){alert("edo_cta1:"+objeto+" "+quepaso+" "+otroobj);}});}document.getElementById("ED_CLIENTE").value=document.getElementById("CT_NO_CLIENTE").value;document.getElementById("ED_CLIENTE").readOnly=true;document.getElementById("ED_CLIENTE").setAttribute("class","READONLY");document.getElementById("ED_CLIENTE").setAttribute("className","READONLY");document.getElementById("img_ED_CLIENTE").parentNode.style.display="none";}function ChangeStyleEdoCta(){d.getElementById("ED_INICIAL").setAttribute("class","textNumberReadOnly");d.getElementById("ED_INICIAL").setAttribute("className","textNumberReadOnly");d.getElementById("ED_CARGOS").setAttribute("class","textNumberReadOnly");d.getElementById("ED_CARGOS").setAttribute("className","textNumberReadOnly");d.getElementById("ED_ABONOS").setAttribute("class","textNumberReadOnly");d.getElementById("ED_ABONOS").setAttribute("className","textNumberReadOnly");d.getElementById("ED_FINAL").setAttribute("class","textNumberReadOnly");d.getElementById("ED_FINAL").setAttribute("className","textNumberReadOnly");}function OpnDiagCteEdoCta(){OpnOpt("CLIENTES","grid","dialogCte",false,false);}function RefreshCteEdoCta(){$("#dialogCte").dialog("close");var intIdCliente=document.getElementById("ED_CLIENTE").value;if(parseInt(intIdCliente)!=0){$("#dialogWait").dialog("open");$.ajax({type:"POST",data:"CT_ID="+intIdCliente,scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"xml",url:"ERP_EdoCta.jsp?id=2",success:function(datos){var lstCte=datos.getElementsByTagName("cliente");var bolExiste=false;for(i=0;i<lstCte.length;i++){var obj=lstCte[i];document.getElementById("ED_LIM_CREDITO").value=FormatNumber(obj.getAttribute("monto_credito"),2,true,false,true,false);document.getElementById("ED_DIAS_CREDITO").value=obj.getAttribute("dias_credito");document.getElementById("ED_NOMBRE").value=obj.getAttribute("nombre");var grid=jQuery("#GRID_DETA");grid.clearGridData();var lstMoneda=obj.getElementsByTagName("moneda");var objSelDest=document.getElementById("ED_MONEDA");select_clear(objSelDest);for(m=0;m<lstMoneda.length;m++){var obj=lstMoneda[m];select_add(objSelDest,obj.getAttribute("desc"),obj.getAttribute("id"));}var selectobject=document.getElementById("ED_MONEDA");for(var ih=0;ih<selectobject.length;ih++){if(parseInt(selectobject.options[ih].value)==parseInt(obj.getAttribute("moneda"))){selectobject.selectedIndex=ih;}}bolExiste=true;}if(!bolExiste){alert(lstMsg[199]);$("#dialogWait").dialog("close");}else{RefreshList(false);}},error:function(objeto,quepaso,otroobj){alert("edo_cta2:"+objeto+" "+quepaso+" "+otroobj);}});}}function SalirEdoCtaCte(){var strNomMain=objMap.getNomMain();if(strNomMain=="PEDIDOS_MAK"){var objSecModiVta=objMap.getScreen("EDO_CTA_CT");if(objSecModiVta!=null){objSecModiVta.bolActivo=false;objSecModiVta.bolMain=false;objSecModiVta.bolInit=false;objSecModiVta.idOperAct=0;}$("#dialogCte").dialog("close");}document.getElementById("ED_CLIENTE").value=document.getElementById("CT_NO_CLIENTE").value;RefreshCteEdoCta();myLayout.open("west");myLayout.open("east");myLayout.open("south");myLayout.open("north");document.getElementById("MainPanel").innerHTML="";var objMainFacPedi=objMap.getScreen("EDO_CTA_CT");objMainFacPedi.bolActivo=false;objMainFacPedi.bolMain=false;objMainFacPedi.bolInit=false;objMainFacPedi.idOperAct=0;}function RefreshList(bolWait){$("#dialogCte").dialog("close");var intIdCliente=document.getElementById("ED_CLIENTE").value;if(parseInt(intIdCliente)!=0){if(bolWait!=null){if(bolWait){$("#dialogWait").dialog("open");}}else{$("#dialogWait").dialog("open");}var strPeriodo=document.getElementById("ED_PERIODO").value;var intIdMoneda=document.getElementById("ED_MONEDA").value;$.ajax({type:"POST",data:"CT_ID="+intIdCliente+"&MON_ID="+intIdMoneda+"&Periodo="+strPeriodo.replace("/",""),scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"xml",url:"ERP_EdoCta.jsp?id=3",success:function(datos){var lstCte=datos.getElementsByTagName("saldos");for(i=0;i<lstCte.length;i++){var obj=lstCte[i];document.getElementById("ED_INICIAL").value=FormatNumber(obj.getAttribute("inicial"),2,true,false,true,false);document.getElementById("ED_CARGOS").value=FormatNumber(obj.getAttribute("cargos"),2,true,false,true,false);document.getElementById("ED_ABONOS").value=FormatNumber(obj.getAttribute("abonos"),2,true,false,true,false);document.getElementById("ED_FINAL").value=FormatNumber(obj.getAttribute("final"),2,true,false,true,false);}RefreshGridList(intIdCliente,intIdMoneda,strPeriodo);},error:function(objeto,quepaso,otroobj){alert("edo_cta3:"+objeto+" "+quepaso+" "+otroobj);}});}}function RefreshGridList(intIdCliente,intIdMoneda,strPeriodo){var grid=jQuery("#GRID_DETA");grid.clearGridData();var iConSaldo=0;if(document.getElementById("ED_CON_SALDO").checked){iConSaldo=1;}$.ajax({type:"POST",data:"CT_ID="+intIdCliente+"&MON_ID="+intIdMoneda+"&Periodo="+strPeriodo.replace("/","")+"&ConSaldo="+iConSaldo,scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"xml",url:"ERP_EdoCta.jsp?id=4",success:function(datos){var lstCte=datos.getElementsByTagName("doc");for(i=0;i<lstCte.length;i++){var obj=lstCte[i];var idMasivo=0;var strStatus=obj.getAttribute("estatus");if(parseFloat(obj.getAttribute("saldo"))<=1){strStatus="PAGADO";}if(parseInt(obj.getAttribute("anticipo"))==1){strStatus="ANTICIPO";}if(parseInt(obj.getAttribute("esPago"))==1){idMasivo=obj.getAttribute("idMasivo");}var datarow={DET_ID:obj.getAttribute("id"),DET_TIPO:obj.getAttribute("tipo"),DET_FOLIO:obj.getAttribute("folio"),DET_FECHA:obj.getAttribute("fecha"),DET_VENCIMIENTO:obj.getAttribute("vencimiento"),DET_CARGOS:obj.getAttribute("cargos"),DET_ABONOS:obj.getAttribute("abonos"),DET_SALDO:obj.getAttribute("saldo"),DET_ESTATUS:strStatus,DET_BANCO:obj.getAttribute("banco"),DET_MAS:idMasivo};itemIdEdCta++;grid.addRowData(itemIdEdCta,datarow,"last");}var arr=grid.getDataIDs();for(var i=0;i<arr.length;i++){var id=arr[i];var lstRow=grid.getRowData(id);if(lstRow.DET_ESTATUS=="VENCIDO"){grid.setCell(id,"DET_TIPO","","advertencia","",false);grid.setCell(id,"DET_FOLIO","","advertencia","",false);grid.setCell(id,"DET_FECHA","","advertencia","",false);grid.setCell(id,"DET_VENCIMIENTO","","advertencia","",false);grid.setCell(id,"DET_CARGOS","","advertencia","",false);grid.setCell(id,"DET_ABONOS","","advertencia","",false);grid.setCell(id,"DET_SALDO","","advertencia","",false);grid.setCell(id,"DET_ESTATUS","","advertencia","",false);grid.setCell(id,"DET_BANCO","","advertencia","",false);}}$("#dialogWait").dialog("close");},error:function(objeto,quepaso,otroobj){alert("edo_cta4:"+objeto+" "+quepaso+" "+otroobj);}});}function VerDetalleEdoCtaCte(){var grid=jQuery("#GRID_DETA");if(grid.getGridParam("selrow")!=null){$("#dialogWait").dialog("open");var lstRowAct=grid.getRowData(grid.getGridParam("selrow"));if(lstRowAct.DET_TIPO!="COBRO"){var intIdCliente=document.getElementById("ED_CLIENTE").value;
var intIdMoneda=document.getElementById("ED_MONEDA").value;$.ajax({type:"POST",data:"CT_ID="+intIdCliente+"&MON_ID="+intIdMoneda+"&FAC_ID="+lstRowAct.DET_ID,scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=utf-8",cache:false,dataType:"xml",url:"ERP_EdoCta.jsp?id=5",success:function(datos){var lstCte=datos.getElementsByTagName("doc");var strHTML="<table border=0>";strHTML+="<tr>";strHTML+="<th>&nbsp;</th>";strHTML+="<th>"+lstMsg[200]+"</th>";strHTML+="<th>"+lstMsg[201]+"</th>";strHTML+="<th>"+lstMsg[202]+"</th>";strHTML+="<th>"+lstMsg[203]+"</th>";strHTML+="<th>"+lstMsg[204]+"</th>";strHTML+="<th>"+lstMsg[205]+"</th>";strHTML+="<th>"+lstMsg[206]+"</th>";strHTML+="<th>"+lstMsg[258]+"</th>";strHTML+="</tr>";var dblSaldo=0;for(i=0;i<lstCte.length;i++){var obj=lstCte[i];var dblCargo=obj.getAttribute("cargos");var dblAbono=obj.getAttribute("abonos");if(parseFloat(obj.getAttribute("paridad"))!=1){if(intIdMoneda==1){dblCargo=parseFloat(dblCargo)*parseFloat(obj.getAttribute("paridad"));dblAbono=parseFloat(dblAbono)*parseFloat(obj.getAttribute("paridad"));}else{dblCargo=parseFloat(dblCargo)/parseFloat(obj.getAttribute("paridad"));dblAbono=parseFloat(dblAbono)/parseFloat(obj.getAttribute("paridad"));}}dblSaldo+=parseFloat(dblCargo)-parseFloat(dblAbono);strHTML+="<tr>";if(parseFloat(dblAbono)>0){strHTML+="<td><a href='javascript:ImprimirEdoCtaCobro("+obj.getAttribute("id")+","+obj.getAttribute("id_Masivo")+')\'><img border="0" src="images/ptovta/printer_64.png"></a></td>';}else{strHTML+="<td><a href='javascript:ImprimirEdoCtaFact("+obj.getAttribute("id_Fac")+')\'><img border="0" src="images/ptovta/printer_64.png"></a></td>';}strHTML+="<td>"+obj.getAttribute("fecha")+"</td>";if(obj.getAttribute("nc_folio")!="null"){strHTML+="<td>"+obj.getAttribute("nc_folio")+"</td>";}else{if(obj.getAttribute("mc_folio")!=""){strHTML+="<td>"+obj.getAttribute("mc_folio")+"</td>";}else{strHTML+="<td>"+obj.getAttribute("folio")+"</td>";}}strHTML+="<td>"+obj.getAttribute("concepto")+"</td>";strHTML+="<td align='right'>"+FormatNumber(dblCargo,2,true,false,true,false)+"</td>";strHTML+="<td align='right'>"+FormatNumber(dblAbono,2,true,false,true,false)+"</td>";strHTML+="<td align='right'>"+FormatNumber(dblSaldo,2,true,false,true,false)+"</td>";strHTML+="<td align='right'>"+obj.getAttribute("paridad")+"</td>";strHTML+="<td align='right'>"+obj.getAttribute("banco")+"</td>";strHTML+="</tr>";}strHTML+="</table border=0>";document.getElementById("dialog2_inside").innerHTML=strHTML;$("#dialogWait").dialog("close");$("#dialog2").dialog("option","title",lstMsg[207]+" "+lstRowAct.DET_FOLIO);$("#dialog2").dialog("open");},error:function(objeto,quepaso,otroobj){alert("edo_cta4:"+objeto+" "+quepaso+" "+otroobj);}});}else{var strHTML="<table border=0>";strHTML+="<tr>";strHTML+="<th>&nbsp;</th>";strHTML+="<th>"+lstMsg[200]+"</th>";strHTML+="<th>"+lstMsg[201]+"</th>";strHTML+="<th>"+lstMsg[202]+"</th>";strHTML+="<th>"+lstMsg[204]+"</th>";strHTML+="<th>"+lstMsg[205]+"</th>";strHTML+="<th>"+lstMsg[258]+"</th>";strHTML+="</tr>";strHTML+="<tr>";strHTML+="<td><a href='javascript:ImprimirEdoCtaCobro("+lstRowAct.DET_ID+","+lstRowAct.DET_MAS+')\'><img border="0" src="images/ptovta/printer_64.png"></a></td>';strHTML+="<td>"+lstRowAct.DET_FECHA+"</td>";strHTML+="<td>"+lstRowAct.DET_FOLIO+"</td>";strHTML+="<td>"+lstRowAct.DET_TIPO+"</td>";strHTML+="<td align='right'>"+FormatNumber(lstRowAct.DET_ABONOS,2,true,false,true,false)+"</td>";strHTML+="<td align='right'>"+FormatNumber(lstRowAct.DET_SALDO,2,true,false,true,false)+"</td>";strHTML+="<td align='right'>"+lstRowAct.DET_BANCO+"</td>";strHTML+="</tr>";strHTML+="</table border=0>";document.getElementById("dialog2_inside").innerHTML=strHTML;$("#dialogWait").dialog("close");$("#dialog2").dialog("option","title",lstMsg[259]+" "+lstRowAct.DET_FOLIO);$("#dialog2").dialog("open");}}}function ImprimirEdoCtaCte(){var intIdCliente=document.getElementById("ED_CLIENTE").value;var strPeriodo=document.getElementById("ED_PERIODO").value;var intIdMoneda=document.getElementById("ED_MONEDA").value;var iConSaldo=0;if(document.getElementById("ED_CON_SALDO").checked){iConSaldo=1;}strPeriodo=strPeriodo.replace("/","");var month=parseInt(strPeriodo.substring(4,6));var d=new Date(strPeriodo.substring(0,4),month,0);var curr_date=d.getDate();Abrir_Link("ERP_EdoCta.jsp?id=6"+"&boton_1=PDF&Cliente="+intIdCliente+"&Periodo="+strPeriodo+"&Moneda="+intIdMoneda+"&EMP_ID="+intEMP_ID+"&iConSaldo="+iConSaldo,"_reporte",500,600,0,0);}function ImprimirEdoCtaCobro(intMcId,intMcmId){if(parseInt(intMcmId)!=0){openFormat("COBROSMAS","PDF",CreaHidden("MCM_ID",intMcmId));}else{openFormat("COBROS","PDF",CreaHidden("MC_ID",intMcId));}}function ImprimirEdoCtaFact(intIdFact){var strHtml=CreaHidden("FAC_ID",intIdFact);openWhereverFormat("ERP_SendInvoice?id="+intIdFact,"FACTURA","PDF",strHtml);}